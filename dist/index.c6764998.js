(function(){"use strict";var e="function"==typeof Object.defineProperties?Object.defineProperty:function(e,n,t){e!=Array.prototype&&e!=Object.prototype&&(e[n]=t.value)},n="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function t(){t=function(){},n.Symbol||(n.Symbol=a)}var r,a=(r=0,function(e){return"jscomp_symbol_"+(e||"")+r++});function i(){t();var r=n.Symbol.iterator;r||(r=n.Symbol.iterator=n.Symbol("iterator")),"function"!=typeof Array.prototype[r]&&e(Array.prototype,r,{configurable:!0,writable:!0,value:function(){return function(e){var t=0;return function(e){return i(),e={next:e},e[n.Symbol.iterator]=function(){return this},e}((function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}))}(this)}}),i=function(){}}function o(t,r){if(r){var a=n;t=t.split(".");for(var i=0;i<t.length-1;i++){var o=t[i];o in a||(a[o]={}),a=a[o]}(r=r(i=a[t=t[t.length-1]]))!=i&&null!=r&&e(a,t,{configurable:!0,writable:!0,value:r})}}o("Array.from",(function(e){return e||function(e,n,t){i(),n=null!=n?n:function(e){return e};var r=[],a=e[Symbol.iterator];if("function"==typeof a)for(e=a.call(e);!(a=e.next()).done;)r.push(n.call(t,a.value));else{a=e.length;for(var o=0;o<a;o++)r.push(n.call(t,e[o]))}return r}})),o("Array.prototype.keys",(function(e){return e||function(){return function(e,n){i(),e instanceof String&&(e+="");var t=0,r={next:function(){if(t<e.length){var a=t++;return{value:n(a,e[a]),done:!1}}return r.next=function(){return{done:!0,value:void 0}},r.next()}};return r[Symbol.iterator]=function(){return r},r}(this,(function(e){return e}))}})),o("Array.prototype.fill",(function(e){return e||function(e,n,t){var r=this.length||0;for(0>n&&(n=Math.max(0,r+n)),(null==t||t>r)&&(t=r),0>(t=Number(t))&&(t=Math.max(0,r+t)),n=Number(n||0);n<t;n++)this[n]=e;return this}}));var c,u,l,s,f,p,v,m={addc:"vec2 addc(vec2 a,vec2 b){\nreturn a+b;\n}\n",addpoints:"vec2 addpoints(vec3 a,vec3 b){\nreturn dehomogenize(a) +dehomogenize(b);\n}\n",arccosc:"vec2 arccosc(vec2 a){\nvec2 t2=multc(a,negc(a));\nvec2 tmp=sqrtc(addc(vec2(1.0,0.0),t2));\nvec2 tmp1=addc(multc(a,vec2(0.0,1.0)),tmp);\nvec2 erg=addc(multc(logc(tmp1),vec2(0.0,1.0)),vec2(pi*0.5,0.0));\nreturn erg;\n}\n",arccosf:"vec2 arccosf(float z){\nif(abs(z)<=1.)return vec2(acos(z),0.);\nelse if(z>1.)return vec2(0,log(z+sqrt(z*z-1.)));\nelse return vec2(pi, -log(-z+sqrt(z*z-1.)));\n}\n",arcsinc:"vec2 arcsinc(vec2 a){\nvec2 t2=multc(a,negc(a));\nvec2 tmp=sqrtc(addc(vec2(1.0,0.0),t2));\nvec2 tmp1=addc(multc(a,vec2(0.0,1.0)),tmp);\nvec2 erg=multc(logc(tmp1),vec2(0.0,-1.0));\nreturn erg;\n}\n",arcsinf:"vec2 arcsinf(float z){\nif(abs(z)<=1.)return vec2(asin(z),0.);\nelse if(z>1.)return vec2(pi*.5, -log(z+sqrt(z*z-1.)));\nelse return vec2(-pi*.5,log(-z+sqrt(z*z-1.)));\n}\n",arctan2c:"\n\n\n\nvec2 arctan2c(vec2 x,vec2 y){\nvec2 r=logc(divc(x+vec2(-y.y,y.x),sqrtc(multc(x,x)+multc(y,y))));\nreturn vec2(r.y, -r.x);\n}\n",arctan2cvec2:"vec2 arctan2cvec2(cvec2 v){\nreturn arctan2c(v.real,v.imag);\n}\n",arctan2vec2:"float arctan2vec2(vec2 v){\nreturn atan(v.y,v.x);\n}\n",arctanc:"vec2 arctanc(vec2 a){\nvec2 t1=logc(addc(multc(a,vec2(0.0,-1.0)),vec2(1.0,0.0)));\nvec2 t2=logc(addc(multc(a,vec2(0.0,1.0)),vec2(1.0,0.0)));\nvec2 erg=multc(subc(t1,t2),vec2(0.0,0.5));\nreturn erg;\n}\n",blue:"vec3 blue(float f)\n{\nreturn vec3(0.,0.,clamp(f,0.,1.));\n}\n",cimag:"float imagc(vec2 a){\nreturn a.y;\n}\n",conjugate:"vec2 conjugate(vec2 a){\nreturn vec2(a.x, -a.y);\n}\n",copytexture_f:"#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D sampler;\nvarying vec2 cgl_pixel;\n\nvoid main(void){\ngl_FragColor=texture2D(sampler,cgl_pixel);\n}\n",copytexture_v:"attribute vec3 aPos;\nattribute vec2 aTexCoord;\nvarying vec2 cgl_pixel;\n\nvoid main(void){\ngl_Position=vec4(aPos,1.);\ncgl_pixel=aTexCoord;\n}\n",cosc:"vec2 cosc(vec2 a){\n\nfloat n=exp(a.y);\nfloat imag1=n*sin(-a.x);\nfloat real1=n*cos(-a.x);\nn=exp(-a.y);\nfloat imag2=n*sin(a.x);\nfloat real2=n*cos(a.x);\nfloat i= (imag1+imag2) /2.0;\nfloat r= (real1+real2) /2.0;\n\nreturn vec2(r,i);\n}\n",creal:"float realc(vec2 a){\nreturn a.x;\n}\n",dehomogenize:"vec2 dehomogenize(vec3 z){\nreturn vec2(z.x,z.y)/z.z;\n}\n",dehomogenizex:"float dehomogenizex(vec3 z){\nreturn z.x/z.z;\n}\n",dehomogenizey:"float dehomogenizey(vec3 z){\nreturn z.y/z.z;\n}\n",det2:"float det2(mat2 a){\nreturn a[0][0]*a[1][1] -a[0][1]*a[1][0];\n}\n",det3:"float det3(mat3 a){\nreturn dot(cross(a[0],a[1]),a[2]);\n}\n",det3v:"float det3v(vec3 a,vec3 b,vec3 c){\nreturn dot(cross(a,b),c);\n}\n",det4:"float det4(mat4 a){\nfloat s00=a[0][0]*a[1][1] -a[0][1]*a[1][0],\ns01=a[0][0]*a[1][2] -a[0][2]*a[1][0],\ns02=a[0][0]*a[1][3] -a[0][3]*a[1][0],\ns03=a[0][1]*a[1][2] -a[0][2]*a[1][1],\ns04=a[0][1]*a[1][3] -a[0][3]*a[1][1],\ns05=a[0][2]*a[1][3] -a[0][3]*a[1][2],\ns06=a[2][0]*a[3][1] -a[2][1]*a[3][0],\ns07=a[2][0]*a[3][2] -a[2][2]*a[3][0],\ns08=a[2][0]*a[3][3] -a[2][3]*a[3][0],\ns09=a[2][1]*a[3][2] -a[2][2]*a[3][1],\ns10=a[2][1]*a[3][3] -a[2][3]*a[3][1],\ns11=a[2][2]*a[3][3] -a[2][3]*a[3][2];\nreturn s00*s11-s01*s10+s02*s09+s03*s08-s04*s07+s05*s06;\n}\n",divc:"vec2 divc(vec2 a,vec2 b){\nreturn vec2(dot(a,b),dot(a,vec2(-b.y,b.x)))/dot(b,b);\n}\n",divfc:"vec2 divfc(float a,vec2 b){\nreturn a*vec2(b.x,-b.y)/dot(b,b);\n}\n",expc:"vec2 expc(vec2 a){\nfloat n=exp(a.x);\nfloat r=n*cos(a.y);\nfloat i=n*sin(a.y);\nreturn vec2(r,i);\n}\n",float2color:"vec4 float2color(float f)\n{\nreturn vec4(f,f,f,1.);\n}\n",gray:"vec3 gray(float f)\n{\nf=clamp(f,0.,1.);\nreturn vec3(f,f,f);\n}\n",green:"vec3 green(float f)\n{\nreturn vec3(0.,clamp(f,0.,1.),0.);\n}\n",hsv2rgb:"vec3 hsv2rgb(vec3 c)\n{\nvec4 K=vec4(1.0,2.0/3.0,1.0/3.0,3.0);\nvec3 p=abs(fract(c.xxx+K.xyz) *6.0-K.www);\nreturn c.z*mix(K.xxx,clamp(p-K.xxx,0.0,1.0),c.y);\n}\n",hue:"vec3 hue(float a){\nreturn hsv2rgb(vec3(a,1.,1.));\n}\n",imagc:"float imagc(vec2 a){\nreturn a.y;\n}\n",invc:"vec2 invc(vec2 a){\nfloat n=a.x*a.x+a.y*a.y;\nreturn vec2(a.x/n,-a.y/n);\n}\n",logc:"vec2 logc(vec2 a){\nfloat re=a.x;\nfloat im=a.y;\nfloat s=sqrt(re*re+im*im);\nfloat i=im;\nfloat imag=atan(im,re);\nif(i<0.0){\nimag+= (2.0*pi);\n}\nif(i==0.0&&re<0.0){\nimag=pi;\n}\nif(imag>pi){\nimag-= (2.0*pi);\n};\nfloat real=log(s);\n\nreturn vec2(real,imag);\n}\n",logr:"vec2 logr(float a){\nif(a>=0.)return vec2(log(a),0);\nelse return vec2(log(-a),pi);\n}\n",mat2complex:"mat4 mat2complex(mat2 a)\n{\nreturn mat4(\nvec4(a[0][0],0,a[0][1],0),\nvec4(0,a[0][0],0,a[0][1]),\nvec4(a[1][0],0,a[1][1],0),\nvec4(0,a[1][0],0,a[1][1])\n);\n}\n",multc:"vec2 multc(vec2 a,vec2 b){\nreturn vec2(dot(a,vec2(b.x,-b.y)),dot(a,b.yx));\n}\n",negc:"vec2 negc(vec2 a){\nreturn vec2(-a.x,-a.y);\n}\n",powc:"vec2 powc(vec2 a,vec2 b){\nreturn(b.x==0. &&b.y==0.) ?vec2(1.,0.) : ((a.x==0. &&a.y==0.) ?vec2(0.) :expc(multc(logc(a),b)));\n}\n",powi:"float powi(float a,int b){\nif(mod(float(b),2.) < .5)\nreturn pow(abs(a),float(b));\nelse\nreturn sign(a)*pow(abs(a),float(b));\n}\n",random:"uniform float rnd_;\n\nfloat last_rnd= .1231;\nfloat random(){\nfloat a=fract(132422.21*sin(dot(plain_pixel,343433.671228*vec2(.176574+last_rnd, .1131+rnd_))));\nfloat b=fract(last_rnd*2321.2312*sin(dot(plain_pixel+vec2(rnd_,last_rnd),plain_pixel) *43758.5453));\nlast_rnd=fract(rnd_ +last_rnd+a+b);\nreturn last_rnd;\n}\n",randomnormal:"float randomnormal(){\nreturn sqrt(-2. *log(random())) *cos(6.283185307179586*random());\n}\n",realc:"float realc(vec2 a){\nreturn a.x;\n}\n",red:"vec3 red(float f)\n{\nreturn vec3(clamp(f,0.,1.),0.,0.);\n}\n",rgb2hsv:"vec3 rgb2hsv(vec3 c)\n{\nvec4 K=vec4(0.0, -1.0/3.0,2.0/3.0, -1.0);\nvec4 p=mix(vec4(c.bg,K.wz),vec4(c.gb,K.xy),step(c.b,c.g));\nvec4 q=mix(vec4(p.xyw,c.r),vec4(c.r,p.yzx),step(p.x,c.r));\n\nfloat d=q.x-min(q.w,q.y);\nfloat e=1.0e-10;\nreturn vec3(abs(q.z+ (q.w-q.y) / (6.0*d+e)),d/ (q.x+e),q.x);\n}\n",sinc:"\n\nvec2 sinc(vec2 a){\n\nfloat n=exp(a.y);\nfloat imag1=n*sin(-a.x);\nfloat real1=n*cos(-a.x);\nn=exp(-a.y);\nfloat imag2=n*sin(a.x);\nfloat real2=n*cos(a.x);\nfloat r= -(imag1-imag2) /2.0;\nfloat i= (real1-real2) /2.0;\n\nreturn vec2(r,i);\n}\n",sqrtc:"vec2 sqrtc(vec2 a){\nreturn expc(multc(logc(a),vec2(0.5,0.0)));\n}\n",sqrtf:"vec2 sqrtf(float a){\nif(a>=0.)return vec2(sqrt(a),0.);\nelse return vec2(0.,sqrt(-a));\n}\n",standardFragmentHeader:"#ifdef GL_ES\nprecision highp float;\nprecision highp int;\n#endif\n\n#define pi 3.141592653589793\n\nvarying vec2 cgl_pixel;\nvarying vec2 plain_pixel;\n",subc:"vec2 subc(vec2 a,vec2 b){\nreturn a-b;\n}\n",subpoints:"vec2 subpoints(vec3 a,vec3 b){\nreturn dehomogenize(a) -dehomogenize(b);\n}\n",tanc:"vec2 tanc(vec2 a){\nvec2 s=sinc(a);\nvec2 c=cosc(a);\nreturn divc(s,c);\n}\n",vec2complex:"vec4 vec2complex(vec2 a)\n{\nreturn vec4(a.x,0.,a.y,0);\n}\n",vshader:"attribute vec3 aPos;\nattribute vec2 aTexCoord;\nvarying vec2 cgl_pixel;\nvarying vec2 plain_pixel;\nuniform mat3 transformMatrix;\nvoid main(void){\ngl_Position=vec4(aPos,1.);\nplain_pixel=aTexCoord;\nvec3 r=transformMatrix*vec3(plain_pixel,1);\ncgl_pixel=r.xy/r.z;\n}\n"},g=!1,d=!1,h=!1,y=!1,b=1;function x(){function e(t){c.removeEventListener("webglcontextcreationerror",e,!1),t.statusMessage&&(n=t.statusMessage)}if(!g){(c=document.createElement("canvas")).id="glcanvas",c.style.display="none",c.width=c.height=0,document.body.appendChild(c),(u=document.createElement("canvas")).id="tmpcanvas",u.style.display="none",u.width=u.height=0,document.body.appendChild(u),(l=document.createElement("canvas")).id="dummycanvas",l.style.display="none",l.width=l.height=1,document.body.appendChild(l),s={ctype:"image",value:{img:l,width:1,height:1,ready:!0,live:!1,generation:0,whenReady:function(){}}};var n="Unknown";c.addEventListener("webglcontextcreationerror",e,!1);var t={};if(void 0!==CindyJS._pluginRegistry.CindyXR&&(t.xrCompatible=!0),(f=c.getContext("webgl",t))||(f=c.getContext("experimental-webgl",t)),!f)throw new fn("Could not obtain a WebGL context.\nReason: "+n);K.gl=f,c.removeEventListener("webglcontextcreationerror",e,!1),y||((h=f.getExtension("OES_texture_float")&&f.getExtension("OES_texture_float_linear"))||(console.error("Your browser does not suppert OES_texture_float, trying OES_texture_half_float..."),(d=(v=f.getExtension("OES_texture_half_float"))&&f.getExtension("OES_texture_half_float_linear"))||console.error("Your browser does not suppert OES_texture_half_float, will use 8-bit textures.")),navigator.userAgent.match(/(iPad|iPhone)/i)&&(console.log("You are using an iPhone/iPad."),h=d=!1,f.getExtension("OES_texture_half_float")&&f.getExtension("OES_texture_half_float_linear")&&f.getExtension("EXT_color_buffer_half_float")?d=!0:console.error("Your browser does not suppert writing to half_float textures, we will use 8-bit textures."))),g=!0}}function _(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Array){for(var n=[],t=0,r=e.length;t<r;t++)n[t]=_(e[t]);return n}if(e instanceof Object){for(t in n={},e)e.hasOwnProperty(t)&&(0<="oper impl args ctype stack name arglist value real imag key obj body".split(" ").indexOf(t)&&(n[t]=_(e[t])),e.modifs&&(n.modifs=e.modifs));return n}}function A(e,n){if(null==e||"object"!=typeof e)return e===n;if(e instanceof Array&&n instanceof Array){if(e.length!=n.length)return!1;for(var t=0,r=e.length;t<r;t++)if(!A(e[t],n[t]))return!1;return!0}if(e instanceof Object&&n instanceof Object){for(t="oper impl args ctype stack name modifs arglist value real imag key obj body".split(" "),r=0;r<t.length;r++){var a=t[r];if(!A(e[a],n[a]))return!1}return!0}return!1}function w(e){return-1===e.indexOf("$")?e:e.substr(0,e.indexOf("$"))}function E(e){if("boolean"===e.ctype)return W.A;if("number"===e.ctype)return e=e.value,1e-5>Math.abs(e.imag)?(0|e.real)===e.real?W.u:W.f:W.h;if("list"===e.ctype){var n=e.value;if(3===n.length){if("Point"===e.usage)return W.w;if("Line"===e.usage)return W.line}if(0<n.length){for(var t=E(n[0]),r=1;r<n.length;r++)t=pe(t,E(n[r]));if(t)return{type:"list",length:n.length,parameters:t}}}else{if("string"===e.ctype||"image"===e.ctype)return W.image;if("geo"===e.ctype&&"L"===e.value.kind)return W.line}return console.error("Cannot guess type of the following type:"),console.log(e),!1}var T=0;function R(){return"_h"+ ++T}function j(e,n){(e>c.width||n>c.height)&&(c.width=Math.ceil(e),c.height=Math.ceil(n))}function F(e,n){return e.instance.ha||(e.instance.ha={}),e.instance.ha[n]||(e.instance.ha[n]=e.instance.parse(n)),(e=e.evaluate(e.instance.ha[n])).ctype&&"number"===e.ctype?e.value.real:0}function P(e){return{x:F(e,"(screenbounds()_4).x"),y:F(e,"(screenbounds()_4).y")}}function O(e){return{x:F(e,"(screenbounds()_3).x"),y:F(e,"(screenbounds()_3).y")}}var L=new Float32Array(1),I=new Int32Array(L.buffer);function C(e){L[0]=e;var n=(e=I[0])>>16&32768,t=4096+(2147483647&e);return 1199570944<=t?1199570944<=(2147483647&e)?2139095040>t?31744|n:31744|n|(8388607&e)>>13:31743|n:947912704<=t?n|t-939524096>>13:855638016>t?n:n|(8388607&e|8388608)+(8388608>>>(t=(2147483647&e)>>23)-102)>>126-t}function M(e){return h?new Float32Array(e):d?new Uint16Array(e):new Uint8Array(e)}function D(){return h?f.FLOAT:d?v.HALF_FLOAT_OES:f.UNSIGNED_BYTE}function S(e){for(var n=[],t=0;t<e.length;t++)if(h)n.push(e[t]);else if(d){var r=e[t],a=(31744&r)>>10,i=1023&r;n.push((r>>15?-1:1)*(a?31===a?i?NaN:1/0:Math.pow(2,a-15)*(1+i/1024):i/1024*6103515625e-14))}else n.push(e[t]/255);return n}function U(e){for(var n=1;n<e;)n<<=1;return n}function N(e,n,t){if(e.canvaswrapper){if(!e.ready||e.canvaswrapper.canvas!=s&&e.canvaswrapper.L==e.width&&e.canvaswrapper.G==e.height||(delete e.canvaswrapper,e.canvaswrapper=N(e,n,t)),t){var r=(n=e.canvaswrapper).j;if(t&&(t.repeat!=r.repeat||t.clamptoedge!=r.clamptoedge||t.mipmap!=r.mipmap||t.interpolate!=r.interpolate))for(n.j=t,r=0;2>r;r++)f.bindTexture(f.TEXTURE_2D,n.textures[r]),t.mipmap?f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,t.interpolate?f.LINEAR_MIPMAP_LINEAR:f.NEAREST_MIPMAP_LINEAR):f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,t.interpolate?f.LINEAR:f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t.interpolate?f.LINEAR:f.NEAREST),t.clamptoedge&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE))}}else e.canvaswrapper=new B(e.ready?e:s,t||{interpolate:!0,mipmap:!1,repeat:!1,clamptoedge:!1}),e.ready||console.log("Image is not ready yet.");return e.canvaswrapper}function B(e,n){this.canvas=e,this.j=n,this.L=e.width,this.G=e.height,z(this),this.it=0,this.textures=[],this.X=[],this.generation=-1,this.bindTexture(),e.drawTo=this.drawTo.bind(this),e.readPixels=this.la.bind(this),e.cdyUpdate=this.pa.bind(this),e=M(this.P*this.M*4);for(var t=0;2>t;t++)this.textures[t]=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.textures[t]),f.pixelStorei(f.UNPACK_ALIGNMENT,1),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,this.P,this.M,0,f.RGBA,D(),e),n.mipmap?f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,n.interpolate?f.LINEAR_MIPMAP_LINEAR:f.NEAREST_MIPMAP_LINEAR):f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,n.interpolate?f.LINEAR:f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n.interpolate?f.LINEAR:f.NEAREST),n.clamptoedge&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE)),this.X[t]=f.createFramebuffer(),f.bindFramebuffer(f.FRAMEBUFFER,this.X[t]),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.textures[t],0);this.B=new pn(m.copytexture_v,m.copytexture_f),n=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,n),n=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]),e=f.getAttribLocation(this.B.handle,"aPos"),f.enableVertexAttribArray(e),t=f.getAttribLocation(this.B.handle,"aTexCoord"),f.enableVertexAttribArray(t);var r=new Float32Array([0,0,1,0,0,1,1,1]),a=n.byteLength;f.bufferData(f.ARRAY_BUFFER,a+r.byteLength,f.STATIC_DRAW),f.bufferSubData(f.ARRAY_BUFFER,0,n),f.bufferSubData(f.ARRAY_BUFFER,a,r),f.vertexAttribPointer(e,3,f.FLOAT,!1,0,0),f.vertexAttribPointer(t,2,f.FLOAT,!1,0,a)}function z(e){e.j.clamptoedge&&e.j.interpolate&&!e.j.repeat&&!e.j.mipmap?(e.P=e.L,e.M=e.G):(e.P=U(e.L+e.L/2*(e.j.mipmap&&e.j.repeat)),e.M=U(e.G+e.G/2*(e.j.mipmap&&e.j.repeat)))}function $(e,n){this.C=e,this.X=n,G(this)}function G(e){var n=rn(new Ye(e.C),e.X);e.B=n.D,e.N=n.N,e.ea=n.ea,e.fa=m.standardFragmentHeader+n.code,e.la=m.vshader,e.j=new pn(e.la,e.fa),n=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,n),n=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);var t=f.getAttribLocation(e.j.handle,"aPos");f.enableVertexAttribArray(t),e=f.getAttribLocation(e.j.handle,"aTexCoord"),f.enableVertexAttribArray(e);var r=new Float32Array([0,0,1,0,0,1,1,1]),a=n.byteLength;f.bufferData(f.ARRAY_BUFFER,a+r.byteLength,f.STATIC_DRAW),f.bufferSubData(f.ARRAY_BUFFER,0,n),f.bufferSubData(f.ARRAY_BUFFER,a,r),f.vertexAttribPointer(t,3,f.FLOAT,!1,0,0),f.vertexAttribPointer(e,2,f.FLOAT,!1,0,a)}function V(e,n,t,r){n=[t.x-n.x,r.x-n.x,n.x,t.y-n.y,r.y-n.y,n.y,0,0,1],e.j.uniform.hasOwnProperty("transformMatrix")&&e.j.uniform.transformMatrix([n[0],n[3],n[6],n[1],n[4],n[7],n[2],n[5],n[8]])}function X(e){function n(e,t,r){if(e)if("function"==typeof e)switch(t){case W.h:e([r.value.real,r.value.imag]);break;case W.A:r.value?e([1]):e([0]);break;case W.u:case W.f:e([r.value.real]);break;case W.w:case W.line:"geo"===r.ctype?e(r.value.homog.value.map((function(e){return e.value.real}))):"list"===r.ctype&&2===r.value.length?e(r.value.map((function(e){return e.value.real})).concat([1])):"list"===r.ctype&&3===r.value.length&&e(r.value.map((function(e){return e.value.real})));break;default:if("list"===t.type&&t.parameters===W.f)e(r.value.map((function(e){return e.value.real})));else if("list"===t.type&&"list"===t.parameters.type&&t.parameters.parameters===W.f){for(var a=[],i=0;i<t.length;i++)for(var o=0;o<t.parameters.length;o++)a.push(r.value[i].value[o].value.real);e(a)}else console.error("Don't know how to set uniform of type "+Z(t)+", to "+r)}else if("list"===t.type)if(i=ae(t),1===re(t)&&i===W.f){t=_e(t.length);var c=0;for(a in t)n(e["a"+a],W.aa(t[a]),{ctype:"list",value:xe(t[a]).map((function(e){return r.value[c+e]}))}),c+=t[a]}else for(a=0;a<t.length;a++)n(e["a"+a],t.parameters,{ctype:"list",value:r.value[a].value});else console.error("Don't know how to set uniform of type "+Z(t)+", to"),console.log(r)}for(var t in e.B){var r=e.C.evaluateAndVal(e.B[t].U),a=e.B[t].type;if(!fe(J(r),a))return console.log("Type of "+t+" changed ("+Z(J(r))+" is no subtype of  "+Z(a)+"); forcing rebuild."),G(e),e.j.use(f),void X(e);e.j.uniform[t]&&n(e.j.uniform[t],a,r)}[["rnd_",function(){return[Math.random()]}],["_lowerleft",function(){var n=P(e.C);return[n.x,n.y]}],["_lowerright",function(){var n=O(e.C);return[n.x,n.y]}]].map((function(n){return e.j.uniform[n[0]]&&e.j.uniform[n[0]](n[1]())}))}function k(e){var n,t=0;for(n in e.N){f.activeTexture(f.TEXTURE0+t);var r=e.N[n],a=r.name;(r=cn(r)).reloadIfRequired(),r.bindTexture(),[["_sampler"+a,[t]],["_ratio"+a,[r.L/r.G]],["_cropfact"+a,[r.L/r.P,r.G/r.M]]].map((function(n){return e.j.uniform[n[0]]&&e.j.uniform[n[0]](n[1])})),t++}}function q(e){for(var n in e.ea)if(e.C.getMyfunction(n).generation>e.ea[n])return console.log(n+" is outdated; forcing rebuild."),!1;return!0}function K(e){function n(n,t,r,a,i,o){(!n.ka||n.ja<b)&&(n.ka=!0,n.ja=b,n.ma=new $(e,n)),q(n=n.ma)||G(n);var u=i/a;u={x:t.x+-(r.y-t.y)*u,y:t.y+(r.x-t.x)*u},j(a,i),o?f.viewport(0,0,a,i):f.viewport(0,c.height-i,a,i),n.j.use(f),X(n),V(n,t,r,u),k(n),o?(o.bindFramebuffer(),o.generation=++o.canvas.generation):f.bindFramebuffer(f.FRAMEBUFFER,null),f.drawArrays(f.TRIANGLE_STRIP,0,4),f.flush(),o&&(o.generation=Math.max(o.generation,o.canvas.generation+1))}p=e.nada,e.defineFunction("compile",1,(function(n){return n=rn(new Ye(e),n[0]),console.log(n),{ctype:"string",value:n}})),e.defineFunction("use8bittextures",0,(function(){return y=!0,h=d=!1,console.log("Switching to 8-bit textures mode."),e.nada})),e.defineFunction("forcerecompile",0,(function(){return b++,p})),e.defineFunction("colorplot",1,(function(t){x();var r=e.instance.canvas.width,a=e.instance.canvas.height;return n(t[0],P(e),O(e),r,a,null),(t=e.instance.canvas.getContext("2d")).save(),t.setTransform(1,0,0,1,0,0),t.drawImage(c,0,0,r,a,0,0,r,a),t.restore(),p})),e.defineFunction("colorplot",3,(function(t){x();var r=t[0],a=e.extractPoint(e.evaluateAndVal(t[1])),i=e.extractPoint(e.evaluateAndVal(t[2])),o={x:Math.min(a.x,i.x),y:Math.min(a.y,i.y)},u={x:Math.max(a.x,i.x),y:Math.min(a.y,i.y)},l=Math.min(a.x,i.x),s=Math.max(a.y,i.y);t=e.instance.canvas.width;var f=e.instance.canvas.height,v=F(e,"(screenbounds()_1).x"),m=F(e,"(screenbounds()_1).y"),g=O(e),d=Math.abs((a.x-i.x)/(g.x-v));return n(r,o,u,t*d,f*(a=Math.abs((a.y-i.y)/(g.y-m))),null),r=e.instance.canvas.getContext("2d"),e.getInitialMatrix(),v=t*(l-v)/(g.x-v),m=f*(s-m)/(g.y-m),r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(c,0,0,t*d,f*a,v,m,t*d,f*a),r.restore(),p})),e.defineFunction("colorplot",4,(function(t){x();var r=e.extractPoint(e.evaluateAndVal(t[0])),a=e.extractPoint(e.evaluateAndVal(t[1])),i=e.evaluateAndVal(t[2]);if(t=t[3],!r.ok||!a.ok||"string"!==i.ctype)return p;var o=N(i=e.getImage(i.value,!0),e,!1);return n(t,r,a,i.width,i.height,o),p})),e.defineFunction("colorplot",2,(function(t){x();var r=P(e),a=O(e),i=e.evaluateAndVal(t[0]);if(t=t[1],"string"!==i.ctype)return p;var o=N(i=e.getImage(i.value,!0),e,!1);return n(t,r,a,i.width,i.height,o),p})),e.defineFunction("setpixel",4,(function(n){var t=e.evaluateAndVal(n[0]),r=void 0===r?null:r;if("string"===t.ctype)var a=t.value;else console.log("argument is not a string"),a=r;if(t=ln(e.evaluateAndVal(n[1])),r=ln(e.evaluateAndVal(n[2])),n=function(e){var n=void 0===n?[.5,.5,.5]:n;if("number"===e.ctype){var t=sn(e);if(!isNaN(t))return[t,t,t]}return e=function(e){var n=void 0===n?null:n;return"list"!==e.ctype?(console.log("argument is not a list"),n):e.value}(e),null===e?n:3!=e.length?(console.log("Not an RGB color vector"),n):e.map((function(e){return sn(e)}))}(e.evaluateAndVal(n[3])),!a)return p;var i=e.getImage(a,!0);return i=N(i,e,!1),isFinite(t)&&isFinite(r)&&a&&i&&n&&(i.bindTexture(),a=[n[0],n[1],n[2],1],f.texSubImage2D(f.TEXTURE_2D,0,t,r,1,1,f.RGBA,D(),function(e){if(h)return new Float32Array(e);if(d){for(var n=new Uint16Array(e.length),t=0;t<e.length;t++)n[t]=C(e[t]);return n}for(n=new Uint8Array(e.length),t=0;t<e.length;t++)n[t]=255*e[t];return n}(a)),n=i.canvas.img.getContext("2d"),(i=n.createImageData(1,1)).data.d=a,n.putImageData(i,t,r)),p})),e.defineFunction("colorplotxr",2,(function(n){x();var t=e.evaluate(n[0]).value.real;if((!(n=n[1]).ka||n.ja<b)&&(n.ka=!0,n.ja=b,n.ma=new $(e,n)),n=n.ma,0==t){f.clearColor(0,0,0,1),f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT);var r=f.getAttribLocation(n.j.handle,"aPos");f.enableVertexAttribArray(r);var a=f.getAttribLocation(n.j.handle,"aTexCoord");f.enableVertexAttribArray(a),f.vertexAttribPointer(r,3,f.FLOAT,!1,0,0),f.vertexAttribPointer(a,2,f.FLOAT,!1,0,48)}return q(n)||G(n),n.j.use(f),X(n),V(n,{x:-1,y:-1},{x:1,y:-1},{x:-1,y:1}),k(n),CindyJS._pluginRegistry.CindyXR.xrUpdateCindyGLView(f,t),f.drawArrays(f.TRIANGLE_STRIP,0,4),f.flush(),p}))}function H(e,n){return{type:"list",length:e,parameters:n}}function J(e){return{type:"constant",value:e}}function Y(e){return J({ctype:"number",value:{real:e,imag:0}})}B.prototype.bindTexture=function(){f.bindTexture(f.TEXTURE_2D,this.textures[this.it])},B.prototype.bindFramebuffer=function(){f.bindFramebuffer(f.FRAMEBUFFER,this.X[1^this.it]),this.it^=1},B.prototype.pa=function(){if(this.canvas.img.hasOwnProperty("getContext"))var e=this.canvas.img.getContext("2d");else this.canvas.img=document.createElement("canvas"),this.canvas.img.style.display="none",this.canvas.img.width=this.L,this.canvas.img.height=this.G,e=this.canvas.img.getContext("2d");e.clearRect(0,0,this.L,this.G),this.drawTo(e,0,0),this.canvas.img.generation++},B.prototype.reloadIfRequired=function(){if(!(this.canvas.live&&(this.canvas.img.webkitDecodedFrameCount||this.canvas.img.j)&&this.fa>=(this.canvas.img.webkitDecodedFrameCount||this.canvas.img.j)||!this.canvas.live&&(!this.canvas.ready||this.generation>=this.canvas.generation))){if(this.L!=this.canvas.width||this.G!=this.canvas.height){this.L=this.canvas.width,this.G=this.canvas.height,z(this);for(var e=M(this.P*this.M*4),n=0;2>n;n++)f.bindTexture(f.TEXTURE_2D,this.textures[n]),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,this.P,this.M,0,f.RGBA,D(),e)}this.bindTexture(),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,1),this.j.repeat?(u.width=this.P,u.height=this.M,(e=u.getContext("2d")).drawImage(this.canvas.img,0,this.M-this.G),e.drawImage(this.canvas.img,this.L,this.M-this.G),e.drawImage(this.canvas.img,0,this.M-2*this.G),e.drawImage(this.canvas.img,this.L,this.M-2*this.G),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,D(),u)):f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,D(),this.canvas.img),this.j.mipmap&&f.generateMipmap(f.TEXTURE_2D),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,0),this.generation=this.canvas.generation,this.fa=Math.min(this.fa+1,this.canvas.img.webkitDecodedFrameCount||this.canvas.img.j)}},B.prototype.drawTo=function(e,n,t){j(this.P,this.M),f.viewport(0,0,this.P,this.M),this.B.use(f),f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,this.textures[this.it]),this.B.uniform.sampler([0]),f.bindFramebuffer(f.FRAMEBUFFER,null),f.drawArrays(f.TRIANGLE_STRIP,0,4),f.flush(),e.drawImage(c,0,c.height-this.G,this.L,this.G,n,t,this.L,this.G)},B.prototype.la=function(e,n,t,r){f.bindFramebuffer(f.FRAMEBUFFER,this.X[this.it]),f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.textures[this.it],0);var a=M(t*r*4);for(f.readPixels(e,this.G-n-r,t,r,f.RGBA,D(),a),e=[],--r;0<=r;r--)e=e.concat(S(a.slice(r*t*4,(r+1)*t*4)));return e},K.gl=null,K.generateCanvasWrapperIfRequired=N,K.initGLIfRequired=x,CindyJS.registerPlugin(1,"CindyGL",K);var W={A:1,u:2,f:3,h:4,T:5,color:6,w:7,line:8,K:9,image:10,F:H(2,3),J:H(3,3),O:H(4,3),aa:function(e){return H(e,3)},da:function(e){return H(e,4)},Y:H(2,H(2,3)),Z:H(3,H(3,3)),$:H(4,H(4,3))};function Z(e){return 1<=e&&10>=e?"bool int float complex voidt color point line coordinate2d image".split(" ")[e-1]:"list"===e.type?Z(e.parameters)+"["+e.length+"]":"constant"===e.type?"const["+JSON.stringify(e.value.value)+"]":JSON.stringify(e)}function Q(e){return"list"===e.type&&Q(e.parameters)||fe(e,W.f)}function ee(e){return"list"===e.type&&ee(e.parameters)||fe(e,W.h)}function ne(e){return"constant"===e.type&&fe(e,W.u)}function te(e){return"constant"===e.type?E(e.value):e}function re(e){return"list"===e.type?re(e.parameters)+1:0}function ae(e){return void 0!==e.parameters?ae(e.parameters):e}function ie(e,n){return re(e)===re(n)&&(0===re(e)||e.length===n.length&&ie(e.parameters,n.parameters))}function oe(e){return fe(e,W.f)?W.f:fe(e,W.h)?W.h:{type:"list",length:e.length,parameters:oe(e.parameters)}}function ce(e){return fe(e,W.h)?W.h:{type:"list",length:e.length,parameters:ce(e.parameters)}}function ue(e){return"constant"===e.type&&ue(te(e))||e===W.A||e===W.u||e===W.f||e===W.h||e===W.w||e===W.line||"list"===e.type&&e.parameters===W.f&&1<=e.length&&4>=e.length||"list"===e.type&&"list"===e.parameters.type&&e.parameters.parameters===W.f&&e.length===e.parameters.length&&2<=e.length&&4>=e.length}function le(e){return-1!==[W.A,W.u,W.f,W.h].indexOf(e)}function se(e,n){return e===n||"constant"===e.type&&"constant"===n.type&&A(e.value,n.value)||"list"===e.type&&"list"===n.type&&e.length===n.length&&se(e.parameters,n.parameters)}function fe(e,n){return!!se(e,n)||!!e&&(le(e)&&le(n)?e<=n:"constant"!==n.type&&("constant"===e.type?fe(E(e.value),n):n===W.K?fe(e,W.h)||fe(e,W.F)||fe(e,W.w):n===W.w?fe(e,W.J)||fe(e,W.F):n===W.line?fe(e,W.J):n===W.color?fe(e,W.f)||"list"===e.type&&(3===e.length||4===e.length)&&fe(e.parameters,W.f):"list"===e.type&&"list"===n.type&&e.length===n.length&&fe(e.parameters,n.parameters)))}function pe(e,n){return e?!n||se(e,n)?e:("constant"===e.type&&(e=E(e.value)),"constant"===n.type&&(n=E(n.value)),le(e)&&le(n)?Math.max(e,n):!("list"!==e.type||"list"!==n.type||e.length!==n.length||!(n=pe(e.parameters,n.parameters)))&&{type:"list",length:e.length,parameters:n}):n}function ve(e){return function(n){var t,r={};for(t in e){var a=e[t];if(r.ca=a[0],n.length==r.ca.length&&n.every(function(e){return function(n,t){return fe(n,e.ca[t])}}(r)))return{o:r.ca,s:a[1],l:a[2]};r={ca:r.ca}}return!1}}function me(e){switch(e){case W.u:return ve([[[W.A],W.u,Ge("int")]]);case W.f:return ve([[[W.A],W.f,Ge("float")],[[W.u],W.f,Ge("float")]]);case W.h:return ve([[[W.f],W.h,function(e){return"vec2("+e+", 0.)"}]]);case W.color:return ve([[[W.f],W.color,be("float2color")],[[W.J],W.color,function(e){return"vec4("+e+",1.0)"}],[[W.O],W.color,Xe]]);case W.w:return ve([[[W.F],W.w,function(e){return"vec3("+e+",1.0)"}],[[W.J],W.w,Xe]]);case W.line:return ve([[[W.F],W.line,function(e){return"vec3("+e+",1.0)"}],[[W.J],W.line,Xe]]);case W.K:return ve([[[W.h],W.K,Xe],[[W.F],W.K,Xe],[[W.w],W.K,be("dehomogenize")]]);default:if("list"===e.type)return function(n){var t=n[0],r=me(e.parameters)([t.parameters]).l;return{o:n,s:e,l:function(n,a,i){return Ie(e)(xe(e.length).map((function(e){return r([Ce(t,e)([n],a,i)],a,i)})),a,i)}}}}return console.log("no inclusionfunction ->"+Z(e)+" implemented yet; using identity..."),function(n){return{o:n,s:e,l:Xe}}}function ge(e){switch(e=te(e)){case W.A:return"bool";case W.u:return"int";case W.f:return"float";case W.h:case W.K:return"vec2";case W.T:return"void";case W.color:return"vec4";case W.w:case W.line:return"vec3"}if("list"===e.type&&e.parameters===W.f)return 1==e.length?"float":"vec"+e.length;if("list"===e.type&&e.parameters===W.h)return"cvec"+e.length;if("list"===e.type&&"list"===e.parameters.type&&e.length===e.parameters.length&&e.parameters.parameters===W.f)switch(e.length){case 2:return"mat2";case 3:return"mat3";case 4:return"mat4"}if("list"===e.type)return"l"+e.length+"_"+ge(e.parameters);console.error("No WebGL implementation for type "+Z(e)+" found")}function de(e,n){switch(n){case W.A:return ge(n)+"("+e.value+")";case W.u:return""+(0|e.value.real);case W.f:return ge(n)+"("+e.value.real+")";case W.h:return ge(n)+"("+e.value.real+", "+e.value.imag+")";case W.color:return"vec4("+(e=e.value.real)+","+e+","+e+",1.)";default:console.error("Dont know how to paste values of Type "+Z(n)+" yet.")}}Object.freeze(W);var he={};function ye(e,n,t){if(!t.mark("includedfunctions",e)){for(var r in he[e])ye(he[e][r],n,t);t.add("includedfunctions",e,(function(){return m[e]}))}}function be(e){return function(n,t,r){return ye(e,t,r),Ge(e)(n)}}function xe(e){return Array.from(Array(e).keys())}function _e(e){return 4>=e?[e]:5==e?[2,3]:_e(e-4).concat([4])}function Ae(e){var n=ae(e),t=re(e);return 1==t&&n===W.f?_e(e.length).map((function(e,n){return{type:W.aa(e),name:"a"+n}})):1<=t?xe(e.length).map((function(n){return{type:e.parameters,name:"a"+n}})):[]}function we(e,n){if(!ue(e)){var t=ge(e);n.add("structs",t,(function(){return"struct "+t+" { "+Ae(e).map((function(e){return we(e.type,n)||ge(e.type)+" "+e.name+";"})).join("")+"};"}))}}function Ee(e,n,t){if(!(ue(e)&&1>=re(e))){var r=e.length,a="sum"+ge(e);t.add("functions",a,(function(){return ge(e.parameters)+" "+a+"("+ge(e)+" a){"+ge(e.parameters)+" res = "+Me(e.parameters,0)([],n,t)+";\n      "+xe(r).map((function(r){return"res = "+Fe(e.parameters)(["res",Ce(e,r)(["a",r],n,t)],n,t)+";"})).join("\n")+"\n        return res;\n    }"}))}}function Te(e){if(e===W.h)return be("multc");if(ue(e))return function(e){return Ve("*")([e[1],e[0]])};var n=ae(e);return fe(n,W.f)?function(n,t,r){return function(e,n,t){if(!ue(e)){var r=e.length,a=e.parameters.length;t.add("functions","mult"+r+"_"+a,(function(){return ge(W.aa(r))+" mult"+r+"_"+a+"("+ge(e)+" a, "+ge(W.aa(a))+" b){return "+Le(r)(xe(r).map((function(e){return Re(a)(["a.a"+e,"b"],n,t)})),n,t)+";}"}))}}(e,t,r)||"mult"+e.length+"_"+e.parameters.length+"("+n.join(",")+")"}:n===W.h?function(n,t,r){return function(e,n,t){var r=e.length,a=e.parameters.length;t.add("functions","multc"+r+"_"+a,(function(){return ge(W.da(r))+" multc"+r+"_"+a+"("+ge(e)+" a, "+ge(W.da(a))+" b){\n        return cvec"+r+"("+xe(r).map((function(e){return je(a)(["a.a"+e,"b"],n,t)}))+");\n    }\n    "}))}(e,t,r)||"multc"+e.length+"_"+e.parameters.length+"("+n.join(",")+")"}:void 0}function Re(e){return function(n,t,r){return function(e,n){2<=e&&4>=e||n.add("functions","dot"+e,(function(){return"float dot"+e+"(vec"+e+" a, vec"+e+" b) {\n    return "+_e(e).map((function(e,n){return"dot(a.a"+n+",b.a"+n+")"})).join("+")+"; }\n    "}))}(e,r)||"dot"+(2<=e&&4>=e?"":e)+"("+n.join(",")+")"}}function je(e){return function(n,t,r){return function(e,n){n.add("functions","cdot"+e,(function(){return"vec2 cdot"+e+"(cvec"+e+" a, cvec"+e+" b) {\n      return "+xe(e).map((function(e){return"vec2(dot(a.a"+e+",vec2(b.a"+e+".x,-b.a"+e+".y)), dot(a.a"+e+",b.a"+e+".yx))"})).join("+\n")+";\n    }\n    "}))}(e,r)||"cdot"+e+"("+n.join(",")+")"}}function Fe(e){return ue(e)?Ve("+"):function(n,t,r){return function(e,n,t){var r="add"+ge(e);t.add("functions",r,(function(){return ge(e)+" "+r+"("+ge(e)+" a, "+ge(e)+" b) {\n    return "+ge(e)+"("+Ae(e).map((function(e){return ge(e.type)+"("+Fe(e.type)(["a."+e.name,"b."+e.name],n,t)+")"})).join(",")+");\n      }"}))}(e,t,r)||"add"+ge(e)+"("+n.join(",")+")"}}function Pe(e){return ue(e)?Ve("-"):function(n,t,r){return function(e,n,t){var r="sub"+ge(e);t.add("functions",r,(function(){return ge(e)+" "+r+"("+ge(e)+" a, "+ge(e)+" b) {\n    return "+ge(e)+"("+Ae(e).map((function(e){return ge(e.type)+"("+Pe(e.type)(["a."+e.name,"b."+e.name],n,t)+")"})).join(",")+");\n    }"}))}(e,t,r)||"sub"+ge(e)+"("+n.join(",")+")"}}function Oe(e){return Q(e)&&1==re(e)?function(n,t,r){return Re(e.length)([n[0],Le(e.length)(Array(e.length).fill("1."),t,r)],t,r)}:function(n,t,r){return Ee(e,t,r)||"sum"+ge(e)+"("+n.join(",")+")"}}function Le(e){if(2<=e&&4>=e)return function(n){return"vec"+e+"("+n.join(",")+")"};if(1==e)return function(e){return"float("+e.join(",")+")"};var n=0;return function(t,r,a){return we(W.aa(e),a)||"vec"+e+"("+_e(e).map((function(e){return"vec"+e+"("+xe(e).map((function(){return++n&&t[n-1]})).join(",")+")"})).join(",")+")"}}function Ie(e){var n=re(e);return ue(e)?function(n){return ge(e)+"("+n.join(",")+")"}:1==n&&e.parameters===W.f?Le(e.length):function(n,t,r){return we(e,r)||ge(e)+"("+n.join(",")+")"}}function Ce(e,n){var t=ae(e);return 1==re(e)&&t===W.f?function(e,n){return function(t){if(1==e)return t[0];if(2<=e&&4>=e)return"("+t[0]+")["+n+"]";e:{var r,a=n,i=_e(e);for(r in i){if(!(i[r]<=a)){a={first:r,second:a};break e}a-=i[r]}console.error("Accessing index out of range"),a=void 0}return"("+t[0]+").a"+a.first+"["+a.second+"]"}}(e.length,n):ue(e)?function(e){return"("+e[0]+")["+n+"]"}:function(e){return"("+e[0]+").a"+n}}function Me(e,n){return ue(e)?function(){return ge(e)+"(float("+n+"))"}:function(t,r,a){return Ie(e)+"("+Ae(e).map((function(e){return Me(e.type,n)(t,r,a)})).join(",")+")"}}function De(e){return ue(e)?Ve("*"):function(n,t,r){return function(e,n,t){var r="scalarmult"+ge(e);t.add("functions",r,(function(){return ge(e)+" "+r+"(float a, "+ge(e)+" b) {\n    return "+ge(e)+"("+Ae(e).map((function(e){return ge(e.type)+"("+De(e.type)(["a","b."+e.name],n,t)+")"})).join(",")+");\n    }"}))}(e,t,r)||"scalarmult"+ge(e)+"("+n.join(",")+")"}}function Se(e){return e===W.h?be("multc"):function(n,t,r){return function(e,n,t){ye("multc",n,t);var r="cscalarmult"+ge(e);t.add("functions",r,(function(){return ge(e)+" "+r+"(vec2 a, "+ge(e)+" b) {\n    return "+ge(e)+"("+Ae(e).map((function(e){return""+Se(e.type)(["a","b."+e.name],n,t)})).join(",")+");\n    }"}))}(e,t,r)||"cscalarmult"+ge(e)+"("+n.join(",")+")"}}function Ue(e){return function(n,t,r){return function(e,n,t){var r="reverse"+ge(e);t.add("functions",r,(function(){return ge(e)+" "+r+"("+ge(e)+" a){"+ge(e.parameters)+" m;\n"+xe(Math.floor(e.length/2)).map((function(r){var a=Ce(e,r)(["a",r],n,t);return"m = "+a+"; "+a+" = "+(r=Ce(e,e.length-1-r)(["a",e.length-1-r],n,t))+"; "+r+" = m;"})).join("\n")+"return a;\n      }"}))}(e,t,r)||"reverse"+ge(e)+"("+n.join(",")+")"}}function Ne(e){return function(n,t,r){return function(e,n,t){var r="max"+ge(e);t.add("functions",r,(function(){return ge(e.parameters)+" "+r+"("+ge(e)+" a){"+ge(e.parameters)+" m = "+Ce(e,e.length-1)(["a",e.length-1],n,t)+";\n"+xe(e.length-1).map((function(r){return"m = max(m,"+Ce(e,r)(["a",r],n,t)+");"})).join("\n")+"return m;\n      }"}))}(e,t,r)||"max"+ge(e)+"("+n.join(",")+")"}}function Be(e){return function(n,t,r){return function(e,n,t){var r="min"+ge(e);t.add("functions",r,(function(){return ge(e.parameters)+" "+r+"("+ge(e)+" a){"+ge(e.parameters)+" m = "+Ce(e,e.length-1)(["a",e.length-1],n,t)+";\n"+xe(e.length-1).map((function(r){return"m = min(m,"+Ce(e,r)(["a",r],n,t)+");"})).join("\n")+"return m;\n      }"}))}(e,t,r)||"min"+ge(e)+"("+n.join(",")+")"}}function ze(e){return function(n,t,r){return function(e,n,t){var r="transpose"+ge(e),a=H(e.parameters.length,H(e.length,e.parameters.parameters));t.add("functions",r,(function(){return ge(a)+" "+r+"("+ge(e)+" a){return "+Ie(a)(xe(a.length).map((function(r){return Ie(a.parameters)(xe(a.parameters.length).map((function(a){return Ce(e.parameters,r)([Ce(e,a)(["a",a],n,t),r],n,t)})),n,t)})),n,t)+";}"}))}(e,t,r)||"transpose"+ge(e)+"("+n.join(",")+")"}}function $e(e){return function(n,t,r){return function(e,n,t){var r="sort"+ge(e);t.add("functions",r,(function(){return ge(e)+" "+r+"("+ge(e)+" a){"+ge(e.parameters)+" m;\n"+function(e){function n(e,r,a){if(1<r){var i;for(i=1;i<r;)i<<=1;i>>=1;for(var o=e;o<e+r-i;o++){var c=o,u=o+i;a?t.push([c,u]):t.push([u,c])}n(e,i,a),n(e+i,r-i,a)}}var t=[];return function e(t,r,a){if(1<r){var i=r/2|0;e(t,i,!a),e(t+i,r-i,a),n(t,r,a)}}(0,e,!0),t}(e.length).map((function(r){var a=Ce(e,r[0])(["a",r[0]],n,t);return"m = min("+a+","+(r=Ce(e,r[1])(["a",r[1]],n,t))+"); "+r+" = max("+a+","+r+"); "+a+" = m;"})).join("\n")+"return a;\n      }"}))}(e,t,r)||"sort"+ge(e)+"("+n.join(",")+")"}}function Ge(e){return function(n){return w(e)+"("+n+")"}}function Ve(e){return function(n){return"("+n.join(e)+")"}}function Xe(e){return e}var ke={};ke.join=ve([[[W.w,W.w],W.line,Ge("cross")]]),ke.meet=ve([[[W.line,W.line],W.w,Ge("cross")]]),ke.gauss=ve([[[W.h],W.F,Xe]]),ke.complex=ve([[[W.F],W.h,Xe],[[W.w],W.h,be("dehomogenize")]]),ke.if=function(e){if(!e.every((function(e){return e})))return!1;if(2===e.length)return{o:e,s:e[1],l:function(e){return"if("+e[0]+") {"+e[1]+";}"}};if(3===e.length){var n=pe(e[1],e[2]);return n?{o:[W.A,n,n],s:n,l:function(e){return"("+e[0]+" ? "+e[1]+" : "+e[2]+")"}}:{o:e,s:W.T,l:function(e){return"if("+e[0]+") {"+e[1]+";} else {"+e[2]+";}"}}}return!1},ke["="]=function(e){return{o:e=pe(e[0],e[1]),s:e,l:function(e){return e[0]+" = "+e[1]+";"}}},ke[";"]=function(e){return{o:e,s:e[1]!==W.T?e[1]:e[0],l:function(e){return e[0]+" ; "+e[1]+";"}}},ke.repeat=function(e){return!(2!=e.length&&3!=e.length||!ne(e[0]))&&{o:e,s:e[e.length-1],l:function(){return""}}},ke.forall=function(e){return(2==e.length||3==e.length)&&"list"===te(e[0]).type&&{o:e,s:e[e.length-1],l:function(){return""}}},ke.apply=function(e){return(2==e.length||3==e.length)&&"list"===te(e[0]).type&&{o:e,s:H(te(e[0]).length,e[e.length-1]),l:function(){return""}}},ke.sum=function(e){return!(1!=e.length||!Q(e[0])&&!ee(e[0]))&&{o:e,s:e[0].parameters,l:Oe(e[0])}},ke.regional=function(e){return{o:e,s:W.T,l:function(){return""}}},ke.sqrt=ve([[[W.f],W.h,be("sqrtf")],[[W.h],W.h,be("sqrtc")]]),ke.abs=ve([[[W.f],W.f,Ge("abs")],[[W.h],W.f,Ge("length")],[[W.F],W.f,Ge("length")],[[W.J],W.f,Ge("length")],[[W.O],W.f,Ge("length")]]),ke.abs_infix=ke.abs,ke.dist=ve([[[W.f,W.f],W.f,function(e){return Ge("abs")(Ve("-")(e))}],[[W.h,W.h],W.f,function(e){return Ge("length")(Ve("-")(e))}],[[W.F,W.F],W.f,function(e){return Ge("length")(Ve("-")(e))}],[[W.J,W.J],W.f,function(e){return Ge("length")(Ve("-")(e))}],[[W.O,W.O],W.f,function(e){return Ge("length")(Ve("-")(e))}]]),ke.dist_infix=ke.dist,ke.sin=ve([[[W.f],W.f,Ge("sin")],[[W.h],W.h,be("sinc")]]),ke.cos=ve([[[W.f],W.f,Ge("cos")],[[W.h],W.h,be("cosc")]]),ke.tan=ve([[[W.f],W.f,Ge("tan")],[[W.h],W.h,be("tanc")]]),ke.exp=ve([[[W.f],W.f,Ge("exp")],[[W.h],W.h,be("expc")]]),ke.arctan=ve([[[W.f],W.f,Ge("atan")],[[W.h],W.h,be("arctanc")]]),ke.arcsin=ve([[[W.f],W.h,be("arcsinf")],[[W.h],W.h,be("arcsinc")]]),ke.arccos=ve([[[W.f],W.h,be("arccosf")],[[W.h],W.h,be("arccosc")]]),ke.log=ve([[[W.f],W.h,be("logr")],[[W.h],W.h,be("logc")]]);var qe=[2,3,4].map((function(e){return H(e,W.f)})).concat([2,3,4].map((function(e){return H(e,H(e,W.f))}))),Ke=[W.u,W.f,W.h].concat(qe);function He(e,n){if(!(1>=e))if(2==e)n.add("functions","raise2",(function(){return"float raise2(float a) { return a*a; }"}));else{He(2,n);var t=function(e,n){return 1==n?e:1&n?t(e,n-1)+"*a":"raise2("+t(e,n/2)+")"},r="raise"+e;n.add("functions",r,(function(){return"float "+r+"(float a) { return "+t("a",e)+";}"}))}}function Je(e){return function(n,t,r){return 0==e?"1.":1==e?n[0]:He(e,r)||"raise"+e+"("+n[0]+")"}}function Ye(e){this.i={},this.D={},this.j={},this.R=0,this.B={},this.C=e,this.N={}}function We(e,n){return e.j[n]?e.j[n].order.map((function(t){return e.j[n].ia[t]})).join("\n"):"\n"}function Ze(e,n,t,r){if(se(t,r))return n;if(fe(t,r)){if("constant"===t.type)return de(t.value,r);var a=me(r)([t]);return a?(r=a.l)(Ze(e,n,t,a.o[0]),{},e):(console.error("cannot find an implementation for "+Z(t)+" -> "+Z(r)+", using identity"),n)}return console.error(Z(t)+" is no subtype of "+Z(r)+" (trying to cast the term "+n+")"),n}function Qe(e,n,t){e.i[n]||(e.i[n]={}),e.i[n].S||(e.i[n].S=[]),e.i[n].v||(e.i[n].v=!1),e.hasOwnProperty("global")||(e.i[n].global=t)}function en(e,n){return(!n.na||!n.R||e.R>n.R)&&(n.na=function(e,n){var t=n.I;if(n.isuniform)return e.D[n.uvariable].type;if("variable"===n.ctype)return n=t[n=n.name]||n,e.i[n].v;if("function"===n.ctype&&e.B.hasOwnProperty(n.oper))return e.i[t[n.oper]].v;if("number"===n.ctype)return J(n);if("void"===n.ctype)return W.T;if("field"===n.ctype){if(e=te(en(e,n.obj)),1==n.key.length){if("list"===e.type)return e.parameters;if(fe(e,W.w))return W.f}else if("xy"==n.key&&fe(e,W.w))return W.F;if(!e)return!1}else{if("string"===n.ctype)return W.image;if("function"===n.ctype||"infix"===n.ctype){t=Array(n.args.length);for(var r=!0,a=0;a<n.args.length;a++)t[a]=en(e,n.args[a]),r&="constant"===t[a].type;if(r&&n.impl)return n={ctype:n.ctype,oper:n.oper,impl:n.impl,args:t.map((function(e){return e.value}))},J(n=e.C.evaluateAndVal(n));if(e=w(n.oper),!(r=!!ke[e]&&ke[e](t))&&t.every((function(e){return ae(e)})))throw console.error("Could not find an implementation for "+e+" with args ("+t.map(Z).join(", ")+")"),console.log(n),"error";return!!r&&r.s}}return console.error("Don't know how to compute type of"),console.log(n),!1}(e,n),n.R=e.R),n.na}function nn(e,n){if("function"===n.ctype&&!e.B.hasOwnProperty(n.oper)&&null!==e.C.getMyfunction(n.oper)){var t=n.oper;e.B[t]=_(e.C.getMyfunction(t)),nn(e,e.B[t].body)}for(var r in n.args)nn(e,n.args[r])}function tn(e,n,t){var r=en(e,n);if(n.isuniform)return n=n.uvariable,t?{code:"",m:"constant"===r.type?de(r.value,te(r)):n}:{code:""};if(";"===n.oper){r={m:""};for(var a="",i=n.args.length-1,o=i;0<=o;o--)"void"===n.args[o].ctype&&(i=o-1);for(o=0;o<=i;o++)a+=(r=tn(e,n.args[o],t&&o===i)).code;return t?{code:a,m:r.m}:{code:a}}if("constant"===r.type)return t?{m:de(r.value,te(r)),code:""}:{code:""};if("="===n.oper)return r=tn(e,n.args[1],!0),n=tn(e,n.args[0],!0).m+" = "+Ze(e,r.m,en(e,n.args[1]),en(e,n.args[0])),t?{code:r.code,m:n}:{code:r.code+n+";\n"};if("repeat$2"===n.oper||"repeat$3"===n.oper){if(a=tn(e,n.args[0],!0),"constant"!==en(e,n.args[0]).type)return console.error("repeat possible only for fixed constant number in GLSL"),!1;if(r="repeat$2"===n.oper?n.args[1].I["#"]:n.args[2].I[n.args[1].name],a=Number(a.m),i="","constant"===e.i[r].v.type)for(o=1;o<=a;o++){e.i[r].v=Y(o),e.R++;var c=tn(e,n.args["repeat$2"===n.oper?1:2],o===a&&t);if(i+=c.code,o===a&&t)return{code:i,m:c.m}}else if(o="",c=tn(e,n.args["repeat$2"===n.oper?1:2],t),n=en(e,n.args["repeat$2"===n.oper?1:2]),t&&(o=R(),e.i[o]||(Qe(e,o,!0),e.i[o].v=n)),i=i+"for(int "+r+"=1; "+r+" <= "+a+"; "+r+"++) {\n"+c.code,t&&(i+=o+" = "+c.m+";\n"),i+="}\n",t)return{code:i,m:o};return{code:i}}if("forall$2"===n.oper||"forall$3"===n.oper||"apply$2"===n.oper||"apply$3"===n.oper){var u=en(e,n.args[0]);if("list"!==u.type&&("constant"!==u.type||"list"!==u.value.ctype))return console.error(n.oper+" only possible for lists"),!1;a=u.length||u.value.value.length,o=2===n.args.length?n.args[1].I["#"]:n.args[2].I[n.args[1].name];var l=e.i[o].v,s=c="";if(t&&(s=R(),c+=ge(r)+" "+s+";\n"),"list"===r.type&&we(r,e),"constant"===e.i[o].v.type||"constant"===u.type)for(u=e.C.evaluateAndVal(n.args[0]),l=0;l<a;l++)e.i[o].v=J(u.value[l]),e.R++,c+=(i=tn(e,n.args[2===n.args.length?1:2],t)).code,"forall$2"===n.oper||"forall$3"===n.oper?l+1===a&&t&&(c+=s+" = "+i.m+";\n"):t&&(c+=Ce(r,l)([s],[],e)+" = "+i.m+";\n");else{i=tn(e,n.args[2===n.args.length?1:2],t);var f=tn(e,n.args[0],!0);c+=f.code;var p=f.m;for(!e.i[p]&&!e.D[p]&&2<=u.length&&(p=R(),c+=ge(u)+" "+p+" = "+f.m+";\n"),e.i[o].global=!0,f=0;f<a;f++)c+=o+" = "+Ce(u,f)([p],[],e)+";\n",c+=i.code,t&&("forall$2"===n.oper||"forall$3"===n.oper?f===a-1&&(c+=s+" = "+i.m+";\n"):c+=Ce(r,f)([s],[],e)+" = "+i.m+";\n");"list"===l.type&&we(l,e)}return t?{code:c,m:s}:{code:c}}if("if$2"===n.oper||"if$3"===n.oper)return c=tn(e,n.args[0],!0),a=en(e,n.args[0]),o=i="",s=tn(e,n.args[1],t),t&&(o=R(),e.i[o]||(Qe(e,o,!0),e.i[o].v=r)),"constant"!=a.type&&(i+=c.code,i+="if("+c.m+") {\n"),("constant"!=a.type||"constant"==a.type&&a.value.value)&&(i+=s.code,t&&(i+=o+" = "+Ze(e,s.m,en(e,n.args[1]),r)+";\n")),"if$3"===n.oper&&(c=tn(e,n.args[2],t),"constant"!=a.type&&(i+="} else {\n"),"constant"!=a.type||"constant"==a.type&&!a.value.value)&&(i+=c.code,t&&(i+=o+" = "+Ze(e,c.m,en(e,n.args[2]),r)+";\n")),"constant"!=a.type&&(i+="}\n"),t?{code:i,m:o}:{code:i};if("function"===n.ctype||"infix"===n.ctype){if("verbatimglsl"===w(c=n.oper))return n=e.C.evaluateAndVal(n.args[0]).value,t?{m:n,code:""}:{code:n};if(r=n.args.map((function(n){return tn(e,n,!0)})),a=n.args.map((function(n){return en(e,n)})),e.B.hasOwnProperty(c))for(o=function(e,n){return function(e,n,t){if(!e.mark("compiledfunctions",n)){for(var r=e.B[n],a=n.replace("$","_"),i=r.body.I,o=Array(t),c=0;c<t;c++)o[c]=r.arglist[c].name;t=e.i[a].v===W.T;var u=ge(e.i[a].v)+" "+a+"("+o.map((function(n){return ge(e.i[i[n]].v)+" "+i[n]})).join(", ")+"){\n";for(l in r.i)o=r.i[l],u+=ge(e.i[o].v)+" "+o+";\n";var l=tn(e,r.body,!t);r=en(e,r.body),u+=l.code,t||(u+="return "+Ze(e,l.m,r,e.i[a].v)+";\n"),u+="}\n",e.add("compiledfunctions",n,(function(){return u}))}}(e,n,e.B[n].arglist.length),Ge(n.replace("$","_"))}(e,c),i=Array(r.length),s=0;s<r.length;s++)i[s]=e.i[e.B[c].body.I[e.B[c].arglist[s].name]].v;else{if("regional"===(c=w(c)))return t?{m:"",code:""}:{code:""};if(!(o=ke[c](a)))return console.error("Could not find an implementation for "+c+"("+a.map(Z).join(", ")+").\nReturning empty code"),t?{m:"",code:""}:{code:""};i=o.o,o=o.l}for(c="",s=Array(r.length),u=0;u<r.length;u++)c+=r[u].code,s[u]=Ze(e,r[u].m,a[u],i[u]);return n=o(s,n.modifs,e),t?{m:n,code:c}:{code:c+n+";\n"}}return"variable"===n.ctype?(r=n.name,r=n.I[r]||r,t?{m:r,code:""}:{code:r+";\n"}):"void"===n.ctype?t?{m:"",code:""}:{code:""}:"field"===n.ctype&&(r=en(e,n.obj),o={x:0,y:1,z:2,r:0,g:1,b:2,a:3}[n.key],a=!1,i=tn(e,n.obj,!0).m,null!=o&&"list"===r.type?a=Ce(r,o)([i],null,e):"xy"===n.key&&"list"===r.type?(2===r.length&&(a=i),3===r.length&&(a=be("dehomogenize")([Ze(e,i,r,W.w)],null,e))):r===W.w&&((o={xy:"dehomogenize",x:"dehomogenizex",y:"dehomogenizey"})[n.key]&&(a=be(o[n.key])([Ze(e,i,r,W.w)],null,e))),a)?t?{m:a,code:""}:{code:a+";\n"}:void console.error("dont know how to this.compile "+JSON.stringify(n))}function rn(e,n){T=0;var t=n=_(n);for(var r in nn(e,t),function(e,n,t){function r(e,n,t){var r,i={};for(r in e)i[r]=e[r];return e=R(),Qe(o,e,!1),a[e].v=t,a[e].oa=!0,i[n]=e,i}var a=e.i,i=e.B,o=e;!function e(n,t,c,u){for(var l in n.I=t,n.args){var s=u||"repeat$2"===n.oper&&0==l||"repeat$3"===n.oper&&0==l||"_"===n.oper&&1==l,f=t;-1!==["repeat","forall","apply"].indexOf(w(n.oper))&&(1==l?f="repeat$2"===n.oper?r(t,"#",W.u):"repeat$3"===n.oper?r(t,n.args[1].name,W.u):"forall$2"===n.oper||"apply$2"===n.oper?r(t,"#",!1):"forall$3"===n.oper||"apply$3"===n.oper?r(t,n.args[1].name,!1):t:2==l&&(f=n.args[1].I)),e(n.args[l],f,c,s)}if("field"===n.ctype&&e(n.obj,t,c,u),"variable"===n.ctype&&(l=t[l=n.name]||l,u&&o.i[l]&&(o.i[l].W=!0)),"="===n.oper)u=t[u=n.args[0].name]||u,Qe(o,u,!0),a[u].S.push(n.args[1]);else if(n.oper&&"regional"===w(n.oper)&&"global"!=c)for(var p in n.args){u=n.args[p].name;var v=R();t[u]=v,i[c].i||(i[c].i=[]),i[c].i.push(v),Qe(o,v,!1)}else if("forall$2"===n.oper||"apply$2"===n.oper||"forall$3"===n.oper||"apply$3"===n.oper)a[2===n.args.length?n.args[1].I["#"]:n.args[2].I[n.args[1].name]].S.push({ctype:"infix",oper:"_",args:[n.args[0],{ctype:"number",value:{real:1,imag:0}}],I:n.args[0].I});else if("function"===n.ctype&&i.hasOwnProperty(n.oper)){for(v in p=(c=n.oper).replace("$","_"),Qe(o,p,!1),t[c]=p,t={},i[c].arglist)s=p+"_"+(l=i[c].arglist[v].name),t[l]=s,Qe(o,s,!1),a[s].S.push(n.args[v]);i[c].qa||(i[c].qa=!0,e(i[c].body,t,c,u),a[p].S.push(i[c].body))}}(n,t,"global",!1)}(e,t,function(e,n){function t(e){var n,t={};for(n in e)t[n]=e[n];return t}var r={},a={};if(function e(n,r){for(var i in"repeat$2"===n.oper||"forall$2"===n.oper||"apply$2"===n.oper?(r=t(r))["#"]=!0:"repeat$3"===n.oper||"forall$3"===n.oper||"apply$3"===n.oper?(r=t(r))[n.args[1].name]=!0:"="===n.oper&&(r[n.args[0].name]=!0),n.args)e(n.args[i],r);"field"===n.ctype&&e(n.obj,r),"variable"===n.ctype&&(r[n=n.name]||(a[n]=!0))}(n,{}),Qe(e,"cgl_pixel",!1),e.i.cgl_pixel.v=W.F,1==Object.keys(a).length)r[Object.keys(a)[0]]="cgl_pixel";else if(a["#"])r["#"]="cgl_pixel";else if(a.x&&a.y)Qe(e,"cgl_pixel.x",!1),e.i["cgl_pixel.x"].v=W.f,r.x="cgl_pixel.x",Qe(e,"cgl_pixel.y",!1),e.i["cgl_pixel.y"].v=W.f,r.y="cgl_pixel.y";else{for(var i in n=[],a)e.C.nada==e.C.evaluateAndVal({ctype:"variable",name:i})&&n.push(i);1==n.length?r[n[0]]="cgl_pixel":a.p?r.p="cgl_pixel":a.z&&(r.z="cgl_pixel")}return"cgl_pixel"===r.z&&(e.i.cgl_pixel.v=W.h),r}(e,t)),function(e,n){function t(e){if(e.hasOwnProperty("dependsOnPixel"))return e.dependsOnPixel;if("variable"===e.ctype){var n=e.name;return n=e.I[n]||n,o[n]?e.dependsOnPixel=!0:e.dependsOnPixel=!1}if(n="random randomint randominteger randombool randomnormal verbatimglsl".split(" "),"function"===e.ctype&&-1!==n.indexOf(w(e.oper)))return e.dependsOnPixel=!0;if("repeat$2"===e.oper||"forall$2"===e.oper||"apply$2"===e.oper)return t(e.args[1])?(o[e.args[1].I["#"]]=!0,e.dependsOnPixel=!0):e.dependsOnPixel=!1;if("repeat$3"===e.oper||"forall$3"===e.oper||"apply$3"===e.oper)return t(e.args[2])?(o[e.args[2].I[e.args[1].name]]=!0,e.args[1].dependsOnPixel=!0,e.dependsOnPixel=!0):e.dependsOnPixel=!1;for(var r in e.args)if(t(e.args[r]))return e.dependsOnPixel=!0;return"function"===e.ctype&&i.hasOwnProperty(e.oper)&&t(i[e.oper].body)?e.dependsOnPixel=!0:"field"===e.ctype?e.dependsOnPixel=t(e.obj):e.dependsOnPixel=!1}var r,a=e.i,i=e.B,o={cgl_pixel:!0,"cgl_pixel.x":!0,"cgl_pixel.y":!0};for(r in a)(1<=a[r].S.length||a[r].oa)&&(o[r]=!0);t(n);var c={"":!0},u=e.D;!function e(n,r){if(t(n)){for(var a in n.args)e(n.args[a],r||"repeat$2"===n.oper&&0==a||"repeat$3"===n.oper&&0==a||"_"===n.oper&&1==a);"field"===n.ctype&&e(n.obj,r),"function"===n.ctype&&i.hasOwnProperty(n.oper)&&(n=n.oper,c.hasOwnProperty(n)||(c[n]=!0,e(i[n].body,r)))}else if("boolean"!==n.ctype&&"number"!==n.ctype&&"void"!==n.ctype){var o;for(o in".."===n.oper&&(r=!0),a=!1,u)if(!a&&A(n,u[o].U)){a=!0;var l=o}a||(l=R(),u[l]={U:n,type:!1,W:r}),u[l].W=u[l].W||r,n.isuniform=!0,n.uvariable=l}}(n,!1)}(e,t),e.D){if(!(t=e.C.evaluateAndVal(e.D[r].U)).ctype||"undefined"===t.ctype){console.error("can not evaluate:"),console.log(e.D[r].U);break}e.D[r].type=e.D[r].W?J(t):E(t)}for(var a in r=!0,e.i)e.i[a].v=e.i[a].v||!1,e.i[a].W&&(e.i[a].v=Y(1),e.R++);for(;r;)for(var i in r=!1,e.i)if(!e.i[i].W)for(var o in e.i[i].S){a=te(en(e,e.i[i].S[o]));var c=t=e.i[i].v||!1;a&&((c=t?fe(a,t)?t:pe(t,a):a)&&c!==t&&(e.i[i].v=c,e.R++,r=!0))}for(var u in e.D)"list"===e.D[u].type.type&&we(e.D[u].type,e);for(var l in e.i)"list"===e.i[l].v.type&&we(e.i[l].v,e);for(var s in i=tn(e,n,!0),o=en(e,n),n=Ze(e,i.m,o,W.color),fe(o,W.color)||console.error("expression does not generate a color"),o=We(e,"structs"),o+=We(e,"uniforms"),u=[],e.D)"constant"!=e.D[s].type.type&&e.D[s].type!=W.image&&u.push("uniform "+ge(e.D[s].type)+" "+s+";");for(var f in o+=u.join("\n"),s="",e.N)s+=e.N[f].code+"\n";for(var p in o=o+s+We(e,"includedfunctions"),o+=We(e,"functions"),e.i)e.i[p].v&&e.i[p].global&&(o+=ge(e.i[p].v)+" "+p+";\n");if(o+=We(e,"compiledfunctions"),o+="void main(void) {\n"+i.code+"gl_FragColor = "+n+";\n}\n",console.log(o),f={},e.j.compiledfunctions)for(var v in e.j.compiledfunctions.ga)f[v]=e.C.getMyfunction(v).generation;return{code:o,D:e.D,N:e.N,ea:f}}function an(e,n,t,r){this.U=n,this.C=r,this.B=t,on(this),n=this.j,this.name=e,this.code="uniform sampler2D _sampler"+e+";\nuniform float _ratio"+e+";\nuniform vec2 _cropfact"+e+";\nvec4 _imagergba"+e+"(vec2 A, vec2 B, vec2 p) {\n  p -= A; B -= A;\n  float b = dot(B,B);\n  p = vec2(dot(p,B),_ratio"+e+"*dot(p,vec2(-B.y,B.x)))/b;\n  "+(n.repeat?"p = mod(p, vec2(1.));":"")+"\n  "+(n.repeat&&n.mipmap?"vec4 color = vec4(0.);\n    float totalWeight = 0.;\n    for(int dx=0; dx<2; dx++) for(int dy=0; dy<2; dy++) {\n      vec2 delta = .5*vec2(dx, dy);\n      vec2 center = delta+vec2(.5);\n      vec2 tc = fract(p-delta)+delta;\n      float dst = dot(abs(tc-center),vec2(1.));\n      float w = max(.5-dst,0.);\n      w=w*w;\n      color += w * texture2D(_sampler"+e+", tc*_cropfact"+e+");\n      totalWeight += w;\n    }\n    return color/totalWeight;":n.repeat?"return texture2D(_sampler"+e+", p*_cropfact"+e+");":"if(0. <= p.x && p.x <= 1. && 0. <= p.y && p.y <= 1.)\n          return texture2D(_sampler"+e+", p*_cropfact"+e+");\n       else\n          return vec4(0.);")+"\n  }"}function on(e){var n=e.B,t=e.C;n={interpolate:!n.hasOwnProperty("interpolate")||t.evaluateAndVal(n.interpolate).value,mipmap:!!n.hasOwnProperty("mipmap")&&t.evaluateAndVal(n.mipmap).value,repeat:!!n.hasOwnProperty("repeat")&&t.evaluateAndVal(n.repeat).value},!e.j||e.j.mipmap==n.mipmap&&e.j.repeat==n.repeat||(console.log("enfore recompilation because texture modifiers changed."),b++),e.j=n}function cn(e){var n=e.C.evaluateAndVal(e.U).value,t="string"==typeof n?e.C.getImage(n,!0):n;return null==t?(console.error("Could not find image "+n+"."),p):(on(e),N(t,e.C,e.j))}function un(e,n,t){return t.N.hasOwnProperty(e)||(t.N[e]=new an(e,t.D[e].U,n,t.C)),e}function ln(e){var n=void 0===n?Number.NaN:n;return"number"!==e.ctype?(console.log("argument is not a number"),n):(e=(n=e.value).real,0!==(n=n.imag)&&console.log("complex number is not real"),(n=Math.round(e))!==e&&console.log("number is not an integer"),n)}function sn(e){var n=void 0===n?Number.NaN:n;return n=void 0===n?Number.NaN:n,"number"!==e.ctype?(console.log("argument is not a number"),e=n):(n=(e=e.value).real,0!==e.imag&&console.log("complex number is not real"),e=n),0>e?0:1<e?1:e}function fn(e){this.message=e}function pn(e,n){var t=f;if(this.handle=t.createProgram(),t.j&&(e="#version 300 es\n"+e.replace(/attribute/g,"in").replace(/varying/g,"out"),n="#version 300 es\n"+n.replace(/varying/g,"in").replace(/gl_FragColor/g,"FragColor").replace(/texture2D/g,"texture").replace(/precision highp float;/g,"precision highp float;\n#define webgl2 true\nout vec4 FragColor;")),this.V=vn(this,t,t.VERTEX_SHADER,e),vn(this,t,t.FRAGMENT_SHADER,n),e=this.handle,t.linkProgram(e),!t.getProgramParameter(e,t.LINK_STATUS))throw new fn("Error linking shader:\n"+t.getProgramInfoLog(e));if(t.validateProgram(e),!t.getProgramParameter(e,t.VALIDATE_STATUS))throw new fn("Error validating shader:\n"+t.getProgramInfoLog(e));var r,a,i,o=this.handle,c={};for(n=t.getProgramParameter(o,t.ACTIVE_UNIFORMS),e=0;e<n;++e){var u=t.getActiveUniform(o,e);if(null!==u&&(r=u.name.replace(/\]/g,""))){for(i=c;null!==(a=/[.\[]/.exec(r));){var l=r.substr(0,a.index);i=i.hasOwnProperty(l)?i[l]:"."===a[0]?i[l]={}:i[l]=[],r=r.substr(a.index+1)}if(1<u.size){a=u.size;var s=Array(a);for(l=0;l<a;++l){var p=u.name+"["+l+"]";p=mn(this,t,p,u),s[l]=p}i[r]=s}else p=mn(this,t,u.name,u),i[r]=p}}this.uniform=c}function vn(e,n,t,r){if(t=n.createShader(t),n.shaderSource(t,r),n.compileShader(t),!n.getShaderParameter(t,n.COMPILE_STATUS))throw console.warn(r.split("\n")),new fn("Error compiling shader:\n"+n.getShaderInfoLog(t));return n.attachShader(e.handle,t),t}function mn(e,n,t,r){switch(e=n.getUniformLocation(e.handle,t),r.type){case n.FLOAT:return n.uniform1fv.bind(n,e);case n.FLOAT_VEC2:return n.uniform2fv.bind(n,e);case n.FLOAT_VEC3:return n.uniform3fv.bind(n,e);case n.FLOAT_VEC4:return n.uniform4fv.bind(n,e);case n.BOOL:case n.INT:case n.SAMPLER_2D:case n.SAMPLER_CUBE:return n.uniform1iv.bind(n,e);case n.BOOL_VEC2:case n.INT_VEC2:return n.uniform2iv.bind(n,e);case n.BOOL_VEC3:case n.INT_VEC3:return n.uniform3iv.bind(n,e);case n.BOOL_VEC4:case n.INT_VEC4:return n.uniform4iv.bind(n,e);case n.FLOAT_MAT2:return n.uniformMatrix2fv.bind(n,e,!1);case n.FLOAT_MAT3:return n.uniformMatrix3fv.bind(n,e,!1);case n.FLOAT_MAT4:return n.uniformMatrix4fv.bind(n,e,!1);default:throw new fn("Unknown data type for uniform "+t)}}ke.add=function(e){var n=ve(Ke.map((function(e){return[[e,e],e,Ve("+")]})).concat([[[W.w,W.w],W.F,be("addpoints")]]))(e);return n||([n=e[0],e=e[1]].every((function(e){return Q(e)||ee(e)}))&&ie(n,e)?{o:[e=pe(oe(n),oe(e)),e],s:e,l:Fe(e)}:void 0)},ke.sub=function(e){var n=ve(Ke.map((function(e){return[[e,e],e,Ve("-")]})).concat(Ke.map((function(e){return[[W.T,e],e,Ve("-")]}))).concat([[[W.w,W.w],W.F,be("subpoints")]]))(e);return n||([n=e[0],e=e[1]].every((function(e){return Q(e)||ee(e)}))&&ie(n,e)?{o:[e=pe(oe(n),oe(e)),e],s:e,l:Pe(e)}:void 0)},ke["+"]=ke.add,ke["-"]=ke.sub,ke._=function(e){var n=te(e[0]);if(n!==W.w&&n!==W.line||(n=W.J),"list"===n.type&&ne(e[1])){var t=Number(e[1].value.value.real);return 1<=Math.abs(t)&&Math.abs(t)<=n.length?(0<t&&--t,0>t&&(t=n.length+t),{o:e,s:n.parameters,l:Ce(n,t)}):{o:e,s:n.parameters,l:function(){return console.error("try to access "+t+"-th Element of "+n.length+"-list "+JSON.stringify(e[0]))}}}return!1},ke.mult=function(e){var n=ve([[[W.u,W.u],W.u,Ve("*")],[[W.f,W.f],W.f,Ve("*")],[[W.h,W.f],W.h,Ve("*")],[[W.f,W.h],W.h,Ve("*")],[[W.h,W.h],W.h,be("multc")],[[W.Y,W.Y],W.Y,function(e){return"("+e.reverse().join("*")+")"}],[[W.Z,W.Z],W.Z,function(e){return"("+e.reverse().join("*")+")"}],[[W.$,W.$],W.$,function(e){return"("+e.reverse().join("*")+")"}],[[W.Y,W.F],W.F,function(e){return"("+e.reverse().join("*")+")"}],[[W.Z,W.J],W.J,function(e){return"("+e.reverse().join("*")+")"}],[[W.$,W.O],W.O,function(e){return"("+e.reverse().join("*")+")"}],[[W.F,W.Y],W.F,function(e){return"("+e.reverse().join("*")+")"}],[[W.J,W.Z],W.J,function(e){return"("+e.reverse().join("*")+")"}],[[W.O,W.$],W.O,function(e){return"("+e.reverse().join("*")+")"}]])(e);if(n)return n;if(2!==e.length)return!1;n=e[0];var t=e[1];if([n,t].every((function(e){return"list"===e.type&&fe(e.parameters,W.f)}))&&n.length===t.length)return ue(e=oe(n))?{o:[e,e],s:W.f,l:Ge("dot")}:{o:[e,e],s:W.f,l:Re(n.length)};if([n,t].every((function(e){return"list"===e.type&&fe(e.parameters,W.h)}))&&n.length===t.length)return{o:[e=ce(n),e],s:W.h,l:je(n.length)};if(Q(n)&&2===re(n)&&Q(t)&&1===re(t)&&n.parameters.length===t.length)return{o:[oe(n),oe(t)],s:W.aa(n.length),l:Te(oe(n))};if(ee(n)&&2===re(n)&&ee(t)&&1===re(t)&&n.parameters.length===t.length)return{o:[ce(n),ce(t)],s:W.da(n.length),l:Te(ce(n))};for(n={H:0};2>n.H;(n={V:n.V,H:n.H,ba:n.ba}).H++){if(fe(e[0^n.H],W.f)&&(Q(e[1^n.H])||ee(e[1^n.H])))return n.V=oe(e[1^n.H]),{o:n.H?[n.V,W.f]:[W.f,n.V],s:n.V,l:function(e){return function(n,t,r){return De(e.V)([n[0^e.H],n[1^e.H]],t,r)}}(n)};if(fe(e[0^n.H],W.h)&&ee(e[1^n.H]))return n.ba=ce(e[1^n.H]),{o:n.H?[n.ba,W.h]:[W.h,n.ba],s:n.ba,l:function(e){return function(n,t,r){return Se(e.ba)([n[0^e.H],n[1^e.H]],t,r)}}(n)}}},ke["*"]=ke.mult,ke.div=function(e){var n=ve([[[W.f,W.f],W.f,Ve("/")],[[W.f,W.h],W.h,be("divfc")],[[W.h,W.f],W.h,Ve("/")],[[W.h,W.h],W.h,be("divc")]])(e);return n||!!(fe(e[1],W.f)&&ee(e[0])&&(e=oe(e[0]),ue(e)))&&{o:[e,W.f],s:e,l:Ve("/")}},ke["/"]=ke.div,ke.re=ve([[[W.h],W.f,be("realc")]]),ke.im=ve([[[W.h],W.f,be("imagc")]]),ke.floor=ve([[[W.f],W.u,function(e){return"int(floor("+e+"))"}],[[W.h],W.h,Ge("floor")]]),ke.round=ve([[[W.f],W.u,function(e){return"int(floor("+e+"+.5))"}],[[W.h],W.h,function(e){return"floor("+e+"+vec2(.5))"}]]),ke.ceil=ve([[[W.f],W.u,function(e){return"int(ceil("+e+"))"}],[[W.h],W.h,Ge("ceil")]]),ke.mod=ve([[[W.u,W.u],W.u,function(e,n){return"int("+Ge("mod")("float("+e[0]+"), float("+e[1]+")",n)+")"}],[[W.f,W.f],W.f,Ge("mod")],[[W.h,W.h],W.h,be("mod")]]),ke.random=ve([[[],W.f,be("random")],[[W.f],W.f,function(e,n,t){return be("random")([],n,t)+"*"+e[0]}],[[W.h],W.h,function(e,n,t){return"vec2("+be("random")([],n,t)+","+be("random")([],n,t)+")*"+e[0]}]]),ke.randomint=ve([[[W.u],W.u,function(e,n,t){return"int(floor("+be("random")([],n,t)+"*float("+e[0]+")))"}],[[W.f],W.u,function(e,n,t){return"int(floor("+be("random")([],n,t)+"*floor("+e[0]+")))"}]]),ke.randominteger=ke.randomint,ke.randombool=ve([[[],W.A,function(e,n,t){return"("+be("random")([],n,t)+">.5)"}]]),ke.randomnormal=ve([[[],W.f,be("randomnormal")]]),ke.arctan2=ve([[[W.f,W.f],W.f,function(e){return"atan("+e[1]+", "+e[0]+")"}],[[W.h,W.h],W.h,be("arctan2c")],[[W.h],W.f,be("arctan2vec2")],[[W.F],W.f,be("arctan2vec2")],[[W.da(2)],W.h,be("arctan2cvec2")]]),["red","green","blue","gray","hue"].forEach((function(e){ke[e]=ve([[[W.f],W.J,be(e)]])})),ke.grey=ke.gray,ke.min=function(e){var n=ve([[[W.f,W.f],W.f,Ge("min")]])(e);return n||(1===e.length&&1===re(e[0])&&Q(e[0])?{o:e,s:e[0].parameters,l:Be(e[0])}:void 0)},ke.max=function(e){var n=ve([[[W.u,W.u],W.u,Ge("max")],[[W.f,W.f],W.f,Ge("max")]])(e);return n||(1===e.length&&1===re(e[0])&&Q(e[0])?{o:e,s:e[0].parameters,l:Ne(e[0])}:void 0)},ke.pow=function(e){if(ne(e[1])&&fe(e[0],W.f)){var n=Number(e[1].value.value.real);if(0<=n)return{o:[W.f,e[1]],s:W.f,l:Je(n)}}return ve([[[W.f,W.u],W.f,be("powi")],[[W.h,W.h],W.h,be("powc")]])(e)},ke["^"]=ke.pow,ke.re=ve([[[W.h],W.f,function(e){return"("+e+").x"}]]),ke.conjugate=ve([[[W.h],W.h,be("conjugate")]]),ke.im=ve([[[W.h],W.f,function(e){return"("+e+").y"}]]),ke.genList=function(e){var n=e.length;if(0<n){var t,r=!1;for(t in e)r=pe(r,e[t]);if(r)return e=H(n,r),{o:Array(n).fill(r),s:e,l:Ie(e)}}return!1},ke["&"]=ve([[[W.A,W.A],W.A,Ve("&&")]]),ke["%"]=ve([[[W.A,W.A],W.A,Ve("||")]]),"> < >= <= == !=".split(" ").forEach((function(e){ke[e]=ve([[[W.u,W.u],W.A,Ve(e)],[[W.f,W.f],W.A,Ve(e)]])})),ke["!"]=ve([[[W.A],W.A,Ge("!")],[[W.T,W.A],W.A,function(e){return Ge("!")([e[1]])}]]),ke.not=ke["!"],ke.imagergb=ve([[[W.image,W.K],W.J,function(e,n,t){return t.add("uniforms","corners",(function(){return"uniform vec2 _lowerleft, _lowerright;"})),["(_imagergba",un(e[0],n,t),"(_lowerleft, _lowerright, ",e[1],").rgb)"].join("")}],[[W.K,W.K,W.image,W.K],W.J,function(e,n,t){return["(_imagergba",un(e[2],n,t),"(",e[0],",",e[1],",",e[3],").rgb)"].join("")}]]),ke.imagergba=ve([[[W.image,W.K],W.O,function(e,n,t){return t.add("uniforms","corners",(function(){return"uniform vec2 _lowerleft, _lowerright;"})),["_imagergba",un(e[0],n,t),"(_lowerleft, _lowerright, ",e[1],")"].join("")}],[[W.K,W.K,W.image,W.K],W.O,function(e,n,t){return["_imagergba",un(e[2],n,t),"(",e[0],",",e[1],",",e[3],")"].join("")}]]),ke.reverse=function(e){return 1===e.length&&"list"===e[0].type&&{o:e,s:e[0],l:Ue(e[0])}},ke.sort=function(e){return!(1!==e.length||1!==re(e[0])||!Q(e[0]))&&{o:e,s:e[0],l:$e(e[0])}},ke.transpose=function(e){return 1===e.length&&2<=re(e[0])&&{o:e,s:H(e[0].parameters.length,H(e[0].length,e[0].parameters.parameters)),l:ze(e[0])}},ke.det=ve([[[W.Y],W.f,be("det2")],[[W.Z],W.f,be("det3")],[[W.$],W.f,be("det4")],[[W.w,W.w,W.w],W.f,be("det3v")]]),Object.freeze(ke),he.powc=["expc","multc","logc"],he.sqrtc=["expc","multc","logc"],he.arccosc=["multc","negc","sqrtc","addc","logc"],he.arcsinc=["multc","negc","sqrtc","addc","logc"],he.tanc=["sinc","cosc","divc"],he.arctanc=["logc","addc","multc","subc"],he.arctan2c=["logc","divc","sqrtc","multc"],he.arctan2vec2c=["arctan2c"],he.hue=["hsv2rgb"],he.randomnormal=["random"],he.subpoints=["dehomogenize"],he.addpoints=["dehomogenize"],Object.freeze(he),Ye.prototype.add=function(e,n,t){this.mark(e,n),this.j[e].ia[n]||(this.j[e].ia[n]=t(),this.j[e].ga[n]=!0,this.j[e].order.push(n))},Ye.prototype.mark=function(e,n){this.j[e]||(this.j[e]={order:[],ga:{},ia:{}});var t=this.j[e].ga[n]||!1;return this.j[e].ga[n]=!0,t},fn.prototype.toString=function(){return this.message},pn.prototype.use=function(e){return e.useProgram(this.handle),this}}).call(this);
//# sourceMappingURL=index.c6764998.js.map
