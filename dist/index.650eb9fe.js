/*
 npm.im/iphone-inline-video 2.0.2  npm.im/intervalometer  https://github.com/paulmillr/es6-shim
 @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
   and contributors,  MIT License
 es6-shim: v0.35.4
 see https://github.com/paulmillr/es6-shim/blob/0.35.3/LICENSE
 Details and documentation:
 https://github.com/paulmillr/es6-shim/
*/
"use strict";var $jscomp=$jscomp||{};$jscomp.scope={},$jscomp.ASSUME_ES5=!1,$jscomp.ASSUME_NO_NATIVE_MAP=!1,$jscomp.ASSUME_NO_NATIVE_SET=!1,$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,r){e!=Array.prototype&&e!=Object.prototype&&(e[t]=r.value)},$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e},$jscomp.global=$jscomp.getGlobal(this),$jscomp.SYMBOL_PREFIX="jscomp_symbol_",$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){},$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)},$jscomp.Symbol=function(){var e=0;return function(t){return $jscomp.SYMBOL_PREFIX+(t||"")+e++}}(),$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}}),$jscomp.initSymbolIterator=function(){}},$jscomp.arrayIterator=function(e){var t=0;return $jscomp.iteratorPrototype((function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}))},$jscomp.iteratorPrototype=function(e){return $jscomp.initSymbolIterator(),(e={next:e})[$jscomp.global.Symbol.iterator]=function(){return this},e},$jscomp.makeIterator=function(e){$jscomp.initSymbolIterator(),$jscomp.initSymbol(),$jscomp.initSymbolIterator();var t=e[Symbol.iterator];return t?t.call(e):$jscomp.arrayIterator(e)},$jscomp.arrayFromIterator=function(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r},$jscomp.arrayFromIterable=function(e){return e instanceof Array?e:$jscomp.arrayFromIterator($jscomp.makeIterator(e))},$jscomp.polyfill=function(e,t,r,n){if(t){for(r=$jscomp.global,e=e.split("."),n=0;n<e.length-1;n++){var i=e[n];i in r||(r[i]={}),r=r[i]}(t=t(n=r[e=e[e.length-1]]))!=n&&null!=t&&$jscomp.defineProperty(r,e,{configurable:!0,writable:!0,value:t})}},$jscomp.FORCE_POLYFILL_PROMISE=!1,$jscomp.polyfill("Promise",(function(e){function t(){this.batch_=null}function r(e){return e instanceof i?e:new i((function(t,r){t(e)}))}if(e&&!$jscomp.FORCE_POLYFILL_PROMISE)return e;t.prototype.asyncExecute=function(e){return null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_()),this.batch_.push(e),this},t.prototype.asyncExecuteBatch_=function(){var e=this;this.asyncExecuteFunction((function(){e.executeBatch_()}))};var n=$jscomp.global.setTimeout;t.prototype.asyncExecuteFunction=function(e){n(e,0)},t.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var r=e[t];e[t]=null;try{r()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},t.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var i=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[];var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};i.prototype.createResolveAndReject_=function(){function e(e){return function(n){r||(r=!0,e.call(t,n))}}var t=this,r=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},i.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof i)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},i.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},i.prototype.reject_=function(e){this.settle_(2,e)},i.prototype.fulfill_=function(e){this.settle_(1,e)},i.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,this.executeOnSettledCallbacks_()},i.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)a.asyncExecute(this.onSettledCallbacks_[e]);this.onSettledCallbacks_=null}};var a=new t;return i.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},i.prototype.settleSameAsThenable_=function(e,t){var r=this.createResolveAndReject_();try{e.call(t,r.resolve,r.reject)}catch(e){r.reject(e)}},i.prototype.then=function(e,t){function r(e,t){return"function"==typeof e?function(t){try{n(e(t))}catch(e){a(e)}}:t}var n,a,o=new i((function(e,t){n=e,a=t}));return this.callWhenSettled_(r(e,n),r(t,a)),o},i.prototype.catch=function(e){return this.then(void 0,e)},i.prototype.callWhenSettled_=function(e,t){function r(){switch(n.state_){case 1:e(n.result_);break;case 2:t(n.result_);break;default:throw Error("Unexpected state: "+n.state_)}}var n=this;null==this.onSettledCallbacks_?a.asyncExecute(r):this.onSettledCallbacks_.push(r)},i.resolve=r,i.reject=function(e){return new i((function(t,r){r(e)}))},i.race=function(e){return new i((function(t,n){for(var i=$jscomp.makeIterator(e),a=i.next();!a.done;a=i.next())r(a.value).callWhenSettled_(t,n)}))},i.all=function(e){var t=$jscomp.makeIterator(e),n=t.next();return n.done?r([]):new i((function(e,i){function a(t){return function(r){o[t]=r,0==--l&&e(o)}}var o=[],l=0;do{o.push(void 0),l++,r(n.value).callWhenSettled_(a(o.length-1),i),n=t.next()}while(!n.done)}))},i}),"es6","es3"),$jscomp.iteratorFromArray=function(e,t){$jscomp.initSymbolIterator(),e instanceof String&&(e+="");var r=0,n={next:function(){if(r<e.length){var i=r++;return{value:t(i,e[i]),done:!1}}return n.next=function(){return{done:!0,value:void 0}},n.next()}};return n[Symbol.iterator]=function(){return n},n},$jscomp.polyfill("Array.prototype.keys",(function(e){return e||function(){return $jscomp.iteratorFromArray(this,(function(e){return e}))}}),"es6","es3"),$jscomp.polyfill("Number.isNaN",(function(e){return e||function(e){return"number"==typeof e&&isNaN(e)}}),"es6","es3"),$jscomp.polyfill("Number.isFinite",(function(e){return e||function(e){return"number"==typeof e&&(!isNaN(e)&&1/0!==e&&-1/0!==e)}}),"es6","es3"),$jscomp.polyfill("Math.sign",(function(e){return e||function(e){return 0===(e=Number(e))||isNaN(e)?e:0<e?1:-1}}),"es6","es3"),$jscomp.polyfill("Number.EPSILON",(function(e){return Math.pow(2,-52)}),"es6","es3"),$jscomp.polyfill("Number.MAX_SAFE_INTEGER",(function(){return 9007199254740991}),"es6","es3"),$jscomp.checkStringArgs=function(e,t,r){if(null==e)throw new TypeError("The 'this' value for String.prototype."+r+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+r+" must not be a regular expression");return e+""},$jscomp.polyfill("String.prototype.startsWith",(function(e){return e||function(e,t){var r=$jscomp.checkStringArgs(this,e,"startsWith");e+="";var n=r.length,i=e.length;t=Math.max(0,Math.min(0|t,r.length));for(var a=0;a<i&&t<n;)if(r[t++]!=e[a++])return!1;return a>=i}}),"es6","es3"),$jscomp.polyfill("String.prototype.endsWith",(function(e){return e||function(e,t){var r=$jscomp.checkStringArgs(this,e,"endsWith");e+="",void 0===t&&(t=r.length),t=Math.max(0,Math.min(0|t,r.length));for(var n=e.length;0<n&&0<t;)if(r[--t]!=e[--n])return!1;return 0>=n}}),"es6","es3"),$jscomp.polyfill("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}}),"es6","es3"),$jscomp.polyfill("Array.prototype.includes",(function(e){return e||function(e,t){var r=this;r instanceof String&&(r=String(r));var n=r.length;for(0>(t=t||0)&&(t=Math.max(t+n,0));t<n;t++){var i=r[t];if(i===e||Object.is(i,e))return!0}return!1}}),"es7","es3"),$jscomp.polyfill("String.prototype.includes",(function(e){return e||function(e,t){return-1!==$jscomp.checkStringArgs(this,e,"includes").indexOf(e,t||0)}}),"es6","es3"),$jscomp.polyfill("Array.prototype.values",(function(e){return e||function(){return $jscomp.iteratorFromArray(this,(function(e,t){return t}))}}),"es8","es3"),$jscomp.polyfill("Array.from",(function(e){return e||function(e,t,r){$jscomp.initSymbolIterator(),t=null!=t?t:function(e){return e};var n=[],i=e[Symbol.iterator];if("function"==typeof i)for(e=i.call(e);!(i=e.next()).done;)n.push(t.call(r,i.value));else{i=e.length;for(var a=0;a<i;a++)n.push(t.call(r,e[a]))}return n}}),"es6","es3"),$jscomp.polyfill("Array.prototype.entries",(function(e){return e||function(){return $jscomp.iteratorFromArray(this,(function(e,t){return[e,t]}))}}),"es6","es3"),$jscomp.polyfill("Number.isInteger",(function(e){return e||function(e){return!!Number.isFinite(e)&&e===Math.floor(e)}}),"es6","es3"),$jscomp.findInternal=function(e,t,r){e instanceof String&&(e=String(e));for(var n=e.length,i=0;i<n;i++){var a=e[i];if(t.call(r,a,i,e))return{i:i,v:a}}return{i:-1,v:void 0}},$jscomp.polyfill("Array.prototype.find",(function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).v}}),"es6","es3"),$jscomp.polyfill("Array.prototype.findIndex",(function(e){return e||function(e,t){return $jscomp.findInternal(this,e,t).i}}),"es6","es3"),$jscomp.polyfill("Object.getOwnPropertySymbols",(function(e){return e||function(){return[]}}),"es6","es5"),$jscomp.polyfill("Math.expm1",(function(e){return e||function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,r=1,n=e,i=0;i!=n;)n=(i=n)+(t*=e/++r);return n}return Math.exp(e)-1}}),"es6","es3"),$jscomp.polyfill("Math.sinh",(function(e){if(e)return e;var t=Math.exp;return function(e){return 0===(e=Number(e))?e:(t(e)-t(-e))/2}}),"es6","es3"),$jscomp.polyfill("Math.cosh",(function(e){if(e)return e;var t=Math.exp;return function(e){return e=Number(e),(t(e)+t(-e))/2}}),"es6","es3"),$jscomp.polyfill("Math.log1p",(function(e){return e||function(e){if(.25>(e=Number(e))&&-.25<e){for(var t=e,r=1,n=e,i=0,a=1;i!=n;)n=(i=n)+(a*=-1)*(t*=e)/++r;return n}return Math.log(1+e)}}),"es6","es3"),$jscomp.polyfill("Math.asinh",(function(e){return e||function(e){if(0===(e=Number(e)))return e;var t=Math.log(Math.abs(e)+Math.sqrt(e*e+1));return 0>e?-t:t}}),"es6","es3"),$jscomp.polyfill("Math.atanh",(function(e){if(e)return e;var t=Math.log1p;return function(e){return e=Number(e),(t(e)-t(-e))/2}}),"es6","es3"),$jscomp.polyfill("Math.tanh",(function(e){return e||function(e){if(0===(e=Number(e)))return e;var t=Math.exp(-2*Math.abs(e));return t=(1-t)/(1+t),0>e?-t:t}}),"es6","es3"),$jscomp.polyfill("Math.acosh",(function(e){return e||function(e){return e=Number(e),Math.log(e+Math.sqrt(e*e-1))}}),"es6","es3"),$jscomp.polyfill("Math.cbrt",(function(e){return e||function(e){if(0===e)return e;e=Number(e);var t=Math.pow(Math.abs(e),1/3);return 0>e?-t:t}}),"es6","es3"),$jscomp.polyfill("Math.imul",(function(e){return e||function(e,t){var r=65535&(e=Number(e)),n=65535&(t=Number(t));return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0}}),"es6","es3"),$jscomp.checkEs6ConformanceViaProxy=function(){try{var e={},t=Object.create(new $jscomp.global.Proxy(e,{get:function(r,n,i){return r==e&&"q"==n&&i==t}}));return!0===t.q}catch(e){return!1}},$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy(),$jscomp.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},$jscomp.polyfill("WeakMap",(function(e){function t(e){$jscomp.owns(e,n)||$jscomp.defineProperty(e,n,{value:{}})}function r(e){var r=Object[e];r&&(Object[e]=function(e){return t(e),r(e)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&$jscomp.ES6_CONFORMANCE)return e}else if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),r=Object.seal({}),n=new e([[t,2],[r,3]]);return 2==n.get(t)&&3==n.get(r)&&(n.delete(t),n.set(r,4),!n.has(t)&&4==n.get(r))}catch(e){return!1}}())return e;var n="$jscomp_hidden_"+Math.random();r("freeze"),r("preventExtensions"),r("seal");var i=0,a=function(e){if(this.id_=(i+=Math.random()+1).toString(),e){$jscomp.initSymbol(),$jscomp.initSymbolIterator(),e=$jscomp.makeIterator(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}};return a.prototype.set=function(e,r){if(t(e),!$jscomp.owns(e,n))throw Error("WeakMap key fail: "+e);return e[n][this.id_]=r,this},a.prototype.get=function(e){return $jscomp.owns(e,n)?e[n][this.id_]:void 0},a.prototype.has=function(e){return $jscomp.owns(e,n)&&$jscomp.owns(e[n],this.id_)},a.prototype.delete=function(e){return!(!$jscomp.owns(e,n)||!$jscomp.owns(e[n],this.id_))&&delete e[n][this.id_]},a}),"es6","es3"),$jscomp.MapEntry=function(){},$jscomp.polyfill("Map",(function(e){if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&$jscomp.ES6_CONFORMANCE)return e}else if(function(){if($jscomp.ASSUME_NO_NATIVE_MAP||!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),r=new e($jscomp.makeIterator([[t,"s"]]));if("s"!=r.get(t)||1!=r.size||r.get({x:4})||r.set({x:4},"t")!=r||2!=r.size)return!1;var n=r.entries(),i=n.next();return!i.done&&i.value[0]==t&&"s"==i.value[1]&&!((i=n.next()).done||4!=i.value[0].x||"t"!=i.value[1]||!n.next().done)}catch(e){return!1}}())return e;$jscomp.initSymbol(),$jscomp.initSymbolIterator();var t=new WeakMap,r=function(e){if(this.data_={},this.head_=a(),this.size=0,e){e=$jscomp.makeIterator(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}};r.prototype.set=function(e,t){var r=n(this,e=0===e?0:e);return r.list||(r.list=this.data_[r.id]=[]),r.entry?r.entry.value=t:(r.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:e,value:t},r.list.push(r.entry),this.head_.previous.next=r.entry,this.head_.previous=r.entry,this.size++),this},r.prototype.delete=function(e){return!(!(e=n(this,e)).entry||!e.list)&&(e.list.splice(e.index,1),e.list.length||delete this.data_[e.id],e.entry.previous.next=e.entry.next,e.entry.next.previous=e.entry.previous,e.entry.head=null,this.size--,!0)},r.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=a(),this.size=0},r.prototype.has=function(e){return!!n(this,e).entry},r.prototype.get=function(e){return(e=n(this,e).entry)&&e.value},r.prototype.entries=function(){return i(this,(function(e){return[e.key,e.value]}))},r.prototype.keys=function(){return i(this,(function(e){return e.key}))},r.prototype.values=function(){return i(this,(function(e){return e.value}))},r.prototype.forEach=function(e,t){for(var r,n=this.entries();!(r=n.next()).done;)r=r.value,e.call(t,r[1],r[0],this)},r.prototype[Symbol.iterator]=r.prototype.entries;var n=function(e,r){var n=r&&typeof r;"object"==n||"function"==n?t.has(r)?n=t.get(r):(n=""+ ++o,t.set(r,n)):n="p_"+r;var i=e.data_[n];if(i&&$jscomp.owns(e.data_,n))for(e=0;e<i.length;e++){var a=i[e];if(r!=r&&a.key!=a.key||r===a.key)return{id:n,list:i,index:e,entry:a}}return{id:n,list:i,index:-1,entry:void 0}},i=function(e,t){var r=e.head_;return $jscomp.iteratorPrototype((function(){if(r){for(;r.head!=e.head_;)r=r.previous;for(;r.next!=r.head;)return r=r.next,{done:!1,value:t(r)};r=null}return{done:!0,value:void 0}}))},a=function(){var e={};return e.previous=e.next=e.head=e},o=0;return r}),"es6","es3"),$jscomp.polyfill("Set",(function(e){if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(e&&$jscomp.ES6_CONFORMANCE)return e}else if(function(){if($jscomp.ASSUME_NO_NATIVE_SET||!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),r=new e($jscomp.makeIterator([t]));if(!r.has(t)||1!=r.size||r.add(t)!=r||1!=r.size||r.add({x:4})!=r||2!=r.size)return!1;var n=r.entries(),i=n.next();return!i.done&&i.value[0]==t&&i.value[1]==t&&(!(i=n.next()).done&&i.value[0]!=t&&4==i.value[0].x&&i.value[1]==i.value[0]&&n.next().done)}catch(e){return!1}}())return e;$jscomp.initSymbol(),$jscomp.initSymbolIterator();var t=function(e){if(this.map_=new Map,e){e=$jscomp.makeIterator(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.map_.size};return t.prototype.add=function(e){return e=0===e?0:e,this.map_.set(e,e),this.size=this.map_.size,this},t.prototype.delete=function(e){return e=this.map_.delete(e),this.size=this.map_.size,e},t.prototype.clear=function(){this.map_.clear(),this.size=0},t.prototype.has=function(e){return this.map_.has(e)},t.prototype.entries=function(){return this.map_.entries()},t.prototype.values=function(){return this.map_.values()},t.prototype.keys=t.prototype.values,t.prototype[Symbol.iterator]=t.prototype.values,t.prototype.forEach=function(e,t){var r=this;this.map_.forEach((function(n){return e.call(t,n,n,r)}))},t}),"es6","es3"),$jscomp.underscoreProtoCanBeSet=function(){var e={};try{return e.__proto__={a:!0},e.a}catch(e){}return!1},$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,$jscomp.polyfill("Object.setPrototypeOf",(function(e){return e||$jscomp.setPrototypeOf}),"es6","es5"),$jscomp.assign="function"==typeof Object.assign?Object.assign:function(e,t){for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n)for(var i in n)$jscomp.owns(n,i)&&(e[i]=n[i])}return e},$jscomp.polyfill("Object.assign",(function(e){return e||$jscomp.assign}),"es6","es3"),$jscomp.polyfill("Object.values",(function(e){return e||function(e){var t,r=[];for(t in e)$jscomp.owns(e,t)&&r.push(e[t]);return r}}),"es8","es3"),$jscomp.polyfill("Array.prototype.fill",(function(e){return e||function(e,t,r){var n=this.length||0;for(0>t&&(t=Math.max(0,n+t)),(null==r||r>n)&&(r=n),0>(r=Number(r))&&(r=Math.max(0,n+r)),t=Number(t||0);t<r;t++)this[t]=e;return this}}),"es6","es3");var enableInlineVideo=function(){function e(e,t,r,n){function i(t){!!e[r]==!!n&&t.stopImmediatePropagation(),delete e[r]}return e.addEventListener(t,i,!1),i}function t(e,t,r,n){function i(e){r[t]=e}n&&i(e[t]),Object.defineProperty(e,t,{get:function(){return r[t]},set:i})}function r(e,t,r){r.addEventListener(t,(function(){return e.dispatchEvent(new Event(t))}))}function n(e,t){Promise.resolve().then((function(){e.dispatchEvent(new Event(t))}))}function i(e,t,r){(u||0)+200<Date.now()&&(e[f]=!0,u=Date.now()),r||(e.currentTime=t),d[++m%3]=100*t|0}function a(e){this.video.readyState>=this.video.HAVE_FUTURE_DATA?(this.hasAudio||(this.driver.currentTime=this.video.currentTime+e*this.video.playbackRate/1e3,this.video.loop&&this.driver.currentTime>=this.video.duration&&(this.driver.currentTime=0)),i(this.video,this.driver.currentTime)):this.video.networkState===this.video.NETWORK_IDLE&&0===this.video.buffered.length&&this.video.load(),this.video.ended&&(delete this.video[f],this.video.pause(!0))}function o(){var e=this[p];return this.webkitDisplayingFullscreen?void this[h]():("data:"!==e.driver.src&&e.driver.src!==this.src&&(i(this,0,!0),e.driver.src=this.src),void(this.paused&&(e.paused=!1,0===this.buffered.length&&this.load(),e.driver.play(),e.updater.start(),e.hasAudio||(n(this,"play"),e.video.readyState>=e.video.HAVE_ENOUGH_DATA&&n(this,"playing")))))}function l(e){var t=this[p];t.driver.pause(),t.updater.stop(),this.webkitDisplayingFullscreen&&this[v](),t.paused&&!e||(t.paused=!0,t.hasAudio||n(this,"pause"),this.ended&&(this[f]=!0,n(this,"ended")))}function s(e,t){var o=e[p]={};o.paused=!0,o.hasAudio=t,o.video=e,o.updater=function(e,t,r,n){function i(r){a=t(i,n),e(r-(o||r)),o=r}var a,o;return{start:function(){a||i(0)},stop:function(){r(a),a=null,o=0}}}(a.bind(o),requestAnimationFrame,cancelAnimationFrame),t?o.driver=function(e){var t=new Audio;return r(e,"play",t),r(e,"playing",t),r(e,"pause",t),t.crossOrigin=e.crossOrigin,t.src=e.src||e.currentSrc||"data:",t}(e):(e.addEventListener("canplay",(function(){e.paused||n(e,"playing")})),o.driver={src:e.src||e.currentSrc||"data:",muted:!0,paused:!0,pause:function(){o.driver.paused=!0},play:function(){o.driver.paused=!1,o.driver.currentTime>=o.video.duration&&i(e,0)},get ended(){return o.driver.currentTime>=o.video.duration}}),e.addEventListener("emptied",(function(){var t=!o.driver.src||"data:"===o.driver.src;o.driver.src&&o.driver.src!==e.src&&(i(e,0,!0),o.driver.src=e.src,t?o.driver.play():o.updater.stop())}),!1),e.addEventListener("webkitbeginfullscreen",(function(){e.paused?t&&0===o.driver.buffered.length&&o.driver.load():(e.pause(),e[h]())})),t&&(e.addEventListener("webkitendfullscreen",(function(){o.driver.currentTime=e.currentTime})),e.addEventListener("seeking",(function(){0>d.indexOf(100*e.currentTime|0)&&(o.driver.currentTime=e.currentTime)})))}var u,c="object"==typeof document&&"object-fit"in document.head.style&&!matchMedia("(-webkit-video-playable-inline)").matches,p="bfred-it:iphone-inline-video",f="bfred-it:iphone-inline-video:event",h="bfred-it:iphone-inline-video:nativeplay",v="bfred-it:iphone-inline-video:nativepause",d=[],m=0;return function(r,n){void 0===n&&(n={}),r[p]||(n.everywhere||c&&(n.iPad||n.ipad?/iPhone|iPod|iPad/:/iPhone|iPod/).test(navigator.userAgent))&&(!r.paused&&r.webkitDisplayingFullscreen&&r.pause(),s(r,!r.muted),n=r[p],r[h]=r.play,r[v]=r.pause,r.play=o,r.pause=l,t(r,"paused",n.driver),t(r,"muted",n.driver,!0),t(r,"playbackRate",n.driver,!0),t(r,"ended",n.driver),t(r,"loop",n.driver,!0),e(r,"seeking"),e(r,"seeked"),e(r,"timeupdate",f,!1),e(r,"ended",f,!1),r.classList.add("IIV"),r.muted&&r.autoplay&&r.play(),/iPhone|iPod|iPad/.test(navigator.platform)||console.warn("iphone-inline-video is not guaranteed to work in emulated environments"))}}();!function(){function e(e,t,r){v.biginteger_used=1,null!=e&&("number"==typeof e&&void 0===t?this.fromInt(e):"number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function t(){return new e(null,void 0,void 0)}function r(e,t){return null==(e=S[e.charCodeAt(t)])?-1:e}function n(e){var r=t();return r.fromInt(e),r}function i(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=e>>1&&(r+=1),r}function a(e){this.m=e}function o(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function l(e,t){return e&t}function s(e,t){return e|t}function u(e,t){return e^t}function c(e,t){return e&~t}function p(){}function f(e){return e}function h(r){this.r2=t(),this.q3=t(),e.ONE.dlShiftTo(2*r.t,this.r2),this.mu=this.r2.divide(r),this.m=r}var v={use_lines:!0,use_xyz:!1},d=!1;if("undefined"!=typeof module&&module.exports?(module.exports=v,d=!0):"undefined"!=typeof document?window.ClipperLib=v:self.ClipperLib=v,d){g="chrome";var m="Netscape"}else{var g=navigator.userAgent.toString().toLowerCase();m=navigator.appName}var y=-1!=g.indexOf("chrome")&&-1==g.indexOf("chromium")?1:0;d=-1!=g.indexOf("chromium")?1:0;var b=-1!=g.indexOf("safari")&&-1==g.indexOf("chrome")&&-1==g.indexOf("chromium")?1:0,P=-1!=g.indexOf("firefox")?1:0;g.indexOf("firefox/17"),g.indexOf("firefox/15"),g.indexOf("firefox/3");var x=-1!=g.indexOf("opera")?1:0;g.indexOf("msie 10"),g.indexOf("msie 9");var C=-1!=g.indexOf("msie 8")?1:0,_=-1!=g.indexOf("msie 7")?1:0;g=-1!=g.indexOf("msie ")?1:0,v.biginteger_used=null,"Microsoft Internet Explorer"==m?(e.prototype.am=function(e,t,r,n,i,a){var o=32767&t;for(t>>=15;0<=--a;){var l=32767&this[e],s=this[e++]>>15,u=t*l+s*o;i=((l=o*l+((32767&u)<<15)+r[n]+(1073741823&i))>>>30)+(u>>>15)+t*s+(i>>>30),r[n++]=1073741823&l}return i},m=30):"Netscape"!=m?(e.prototype.am=function(e,t,r,n,i,a){for(;0<=--a;){var o=t*this[e++]+r[n]+i;i=Math.floor(o/67108864),r[n++]=67108863&o}return i},m=26):(e.prototype.am=function(e,t,r,n,i,a){var o=16383&t;for(t>>=14;0<=--a;){var l=16383&this[e],s=this[e++]>>14,u=t*l+s*o;i=((l=o*l+((16383&u)<<14)+r[n]+i)>>28)+(u>>14)+t*s,r[n++]=268435455&l}return i},m=28),e.prototype.DB=m,e.prototype.DM=(1<<m)-1,e.prototype.DV=1<<m,e.prototype.FV=Math.pow(2,52),e.prototype.F1=52-m,e.prototype.F2=2*m-52;var w,S=[];for(m=48,w=0;9>=w;++w)S[m++]=w;for(m=97,w=10;36>w;++w)S[m++]=w;for(m=65,w=10;36>w;++w)S[m++]=w;a.prototype.convert=function(e){return 0>e.s||0<=e.compareTo(this.m)?e.mod(this.m):e},a.prototype.revert=function(e){return e},a.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},a.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},a.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},o.prototype.convert=function(r){var n=t();return r.abs().dlShiftTo(this.m.t,n),n.divRemTo(this.m,null,n),0>r.s&&0<n.compareTo(e.ZERO)&&this.m.subTo(n,n),n},o.prototype.revert=function(e){var r=t();return e.copyTo(r),this.reduce(r),r},o.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e[t],n=r*this.mpl+((r*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[r=t+this.m.t]+=this.m.am(0,n,e,t,0,this.m.t);e[r]>=e.DV;)e[r]-=e.DV,e[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),0<=e.compareTo(this.m)&&e.subTo(this.m,e)},o.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},o.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},e.prototype.copyTo=function(e){for(var t=this.t-1;0<=t;--t)e[t]=this[t];e.t=this.t,e.s=this.s},e.prototype.fromInt=function(e){this.t=1,this.s=0>e?-1:0,0<e?this[0]=e:-1>e?this[0]=e+this.DV:this.t=0},e.prototype.fromString=function(t,n){if(16==n)n=4;else if(8==n)n=3;else if(256==n)n=8;else if(2==n)n=1;else if(32==n)n=5;else{if(4!=n)return void this.fromRadix(t,n);n=2}this.s=this.t=0;for(var i=t.length,a=!1,o=0;0<=--i;){var l=8==n?255&t[i]:r(t,i);0>l?"-"==t.charAt(i)&&(a=!0):(a=!1,0==o?this[this.t++]=l:o+n>this.DB?(this[this.t-1]|=(l&(1<<this.DB-o)-1)<<o,this[this.t++]=l>>this.DB-o):this[this.t-1]|=l<<o,(o+=n)>=this.DB&&(o-=this.DB))}8==n&&0!=(128&t[0])&&(this.s=-1,0<o&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),a&&e.ZERO.subTo(this,this)},e.prototype.clamp=function(){for(var e=this.s&this.DM;0<this.t&&this[this.t-1]==e;)--this.t},e.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;0<=r;--r)t[r+e]=this[r];for(r=e-1;0<=r;--r)t[r]=0;t.t=this.t+e,t.s=this.s},e.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t[r-e]=this[r];t.t=Math.max(this.t-e,0),t.s=this.s},e.prototype.lShiftTo=function(e,t){var r=e%this.DB,n=this.DB-r,i=(1<<n)-1;e=Math.floor(e/this.DB);var a,o=this.s<<r&this.DM;for(a=this.t-1;0<=a;--a)t[a+e+1]=this[a]>>n|o,o=(this[a]&i)<<r;for(a=e-1;0<=a;--a)t[a]=0;t[e]=o,t.t=this.t+e+1,t.s=this.s,t.clamp()},e.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{e%=this.DB;var n=this.DB-e,i=(1<<e)-1;t[0]=this[r]>>e;for(var a=r+1;a<this.t;++a)t[a-r-1]|=(this[a]&i)<<n,t[a-r]=this[a]>>e;0<e&&(t[this.t-r-1]|=(this.s&i)<<n),t.t=this.t-r,t.clamp()}},e.prototype.subTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]-e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e[r],t[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=0>n?-1:0,-1>n?t[r++]=this.DV+n:0<n&&(t[r++]=n),t.t=r,t.clamp()},e.prototype.multiplyTo=function(t,r){var n=this.abs(),i=t.abs(),a=n.t;for(r.t=a+i.t;0<=--a;)r[a]=0;for(a=0;a<i.t;++a)r[a+n.t]=n.am(0,i[a],r,a,0,n.t);r.s=0,r.clamp(),this.s!=t.s&&e.ZERO.subTo(r,r)},e.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;0<=--r;)e[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t[r],e,2*r,0,1);(e[r+t.t]+=t.am(r+1,2*t[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e[r+t.t]-=t.DV,e[r+t.t+1]=1)}0<e.t&&(e[e.t-1]+=t.am(r,t[r],e,2*r,0,1)),e.s=0,e.clamp()},e.prototype.divRemTo=function(r,n,a){var o=r.abs();if(!(0>=o.t)){var l=this.abs();if(l.t<o.t)null!=n&&n.fromInt(0),null!=a&&this.copyTo(a);else{null==a&&(a=t());var s=t(),u=this.s;r=r.s;var c=this.DB-i(o[o.t-1]);if(0<c?(o.lShiftTo(c,s),l.lShiftTo(c,a)):(o.copyTo(s),l.copyTo(a)),0!=(l=s[(o=s.t)-1])){var p=l*(1<<this.F1)+(1<o?s[o-2]>>this.F2:0),f=this.FV/p;p=(1<<this.F1)/p;var h=1<<this.F2,v=a.t,d=v-o,m=null==n?t():n;for(s.dlShiftTo(d,m),0<=a.compareTo(m)&&(a[a.t++]=1,a.subTo(m,a)),e.ONE.dlShiftTo(o,m),m.subTo(s,s);s.t<o;)s[s.t++]=0;for(;0<=--d;){var g=a[--v]==l?this.DM:Math.floor(a[v]*f+(a[v-1]+h)*p);if((a[v]+=s.am(0,g,a,d,0,o))<g)for(s.dlShiftTo(d,m),a.subTo(m,a);a[v]<--g;)a.subTo(m,a)}null!=n&&(a.drShiftTo(o,n),u!=r&&e.ZERO.subTo(n,n)),a.t=o,a.clamp(),0<c&&a.rShiftTo(c,a),0>u&&e.ZERO.subTo(a,a)}}}},e.prototype.invDigit=function(){if(1>this.t)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return 0<(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)?this.DV-t:-t},e.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},e.prototype.exp=function(r,n){if(4294967295<r||1>r)return e.ONE;var a=t(),o=t(),l=n.convert(this),s=i(r)-1;for(l.copyTo(a);0<=--s;)if(n.sqrTo(a,o),0<(r&1<<s))n.mulTo(o,l,a);else{var u=a;a=o,o=u}return n.revert(a)},e.prototype.toString=function(e){if(0>this.s)return"-"+this.negate().toString(e);if(16==e)e=4;else if(8==e)e=3;else if(2==e)e=1;else if(32==e)e=5;else{if(4!=e)return this.toRadix(e);e=2}var t,r=(1<<e)-1,n=!1,i="",a=this.t,o=this.DB-a*this.DB%e;if(0<a--)for(o<this.DB&&0<(t=this[a]>>o)&&(n=!0,i="0123456789abcdefghijklmnopqrstuvwxyz".charAt(t));0<=a;)o<e?(t=(this[a]&(1<<o)-1)<<e-o,t|=this[--a]>>(o+=this.DB-e)):(t=this[a]>>(o-=e)&r,0>=o&&(o+=this.DB,--a)),0<t&&(n=!0),n&&(i+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(t));return n?i:"0"},e.prototype.negate=function(){var r=t();return e.ZERO.subTo(this,r),r},e.prototype.abs=function(){return 0>this.s?this.negate():this},e.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return 0>this.s?-t:t;for(;0<=--r;)if(0!=(t=this[r]-e[r]))return t;return 0},e.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+i(this[this.t-1]^this.s&this.DM)},e.prototype.mod=function(r){var n=t();return this.abs().divRemTo(r,null,n),0>this.s&&0<n.compareTo(e.ZERO)&&r.subTo(n,n),n},e.prototype.modPowInt=function(e,t){return t=256>e||t.isEven()?new a(t):new o(t),this.exp(e,t)},e.ZERO=n(0),e.ONE=n(1),p.prototype.convert=f,p.prototype.revert=f,p.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},p.prototype.sqrTo=function(e,t){e.squareTo(t)},h.prototype.convert=function(e){if(0>e.s||e.t>2*this.m.t)return e.mod(this.m);if(0>e.compareTo(this.m))return e;var r=t();return e.copyTo(r),this.reduce(r),r},h.prototype.revert=function(e){return e},h.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>e.compareTo(this.r2);)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);0<=e.compareTo(this.m);)e.subTo(this.m,e)},h.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},h.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var M=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],T=67108864/M[M.length-1];e.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},e.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||2>e||36<e)return"0";var r=this.chunkSize(e),i=n(r=Math.pow(e,r)),a=t(),o=t(),l="";for(this.divRemTo(i,a,o);0<a.signum();)l=(r+o.intValue()).toString(e).substr(1)+l,a.divRemTo(i,a,o);return o.intValue().toString(e)+l},e.prototype.fromRadix=function(t,n){this.fromInt(0),null==n&&(n=10);for(var i=this.chunkSize(n),a=Math.pow(n,i),o=!1,l=0,s=0,u=0;u<t.length;++u){var c=r(t,u);0>c?"-"==t.charAt(u)&&0==this.signum()&&(o=!0):(s=n*s+c,++l>=i&&(this.dMultiply(a),this.dAddOffset(s,0),s=l=0))}0<l&&(this.dMultiply(Math.pow(n,l)),this.dAddOffset(s,0)),o&&e.ZERO.subTo(this,this)},e.prototype.fromNumber=function(t,r,n){if("number"==typeof r)if(2>t)this.fromInt(1);else for(this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(e.ONE.shiftLeft(t-1),s,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(r);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(e.ONE.shiftLeft(t-1),this);else{var i=7&t;(n=[]).length=1+(t>>3),r.nextBytes(n),n[0]=0<i?n[0]&(1<<i)-1:0,this.fromString(n,256)}},e.prototype.bitwiseTo=function(e,t,r){var n,i=Math.min(e.t,this.t);for(n=0;n<i;++n)r[n]=t(this[n],e[n]);if(e.t<this.t){var a=e.s&this.DM;for(n=i;n<this.t;++n)r[n]=t(this[n],a);r.t=this.t}else{for(a=this.s&this.DM,n=i;n<e.t;++n)r[n]=t(a,e[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},e.prototype.changeBit=function(t,r){return t=e.ONE.shiftLeft(t),this.bitwiseTo(t,r,t),t},e.prototype.addTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this[r]+e[r],t[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this[r],t[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e[r],t[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=0>n?-1:0,0<n?t[r++]=n:-1>n&&(t[r++]=this.DV+n),t.t=r,t.clamp()},e.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},e.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},e.prototype.multiplyLowerTo=function(e,t,r){var n,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;0<i;)r[--i]=0;for(n=r.t-this.t;i<n;++i)r[i+this.t]=this.am(0,e[i],r,i,0,this.t);for(n=Math.min(e.t,t);i<n;++i)this.am(0,e[i],r,i,0,t-i);r.clamp()},e.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;0<=--n;)r[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r[this.t+n-t]=this.am(t-n,e[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},e.prototype.modInt=function(e){if(0>=e)return 0;var t=this.DV%e,r=0>this.s?e-1:0;if(0<this.t)if(0==t)r=this[0]%e;else for(var n=this.t-1;0<=n;--n)r=(t*r+this[n])%e;return r},e.prototype.millerRabin=function(r){var n=this.subtract(e.ONE),i=n.getLowestSetBit();if(0>=i)return!1;var a=n.shiftRight(i);(r=r+1>>1)>M.length&&(r=M.length);for(var o=t(),l=0;l<r;++l){o.fromInt(M[Math.floor(Math.random()*M.length)]);var s=o.modPow(a,this);if(0!=s.compareTo(e.ONE)&&0!=s.compareTo(n)){for(var u=1;u++<i&&0!=s.compareTo(n);)if(0==(s=s.modPowInt(2,this)).compareTo(e.ONE))return!1;if(0!=s.compareTo(n))return!1}}return!0},e.prototype.clone=function(){var e=t();return this.copyTo(e),e},e.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},e.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},e.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},e.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1},e.prototype.toByteArray=function(){var e=this.t,t=[];t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(0<e--)for(n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);0<=e;)8>n?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,0>=n&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(0<i||r!=this.s)&&(t[i++]=r);return t},e.prototype.equals=function(e){return 0==this.compareTo(e)},e.prototype.min=function(e){return 0>this.compareTo(e)?this:e},e.prototype.max=function(e){return 0<this.compareTo(e)?this:e},e.prototype.and=function(e){var r=t();return this.bitwiseTo(e,l,r),r},e.prototype.or=function(e){var r=t();return this.bitwiseTo(e,s,r),r},e.prototype.xor=function(e){var r=t();return this.bitwiseTo(e,u,r),r},e.prototype.andNot=function(e){var r=t();return this.bitwiseTo(e,c,r),r},e.prototype.not=function(){for(var e=t(),r=0;r<this.t;++r)e[r]=this.DM&~this[r];return e.t=this.t,e.s=~this.s,e},e.prototype.shiftLeft=function(e){var r=t();return 0>e?this.rShiftTo(-e,r):this.lShiftTo(e,r),r},e.prototype.shiftRight=function(e){var r=t();return 0>e?this.lShiftTo(-e,r):this.rShiftTo(e,r),r},e.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e]){var t=e*this.DB;if(0==(e=this[e]))e=-1;else{var r=0;0==(65535&e)&&(e>>=16,r+=16),0==(255&e)&&(e>>=8,r+=8),0==(15&e)&&(e>>=4,r+=4),0==(3&e)&&(e>>=2,r+=2),0==(1&e)&&++r,e=r}return t+e}return 0>this.s?this.t*this.DB:-1},e.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r){for(var n=this[r]^t,i=0;0!=n;)n&=n-1,++i;e+=i}return e},e.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this[t]&1<<e%this.DB)},e.prototype.setBit=function(e){return this.changeBit(e,s)},e.prototype.clearBit=function(e){return this.changeBit(e,c)},e.prototype.flipBit=function(e){return this.changeBit(e,u)},e.prototype.add=function(e){var r=t();return this.addTo(e,r),r},e.prototype.subtract=function(e){var r=t();return this.subTo(e,r),r},e.prototype.multiply=function(e){var r=t();return this.multiplyTo(e,r),r},e.prototype.divide=function(e){var r=t();return this.divRemTo(e,r,null),r},e.prototype.remainder=function(e){var r=t();return this.divRemTo(e,null,r),r},e.prototype.divideAndRemainder=function(e){var r=t(),n=t();return this.divRemTo(e,r,n),[r,n]},e.prototype.modPow=function(e,r){var l=e.bitLength(),s=n(1);if(0>=l)return s;var u=18>l?1:48>l?3:144>l?4:768>l?5:6;r=8>l?new a(r):r.isEven()?new h(r):new o(r);var c=[],p=3,f=u-1,v=(1<<u)-1;if(c[1]=r.convert(this),1<u)for(l=t(),r.sqrTo(c[1],l);p<=v;)c[p]=t(),r.mulTo(l,c[p-2],c[p]),p+=2;var d,m=e.t-1,g=!0,y=t();for(l=i(e[m])-1;0<=m;){for(l>=f?d=e[m]>>l-f&v:(d=(e[m]&(1<<l+1)-1)<<f-l,0<m&&(d|=e[m-1]>>this.DB+l-f)),p=u;0==(1&d);)d>>=1,--p;if(0>(l-=p)&&(l+=this.DB,--m),g)c[d].copyTo(s),g=!1;else{for(;1<p;)r.sqrTo(s,y),r.sqrTo(y,s),p-=2;0<p?r.sqrTo(s,y):(p=s,s=y,y=p),r.mulTo(y,c[d],s)}for(;0<=m&&0==(e[m]&1<<l);)r.sqrTo(s,y),p=s,s=y,y=p,0>--l&&(l=this.DB-1,--m)}return r.revert(s)},e.prototype.modInverse=function(t){var r=t.isEven();if(this.isEven()&&r||0==t.signum())return e.ZERO;for(var i=t.clone(),a=this.clone(),o=n(1),l=n(0),s=n(0),u=n(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),r?(o.isEven()&&l.isEven()||(o.addTo(this,o),l.subTo(t,l)),o.rShiftTo(1,o)):l.isEven()||l.subTo(t,l),l.rShiftTo(1,l);for(;a.isEven();)a.rShiftTo(1,a),r?(s.isEven()&&u.isEven()||(s.addTo(this,s),u.subTo(t,u)),s.rShiftTo(1,s)):u.isEven()||u.subTo(t,u),u.rShiftTo(1,u);0<=i.compareTo(a)?(i.subTo(a,i),r&&o.subTo(s,o),l.subTo(u,l)):(a.subTo(i,a),r&&s.subTo(o,s),u.subTo(l,u))}return 0!=a.compareTo(e.ONE)?e.ZERO:0<=u.compareTo(t)?u.subtract(t):0>u.signum()?(u.addTo(t,u),0>u.signum()?u.add(t):u):u},e.prototype.pow=function(e){return this.exp(e,new p)},e.prototype.gcd=function(e){var t=0>this.s?this.negate():this.clone();if(e=0>e.s?e.negate():e.clone(),0>t.compareTo(e)){var r=t;t=e,e=r}r=t.getLowestSetBit();var n=e.getLowestSetBit();if(0>n)return t;for(r<n&&(n=r),0<n&&(t.rShiftTo(n,t),e.rShiftTo(n,e));0<t.signum();)0<(r=t.getLowestSetBit())&&t.rShiftTo(r,t),0<(r=e.getLowestSetBit())&&e.rShiftTo(r,e),0<=t.compareTo(e)?(t.subTo(e,t),t.rShiftTo(1,t)):(e.subTo(t,e),e.rShiftTo(1,e));return 0<n&&e.lShiftTo(n,e),e},e.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r[0]<=M[M.length-1]){for(t=0;t<M.length;++t)if(r[0]==M[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<M.length;){for(var n=M[t],i=t+1;i<M.length&&n<T;)n*=M[i++];for(n=r.modInt(n);t<i;)if(0==n%M[t++])return!1}return r.millerRabin(e)},e.prototype.square=function(){var e=t();return this.squareTo(e),e},e.prototype.IsNegative=function(){return-1==this.compareTo(e.ZERO)},e.op_Equality=function(e,t){return 0==e.compareTo(t)},e.op_Inequality=function(e,t){return 0!=e.compareTo(t)},e.op_GreaterThan=function(e,t){return 0<e.compareTo(t)},e.op_LessThan=function(e,t){return 0>e.compareTo(t)},e.op_Addition=function(t,r){return new e(t).add(new e(r))},e.op_Subtraction=function(t,r){return new e(t).subtract(new e(r))},e.Int128Mul=function(t,r){return new e(t).multiply(new e(r))},e.op_Division=function(e,t){return e.divide(t)},e.prototype.ToDouble=function(){return parseFloat(this.toString())},m=function(e,t){var r;if(void 0===Object.getOwnPropertyNames)for(r in t.prototype)void 0!==e.prototype[r]&&e.prototype[r]!=Object.prototype[r]||(e.prototype[r]=t.prototype[r]);else for(var n=Object.getOwnPropertyNames(t.prototype),i=0;i<n.length;i++)void 0===Object.getOwnPropertyDescriptor(e.prototype,n[i])&&Object.defineProperty(e.prototype,n[i],Object.getOwnPropertyDescriptor(t.prototype,n[i]));for(r in t)void 0===e[r]&&(e[r]=t[r]);e.$baseCtor=t},v.Path=function(){return[]},v.Paths=function(){return[]},v.DoublePoint=function(){var e=arguments;this.Y=this.X=0,1==e.length?(this.X=e[0].X,this.Y=e[0].Y):2==e.length&&(this.X=e[0],this.Y=e[1])},v.DoublePoint0=function(){this.Y=this.X=0},v.DoublePoint1=function(e){this.X=e.X,this.Y=e.Y},v.DoublePoint2=function(e,t){this.X=e,this.Y=t},v.PolyNode=function(){this.m_Parent=null,this.m_polygon=new v.Path,this.m_endtype=this.m_jointype=this.m_Index=0,this.m_Childs=[],this.IsOpen=!1},v.PolyNode.prototype.IsHoleNode=function(){for(var e=!0,t=this.m_Parent;null!==t;)e=!e,t=t.m_Parent;return e},v.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},v.PolyNode.prototype.Contour=function(){return this.m_polygon},v.PolyNode.prototype.AddChild=function(e){var t=this.m_Childs.length;this.m_Childs.push(e),e.m_Parent=this,e.m_Index=t},v.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()},v.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},v.PolyNode.prototype.Childs=function(){return this.m_Childs},v.PolyNode.prototype.Parent=function(){return this.m_Parent},v.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},v.PolyTree=function(){this.m_AllPolys=[],v.PolyNode.call(this)},v.PolyTree.prototype.Clear=function(){for(var e=0,t=this.m_AllPolys.length;e<t;e++)this.m_AllPolys[e]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},v.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null},v.PolyTree.prototype.Total=function(){var e=this.m_AllPolys.length;return 0<e&&this.m_Childs[0]!=this.m_AllPolys[0]&&e--,e},m(v.PolyTree,v.PolyNode),v.Math_Abs_Int64=v.Math_Abs_Int32=v.Math_Abs_Double=function(e){return Math.abs(e)},v.Math_Max_Int32_Int32=function(e,t){return Math.max(e,t)},v.Cast_Int32=g||x||b?function(e){return 0|e}:function(e){return~~e},v.Cast_Int64=y?function(e){return-2147483648>e||2147483647<e?0>e?Math.ceil(e):Math.floor(e):~~e}:P&&"function"==typeof Number.toInteger?function(e){return Number.toInteger(e)}:_||C?function(e){return parseInt(e,10)}:g?function(e){return-2147483648>e||2147483647<e?0>e?Math.ceil(e):Math.floor(e):0|e}:function(e){return 0>e?Math.ceil(e):Math.floor(e)},v.Clear=function(e){e.length=0},v.PI=3.141592653589793,v.PI2=6.283185307179586,v.IntPoint=function(){var e=arguments,t=e.length;this.Y=this.X=0,v.use_xyz?(this.Z=0,3==t?(this.X=e[0],this.Y=e[1],this.Z=e[2]):2==t?(this.X=e[0],this.Y=e[1],this.Z=0):1==t?e[0]instanceof v.DoublePoint?(e=e[0],this.X=v.Clipper.Round(e.X),this.Y=v.Clipper.Round(e.Y),this.Z=0):(void 0===(e=e[0]).Z&&(e.Z=0),this.X=e.X,this.Y=e.Y,this.Z=e.Z):this.Z=this.Y=this.X=0):2==t?(this.X=e[0],this.Y=e[1]):1==t?e[0]instanceof v.DoublePoint?(e=e[0],this.X=v.Clipper.Round(e.X),this.Y=v.Clipper.Round(e.Y)):(e=e[0],this.X=e.X,this.Y=e.Y):this.Y=this.X=0},v.IntPoint.op_Equality=function(e,t){return e.X==t.X&&e.Y==t.Y},v.IntPoint.op_Inequality=function(e,t){return e.X!=t.X||e.Y!=t.Y},v.use_xyz?(v.IntPoint0=function(){this.Z=this.Y=this.X=0},v.IntPoint1=function(e){this.X=e.X,this.Y=e.Y,this.Z=e.Z},v.IntPoint1dp=function(e){this.X=v.Clipper.Round(e.X),this.Y=v.Clipper.Round(e.Y),this.Z=0},v.IntPoint2=function(e,t){this.X=e,this.Y=t,this.Z=0},v.IntPoint3=function(e,t,r){this.X=e,this.Y=t,this.Z=r}):(v.IntPoint0=function(){this.Y=this.X=0},v.IntPoint1=function(e){this.X=e.X,this.Y=e.Y},v.IntPoint1dp=function(e){this.X=v.Clipper.Round(e.X),this.Y=v.Clipper.Round(e.Y)},v.IntPoint2=function(e,t){this.X=e,this.Y=t}),v.IntRect=function(){var e=arguments,t=e.length;4==t?(this.left=e[0],this.top=e[1],this.right=e[2],this.bottom=e[3]):1==t?(this.left=e[0].left,this.top=e[0].top,this.right=e[0].right,this.bottom=e[0].bottom):this.bottom=this.right=this.top=this.left=0},v.IntRect0=function(){this.bottom=this.right=this.top=this.left=0},v.IntRect1=function(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom},v.IntRect4=function(e,t,r,n){this.left=e,this.top=t,this.right=r,this.bottom=n},v.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},v.PolyType={ptSubject:0,ptClip:1},v.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},v.JoinType={jtSquare:0,jtRound:1,jtMiter:2},v.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},v.EdgeSide={esLeft:0,esRight:1},v.Direction={dRightToLeft:0,dLeftToRight:1},v.TEdge=function(){this.Bot=new v.IntPoint,this.Curr=new v.IntPoint,this.Top=new v.IntPoint,this.Delta=new v.IntPoint,this.Dx=0,this.PolyTyp=v.PolyType.ptSubject,this.Side=v.EdgeSide.esLeft,this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0,this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null},v.IntersectNode=function(){this.Edge2=this.Edge1=null,this.Pt=new v.IntPoint},v.MyIntersectNodeSort=function(){},v.MyIntersectNodeSort.Compare=function(e,t){return 0<(e=t.Pt.Y-e.Pt.Y)?1:0>e?-1:0},v.LocalMinima=function(){this.Y=0,this.Next=this.RightBound=this.LeftBound=null},v.Scanbeam=function(){this.Y=0,this.Next=null},v.OutRec=function(){this.Idx=0,this.IsOpen=this.IsHole=!1,this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null},v.OutPt=function(){this.Idx=0,this.Pt=new v.IntPoint,this.Prev=this.Next=null},v.Join=function(){this.OutPt2=this.OutPt1=null,this.OffPt=new v.IntPoint},v.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null,this.m_edges=[],this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1,this.m_CurrentLM=this.m_MinimaList=null,this.m_HasOpenPaths=this.m_UseFullRange=!1},v.ClipperBase.horizontal=-9007199254740992,v.ClipperBase.Skip=-2,v.ClipperBase.Unassigned=-1,v.ClipperBase.tolerance=1e-20,v.ClipperBase.loRange=47453132,v.ClipperBase.hiRange=0xfffffffffffff,v.ClipperBase.near_zero=function(e){return e>-v.ClipperBase.tolerance&&e<v.ClipperBase.tolerance},v.ClipperBase.IsHorizontal=function(e){return 0===e.Delta.Y},v.ClipperBase.prototype.PointIsVertex=function(e,t){var r=t;do{if(v.IntPoint.op_Equality(r.Pt,e))return!0;r=r.Next}while(r!=t);return!1},v.ClipperBase.prototype.PointOnLineSegment=function(t,r,n,i){return i?t.X==r.X&&t.Y==r.Y||t.X==n.X&&t.Y==n.Y||t.X>r.X==t.X<n.X&&t.Y>r.Y==t.Y<n.Y&&e.op_Equality(e.Int128Mul(t.X-r.X,n.Y-r.Y),e.Int128Mul(n.X-r.X,t.Y-r.Y)):t.X==r.X&&t.Y==r.Y||t.X==n.X&&t.Y==n.Y||t.X>r.X==t.X<n.X&&t.Y>r.Y==t.Y<n.Y&&(t.X-r.X)*(n.Y-r.Y)==(n.X-r.X)*(t.Y-r.Y)},v.ClipperBase.prototype.PointOnPolygon=function(e,t,r){for(var n=t;;){if(this.PointOnLineSegment(e,n.Pt,n.Next.Pt,r))return!0;if((n=n.Next)==t)break}return!1},v.ClipperBase.prototype.SlopesEqual=v.ClipperBase.SlopesEqual=function(){var t,r,n=arguments,i=n.length;if(3==i)return i=n[0],t=n[1],n[2]?e.op_Equality(e.Int128Mul(i.Delta.Y,t.Delta.X),e.Int128Mul(i.Delta.X,t.Delta.Y)):v.Cast_Int64(i.Delta.Y*t.Delta.X)==v.Cast_Int64(i.Delta.X*t.Delta.Y);if(4==i)return i=n[0],t=n[1],r=n[2],n[3]?e.op_Equality(e.Int128Mul(i.Y-t.Y,t.X-r.X),e.Int128Mul(i.X-t.X,t.Y-r.Y)):0==v.Cast_Int64((i.Y-t.Y)*(t.X-r.X))-v.Cast_Int64((i.X-t.X)*(t.Y-r.Y));i=n[0],t=n[1],r=n[2];var a=n[3];return n[4]?e.op_Equality(e.Int128Mul(i.Y-t.Y,r.X-a.X),e.Int128Mul(i.X-t.X,r.Y-a.Y)):0==v.Cast_Int64((i.Y-t.Y)*(r.X-a.X))-v.Cast_Int64((i.X-t.X)*(r.Y-a.Y))},v.ClipperBase.SlopesEqual3=function(t,r,n){return n?e.op_Equality(e.Int128Mul(t.Delta.Y,r.Delta.X),e.Int128Mul(t.Delta.X,r.Delta.Y)):v.Cast_Int64(t.Delta.Y*r.Delta.X)==v.Cast_Int64(t.Delta.X*r.Delta.Y)},v.ClipperBase.SlopesEqual4=function(t,r,n,i){return i?e.op_Equality(e.Int128Mul(t.Y-r.Y,r.X-n.X),e.Int128Mul(t.X-r.X,r.Y-n.Y)):0==v.Cast_Int64((t.Y-r.Y)*(r.X-n.X))-v.Cast_Int64((t.X-r.X)*(r.Y-n.Y))},v.ClipperBase.SlopesEqual5=function(t,r,n,i,a){return a?e.op_Equality(e.Int128Mul(t.Y-r.Y,n.X-i.X),e.Int128Mul(t.X-r.X,n.Y-i.Y)):0==v.Cast_Int64((t.Y-r.Y)*(n.X-i.X))-v.Cast_Int64((t.X-r.X)*(n.Y-i.Y))},v.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var e=0,t=this.m_edges.length;e<t;++e){for(var r=0,n=this.m_edges[e].length;r<n;++r)this.m_edges[e][r]=null;v.Clear(this.m_edges[e])}v.Clear(this.m_edges),this.m_HasOpenPaths=this.m_UseFullRange=!1},v.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var e=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=e}this.m_CurrentLM=null},v.ClipperBase.prototype.RangeTest=function(e,t){t.Value?(e.X>v.ClipperBase.hiRange||e.Y>v.ClipperBase.hiRange||-e.X>v.ClipperBase.hiRange||-e.Y>v.ClipperBase.hiRange)&&v.Error("Coordinate outside allowed range in RangeTest()."):(e.X>v.ClipperBase.loRange||e.Y>v.ClipperBase.loRange||-e.X>v.ClipperBase.loRange||-e.Y>v.ClipperBase.loRange)&&(t.Value=!0,this.RangeTest(e,t))},v.ClipperBase.prototype.InitEdge=function(e,t,r,n){e.Next=t,e.Prev=r,e.Curr.X=n.X,e.Curr.Y=n.Y,v.use_xyz&&(e.Curr.Z=n.Z),e.OutIdx=-1},v.ClipperBase.prototype.InitEdge2=function(e,t){e.Curr.Y>=e.Next.Curr.Y?(e.Bot.X=e.Curr.X,e.Bot.Y=e.Curr.Y,v.use_xyz&&(e.Bot.Z=e.Curr.Z),e.Top.X=e.Next.Curr.X,e.Top.Y=e.Next.Curr.Y,v.use_xyz&&(e.Top.Z=e.Next.Curr.Z)):(e.Top.X=e.Curr.X,e.Top.Y=e.Curr.Y,v.use_xyz&&(e.Top.Z=e.Curr.Z),e.Bot.X=e.Next.Curr.X,e.Bot.Y=e.Next.Curr.Y,v.use_xyz&&(e.Bot.Z=e.Next.Curr.Z)),this.SetDx(e),e.PolyTyp=t},v.ClipperBase.prototype.FindNextLocMin=function(e){for(var t;;){for(;v.IntPoint.op_Inequality(e.Bot,e.Prev.Bot)||v.IntPoint.op_Equality(e.Curr,e.Top);)e=e.Next;if(e.Dx!=v.ClipperBase.horizontal&&e.Prev.Dx!=v.ClipperBase.horizontal)break;for(;e.Prev.Dx==v.ClipperBase.horizontal;)e=e.Prev;for(t=e;e.Dx==v.ClipperBase.horizontal;)e=e.Next;if(e.Top.Y!=e.Prev.Bot.Y){t.Prev.Bot.X<e.Bot.X&&(e=t);break}}return e},v.ClipperBase.prototype.ProcessBound=function(e,t){var r,n,i=e;if(i.OutIdx==v.ClipperBase.Skip){if(e=i,t){for(;e.Top.Y==e.Next.Bot.Y;)e=e.Next;for(;e!=i&&e.Dx==v.ClipperBase.horizontal;)e=e.Prev}else{for(;e.Top.Y==e.Prev.Bot.Y;)e=e.Prev;for(;e!=i&&e.Dx==v.ClipperBase.horizontal;)e=e.Next}return e==i?i=t?e.Next:e.Prev:(e=t?i.Next:i.Prev,(r=new v.LocalMinima).Next=null,r.Y=e.Bot.Y,r.LeftBound=null,r.RightBound=e,e.WindDelta=0,i=this.ProcessBound(e,t),this.InsertLocalMinima(r)),i}if(e.Dx==v.ClipperBase.horizontal&&((r=t?e.Prev:e.Next).OutIdx!=v.ClipperBase.Skip&&(r.Dx==v.ClipperBase.horizontal?r.Bot.X!=e.Bot.X&&r.Top.X!=e.Bot.X&&this.ReverseHorizontal(e):r.Bot.X!=e.Bot.X&&this.ReverseHorizontal(e))),r=e,t){for(;i.Top.Y==i.Next.Bot.Y&&i.Next.OutIdx!=v.ClipperBase.Skip;)i=i.Next;if(i.Dx==v.ClipperBase.horizontal&&i.Next.OutIdx!=v.ClipperBase.Skip){for(n=i;n.Prev.Dx==v.ClipperBase.horizontal;)n=n.Prev;n.Prev.Top.X==i.Next.Top.X?t||(i=n.Prev):n.Prev.Top.X>i.Next.Top.X&&(i=n.Prev)}for(;e!=i;)e.NextInLML=e.Next,e.Dx==v.ClipperBase.horizontal&&e!=r&&e.Bot.X!=e.Prev.Top.X&&this.ReverseHorizontal(e),e=e.Next;e.Dx==v.ClipperBase.horizontal&&e!=r&&e.Bot.X!=e.Prev.Top.X&&this.ReverseHorizontal(e),i=i.Next}else{for(;i.Top.Y==i.Prev.Bot.Y&&i.Prev.OutIdx!=v.ClipperBase.Skip;)i=i.Prev;if(i.Dx==v.ClipperBase.horizontal&&i.Prev.OutIdx!=v.ClipperBase.Skip){for(n=i;n.Next.Dx==v.ClipperBase.horizontal;)n=n.Next;n.Next.Top.X==i.Prev.Top.X?t||(i=n.Next):n.Next.Top.X>i.Prev.Top.X&&(i=n.Next)}for(;e!=i;)e.NextInLML=e.Prev,e.Dx==v.ClipperBase.horizontal&&e!=r&&e.Bot.X!=e.Next.Top.X&&this.ReverseHorizontal(e),e=e.Prev;e.Dx==v.ClipperBase.horizontal&&e!=r&&e.Bot.X!=e.Next.Top.X&&this.ReverseHorizontal(e),i=i.Prev}return i},v.ClipperBase.prototype.AddPath=function(e,t,r){v.use_lines?r||t!=v.PolyType.ptClip||v.Error("AddPath: Open paths must be subject."):r||v.Error("AddPath: Open paths have been disabled.");var n=e.length-1;if(r)for(;0<n&&v.IntPoint.op_Equality(e[n],e[0]);)--n;for(;0<n&&v.IntPoint.op_Equality(e[n],e[n-1]);)--n;if(r&&2>n||!r&&1>n)return!1;for(var i=[],a=0;a<=n;a++)i.push(new v.TEdge);var o=!0;i[1].Curr.X=e[1].X,i[1].Curr.Y=e[1].Y,v.use_xyz&&(i[1].Curr.Z=e[1].Z);var l={Value:this.m_UseFullRange};for(this.RangeTest(e[0],l),this.m_UseFullRange=l.Value,l.Value=this.m_UseFullRange,this.RangeTest(e[n],l),this.m_UseFullRange=l.Value,this.InitEdge(i[0],i[1],i[n],e[0]),this.InitEdge(i[n],i[0],i[n-1],e[n]),a=n-1;1<=a;--a)l.Value=this.m_UseFullRange,this.RangeTest(e[a],l),this.m_UseFullRange=l.Value,this.InitEdge(i[a],i[a+1],i[a-1],e[a]);for(a=e=n=i[0];;)if(e.Curr!=e.Next.Curr||!r&&e.Next==n){if(e.Prev==e.Next)break;if(r&&v.ClipperBase.SlopesEqual(e.Prev.Curr,e.Curr,e.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(e.Prev.Curr,e.Curr,e.Next.Curr))){e==n&&(n=e.Next),a=e=(e=this.RemoveEdge(e)).Prev;continue}if((e=e.Next)==a||!r&&e.Next==n)break}else{if(e==e.Next)break;e==n&&(n=e.Next),a=e=this.RemoveEdge(e)}if(!r&&e==e.Next||r&&e.Prev==e.Next)return!1;r||(this.m_HasOpenPaths=!0,n.Prev.OutIdx=v.ClipperBase.Skip),e=n;do{this.InitEdge2(e,t),e=e.Next,o&&e.Curr.Y!=n.Curr.Y&&(o=!1)}while(e!=n);if(o){if(r)return!1;for(e.Prev.OutIdx=v.ClipperBase.Skip,e.Prev.Bot.X<e.Prev.Top.X&&this.ReverseHorizontal(e.Prev),(t=new v.LocalMinima).Next=null,t.Y=e.Bot.Y,t.LeftBound=null,t.RightBound=e,t.RightBound.Side=v.EdgeSide.esRight,t.RightBound.WindDelta=0;e.Next.OutIdx!=v.ClipperBase.Skip;)e.NextInLML=e.Next,e.Bot.X!=e.Prev.Top.X&&this.ReverseHorizontal(e),e=e.Next;return this.InsertLocalMinima(t),this.m_edges.push(i),!0}for(this.m_edges.push(i),o=null,v.IntPoint.op_Equality(e.Prev.Bot,e.Prev.Top)&&(e=e.Next);(e=this.FindNextLocMin(e))!=o;)null==o&&(o=e),(t=new v.LocalMinima).Next=null,t.Y=e.Bot.Y,e.Dx<e.Prev.Dx?(t.LeftBound=e.Prev,t.RightBound=e,i=!1):(t.LeftBound=e,t.RightBound=e.Prev,i=!0),t.LeftBound.Side=v.EdgeSide.esLeft,t.RightBound.Side=v.EdgeSide.esRight,t.LeftBound.WindDelta=r?t.LeftBound.Next==t.RightBound?-1:1:0,t.RightBound.WindDelta=-t.LeftBound.WindDelta,(e=this.ProcessBound(t.LeftBound,i)).OutIdx==v.ClipperBase.Skip&&(e=this.ProcessBound(e,i)),(n=this.ProcessBound(t.RightBound,!i)).OutIdx==v.ClipperBase.Skip&&(n=this.ProcessBound(n,!i)),t.LeftBound.OutIdx==v.ClipperBase.Skip?t.LeftBound=null:t.RightBound.OutIdx==v.ClipperBase.Skip&&(t.RightBound=null),this.InsertLocalMinima(t),i||(e=n);return!0},v.ClipperBase.prototype.AddPaths=function(e,t,r){for(var n=!1,i=0,a=e.length;i<a;++i)this.AddPath(e[i],t,r)&&(n=!0);return n},v.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(e,t,r){return!(v.IntPoint.op_Equality(e,r)||v.IntPoint.op_Equality(e,t)||v.IntPoint.op_Equality(r,t))&&(e.X!=r.X?t.X>e.X==t.X<r.X:t.Y>e.Y==t.Y<r.Y)},v.ClipperBase.prototype.RemoveEdge=function(e){e.Prev.Next=e.Next,e.Next.Prev=e.Prev;var t=e.Next;return e.Prev=null,t},v.ClipperBase.prototype.SetDx=function(e){e.Delta.X=e.Top.X-e.Bot.X,e.Delta.Y=e.Top.Y-e.Bot.Y,e.Dx=0===e.Delta.Y?v.ClipperBase.horizontal:e.Delta.X/e.Delta.Y},v.ClipperBase.prototype.InsertLocalMinima=function(e){if(null===this.m_MinimaList)this.m_MinimaList=e;else if(e.Y>=this.m_MinimaList.Y)e.Next=this.m_MinimaList,this.m_MinimaList=e;else{for(var t=this.m_MinimaList;null!==t.Next&&e.Y<t.Next.Y;)t=t.Next;e.Next=t.Next,t.Next=e}},v.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)},v.ClipperBase.prototype.ReverseHorizontal=function(e){var t=e.Top.X;e.Top.X=e.Bot.X,e.Bot.X=t,v.use_xyz&&(t=e.Top.Z,e.Top.Z=e.Bot.Z,e.Bot.Z=t)},v.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!=this.m_CurrentLM)for(var e=this.m_MinimaList;null!=e;){var t=e.LeftBound;null!=t&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,v.use_xyz&&(t.Curr.Z=t.Bot.Z),t.Side=v.EdgeSide.esLeft,t.OutIdx=v.ClipperBase.Unassigned),null!=(t=e.RightBound)&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,v.use_xyz&&(t.Curr.Z=t.Bot.Z),t.Side=v.EdgeSide.esRight,t.OutIdx=v.ClipperBase.Unassigned),e=e.Next}},v.Clipper=function(e){void 0===e&&(e=0),this.m_PolyOuts=null,this.m_ClipType=v.ClipType.ctIntersection,this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null,this.m_ExecuteLocked=!1,this.m_SubjFillType=this.m_ClipFillType=v.PolyFillType.pftEvenOdd,this.m_GhostJoins=this.m_Joins=null,this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1,v.ClipperBase.call(this),this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null,this.m_IntersectList=[],this.m_IntersectNodeComparer=v.MyIntersectNodeSort.Compare,this.m_UsingPolyTree=this.m_ExecuteLocked=!1,this.m_PolyOuts=[],this.m_Joins=[],this.m_GhostJoins=[],this.ReverseSolution=0!=(1&e),this.StrictlySimple=0!=(2&e),this.PreserveCollinear=0!=(4&e),v.use_xyz&&(this.ZFillFunction=null)},v.Clipper.ioReverseSolution=1,v.Clipper.ioStrictlySimple=2,v.Clipper.ioPreserveCollinear=4,v.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),v.ClipperBase.prototype.Clear.call(this))},v.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var e=this.m_Scanbeam.Next;this.m_Scanbeam=null,this.m_Scanbeam=e}},v.Clipper.prototype.Reset=function(){v.ClipperBase.prototype.Reset.call(this),this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;for(var e=this.m_MinimaList;null!==e;)this.InsertScanbeam(e.Y),e=e.Next},v.Clipper.prototype.InsertScanbeam=function(e){if(null===this.m_Scanbeam)this.m_Scanbeam=new v.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=e;else if(e>this.m_Scanbeam.Y){var t=new v.Scanbeam;t.Y=e,t.Next=this.m_Scanbeam,this.m_Scanbeam=t}else{for(var r=this.m_Scanbeam;null!==r.Next&&e<=r.Next.Y;)r=r.Next;e!=r.Y&&((t=new v.Scanbeam).Y=e,t.Next=r.Next,r.Next=t)}},v.Clipper.prototype.Execute=function(){var e=arguments,t=e.length,r=e[1]instanceof v.PolyTree;if(4==t&&!r){if(t=e[0],i=e[1],r=e[2],e=e[3],this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&v.Error("Error: PolyTree struct is need for open path clipping."),this.m_ExecuteLocked=!0,v.Clear(i),this.m_SubjFillType=r,this.m_ClipFillType=e,this.m_ClipType=t,this.m_UsingPolyTree=!1;try{var n=this.ExecuteInternal();n&&this.BuildResult(i)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return n}if(4==t&&r){t=e[0];var i=e[1];if(r=e[2],e=e[3],this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=r,this.m_ClipFillType=e,this.m_ClipType=t,this.m_UsingPolyTree=!0;try{(n=this.ExecuteInternal())&&this.BuildResult2(i)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return n}if(2==t&&!r||2==t&&r)return t=e[0],i=e[1],this.Execute(t,i,v.PolyFillType.pftEvenOdd,v.PolyFillType.pftEvenOdd)},v.Clipper.prototype.FixHoleLinkage=function(e){if(null!==e.FirstLeft&&(e.IsHole==e.FirstLeft.IsHole||null===e.FirstLeft.Pts)){for(var t=e.FirstLeft;null!==t&&(t.IsHole==e.IsHole||null===t.Pts);)t=t.FirstLeft;e.FirstLeft=t}},v.Clipper.prototype.ExecuteInternal=function(){try{if(this.Reset(),null===this.m_CurrentLM)return!1;var e=this.PopScanbeam();do{if(this.InsertLocalMinimaIntoAEL(e),v.Clear(this.m_GhostJoins),this.ProcessHorizontals(!1),null===this.m_Scanbeam)break;var t=this.PopScanbeam();if(!this.ProcessIntersections(t))return!1;this.ProcessEdgesAtTopOfScanbeam(t),e=t}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);e=0;for(var r=this.m_PolyOuts.length;e<r;e++){var n=this.m_PolyOuts[e];null===n.Pts||n.IsOpen||(n.IsHole^this.ReverseSolution)==0<this.Area(n)&&this.ReversePolyPtLinks(n.Pts)}for(this.JoinCommonEdges(),e=0,r=this.m_PolyOuts.length;e<r;e++)null===(n=this.m_PolyOuts[e]).Pts||n.IsOpen||this.FixupOutPolygon(n);return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{v.Clear(this.m_Joins),v.Clear(this.m_GhostJoins)}},v.Clipper.prototype.PopScanbeam=function(){var e=this.m_Scanbeam.Y;return this.m_Scanbeam=this.m_Scanbeam.Next,e},v.Clipper.prototype.DisposeAllPolyPts=function(){for(var e=0,t=this.m_PolyOuts.length;e<t;++e)this.DisposeOutRec(e);v.Clear(this.m_PolyOuts)},v.Clipper.prototype.DisposeOutRec=function(e){this.m_PolyOuts[e].Pts=null,this.m_PolyOuts[e]=null},v.Clipper.prototype.AddJoin=function(e,t,r){var n=new v.Join;n.OutPt1=e,n.OutPt2=t,n.OffPt.X=r.X,n.OffPt.Y=r.Y,v.use_xyz&&(n.OffPt.Z=r.Z),this.m_Joins.push(n)},v.Clipper.prototype.AddGhostJoin=function(e,t){var r=new v.Join;r.OutPt1=e,r.OffPt.X=t.X,r.OffPt.Y=t.Y,v.use_xyz&&(r.OffPt.Z=t.Z),this.m_GhostJoins.push(r)},v.Clipper.prototype.SetZ=function(e,t,r){null!==this.ZFillFunction&&0==e.Z&&null!==this.ZFillFunction&&(v.IntPoint.op_Equality(e,t.Bot)?e.Z=t.Bot.Z:v.IntPoint.op_Equality(e,t.Top)?e.Z=t.Top.Z:v.IntPoint.op_Equality(e,r.Bot)?e.Z=r.Bot.Z:v.IntPoint.op_Equality(e,r.Top)?e.Z=r.Top.Z:this.ZFillFunction(t.Bot,t.Top,r.Bot,r.Top,e))},v.Clipper.prototype.InsertLocalMinimaIntoAEL=function(e){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==e;){var t=this.m_CurrentLM.LeftBound,r=this.m_CurrentLM.RightBound;this.PopLocalMinima();var n=null;if(null===t?(this.InsertEdgeIntoAEL(r,null),this.SetWindingCount(r),this.IsContributing(r)&&(n=this.AddOutPt(r,r.Bot))):(null==r?(this.InsertEdgeIntoAEL(t,null),this.SetWindingCount(t),this.IsContributing(t)&&(n=this.AddOutPt(t,t.Bot))):(this.InsertEdgeIntoAEL(t,null),this.InsertEdgeIntoAEL(r,t),this.SetWindingCount(t),r.WindCnt=t.WindCnt,r.WindCnt2=t.WindCnt2,this.IsContributing(t)&&(n=this.AddLocalMinPoly(t,r,t.Bot))),this.InsertScanbeam(t.Top.Y)),null!=r&&(v.ClipperBase.IsHorizontal(r)?this.AddEdgeToSEL(r):this.InsertScanbeam(r.Top.Y)),null!=t&&null!=r){if(null!==n&&v.ClipperBase.IsHorizontal(r)&&0<this.m_GhostJoins.length&&0!==r.WindDelta)for(var i=0,a=this.m_GhostJoins.length;i<a;i++){var o=this.m_GhostJoins[i];this.HorzSegmentsOverlap(o.OutPt1.Pt.X,o.OffPt.X,r.Bot.X,r.Top.X)&&this.AddJoin(o.OutPt1,n,o.OffPt)}if(0<=t.OutIdx&&null!==t.PrevInAEL&&t.PrevInAEL.Curr.X==t.Bot.X&&0<=t.PrevInAEL.OutIdx&&v.ClipperBase.SlopesEqual(t.PrevInAEL,t,this.m_UseFullRange)&&0!==t.WindDelta&&0!==t.PrevInAEL.WindDelta&&(i=this.AddOutPt(t.PrevInAEL,t.Bot),this.AddJoin(n,i,t.Top)),t.NextInAEL!=r&&(0<=r.OutIdx&&0<=r.PrevInAEL.OutIdx&&v.ClipperBase.SlopesEqual(r.PrevInAEL,r,this.m_UseFullRange)&&0!==r.WindDelta&&0!==r.PrevInAEL.WindDelta&&(i=this.AddOutPt(r.PrevInAEL,r.Bot),this.AddJoin(n,i,r.Top)),null!==(n=t.NextInAEL)))for(;n!=r;)this.IntersectEdges(r,n,t.Curr,!1),n=n.NextInAEL}}},v.Clipper.prototype.InsertEdgeIntoAEL=function(e,t){if(null===this.m_ActiveEdges)e.PrevInAEL=null,e.NextInAEL=null,this.m_ActiveEdges=e;else if(null===t&&this.E2InsertsBeforeE1(this.m_ActiveEdges,e))e.PrevInAEL=null,e.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=e;else{for(null===t&&(t=this.m_ActiveEdges);null!==t.NextInAEL&&!this.E2InsertsBeforeE1(t.NextInAEL,e);)t=t.NextInAEL;e.NextInAEL=t.NextInAEL,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=e),e.PrevInAEL=t,t.NextInAEL=e}},v.Clipper.prototype.E2InsertsBeforeE1=function(e,t){return t.Curr.X==e.Curr.X?t.Top.Y>e.Top.Y?t.Top.X<v.Clipper.TopX(e,t.Top.Y):e.Top.X>v.Clipper.TopX(t,e.Top.Y):t.Curr.X<e.Curr.X},v.Clipper.prototype.IsEvenOddFillType=function(e){return e.PolyTyp==v.PolyType.ptSubject?this.m_SubjFillType==v.PolyFillType.pftEvenOdd:this.m_ClipFillType==v.PolyFillType.pftEvenOdd},v.Clipper.prototype.IsEvenOddAltFillType=function(e){return e.PolyTyp==v.PolyType.ptSubject?this.m_ClipFillType==v.PolyFillType.pftEvenOdd:this.m_SubjFillType==v.PolyFillType.pftEvenOdd},v.Clipper.prototype.IsContributing=function(e){var t,r;switch(e.PolyTyp==v.PolyType.ptSubject?(t=this.m_SubjFillType,r=this.m_ClipFillType):(t=this.m_ClipFillType,r=this.m_SubjFillType),t){case v.PolyFillType.pftEvenOdd:if(0===e.WindDelta&&1!=e.WindCnt)return!1;break;case v.PolyFillType.pftNonZero:if(1!=Math.abs(e.WindCnt))return!1;break;case v.PolyFillType.pftPositive:if(1!=e.WindCnt)return!1;break;default:if(-1!=e.WindCnt)return!1}switch(this.m_ClipType){case v.ClipType.ctIntersection:switch(r){case v.PolyFillType.pftEvenOdd:case v.PolyFillType.pftNonZero:return 0!==e.WindCnt2;case v.PolyFillType.pftPositive:return 0<e.WindCnt2;default:return 0>e.WindCnt2}case v.ClipType.ctUnion:switch(r){case v.PolyFillType.pftEvenOdd:case v.PolyFillType.pftNonZero:return 0===e.WindCnt2;case v.PolyFillType.pftPositive:return 0>=e.WindCnt2;default:return 0<=e.WindCnt2}case v.ClipType.ctDifference:if(e.PolyTyp==v.PolyType.ptSubject)switch(r){case v.PolyFillType.pftEvenOdd:case v.PolyFillType.pftNonZero:return 0===e.WindCnt2;case v.PolyFillType.pftPositive:return 0>=e.WindCnt2;default:return 0<=e.WindCnt2}else switch(r){case v.PolyFillType.pftEvenOdd:case v.PolyFillType.pftNonZero:return 0!==e.WindCnt2;case v.PolyFillType.pftPositive:return 0<e.WindCnt2;default:return 0>e.WindCnt2}case v.ClipType.ctXor:if(0===e.WindDelta)switch(r){case v.PolyFillType.pftEvenOdd:case v.PolyFillType.pftNonZero:return 0===e.WindCnt2;case v.PolyFillType.pftPositive:return 0>=e.WindCnt2;default:return 0<=e.WindCnt2}}return!0},v.Clipper.prototype.SetWindingCount=function(e){for(var t=e.PrevInAEL;null!==t&&(t.PolyTyp!=e.PolyTyp||0===t.WindDelta);)t=t.PrevInAEL;if(null===t)e.WindCnt=0===e.WindDelta?1:e.WindDelta,e.WindCnt2=0,t=this.m_ActiveEdges;else{if(0===e.WindDelta&&this.m_ClipType!=v.ClipType.ctUnion)e.WindCnt=1;else if(this.IsEvenOddFillType(e))if(0===e.WindDelta){for(var r=!0,n=t.PrevInAEL;null!==n;)n.PolyTyp==t.PolyTyp&&0!==n.WindDelta&&(r=!r),n=n.PrevInAEL;e.WindCnt=r?0:1}else e.WindCnt=e.WindDelta;else e.WindCnt=0>t.WindCnt*t.WindDelta?1<Math.abs(t.WindCnt)?0>t.WindDelta*e.WindDelta?t.WindCnt:t.WindCnt+e.WindDelta:0===e.WindDelta?1:e.WindDelta:0===e.WindDelta?0>t.WindCnt?t.WindCnt-1:t.WindCnt+1:0>t.WindDelta*e.WindDelta?t.WindCnt:t.WindCnt+e.WindDelta;e.WindCnt2=t.WindCnt2,t=t.NextInAEL}if(this.IsEvenOddAltFillType(e))for(;t!=e;)0!==t.WindDelta&&(e.WindCnt2=0===e.WindCnt2?1:0),t=t.NextInAEL;else for(;t!=e;)e.WindCnt2+=t.WindDelta,t=t.NextInAEL},v.Clipper.prototype.AddEdgeToSEL=function(e){null===this.m_SortedEdges?(this.m_SortedEdges=e,e.PrevInSEL=null,e.NextInSEL=null):(e.NextInSEL=this.m_SortedEdges,e.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=e)},v.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e=e.NextInSEL=e.NextInAEL},v.Clipper.prototype.SwapPositionsInAEL=function(e,t){if(e.NextInAEL!=e.PrevInAEL&&t.NextInAEL!=t.PrevInAEL){if(e.NextInAEL==t){var r=t.NextInAEL;null!==r&&(r.PrevInAEL=e);var n=e.PrevInAEL;null!==n&&(n.NextInAEL=t),t.PrevInAEL=n,t.NextInAEL=e,e.PrevInAEL=t,e.NextInAEL=r}else t.NextInAEL==e?(null!==(r=e.NextInAEL)&&(r.PrevInAEL=t),null!==(n=t.PrevInAEL)&&(n.NextInAEL=e),e.PrevInAEL=n,e.NextInAEL=t,t.PrevInAEL=e,t.NextInAEL=r):(r=e.NextInAEL,n=e.PrevInAEL,e.NextInAEL=t.NextInAEL,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=t.PrevInAEL,null!==e.PrevInAEL&&(e.PrevInAEL.NextInAEL=e),t.NextInAEL=r,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=n,null!==t.PrevInAEL&&(t.PrevInAEL.NextInAEL=t));null===e.PrevInAEL?this.m_ActiveEdges=e:null===t.PrevInAEL&&(this.m_ActiveEdges=t)}},v.Clipper.prototype.SwapPositionsInSEL=function(e,t){if(!(null===e.NextInSEL&&null===e.PrevInSEL||null===t.NextInSEL&&null===t.PrevInSEL)){if(e.NextInSEL==t){var r=t.NextInSEL;null!==r&&(r.PrevInSEL=e);var n=e.PrevInSEL;null!==n&&(n.NextInSEL=t),t.PrevInSEL=n,t.NextInSEL=e,e.PrevInSEL=t,e.NextInSEL=r}else t.NextInSEL==e?(null!==(r=e.NextInSEL)&&(r.PrevInSEL=t),null!==(n=t.PrevInSEL)&&(n.NextInSEL=e),e.PrevInSEL=n,e.NextInSEL=t,t.PrevInSEL=e,t.NextInSEL=r):(r=e.NextInSEL,n=e.PrevInSEL,e.NextInSEL=t.NextInSEL,null!==e.NextInSEL&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=t.PrevInSEL,null!==e.PrevInSEL&&(e.PrevInSEL.NextInSEL=e),t.NextInSEL=r,null!==t.NextInSEL&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=n,null!==t.PrevInSEL&&(t.PrevInSEL.NextInSEL=t));null===e.PrevInSEL?this.m_SortedEdges=e:null===t.PrevInSEL&&(this.m_SortedEdges=t)}},v.Clipper.prototype.AddLocalMaxPoly=function(e,t,r){this.AddOutPt(e,r),0==t.WindDelta&&this.AddOutPt(t,r),e.OutIdx==t.OutIdx?(e.OutIdx=-1,t.OutIdx=-1):e.OutIdx<t.OutIdx?this.AppendPolygon(e,t):this.AppendPolygon(t,e)},v.Clipper.prototype.AddLocalMinPoly=function(e,t,r){var n,i;return v.ClipperBase.IsHorizontal(t)||e.Dx>t.Dx?(n=this.AddOutPt(e,r),t.OutIdx=e.OutIdx,e.Side=v.EdgeSide.esLeft,t.Side=v.EdgeSide.esRight,e=(i=e).PrevInAEL==t?t.PrevInAEL:i.PrevInAEL):(n=this.AddOutPt(t,r),e.OutIdx=t.OutIdx,e.Side=v.EdgeSide.esRight,t.Side=v.EdgeSide.esLeft,e=(i=t).PrevInAEL==e?e.PrevInAEL:i.PrevInAEL),null!==e&&0<=e.OutIdx&&v.Clipper.TopX(e,r.Y)==v.Clipper.TopX(i,r.Y)&&v.ClipperBase.SlopesEqual(i,e,this.m_UseFullRange)&&0!==i.WindDelta&&0!==e.WindDelta&&(r=this.AddOutPt(e,r),this.AddJoin(n,r,i.Top)),n},v.Clipper.prototype.CreateOutRec=function(){var e=new v.OutRec;return e.Idx=-1,e.IsHole=!1,e.IsOpen=!1,e.FirstLeft=null,e.Pts=null,e.BottomPt=null,e.PolyNode=null,this.m_PolyOuts.push(e),e.Idx=this.m_PolyOuts.length-1,e},v.Clipper.prototype.AddOutPt=function(e,t){var r=e.Side==v.EdgeSide.esLeft;if(0>e.OutIdx){var n=this.CreateOutRec();n.IsOpen=0===e.WindDelta;var i=new v.OutPt;n.Pts=i,i.Idx=n.Idx,i.Pt.X=t.X,i.Pt.Y=t.Y,v.use_xyz&&(i.Pt.Z=t.Z),i.Next=i,i.Prev=i,n.IsOpen||this.SetHoleState(e,n),e.OutIdx=n.Idx}else{if(e=(n=this.m_PolyOuts[e.OutIdx]).Pts,r&&v.IntPoint.op_Equality(t,e.Pt))return e;if(!r&&v.IntPoint.op_Equality(t,e.Prev.Pt))return e.Prev;(i=new v.OutPt).Idx=n.Idx,i.Pt.X=t.X,i.Pt.Y=t.Y,v.use_xyz&&(i.Pt.Z=t.Z),i.Next=e,i.Prev=e.Prev,i.Prev.Next=i,e.Prev=i,r&&(n.Pts=i)}return i},v.Clipper.prototype.SwapPoints=function(e,t){var r=new v.IntPoint(e.Value);e.Value.X=t.Value.X,e.Value.Y=t.Value.Y,v.use_xyz&&(e.Value.Z=t.Value.Z),t.Value.X=r.X,t.Value.Y=r.Y,v.use_xyz&&(t.Value.Z=r.Z)},v.Clipper.prototype.HorzSegmentsOverlap=function(e,t,r,n){var i;return e>t&&(i=e,e=t,t=i),r>n&&(i=r,r=n,n=i),e<n&&r<t},v.Clipper.prototype.SetHoleState=function(e,t){var r=!1;for(e=e.PrevInAEL;null!==e;)0<=e.OutIdx&&0!=e.WindDelta&&(r=!r,null===t.FirstLeft&&(t.FirstLeft=this.m_PolyOuts[e.OutIdx])),e=e.PrevInAEL;r&&(t.IsHole=!0)},v.Clipper.prototype.GetDx=function(e,t){return e.Y==t.Y?v.ClipperBase.horizontal:(t.X-e.X)/(t.Y-e.Y)},v.Clipper.prototype.FirstIsBottomPt=function(e,t){for(var r=e.Prev;v.IntPoint.op_Equality(r.Pt,e.Pt)&&r!=e;)r=r.Prev;var n=Math.abs(this.GetDx(e.Pt,r.Pt));for(r=e.Next;v.IntPoint.op_Equality(r.Pt,e.Pt)&&r!=e;)r=r.Next;for(e=Math.abs(this.GetDx(e.Pt,r.Pt)),r=t.Prev;v.IntPoint.op_Equality(r.Pt,t.Pt)&&r!=t;)r=r.Prev;var i=Math.abs(this.GetDx(t.Pt,r.Pt));for(r=t.Next;v.IntPoint.op_Equality(r.Pt,t.Pt)&&r!=t;)r=r.Next;return r=Math.abs(this.GetDx(t.Pt,r.Pt)),n>=i&&n>=r||e>=i&&e>=r},v.Clipper.prototype.GetBottomPt=function(e){for(var t=null,r=e.Next;r!=e;)r.Pt.Y>e.Pt.Y?(e=r,t=null):r.Pt.Y==e.Pt.Y&&r.Pt.X<=e.Pt.X&&(r.Pt.X<e.Pt.X?(t=null,e=r):r.Next!=e&&r.Prev!=e&&(t=r)),r=r.Next;if(null!==t)for(;t!=r;)for(this.FirstIsBottomPt(r,t)||(e=t),t=t.Next;v.IntPoint.op_Inequality(t.Pt,e.Pt);)t=t.Next;return e},v.Clipper.prototype.GetLowermostRec=function(e,t){null===e.BottomPt&&(e.BottomPt=this.GetBottomPt(e.Pts)),null===t.BottomPt&&(t.BottomPt=this.GetBottomPt(t.Pts));var r=e.BottomPt,n=t.BottomPt;return r.Pt.Y>n.Pt.Y?e:r.Pt.Y<n.Pt.Y?t:r.Pt.X<n.Pt.X?e:r.Pt.X>n.Pt.X||r.Next==r?t:n.Next==n||this.FirstIsBottomPt(r,n)?e:t},v.Clipper.prototype.Param1RightOfParam2=function(e,t){do{if((e=e.FirstLeft)==t)return!0}while(null!==e);return!1},v.Clipper.prototype.GetOutRec=function(e){for(e=this.m_PolyOuts[e];e!=this.m_PolyOuts[e.Idx];)e=this.m_PolyOuts[e.Idx];return e},v.Clipper.prototype.AppendPolygon=function(e,t){var r=this.m_PolyOuts[e.OutIdx],n=this.m_PolyOuts[t.OutIdx],i=this.Param1RightOfParam2(r,n)?n:this.Param1RightOfParam2(n,r)?r:this.GetLowermostRec(r,n),a=r.Pts,o=a.Prev,l=n.Pts,s=l.Prev;for(e.Side==v.EdgeSide.esLeft?(t.Side==v.EdgeSide.esLeft?(this.ReversePolyPtLinks(l),l.Next=a,a.Prev=l,o.Next=s,s.Prev=o,r.Pts=s):(s.Next=a,a.Prev=s,l.Prev=o,o.Next=l,r.Pts=l),a=v.EdgeSide.esLeft):(t.Side==v.EdgeSide.esRight?(this.ReversePolyPtLinks(l),o.Next=s,s.Prev=o,l.Next=a,a.Prev=l):(o.Next=l,l.Prev=o,a.Prev=s,s.Next=a),a=v.EdgeSide.esRight),r.BottomPt=null,i==n&&(n.FirstLeft!=r&&(r.FirstLeft=n.FirstLeft),r.IsHole=n.IsHole),n.Pts=null,n.BottomPt=null,n.FirstLeft=r,i=e.OutIdx,o=t.OutIdx,e.OutIdx=-1,t.OutIdx=-1,l=this.m_ActiveEdges;null!==l;){if(l.OutIdx==o){l.OutIdx=i,l.Side=a;break}l=l.NextInAEL}n.Idx=r.Idx},v.Clipper.prototype.ReversePolyPtLinks=function(e){if(null!==e){var t=e;do{var r=t.Next;t.Next=t.Prev,t=t.Prev=r}while(t!=e)}},v.Clipper.SwapSides=function(e,t){var r=e.Side;e.Side=t.Side,t.Side=r},v.Clipper.SwapPolyIndexes=function(e,t){var r=e.OutIdx;e.OutIdx=t.OutIdx,t.OutIdx=r},v.Clipper.prototype.IntersectEdges=function(e,t,r){var n=0<=e.OutIdx,i=0<=t.OutIdx;if(v.use_xyz&&this.SetZ(r,e,t),!v.use_lines||0!==e.WindDelta&&0!==t.WindDelta){if(e.PolyTyp==t.PolyTyp)if(this.IsEvenOddFillType(e)){var a=e.WindCnt;e.WindCnt=t.WindCnt,t.WindCnt=a}else e.WindCnt=0===e.WindCnt+t.WindDelta?-e.WindCnt:e.WindCnt+t.WindDelta,t.WindCnt=0==t.WindCnt-e.WindDelta?-t.WindCnt:t.WindCnt-e.WindDelta;else this.IsEvenOddFillType(t)?e.WindCnt2=0===e.WindCnt2?1:0:e.WindCnt2+=t.WindDelta,this.IsEvenOddFillType(e)?t.WindCnt2=0===t.WindCnt2?1:0:t.WindCnt2-=e.WindDelta;var o,l,s;switch(e.PolyTyp==v.PolyType.ptSubject?(o=this.m_SubjFillType,s=this.m_ClipFillType):(o=this.m_ClipFillType,s=this.m_SubjFillType),t.PolyTyp==v.PolyType.ptSubject?(l=this.m_SubjFillType,a=this.m_ClipFillType):(l=this.m_ClipFillType,a=this.m_SubjFillType),o){case v.PolyFillType.pftPositive:o=e.WindCnt;break;case v.PolyFillType.pftNegative:o=-e.WindCnt;break;default:o=Math.abs(e.WindCnt)}switch(l){case v.PolyFillType.pftPositive:l=t.WindCnt;break;case v.PolyFillType.pftNegative:l=-t.WindCnt;break;default:l=Math.abs(t.WindCnt)}if(n&&i)0!=o&&1!=o||0!=l&&1!=l||e.PolyTyp!=t.PolyTyp&&this.m_ClipType!=v.ClipType.ctXor?this.AddLocalMaxPoly(e,t,r):(this.AddOutPt(e,r),this.AddOutPt(t,r),v.Clipper.SwapSides(e,t),v.Clipper.SwapPolyIndexes(e,t));else if(n)0!==l&&1!=l||(this.AddOutPt(e,r),v.Clipper.SwapSides(e,t),v.Clipper.SwapPolyIndexes(e,t));else if(i)0!==o&&1!=o||(this.AddOutPt(t,r),v.Clipper.SwapSides(e,t),v.Clipper.SwapPolyIndexes(e,t));else if(!(0!=o&&1!=o||0!=l&&1!=l)){switch(s){case v.PolyFillType.pftPositive:n=e.WindCnt2;break;case v.PolyFillType.pftNegative:n=-e.WindCnt2;break;default:n=Math.abs(e.WindCnt2)}switch(a){case v.PolyFillType.pftPositive:i=t.WindCnt2;break;case v.PolyFillType.pftNegative:i=-t.WindCnt2;break;default:i=Math.abs(t.WindCnt2)}if(e.PolyTyp!=t.PolyTyp)this.AddLocalMinPoly(e,t,r);else if(1==o&&1==l)switch(this.m_ClipType){case v.ClipType.ctIntersection:0<n&&0<i&&this.AddLocalMinPoly(e,t,r);break;case v.ClipType.ctUnion:0>=n&&0>=i&&this.AddLocalMinPoly(e,t,r);break;case v.ClipType.ctDifference:(e.PolyTyp==v.PolyType.ptClip&&0<n&&0<i||e.PolyTyp==v.PolyType.ptSubject&&0>=n&&0>=i)&&this.AddLocalMinPoly(e,t,r);break;case v.ClipType.ctXor:this.AddLocalMinPoly(e,t,r)}else v.Clipper.SwapSides(e,t)}}else 0==e.WindDelta&&0==t.WindDelta||(e.PolyTyp==t.PolyTyp&&e.WindDelta!=t.WindDelta&&this.m_ClipType==v.ClipType.ctUnion?0===e.WindDelta?i&&(this.AddOutPt(e,r),n&&(e.OutIdx=-1)):n&&(this.AddOutPt(t,r),i&&(t.OutIdx=-1)):e.PolyTyp!=t.PolyTyp&&(0!==e.WindDelta||1!=Math.abs(t.WindCnt)||this.m_ClipType==v.ClipType.ctUnion&&0!==t.WindCnt2?0!==t.WindDelta||1!=Math.abs(e.WindCnt)||this.m_ClipType==v.ClipType.ctUnion&&0!==e.WindCnt2||(this.AddOutPt(t,r),i&&(t.OutIdx=-1)):(this.AddOutPt(e,r),n&&(e.OutIdx=-1))))},v.Clipper.prototype.DeleteFromAEL=function(e){var t=e.PrevInAEL,r=e.NextInAEL;null===t&&null===r&&e!=this.m_ActiveEdges||(null!==t?t.NextInAEL=r:this.m_ActiveEdges=r,null!==r&&(r.PrevInAEL=t),e.NextInAEL=null,e.PrevInAEL=null)},v.Clipper.prototype.DeleteFromSEL=function(e){var t=e.PrevInSEL,r=e.NextInSEL;null===t&&null===r&&e!=this.m_SortedEdges||(null!==t?t.NextInSEL=r:this.m_SortedEdges=r,null!==r&&(r.PrevInSEL=t),e.NextInSEL=null,e.PrevInSEL=null)},v.Clipper.prototype.UpdateEdgeIntoAEL=function(e){null===e.NextInLML&&v.Error("UpdateEdgeIntoAEL: invalid call");var t=e.PrevInAEL,r=e.NextInAEL;return e.NextInLML.OutIdx=e.OutIdx,null!==t?t.NextInAEL=e.NextInLML:this.m_ActiveEdges=e.NextInLML,null!==r&&(r.PrevInAEL=e.NextInLML),e.NextInLML.Side=e.Side,e.NextInLML.WindDelta=e.WindDelta,e.NextInLML.WindCnt=e.WindCnt,e.NextInLML.WindCnt2=e.WindCnt2,(e=e.NextInLML).Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,v.use_xyz&&(e.Curr.Z=e.Bot.Z),e.PrevInAEL=t,e.NextInAEL=r,v.ClipperBase.IsHorizontal(e)||this.InsertScanbeam(e.Top.Y),e},v.Clipper.prototype.ProcessHorizontals=function(e){for(var t=this.m_SortedEdges;null!==t;)this.DeleteFromSEL(t),this.ProcessHorizontal(t,e),t=this.m_SortedEdges},v.Clipper.prototype.GetHorzDirection=function(e,t){e.Bot.X<e.Top.X?(t.Left=e.Bot.X,t.Right=e.Top.X,t.Dir=v.Direction.dLeftToRight):(t.Left=e.Top.X,t.Right=e.Bot.X,t.Dir=v.Direction.dRightToLeft)},v.Clipper.prototype.ProcessHorizontal=function(e,t){var r={Dir:null,Left:null,Right:null};this.GetHorzDirection(e,r);for(var n=r.Dir,i=r.Left,a=r.Right,o=e,l=null;null!==o.NextInLML&&v.ClipperBase.IsHorizontal(o.NextInLML);)o=o.NextInLML;for(null===o.NextInLML&&(l=this.GetMaximaPair(o));;){for(var s=e==o,u=this.GetNextInAEL(e,n);null!==u&&!(u.Curr.X==e.Top.X&&null!==e.NextInLML&&u.Dx<e.NextInLML.Dx);){if(r=this.GetNextInAEL(u,n),n==v.Direction.dLeftToRight&&u.Curr.X<=a||n==v.Direction.dRightToLeft&&u.Curr.X>=i){if(u==l&&s){if(0<=e.OutIdx){for(n=this.AddOutPt(e,e.Top),r=this.m_SortedEdges;null!==r;)0<=r.OutIdx&&this.HorzSegmentsOverlap(e.Bot.X,e.Top.X,r.Bot.X,r.Top.X)&&(i=this.AddOutPt(r,r.Bot),this.AddJoin(i,n,r.Top)),r=r.NextInSEL;this.AddGhostJoin(n,e.Bot),this.AddLocalMaxPoly(e,l,e.Top)}return this.DeleteFromAEL(e),void this.DeleteFromAEL(l)}if(n==v.Direction.dLeftToRight){var c=new v.IntPoint(u.Curr.X,e.Curr.Y);this.IntersectEdges(e,u,c)}else c=new v.IntPoint(u.Curr.X,e.Curr.Y),this.IntersectEdges(u,e,c);this.SwapPositionsInAEL(e,u)}else if(n==v.Direction.dLeftToRight&&u.Curr.X>=a||n==v.Direction.dRightToLeft&&u.Curr.X<=i)break;u=r}if(null===e.NextInLML||!v.ClipperBase.IsHorizontal(e.NextInLML))break;0<=(e=this.UpdateEdgeIntoAEL(e)).OutIdx&&this.AddOutPt(e,e.Bot),r={Dir:n,Left:i,Right:a},this.GetHorzDirection(e,r),n=r.Dir,i=r.Left,a=r.Right}null!==e.NextInLML?0<=e.OutIdx?(n=this.AddOutPt(e,e.Top),t&&this.AddGhostJoin(n,e.Bot),0!==(e=this.UpdateEdgeIntoAEL(e)).WindDelta&&(l=e.PrevInAEL,r=e.NextInAEL,null!==l&&l.Curr.X==e.Bot.X&&l.Curr.Y==e.Bot.Y&&0!==l.WindDelta&&0<=l.OutIdx&&l.Curr.Y>l.Top.Y&&v.ClipperBase.SlopesEqual(e,l,this.m_UseFullRange)?(i=this.AddOutPt(l,e.Bot),this.AddJoin(n,i,e.Top)):null!==r&&r.Curr.X==e.Bot.X&&r.Curr.Y==e.Bot.Y&&0!==r.WindDelta&&0<=r.OutIdx&&r.Curr.Y>r.Top.Y&&v.ClipperBase.SlopesEqual(e,r,this.m_UseFullRange)&&(i=this.AddOutPt(r,e.Bot),this.AddJoin(n,i,e.Top)))):this.UpdateEdgeIntoAEL(e):(0<=e.OutIdx&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e))},v.Clipper.prototype.GetNextInAEL=function(e,t){return t==v.Direction.dLeftToRight?e.NextInAEL:e.PrevInAEL},v.Clipper.prototype.IsMinima=function(e){return null!==e&&e.Prev.NextInLML!=e&&e.Next.NextInLML!=e},v.Clipper.prototype.IsMaxima=function(e,t){return null!==e&&e.Top.Y==t&&null===e.NextInLML},v.Clipper.prototype.IsIntermediate=function(e,t){return e.Top.Y==t&&null!==e.NextInLML},v.Clipper.prototype.GetMaximaPair=function(e){var t=null;return v.IntPoint.op_Equality(e.Next.Top,e.Top)&&null===e.Next.NextInLML?t=e.Next:v.IntPoint.op_Equality(e.Prev.Top,e.Top)&&null===e.Prev.NextInLML&&(t=e.Prev),null===t||-2!=t.OutIdx&&(t.NextInAEL!=t.PrevInAEL||v.ClipperBase.IsHorizontal(t))?t:null},v.Clipper.prototype.ProcessIntersections=function(e){if(null==this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(e),0==this.m_IntersectList.length)return!0;if(1!=this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(e){this.m_SortedEdges=null,this.m_IntersectList.length=0,v.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},v.Clipper.prototype.BuildIntersectList=function(e){if(null!==this.m_ActiveEdges){var t=this.m_ActiveEdges;for(this.m_SortedEdges=t;null!==t;)t.PrevInSEL=t.PrevInAEL,t.NextInSEL=t.NextInAEL,t.Curr.X=v.Clipper.TopX(t,e),t=t.NextInAEL;for(var r=!0;r&&null!==this.m_SortedEdges;){for(r=!1,t=this.m_SortedEdges;null!==t.NextInSEL;){e=t.NextInSEL;var n=new v.IntPoint;t.Curr.X>e.Curr.X?(this.IntersectPoint(t,e,n),(r=new v.IntersectNode).Edge1=t,r.Edge2=e,r.Pt.X=n.X,r.Pt.Y=n.Y,v.use_xyz&&(r.Pt.Z=n.Z),this.m_IntersectList.push(r),this.SwapPositionsInSEL(t,e),r=!0):t=e}if(null===t.PrevInSEL)break;t.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},v.Clipper.prototype.EdgesAdjacent=function(e){return e.Edge1.NextInSEL==e.Edge2||e.Edge1.PrevInSEL==e.Edge2},v.Clipper.IntersectNodeSort=function(e,t){return t.Pt.Y-e.Pt.Y},v.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var e=this.m_IntersectList.length,t=0;t<e;t++){if(!this.EdgesAdjacent(this.m_IntersectList[t])){for(var r=t+1;r<e&&!this.EdgesAdjacent(this.m_IntersectList[r]);)r++;if(r==e)return!1;var n=this.m_IntersectList[t];this.m_IntersectList[t]=this.m_IntersectList[r],this.m_IntersectList[r]=n}this.SwapPositionsInSEL(this.m_IntersectList[t].Edge1,this.m_IntersectList[t].Edge2)}return!0},v.Clipper.prototype.ProcessIntersectList=function(){for(var e=0,t=this.m_IntersectList.length;e<t;e++){var r=this.m_IntersectList[e];this.IntersectEdges(r.Edge1,r.Edge2,r.Pt),this.SwapPositionsInAEL(r.Edge1,r.Edge2)}this.m_IntersectList.length=0},y=function(e){return 0>e?Math.ceil(e-.5):Math.round(e)},P=function(e){return 0>e?Math.ceil(e-.5):Math.floor(e+.5)},x=function(e){return 0>e?-Math.round(Math.abs(e)):Math.round(e)},C=function(e){return 0>e?-2147483648>(e-=.5)?Math.ceil(e):0|e:2147483647<(e+=.5)?Math.floor(e):0|e},v.Clipper.Round=g?y:d?x:b?C:P,v.Clipper.TopX=function(e,t){return t==e.Top.Y?e.Top.X:e.Bot.X+v.Clipper.Round(e.Dx*(t-e.Bot.Y))},v.Clipper.prototype.IntersectPoint=function(e,t,r){var n,i;if(r.X=0,r.Y=0,e.Dx==t.Dx)r.Y=e.Curr.Y,r.X=v.Clipper.TopX(e,r.Y);else{if(0===e.Delta.X)r.X=e.Bot.X,v.ClipperBase.IsHorizontal(t)?r.Y=t.Bot.Y:(i=t.Bot.Y-t.Bot.X/t.Dx,r.Y=v.Clipper.Round(r.X/t.Dx+i));else if(0===t.Delta.X)r.X=t.Bot.X,v.ClipperBase.IsHorizontal(e)?r.Y=e.Bot.Y:(n=e.Bot.Y-e.Bot.X/e.Dx,r.Y=v.Clipper.Round(r.X/e.Dx+n));else{n=e.Bot.X-e.Bot.Y*e.Dx;var a=((i=t.Bot.X-t.Bot.Y*t.Dx)-n)/(e.Dx-t.Dx);r.Y=v.Clipper.Round(a),r.X=Math.abs(e.Dx)<Math.abs(t.Dx)?v.Clipper.Round(e.Dx*a+n):v.Clipper.Round(t.Dx*a+i)}if(r.Y<e.Top.Y||r.Y<t.Top.Y){if(e.Top.Y>t.Top.Y)return r.Y=e.Top.Y,r.X=v.Clipper.TopX(t,e.Top.Y),r.X<e.Top.X;r.Y=t.Top.Y,r.X=Math.abs(e.Dx)<Math.abs(t.Dx)?v.Clipper.TopX(e,r.Y):v.Clipper.TopX(t,r.Y)}r.Y>e.Curr.Y&&(r.Y=e.Curr.Y,r.X=Math.abs(e.Dx)>Math.abs(t.Dx)?v.Clipper.TopX(t,r.Y):v.Clipper.TopX(e,r.Y))}},v.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(e){for(var t=this.m_ActiveEdges;null!==t;){var r=this.IsMaxima(t,e);if(r&&(r=null===(r=this.GetMaximaPair(t))||!v.ClipperBase.IsHorizontal(r)),r){var n=t.PrevInAEL;this.DoMaxima(t),t=null===n?this.m_ActiveEdges:n.NextInAEL}else{if(this.IsIntermediate(t,e)&&v.ClipperBase.IsHorizontal(t.NextInLML)?(0<=(t=this.UpdateEdgeIntoAEL(t)).OutIdx&&this.AddOutPt(t,t.Bot),this.AddEdgeToSEL(t)):(t.Curr.X=v.Clipper.TopX(t,e),t.Curr.Y=e),this.StrictlySimple&&(n=t.PrevInAEL,0<=t.OutIdx&&0!==t.WindDelta&&null!==n&&0<=n.OutIdx&&n.Curr.X==t.Curr.X&&0!==n.WindDelta)){var i=new v.IntPoint(t.Curr);v.use_xyz&&this.SetZ(i,n,t),r=this.AddOutPt(n,i),n=this.AddOutPt(t,i),this.AddJoin(r,n,i)}t=t.NextInAEL}}for(this.ProcessHorizontals(!0),t=this.m_ActiveEdges;null!==t;)this.IsIntermediate(t,e)&&(r=null,0<=t.OutIdx&&(r=this.AddOutPt(t,t.Top)),n=(t=this.UpdateEdgeIntoAEL(t)).PrevInAEL,i=t.NextInAEL,null!==n&&n.Curr.X==t.Bot.X&&n.Curr.Y==t.Bot.Y&&null!==r&&0<=n.OutIdx&&n.Curr.Y>n.Top.Y&&v.ClipperBase.SlopesEqual(t,n,this.m_UseFullRange)&&0!==t.WindDelta&&0!==n.WindDelta?(n=this.AddOutPt(n,t.Bot),this.AddJoin(r,n,t.Top)):null!==i&&i.Curr.X==t.Bot.X&&i.Curr.Y==t.Bot.Y&&null!==r&&0<=i.OutIdx&&i.Curr.Y>i.Top.Y&&v.ClipperBase.SlopesEqual(t,i,this.m_UseFullRange)&&0!==t.WindDelta&&0!==i.WindDelta&&(n=this.AddOutPt(i,t.Bot),this.AddJoin(r,n,t.Top))),t=t.NextInAEL},v.Clipper.prototype.DoMaxima=function(e){var t=this.GetMaximaPair(e);if(null===t)0<=e.OutIdx&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e);else{for(var r=e.NextInAEL;null!==r&&r!=t;)this.IntersectEdges(e,r,e.Top),this.SwapPositionsInAEL(e,r),r=e.NextInAEL;-1==e.OutIdx&&-1==t.OutIdx?(this.DeleteFromAEL(e),this.DeleteFromAEL(t)):0<=e.OutIdx&&0<=t.OutIdx?(0<=e.OutIdx&&this.AddLocalMaxPoly(e,t,e.Top),this.DeleteFromAEL(e),this.DeleteFromAEL(t)):v.use_lines&&0===e.WindDelta?(0<=e.OutIdx&&(this.AddOutPt(e,e.Top),e.OutIdx=-1),this.DeleteFromAEL(e),0<=t.OutIdx&&(this.AddOutPt(t,e.Top),t.OutIdx=-1),this.DeleteFromAEL(t)):v.Error("DoMaxima error")}},v.Clipper.ReversePaths=function(e){for(var t=0,r=e.length;t<r;t++)e[t].reverse()},v.Clipper.Orientation=function(e){return 0<=v.Clipper.Area(e)},v.Clipper.prototype.PointCount=function(e){if(null===e)return 0;var t=0,r=e;do{t++,r=r.Next}while(r!=e);return t},v.Clipper.prototype.BuildResult=function(e){v.Clear(e);for(var t=0,r=this.m_PolyOuts.length;t<r;t++){var n=this.m_PolyOuts[t];if(null!==n.Pts){n=n.Pts.Prev;var i=this.PointCount(n);if(!(2>i)){for(var a=Array(i),o=0;o<i;o++)a[o]=n.Pt,n=n.Prev;e.push(a)}}}},v.Clipper.prototype.BuildResult2=function(e){e.Clear();for(var t=0,r=this.m_PolyOuts.length;t<r;t++){var n=this.m_PolyOuts[t],i=this.PointCount(n.Pts);if(!(n.IsOpen&&2>i||!n.IsOpen&&3>i)){this.FixHoleLinkage(n);var a=new v.PolyNode;e.m_AllPolys.push(a),n.PolyNode=a,a.m_polygon.length=i,n=n.Pts.Prev;for(var o=0;o<i;o++)a.m_polygon[o]=n.Pt,n=n.Prev}}for(t=0,r=this.m_PolyOuts.length;t<r;t++)null!==(n=this.m_PolyOuts[t]).PolyNode&&(n.IsOpen?(n.PolyNode.IsOpen=!0,e.AddChild(n.PolyNode)):null!==n.FirstLeft&&null!=n.FirstLeft.PolyNode?n.FirstLeft.PolyNode.AddChild(n.PolyNode):e.AddChild(n.PolyNode))},v.Clipper.prototype.FixupOutPolygon=function(e){var t=null;e.BottomPt=null;for(var r=e.Pts;;){if(r.Prev==r||r.Prev==r.Next)return void(e.Pts=null);if(v.IntPoint.op_Equality(r.Pt,r.Next.Pt)||v.IntPoint.op_Equality(r.Pt,r.Prev.Pt)||v.ClipperBase.SlopesEqual(r.Prev.Pt,r.Pt,r.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(r.Prev.Pt,r.Pt,r.Next.Pt)))t=null,r.Prev.Next=r.Next,r=r.Next.Prev=r.Prev;else{if(r==t)break;null===t&&(t=r),r=r.Next}}e.Pts=r},v.Clipper.prototype.DupOutPt=function(e,t){var r=new v.OutPt;return r.Pt.X=e.Pt.X,r.Pt.Y=e.Pt.Y,v.use_xyz&&(r.Pt.Z=e.Pt.Z),r.Idx=e.Idx,t?(r.Next=e.Next,r.Prev=e,e.Next.Prev=r,e.Next=r):(r.Prev=e.Prev,r.Next=e,e.Prev.Next=r,e.Prev=r),r},v.Clipper.prototype.GetOverlap=function(e,t,r,n,i){return e<t?r<n?(i.Left=Math.max(e,r),i.Right=Math.min(t,n)):(i.Left=Math.max(e,n),i.Right=Math.min(t,r)):r<n?(i.Left=Math.max(t,r),i.Right=Math.min(e,n)):(i.Left=Math.max(t,n),i.Right=Math.min(e,r)),i.Left<i.Right},v.Clipper.prototype.JoinHorz=function(e,t,r,n,i,a){var o=e.Pt.X>t.Pt.X?v.Direction.dRightToLeft:v.Direction.dLeftToRight;if(o==(n=r.Pt.X>n.Pt.X?v.Direction.dRightToLeft:v.Direction.dLeftToRight))return!1;if(o==v.Direction.dLeftToRight){for(;e.Next.Pt.X<=i.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y==i.Y;)e=e.Next;a&&e.Pt.X!=i.X&&(e=e.Next),t=this.DupOutPt(e,!a),v.IntPoint.op_Inequality(t.Pt,i)&&((e=t).Pt.X=i.X,e.Pt.Y=i.Y,v.use_xyz&&(e.Pt.Z=i.Z),t=this.DupOutPt(e,!a))}else{for(;e.Next.Pt.X>=i.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y==i.Y;)e=e.Next;a||e.Pt.X==i.X||(e=e.Next),t=this.DupOutPt(e,a),v.IntPoint.op_Inequality(t.Pt,i)&&((e=t).Pt.X=i.X,e.Pt.Y=i.Y,v.use_xyz&&(e.Pt.Z=i.Z),t=this.DupOutPt(e,a))}if(n==v.Direction.dLeftToRight){for(;r.Next.Pt.X<=i.X&&r.Next.Pt.X>=r.Pt.X&&r.Next.Pt.Y==i.Y;)r=r.Next;a&&r.Pt.X!=i.X&&(r=r.Next),n=this.DupOutPt(r,!a),v.IntPoint.op_Inequality(n.Pt,i)&&((r=n).Pt.X=i.X,r.Pt.Y=i.Y,v.use_xyz&&(r.Pt.Z=i.Z),n=this.DupOutPt(r,!a))}else{for(;r.Next.Pt.X>=i.X&&r.Next.Pt.X<=r.Pt.X&&r.Next.Pt.Y==i.Y;)r=r.Next;a||r.Pt.X==i.X||(r=r.Next),n=this.DupOutPt(r,a),v.IntPoint.op_Inequality(n.Pt,i)&&((r=n).Pt.X=i.X,r.Pt.Y=i.Y,v.use_xyz&&(r.Pt.Z=i.Z),n=this.DupOutPt(r,a))}return o==v.Direction.dLeftToRight==a?(e.Prev=r,r.Next=e,t.Next=n,n.Prev=t):(e.Next=r,r.Prev=e,t.Prev=n,n.Next=t),!0},v.Clipper.prototype.JoinPoints=function(e,t,r){var n,i=e.OutPt1;new v.OutPt;var a,o=e.OutPt2;if(new v.OutPt,(a=e.OutPt1.Pt.Y==e.OffPt.Y)&&v.IntPoint.op_Equality(e.OffPt,e.OutPt1.Pt)&&v.IntPoint.op_Equality(e.OffPt,e.OutPt2.Pt)){if(t!=r)return!1;for(n=e.OutPt1.Next;n!=i&&v.IntPoint.op_Equality(n.Pt,e.OffPt);)n=n.Next;for(n=n.Pt.Y>e.OffPt.Y,a=e.OutPt2.Next;a!=o&&v.IntPoint.op_Equality(a.Pt,e.OffPt);)a=a.Next;return n!=a.Pt.Y>e.OffPt.Y&&(n?(n=this.DupOutPt(i,!1),a=this.DupOutPt(o,!0),i.Prev=o,o.Next=i,n.Next=a,a.Prev=n):(n=this.DupOutPt(i,!0),a=this.DupOutPt(o,!1),i.Next=o,o.Prev=i,n.Prev=a,a.Next=n),e.OutPt1=i,e.OutPt2=n,!0)}if(a){for(n=i;i.Prev.Pt.Y==i.Pt.Y&&i.Prev!=n&&i.Prev!=o;)i=i.Prev;for(;n.Next.Pt.Y==n.Pt.Y&&n.Next!=i&&n.Next!=o;)n=n.Next;if(n.Next==i||n.Next==o)return!1;for(a=o;o.Prev.Pt.Y==o.Pt.Y&&o.Prev!=a&&o.Prev!=n;)o=o.Prev;for(;a.Next.Pt.Y==a.Pt.Y&&a.Next!=o&&a.Next!=i;)a=a.Next;if(a.Next==o||a.Next==i)return!1;if(r={Left:null,Right:null},!this.GetOverlap(i.Pt.X,n.Pt.X,o.Pt.X,a.Pt.X,r))return!1;t=r.Left;var l=r.Right;return r=new v.IntPoint,i.Pt.X>=t&&i.Pt.X<=l?(r.X=i.Pt.X,r.Y=i.Pt.Y,v.use_xyz&&(r.Z=i.Pt.Z),t=i.Pt.X>n.Pt.X):o.Pt.X>=t&&o.Pt.X<=l?(r.X=o.Pt.X,r.Y=o.Pt.Y,v.use_xyz&&(r.Z=o.Pt.Z),t=o.Pt.X>a.Pt.X):n.Pt.X>=t&&n.Pt.X<=l?(r.X=n.Pt.X,r.Y=n.Pt.Y,v.use_xyz&&(r.Z=n.Pt.Z),t=n.Pt.X>i.Pt.X):(r.X=a.Pt.X,r.Y=a.Pt.Y,v.use_xyz&&(r.Z=a.Pt.Z),t=a.Pt.X>o.Pt.X),e.OutPt1=i,e.OutPt2=o,this.JoinHorz(i,n,o,a,r,t)}for(n=i.Next;v.IntPoint.op_Equality(n.Pt,i.Pt)&&n!=i;)n=n.Next;if(l=n.Pt.Y>i.Pt.Y||!v.ClipperBase.SlopesEqual(i.Pt,n.Pt,e.OffPt,this.m_UseFullRange)){for(n=i.Prev;v.IntPoint.op_Equality(n.Pt,i.Pt)&&n!=i;)n=n.Prev;if(n.Pt.Y>i.Pt.Y||!v.ClipperBase.SlopesEqual(i.Pt,n.Pt,e.OffPt,this.m_UseFullRange))return!1}for(a=o.Next;v.IntPoint.op_Equality(a.Pt,o.Pt)&&a!=o;)a=a.Next;var s=a.Pt.Y>o.Pt.Y||!v.ClipperBase.SlopesEqual(o.Pt,a.Pt,e.OffPt,this.m_UseFullRange);if(s){for(a=o.Prev;v.IntPoint.op_Equality(a.Pt,o.Pt)&&a!=o;)a=a.Prev;if(a.Pt.Y>o.Pt.Y||!v.ClipperBase.SlopesEqual(o.Pt,a.Pt,e.OffPt,this.m_UseFullRange))return!1}return n!=i&&a!=o&&n!=a&&(t!=r||l!=s)&&(l?(n=this.DupOutPt(i,!1),a=this.DupOutPt(o,!0),i.Prev=o,o.Next=i,n.Next=a,a.Prev=n):(n=this.DupOutPt(i,!0),a=this.DupOutPt(o,!1),i.Next=o,o.Prev=i,n.Prev=a,a.Next=n),e.OutPt1=i,e.OutPt2=n,!0)},v.Clipper.GetBounds=function(e){for(var t=0,r=e.length;t<r&&0==e[t].length;)t++;if(t==r)return new v.IntRect(0,0,0,0);var n=new v.IntRect;for(n.left=e[t][0].X,n.right=n.left,n.top=e[t][0].Y,n.bottom=n.top;t<r;t++)for(var i=0,a=e[t].length;i<a;i++)e[t][i].X<n.left?n.left=e[t][i].X:e[t][i].X>n.right&&(n.right=e[t][i].X),e[t][i].Y<n.top?n.top=e[t][i].Y:e[t][i].Y>n.bottom&&(n.bottom=e[t][i].Y);return n},v.Clipper.prototype.GetBounds2=function(e){var t=e,r=new v.IntRect;for(r.left=e.Pt.X,r.right=e.Pt.X,r.top=e.Pt.Y,r.bottom=e.Pt.Y,e=e.Next;e!=t;)e.Pt.X<r.left&&(r.left=e.Pt.X),e.Pt.X>r.right&&(r.right=e.Pt.X),e.Pt.Y<r.top&&(r.top=e.Pt.Y),e.Pt.Y>r.bottom&&(r.bottom=e.Pt.Y),e=e.Next;return r},v.Clipper.PointInPolygon=function(e,t){var r=0,n=t.length;if(3>n)return 0;for(var i=t[0],a=1;a<=n;++a){var o=a==n?t[0]:t[a];if(o.Y==e.Y&&(o.X==e.X||i.Y==e.Y&&o.X>e.X==i.X<e.X))return-1;if(i.Y<e.Y!=o.Y<e.Y)if(i.X>=e.X)if(o.X>e.X)r=1-r;else{var l=(i.X-e.X)*(o.Y-e.Y)-(o.X-e.X)*(i.Y-e.Y);if(0==l)return-1;0<l==o.Y>i.Y&&(r=1-r)}else if(o.X>e.X){if(0==(l=(i.X-e.X)*(o.Y-e.Y)-(o.X-e.X)*(i.Y-e.Y)))return-1;0<l==o.Y>i.Y&&(r=1-r)}i=o}return r},v.Clipper.prototype.PointInPolygon=function(e,t){var r=0,n=t,i=e.X;e=e.Y;var a=t.Pt.X,o=t.Pt.Y;do{var l=(t=t.Next).Pt.X,s=t.Pt.Y;if(s==e&&(l==i||o==e&&l>i==a<i))return-1;if(o<e!=s<e)if(a>=i)if(l>i)r=1-r;else{if(0==(a=(a-i)*(s-e)-(l-i)*(o-e)))return-1;0<a==s>o&&(r=1-r)}else if(l>i){if(0==(a=(a-i)*(s-e)-(l-i)*(o-e)))return-1;0<a==s>o&&(r=1-r)}a=l,o=s}while(n!=t);return r},v.Clipper.prototype.Poly2ContainsPoly1=function(e,t){var r=e;do{var n=this.PointInPolygon(r.Pt,t);if(0<=n)return 0<n;r=r.Next}while(r!=e);return!0},v.Clipper.prototype.FixupFirstLefts1=function(e,t){for(var r=0,n=this.m_PolyOuts.length;r<n;r++){var i=this.m_PolyOuts[r];null!=i.Pts&&null!=i.FirstLeft&&this.ParseFirstLeft(i.FirstLeft)==e&&this.Poly2ContainsPoly1(i.Pts,t.Pts)&&(i.FirstLeft=t)}},v.Clipper.prototype.FixupFirstLefts2=function(e,t){for(var r=0,n=this.m_PolyOuts,i=n.length,a=n[r];r<i;a=n[++r])a.FirstLeft==e&&(a.FirstLeft=t)},v.Clipper.ParseFirstLeft=function(e){for(;null!=e&&null==e.Pts;)e=e.FirstLeft;return e},v.Clipper.prototype.JoinCommonEdges=function(){for(var e=0,t=this.m_Joins.length;e<t;e++){var r=this.m_Joins[e],n=this.GetOutRec(r.OutPt1.Idx),i=this.GetOutRec(r.OutPt2.Idx);if(null!=n.Pts&&null!=i.Pts){var a=n==i?n:this.Param1RightOfParam2(n,i)?i:this.Param1RightOfParam2(i,n)?n:this.GetLowermostRec(n,i);if(this.JoinPoints(r,n,i))if(n==i){if(n.Pts=r.OutPt1,n.BottomPt=null,(i=this.CreateOutRec()).Pts=r.OutPt2,this.UpdateOutPtIdxs(i),this.m_UsingPolyTree){a=0;for(var o=this.m_PolyOuts.length;a<o-1;a++){var l=this.m_PolyOuts[a];null!=l.Pts&&v.Clipper.ParseFirstLeft(l.FirstLeft)==n&&l.IsHole!=n.IsHole&&this.Poly2ContainsPoly1(l.Pts,r.OutPt2)&&(l.FirstLeft=i)}}this.Poly2ContainsPoly1(i.Pts,n.Pts)?(i.IsHole=!n.IsHole,i.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,n),(i.IsHole^this.ReverseSolution)==0<this.Area(i)&&this.ReversePolyPtLinks(i.Pts)):this.Poly2ContainsPoly1(n.Pts,i.Pts)?(i.IsHole=n.IsHole,n.IsHole=!i.IsHole,i.FirstLeft=n.FirstLeft,n.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,i),(n.IsHole^this.ReverseSolution)==0<this.Area(n)&&this.ReversePolyPtLinks(n.Pts)):(i.IsHole=n.IsHole,i.FirstLeft=n.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(n,i))}else i.Pts=null,i.BottomPt=null,i.Idx=n.Idx,n.IsHole=a.IsHole,a==i&&(n.FirstLeft=i.FirstLeft),i.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,n)}}},v.Clipper.prototype.UpdateOutPtIdxs=function(e){var t=e.Pts;do{t.Idx=e.Idx,t=t.Prev}while(t!=e.Pts)},v.Clipper.prototype.DoSimplePolygons=function(){for(var e=0;e<this.m_PolyOuts.length;){var t=this.m_PolyOuts[e++],r=t.Pts;if(null!=r&&!t.IsOpen)do{for(var n=r.Next;n!=t.Pts;){if(v.IntPoint.op_Equality(r.Pt,n.Pt)&&n.Next!=r&&n.Prev!=r){var i=r.Prev,a=n.Prev;r.Prev=a,a.Next=r,n.Prev=i,i.Next=n,t.Pts=r,(i=this.CreateOutRec()).Pts=n,this.UpdateOutPtIdxs(i),this.Poly2ContainsPoly1(i.Pts,t.Pts)?(i.IsHole=!t.IsHole,i.FirstLeft=t,this.m_UsingPolyTree&&this.FixupFirstLefts2(i,t)):this.Poly2ContainsPoly1(t.Pts,i.Pts)?(i.IsHole=t.IsHole,t.IsHole=!i.IsHole,i.FirstLeft=t.FirstLeft,t.FirstLeft=i,this.m_UsingPolyTree&&this.FixupFirstLefts2(t,i)):(i.IsHole=t.IsHole,i.FirstLeft=t.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(t,i)),n=r}n=n.Next}r=r.Next}while(r!=t.Pts)}},v.Clipper.Area=function(e){var t=e.length;if(3>t)return 0;for(var r=0,n=0,i=t-1;n<t;++n)r+=(e[i].X+e[n].X)*(e[i].Y-e[n].Y),i=n;return.5*-r},v.Clipper.prototype.Area=function(e){var t=e.Pts;if(null==t)return 0;var r=0;do{r+=(t.Prev.Pt.X+t.Pt.X)*(t.Prev.Pt.Y-t.Pt.Y),t=t.Next}while(t!=e.Pts);return.5*r},v.Clipper.SimplifyPolygon=function(e,t){var r=[],n=new v.Clipper(0);return n.StrictlySimple=!0,n.AddPath(e,v.PolyType.ptSubject,!0),n.Execute(v.ClipType.ctUnion,r,t,t),r},v.Clipper.SimplifyPolygons=function(e,t){void 0===t&&(t=v.PolyFillType.pftEvenOdd);var r=[],n=new v.Clipper(0);return n.StrictlySimple=!0,n.AddPaths(e,v.PolyType.ptSubject,!0),n.Execute(v.ClipType.ctUnion,r,t,t),r},v.Clipper.DistanceSqrd=function(e,t){var r=e.X-t.X;return r*r+(e=e.Y-t.Y)*e},v.Clipper.DistanceFromLineSqrd=function(e,t,r){var n=t.Y-r.Y;return r=r.X-t.X,t=n*t.X+r*t.Y,(t=n*e.X+r*e.Y-t)*t/(n*n+r*r)},v.Clipper.SlopesNearCollinear=function(e,t,r,n){return Math.abs(e.X-t.X)>Math.abs(e.Y-t.Y)?e.X>t.X==e.X<r.X?v.Clipper.DistanceFromLineSqrd(e,t,r)<n:t.X>e.X==t.X<r.X?v.Clipper.DistanceFromLineSqrd(t,e,r)<n:v.Clipper.DistanceFromLineSqrd(r,e,t)<n:e.Y>t.Y==e.Y<r.Y?v.Clipper.DistanceFromLineSqrd(e,t,r)<n:t.Y>e.Y==t.Y<r.Y?v.Clipper.DistanceFromLineSqrd(t,e,r)<n:v.Clipper.DistanceFromLineSqrd(r,e,t)<n},v.Clipper.PointsAreClose=function(e,t,r){var n=e.X-t.X;return n*n+(e=e.Y-t.Y)*e<=r},v.Clipper.ExcludeOp=function(e){var t=e.Prev;return t.Next=e.Next,e.Next.Prev=t,t.Idx=0,t},v.Clipper.CleanPolygon=function(e,t){void 0===t&&(t=1.415);var r=e.length;if(0==r)return[];for(var n=Array(r),i=0;i<r;++i)n[i]=new v.OutPt;for(i=0;i<r;++i)n[i].Pt=e[i],n[i].Next=n[(i+1)%r],n[i].Next.Prev=n[i],n[i].Idx=0;for(i=t*t,n=n[0];0==n.Idx&&n.Next!=n.Prev;)v.Clipper.PointsAreClose(n.Pt,n.Prev.Pt,i)?(n=v.Clipper.ExcludeOp(n),r--):v.Clipper.PointsAreClose(n.Prev.Pt,n.Next.Pt,i)?(v.Clipper.ExcludeOp(n.Next),n=v.Clipper.ExcludeOp(n),r-=2):v.Clipper.SlopesNearCollinear(n.Prev.Pt,n.Pt,n.Next.Pt,i)?(n=v.Clipper.ExcludeOp(n),r--):(n.Idx=1,n=n.Next);for(3>r&&(r=0),e=Array(r),i=0;i<r;++i)e[i]=new v.IntPoint(n.Pt),n=n.Next;return e},v.Clipper.CleanPolygons=function(e,t){for(var r=Array(e.length),n=0,i=e.length;n<i;n++)r[n]=v.Clipper.CleanPolygon(e[n],t);return r},v.Clipper.Minkowski=function(e,t,r,n){n=n?1:0;var i=e.length,a=t.length,o=[];if(r)for(r=0;r<a;r++){for(var l=Array(i),s=0,u=e.length,c=e[s];s<u;c=e[++s])l[s]=new v.IntPoint(t[r].X+c.X,t[r].Y+c.Y);o.push(l)}else for(r=0;r<a;r++){for(l=Array(i),s=0,u=e.length,c=e[s];s<u;c=e[++s])l[s]=new v.IntPoint(t[r].X-c.X,t[r].Y-c.Y);o.push(l)}for(e=[],r=0;r<a-1+n;r++)for(s=0;s<i;s++)(t=[]).push(o[r%a][s%i]),t.push(o[(r+1)%a][s%i]),t.push(o[(r+1)%a][(s+1)%i]),t.push(o[r%a][(s+1)%i]),v.Clipper.Orientation(t)||t.reverse(),e.push(t);return e},v.Clipper.MinkowskiSum=function(e,t,r){if(t[0]instanceof Array){o=t,t=new v.Paths;for(var n=new v.Clipper,i=0;i<o.length;++i){var a=v.Clipper.Minkowski(e,o[i],!0,r);n.AddPaths(a,v.PolyType.ptSubject,!0),r&&(a=v.Clipper.TranslatePath(o[i],e[0]),n.AddPath(a,v.PolyType.ptClip,!0))}return n.Execute(v.ClipType.ctUnion,t,v.PolyFillType.pftNonZero,v.PolyFillType.pftNonZero),t}var o=v.Clipper.Minkowski(e,t,!0,r);return(n=new v.Clipper).AddPaths(o,v.PolyType.ptSubject,!0),n.Execute(v.ClipType.ctUnion,o,v.PolyFillType.pftNonZero,v.PolyFillType.pftNonZero),o},v.Clipper.TranslatePath=function(e,t){for(var r=new v.Path,n=0;n<e.length;n++)r.push(new v.IntPoint(e[n].X+t.X,e[n].Y+t.Y));return r},v.Clipper.MinkowskiDiff=function(e,t){return e=v.Clipper.Minkowski(e,t,!1,!0),(t=new v.Clipper).AddPaths(e,v.PolyType.ptSubject,!0),t.Execute(v.ClipType.ctUnion,e,v.PolyFillType.pftNonZero,v.PolyFillType.pftNonZero),e},v.Clipper.PolyTreeToPaths=function(e){var t=[];return v.Clipper.AddPolyNodeToPaths(e,v.Clipper.NodeType.ntAny,t),t},v.Clipper.AddPolyNodeToPaths=function(e,t,r){var n=!0;switch(t){case v.Clipper.NodeType.ntOpen:return;case v.Clipper.NodeType.ntClosed:n=!e.IsOpen}0<e.m_polygon.length&&n&&r.push(e.m_polygon),n=0;for(var i=(e=e.Childs()).length,a=e[n];n<i;a=e[++n])v.Clipper.AddPolyNodeToPaths(a,t,r)},v.Clipper.OpenPathsFromPolyTree=function(e){for(var t=new v.Paths,r=0,n=e.ChildCount();r<n;r++)e.Childs()[r].IsOpen&&t.push(e.Childs()[r].m_polygon);return t},v.Clipper.ClosedPathsFromPolyTree=function(e){var t=new v.Paths;return v.Clipper.AddPolyNodeToPaths(e,v.Clipper.NodeType.ntClosed,t),t},m(v.Clipper,v.ClipperBase),v.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},v.ClipperOffset=function(e,t){void 0===e&&(e=2),void 0===t&&(t=v.ClipperOffset.def_arc_tolerance),this.m_destPolys=new v.Paths,this.m_srcPoly=new v.Path,this.m_destPoly=new v.Path,this.m_normals=[],this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0,this.m_lowest=new v.IntPoint,this.m_polyNodes=new v.PolyNode,this.MiterLimit=e,this.ArcTolerance=t,this.m_lowest.X=-1},v.ClipperOffset.two_pi=6.28318530717959,v.ClipperOffset.def_arc_tolerance=.25,v.ClipperOffset.prototype.Clear=function(){v.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},v.ClipperOffset.Round=v.Clipper.Round,v.ClipperOffset.prototype.AddPath=function(e,t,r){var n=e.length-1;if(!(0>n)){var i=new v.PolyNode;if(i.m_jointype=t,i.m_endtype=r,r==v.EndType.etClosedLine||r==v.EndType.etClosedPolygon)for(;0<n&&v.IntPoint.op_Equality(e[0],e[n]);)n--;i.m_polygon.push(e[0]);var a=0;t=0;for(var o=1;o<=n;o++)v.IntPoint.op_Inequality(i.m_polygon[a],e[o])&&(a++,i.m_polygon.push(e[o]),e[o].Y>i.m_polygon[t].Y||e[o].Y==i.m_polygon[t].Y&&e[o].X<i.m_polygon[t].X)&&(t=a);r==v.EndType.etClosedPolygon&&2>a||(this.m_polyNodes.AddChild(i),r!=v.EndType.etClosedPolygon)||(0>this.m_lowest.X?this.m_lowest=new v.IntPoint(this.m_polyNodes.ChildCount()-1,t):(e=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],(i.m_polygon[t].Y>e.Y||i.m_polygon[t].Y==e.Y&&i.m_polygon[t].X<e.X)&&(this.m_lowest=new v.IntPoint(this.m_polyNodes.ChildCount()-1,t))))}},v.ClipperOffset.prototype.AddPaths=function(e,t,r){for(var n=0,i=e.length;n<i;n++)this.AddPath(e[n],t,r)},v.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!v.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var e=0;e<this.m_polyNodes.ChildCount();e++){var t=this.m_polyNodes.Childs()[e];(t.m_endtype==v.EndType.etClosedPolygon||t.m_endtype==v.EndType.etClosedLine&&v.Clipper.Orientation(t.m_polygon))&&t.m_polygon.reverse()}else for(e=0;e<this.m_polyNodes.ChildCount();e++)(t=this.m_polyNodes.Childs()[e]).m_endtype!=v.EndType.etClosedLine||v.Clipper.Orientation(t.m_polygon)||t.m_polygon.reverse()},v.ClipperOffset.GetUnitNormal=function(e,t){var r=t.X-e.X;return e=t.Y-e.Y,0==r&&0==e?new v.DoublePoint(0,0):(t=1/Math.sqrt(r*r+e*e),new v.DoublePoint(e*t,-r*t))},v.ClipperOffset.prototype.DoOffset=function(e){if(this.m_destPolys=[],this.m_delta=e,v.ClipperBase.near_zero(e))for(var t=0;t<this.m_polyNodes.ChildCount();t++){var r=this.m_polyNodes.Childs()[t];r.m_endtype==v.EndType.etClosedPolygon&&this.m_destPolys.push(r.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var n=3.14159265358979/Math.acos(1-(0>=this.ArcTolerance?v.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(e)*v.ClipperOffset.def_arc_tolerance?Math.abs(e)*v.ClipperOffset.def_arc_tolerance:this.ArcTolerance)/Math.abs(e));for(this.m_sin=Math.sin(v.ClipperOffset.two_pi/n),this.m_cos=Math.cos(v.ClipperOffset.two_pi/n),this.m_StepsPerRad=n/v.ClipperOffset.two_pi,0>e&&(this.m_sin=-this.m_sin),t=0;t<this.m_polyNodes.ChildCount();t++){r=this.m_polyNodes.Childs()[t],this.m_srcPoly=r.m_polygon;var i=this.m_srcPoly.length;if(!(0==i||0>=e&&(3>i||r.m_endtype!=v.EndType.etClosedPolygon))){if(this.m_destPoly=[],1==i)if(r.m_jointype==v.JoinType.jtRound){r=1,i=0;for(var a=1;a<=n;a++){this.m_destPoly.push(new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[0].X+r*e),v.ClipperOffset.Round(this.m_srcPoly[0].Y+i*e)));var o=r;r=r*this.m_cos-this.m_sin*i,i=o*this.m_sin+i*this.m_cos}}else for(i=r=-1,a=0;4>a;++a)this.m_destPoly.push(new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[0].X+r*e),v.ClipperOffset.Round(this.m_srcPoly[0].Y+i*e))),0>r?r=1:0>i?i=1:r=-1;else{for(a=this.m_normals.length=0;a<i-1;a++)this.m_normals.push(v.ClipperOffset.GetUnitNormal(this.m_srcPoly[a],this.m_srcPoly[a+1]));if(r.m_endtype==v.EndType.etClosedLine||r.m_endtype==v.EndType.etClosedPolygon?this.m_normals.push(v.ClipperOffset.GetUnitNormal(this.m_srcPoly[i-1],this.m_srcPoly[0])):this.m_normals.push(new v.DoublePoint(this.m_normals[i-2])),r.m_endtype==v.EndType.etClosedPolygon)for(o=i-1,a=0;a<i;a++)o=this.OffsetPoint(a,o,r.m_jointype);else if(r.m_endtype==v.EndType.etClosedLine){for(o=i-1,a=0;a<i;a++)o=this.OffsetPoint(a,o,r.m_jointype);for(this.m_destPolys.push(this.m_destPoly),this.m_destPoly=[],o=this.m_normals[i-1],a=i-1;0<a;a--)this.m_normals[a]=new v.DoublePoint(-this.m_normals[a-1].X,-this.m_normals[a-1].Y);for(this.m_normals[0]=new v.DoublePoint(-o.X,-o.Y),o=0,a=i-1;0<=a;a--)o=this.OffsetPoint(a,o,r.m_jointype)}else{for(o=0,a=1;a<i-1;++a)o=this.OffsetPoint(a,o,r.m_jointype);for(r.m_endtype==v.EndType.etOpenButt?(a=i-1,o=new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[a].X*e),v.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[a].Y*e)),this.m_destPoly.push(o),o=new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[a].X-this.m_normals[a].X*e),v.ClipperOffset.Round(this.m_srcPoly[a].Y-this.m_normals[a].Y*e)),this.m_destPoly.push(o)):(a=i-1,o=i-2,this.m_sinA=0,this.m_normals[a]=new v.DoublePoint(-this.m_normals[a].X,-this.m_normals[a].Y),r.m_endtype==v.EndType.etOpenSquare?this.DoSquare(a,o):this.DoRound(a,o)),a=i-1;0<a;a--)this.m_normals[a]=new v.DoublePoint(-this.m_normals[a-1].X,-this.m_normals[a-1].Y);for(this.m_normals[0]=new v.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y),a=(o=i-1)-1;0<a;--a)o=this.OffsetPoint(a,o,r.m_jointype);r.m_endtype==v.EndType.etOpenButt?(o=new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*e),v.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*e)),this.m_destPoly.push(o),o=new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*e),v.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*e)),this.m_destPoly.push(o)):(this.m_sinA=0,r.m_endtype==v.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}},v.ClipperOffset.prototype.Execute=function(){var e=arguments;if(e[0]instanceof v.PolyTree)if(t=e[0],r=e[1],t.Clear(),this.FixOrientations(),this.DoOffset(r),(e=new v.Clipper(0)).AddPaths(this.m_destPolys,v.PolyType.ptSubject,!0),0<r)e.Execute(v.ClipType.ctUnion,t,v.PolyFillType.pftPositive,v.PolyFillType.pftPositive);else if(r=v.Clipper.GetBounds(this.m_destPolys),(n=new v.Path).push(new v.IntPoint(r.left-10,r.bottom+10)),n.push(new v.IntPoint(r.right+10,r.bottom+10)),n.push(new v.IntPoint(r.right+10,r.top-10)),n.push(new v.IntPoint(r.left-10,r.top-10)),e.AddPath(n,v.PolyType.ptSubject,!0),e.ReverseSolution=!0,e.Execute(v.ClipType.ctUnion,t,v.PolyFillType.pftNegative,v.PolyFillType.pftNegative),1==t.ChildCount()&&0<t.Childs()[0].ChildCount())for(e=t.Childs()[0],t.Childs()[0]=e.Childs()[0],t.Childs()[0].m_Parent=t,r=1;r<e.ChildCount();r++)t.AddChild(e.Childs()[r]);else t.Clear();else{var t=e[0],r=e[1];if(v.Clear(t),this.FixOrientations(),this.DoOffset(r),(e=new v.Clipper(0)).AddPaths(this.m_destPolys,v.PolyType.ptSubject,!0),0<r)e.Execute(v.ClipType.ctUnion,t,v.PolyFillType.pftPositive,v.PolyFillType.pftPositive);else{r=v.Clipper.GetBounds(this.m_destPolys);var n=new v.Path;n.push(new v.IntPoint(r.left-10,r.bottom+10)),n.push(new v.IntPoint(r.right+10,r.bottom+10)),n.push(new v.IntPoint(r.right+10,r.top-10)),n.push(new v.IntPoint(r.left-10,r.top-10)),e.AddPath(n,v.PolyType.ptSubject,!0),e.ReverseSolution=!0,e.Execute(v.ClipType.ctUnion,t,v.PolyFillType.pftNegative,v.PolyFillType.pftNegative),0<t.length&&t.splice(0,1)}}},v.ClipperOffset.prototype.OffsetPoint=function(e,t,r){if(this.m_sinA=this.m_normals[t].X*this.m_normals[e].Y-this.m_normals[e].X*this.m_normals[t].Y,1>Math.abs(this.m_sinA*this.m_delta)){if(0<this.m_normals[t].X*this.m_normals[e].X+this.m_normals[e].Y*this.m_normals[t].Y)return this.m_destPoly.push(new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[t].X*this.m_delta),v.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[t].Y*this.m_delta))),t}else 1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[t].X*this.m_delta),v.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[t].Y*this.m_delta))),this.m_destPoly.push(new v.IntPoint(this.m_srcPoly[e])),this.m_destPoly.push(new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta),v.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta)));else switch(r){case v.JoinType.jtMiter:(r=this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y+1)>=this.m_miterLim?this.DoMiter(e,t,r):this.DoSquare(e,t);break;case v.JoinType.jtSquare:this.DoSquare(e,t);break;case v.JoinType.jtRound:this.DoRound(e,t)}return e},v.ClipperOffset.prototype.DoSquare=function(e,t){var r=Math.tan(Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y)/4);this.m_destPoly.push(new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[t].X-this.m_normals[t].Y*r)),v.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[t].Y+this.m_normals[t].X*r)))),this.m_destPoly.push(new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[e].X+this.m_normals[e].Y*r)),v.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[e].Y-this.m_normals[e].X*r))))},v.ClipperOffset.prototype.DoMiter=function(e,t,r){r=this.m_delta/r,this.m_destPoly.push(new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[e].X+(this.m_normals[t].X+this.m_normals[e].X)*r),v.ClipperOffset.Round(this.m_srcPoly[e].Y+(this.m_normals[t].Y+this.m_normals[e].Y)*r)))},v.ClipperOffset.prototype.DoRound=function(e,t){var r=Math.max(v.Cast_Int32(v.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y)))),1),n=this.m_normals[t].X;t=this.m_normals[t].Y;for(var i,a=0;a<r;++a)this.m_destPoly.push(new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[e].X+n*this.m_delta),v.ClipperOffset.Round(this.m_srcPoly[e].Y+t*this.m_delta))),i=n,n=n*this.m_cos-this.m_sin*t,t=i*this.m_sin+t*this.m_cos;this.m_destPoly.push(new v.IntPoint(v.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta),v.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta)))},v.Error=function(e){try{throw Error(e)}catch(e){alert(e.message)}},v.JS={},v.JS.AreaOfPolygon=function(e,t){return t||(t=1),v.Clipper.Area(e)/(t*t)},v.JS.AreaOfPolygons=function(e,t){t||(t=1);for(var r=0,n=0;n<e.length;n++)r+=v.Clipper.Area(e[n]);return r/(t*t)},v.JS.BoundsOfPath=function(e,t){return v.JS.BoundsOfPaths([e],t)},v.JS.BoundsOfPaths=function(e,t){return t||(t=1),(e=v.Clipper.GetBounds(e)).left/=t,e.bottom/=t,e.right/=t,e.top/=t,e},v.JS.Clean=function(e,t){if(!(e instanceof Array))return[];var r=e[0]instanceof Array;if(e=v.JS.Clone(e),"number"!=typeof t||null===t)return v.Error("Delta is not a number in Clean()."),e;if(0===e.length||1==e.length&&0===e[0].length||0>t)return e;r||(e=[e]);for(var n,i,a,o,l,s,u,c=e.length,p=[],f=0;f<c;f++)if(0!==(n=(i=e[f]).length))if(3>n)a=i,p.push(a);else{for(a=i,o=t*t,l=i[0],u=s=1;u<n;u++)(i[u].X-l.X)*(i[u].X-l.X)+(i[u].Y-l.Y)*(i[u].Y-l.Y)<=o||(a[s]=i[u],l=i[u],s++);l=i[s-1],(i[0].X-l.X)*(i[0].X-l.X)+(i[0].Y-l.Y)*(i[0].Y-l.Y)<=o&&s--,s<n&&a.splice(s,n-s),a.length&&p.push(a)}return!r&&p.length?p=p[0]:r||0!==p.length?r&&0===p.length&&(p=[[]]):p=[],p},v.JS.Clone=function(e){if(!(e instanceof Array)||0===e.length)return[];if(1==e.length&&0===e[0].length)return[[]];var t=e[0]instanceof Array;t||(e=[e]);var r,n,i=e.length,a=Array(i);for(r=0;r<i;r++){var o=e[r].length,l=Array(o);for(n=0;n<o;n++)l[n]={X:e[r][n].X,Y:e[r][n].Y};a[r]=l}return t||(a=a[0]),a},v.JS.Lighten=function(e,t){if(!(e instanceof Array))return[];if("number"!=typeof t||null===t)return v.Error("Tolerance is not a number in Lighten()."),v.JS.Clone(e);if(0===e.length||1==e.length&&0===e[0].length||0>t)return v.JS.Clone(e);e[0]instanceof Array||(e=[e]);var r,n,i,a,o,l=e.length,s=t*t,u=[];for(t=0;t<l;t++)if(0!=(a=(n=e[t]).length)){for(i=0;1e6>i;i++){var c=[];n[(a=n.length)-1].X!=n[0].X||n[a-1].Y!=n[0].Y?(o=1,n.push({X:n[0].X,Y:n[0].Y}),a=n.length):o=0;var p=[];for(r=0;r<a-2;r++){var f=n[r],h=n[r+1],d=n[r+2],m=f.X,g=f.Y;f=d.X-m;var y=d.Y-g;if(0!==f||0!==y){var b=((h.X-m)*f+(h.Y-g)*y)/(f*f+y*y);1<b?(m=d.X,g=d.Y):0<b&&(m+=f*b,g+=y*b)}(d=(f=h.X-m)*f+(y=h.Y-g)*y)<=s&&(p[r+1]=1,r++)}for(c.push({X:n[0].X,Y:n[0].Y}),r=1;r<a-1;r++)p[r]||c.push({X:n[r].X,Y:n[r].Y});if(c.push({X:n[a-1].X,Y:n[a-1].Y}),o&&n.pop(),!p.length)break;n=c}c[(a=c.length)-1].X==c[0].X&&c[a-1].Y==c[0].Y&&c.pop(),2<c.length&&u.push(c)}return e[0]instanceof Array||(u=u[0]),void 0===u&&(u=[[]]),u},v.JS.PerimeterOfPath=function(e,t,r){if(void 0===e)return 0;var n=Math.sqrt,i=0,a=e.length;if(2>a)return 0;for(t&&(e[a]=e[0],a++);--a;){var o=e[a],l=o.X;o=o.Y;var s=e[a-1],u=s.X;i+=n((l-u)*(l-u)+(o-(s=s.Y))*(o-s))}return t&&e.pop(),i/r},v.JS.PerimeterOfPaths=function(e,t,r){r||(r=1);for(var n=0,i=0;i<e.length;i++)n+=v.JS.PerimeterOfPath(e[i],t,r);return n},v.JS.ScaleDownPath=function(e,t){var r;for(t||(t=1),r=e.length;r--;){var n=e[r];n.X/=t,n.Y/=t}},v.JS.ScaleDownPaths=function(e,t){var r,n;for(t||(t=1),r=e.length;r--;)for(n=e[r].length;n--;){var i=e[r][n];i.X/=t,i.Y/=t}},v.JS.ScaleUpPath=function(e,t){var r,n=Math.round;for(t||(t=1),r=e.length;r--;){var i=e[r];i.X=n(i.X*t),i.Y=n(i.Y*t)}},v.JS.ScaleUpPaths=function(e,t){var r,n,i=Math.round;for(t||(t=1),r=e.length;r--;)for(n=e[r].length;n--;){var a=e[r][n];a.X=i(a.X*t),a.Y=i(a.Y*t)}},v.ExPolygons=function(){return[]},v.ExPolygon=function(){this.holes=this.outer=null},v.JS.AddOuterPolyNodeToExPolygons=function(e,t){var r=new v.ExPolygon;r.outer=e.Contour();var n,i,a=(e=e.Childs()).length;for(r.holes=Array(a),n=0;n<a;n++){var o=e[n];r.holes[n]=o.Contour();var l=0,s=o.Childs();for(i=s.length;l<i;l++)o=s[l],v.JS.AddOuterPolyNodeToExPolygons(o,t)}t.push(r)},v.JS.ExPolygonsToPaths=function(e){var t,r,n=new v.Paths,i=0;for(t=e.length;i<t;i++){n.push(e[i].outer);var a=0;for(r=e[i].holes.length;a<r;a++)n.push(e[i].holes[a])}return n},v.JS.PolyTreeToExPolygons=function(e){var t,r=new v.ExPolygons,n=0,i=e.Childs();for(t=i.length;n<t;n++)e=i[n],v.JS.AddOuterPolyNodeToExPolygons(e,r);return r}}(),function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.returnExports=t()}(this,(function(){var e=Function.call.bind(Function.apply),t=Function.call.bind(Function.call),r=Array.isArray,n=Object.keys,i=function(e){try{return e(),!1}catch(e){return!0}},a=function(e){try{return e()}catch(e){return!1}},o=function(t){return function(){return!e(t,this,arguments)}}(i),l=function(){return!i((function(){return Object.defineProperty({},"x",{get:function(){}})}))},s=!!Object.defineProperty&&l(),u="foo"===function(){}.name,c=Function.call.bind(Array.prototype.forEach),p=Function.call.bind(Array.prototype.reduce),f=Function.call.bind(Array.prototype.filter),h=Function.call.bind(Array.prototype.some),v=function(e,t,r,n){!n&&t in e||(s?Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:r}):e[t]=r)},d=function(e,t,r){c(n(t),(function(n){v(e,n,t[n],!!r)}))},m=Function.call.bind(Object.prototype.toString),g="function"==typeof/abc/?function(e){return"function"==typeof e&&"[object Function]"===m(e)}:function(e){return"function"==typeof e},y={getter:function(e,t,r){if(!s)throw new TypeError("getters require true ES5 support");Object.defineProperty(e,t,{configurable:!0,enumerable:!1,get:r})},proxy:function(e,t,r){if(!s)throw new TypeError("getters require true ES5 support");var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function(){return e[t]},set:function(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r,Object.defineProperty(e,t,n)}else e[t]=r},defineByDescriptor:function(e,t,r){s?Object.defineProperty(e,t,r):"value"in r&&(e[t]=r.value)},preserveToString:function(e,t){t&&g(t.toString)&&v(e,"toString",t.toString.bind(t),!0)}},b=Object.create||function(e,t){var r=function(){};r.prototype=e;var i=new r;return void 0!==t&&n(t).forEach((function(e){y.defineByDescriptor(i,e,t[e])})),i},P=function(e,t){return!!Object.setPrototypeOf&&a((function(){var r=function t(r){return r=new e(r),Object.setPrototypeOf(r,t.prototype),r};return Object.setPrototypeOf(r,e),r.prototype=b(e.prototype,{constructor:{value:r}}),t(r)}))},x=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("unable to locate global object")}(),C=x.isFinite,_=Function.call.bind(String.prototype.indexOf),w=Function.apply.bind(Array.prototype.indexOf),S=Function.call.bind(Array.prototype.concat),M=Function.call.bind(String.prototype.slice),T=Function.call.bind(Array.prototype.push),I=Function.apply.bind(Array.prototype.push),L=Function.call.bind(Array.prototype.shift),O=Math.max,E=Math.min,N=Math.floor,A=Math.abs,k=Math.exp,z=Math.log,j=Math.sqrt,R=Function.call.bind(Object.prototype.hasOwnProperty),D=function(){},$=x.Map,B=$&&$.prototype.delete,F=$&&$.prototype.get,X=$&&$.prototype.has,Y=$&&$.prototype.set,q=x.Symbol||{},V=q.species||"@@species",U=Number.isNaN||function(e){return e!=e},W=Number.isFinite||function(e){return"number"==typeof e&&C(e)},G=g(Math.sign)?Math.sign:function(e){return 0===(e=Number(e))||U(e)?e:0>e?-1:1},H=function(e){return-1>(e=Number(e))||U(e)?NaN:0===e||1/0===e?e:-1===e?-1/0:0==1+e-1?e:e*(z(1+e)/(1+e-1))},J=function(e){return"[object Arguments]"===m(e)},Z=function(e){return null!==e&&"object"==typeof e&&"number"==typeof e.length&&0<=e.length&&"[object Array]"!==m(e)&&"[object Function]"===m(e.callee)},Q=J(arguments)?J:Z,K={primitive:function(e){return null===e||"function"!=typeof e&&"object"!=typeof e},string:function(e){return"[object String]"===m(e)},regex:function(e){return"[object RegExp]"===m(e)},symbol:function(e){return"function"==typeof x.Symbol&&"symbol"==typeof e}},ee=function(e,t,r){var n=e[t];v(e,t,r,!0),y.preserveToString(e[t],n)},te="function"==typeof q&&"function"==typeof q.for&&K.symbol(q()),re=K.symbol(q.iterator)?q.iterator:"_es6-shim iterator_";x.Set&&"function"==typeof(new x.Set)["@@iterator"]&&(re="@@iterator"),x.Reflect||v(x,"Reflect",{},!0);var ne=x.Reflect,ie=String,ae="undefined"!=typeof document&&document?document.all:null,oe=null==ae?function(e){return null==e}:function(e){return null==e&&e!==ae},le={Call:function(t,r){var n=2<arguments.length?arguments[2]:[];if(!le.IsCallable(t))throw new TypeError(t+" is not a function");return e(t,r,n)},RequireObjectCoercible:function(e,t){if(oe(e))throw new TypeError(t||"Cannot call method on "+e);return e},TypeIsObject:function(e){return null!=e&&!0!==e&&!1!==e&&("function"==typeof e||"object"==typeof e||e===ae)},ToObject:function(e,t){return Object(le.RequireObjectCoercible(e,t))},IsCallable:g,IsConstructor:function(e){return le.IsCallable(e)},ToInt32:function(e){return le.ToNumber(e)>>0},ToUint32:function(e){return le.ToNumber(e)>>>0},ToNumber:function(e){if("[object Symbol]"===m(e))throw new TypeError("Cannot convert a Symbol value to a number");return+e},ToInteger:function(e){return e=le.ToNumber(e),U(e)?0:0!==e&&W(e)?(0<e?1:-1)*N(A(e)):e},ToLength:function(e){return 0>=(e=le.ToInteger(e))?0:e>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e},SameValue:function(e,t){return e===t?0!==e||1/e==1/t:U(e)&&U(t)},SameValueZero:function(e,t){return e===t||U(e)&&U(t)},IsIterable:function(e){return le.TypeIsObject(e)&&(void 0!==e[re]||Q(e))},GetIterator:function(e){if(Q(e))return new De(e,"value");var t=le.GetMethod(e,re);if(!le.IsCallable(t))throw new TypeError("value is not an iterable");if(e=le.Call(t,e),!le.TypeIsObject(e))throw new TypeError("bad iterator");return e},GetMethod:function(e,t){if(e=le.ToObject(e)[t],!oe(e)){if(!le.IsCallable(e))throw new TypeError("Method not callable: "+t);return e}},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=le.GetMethod(e,"return");if(void 0!==r){try{var n=le.Call(r,e)}catch(e){var i=e}if(!t){if(i)throw i;if(!le.TypeIsObject(n))throw new TypeError("Iterator's return method returned a non-object.")}}},IteratorNext:function(e){var t=1<arguments.length?e.next(arguments[1]):e.next();if(!le.TypeIsObject(t))throw new TypeError("bad iterator");return t},IteratorStep:function(e){return e=le.IteratorNext(e),!le.IteratorComplete(e)&&e},Construct:function(e,t,r,n){return r=void 0===r?e:r,!n&&ne.construct?ne.construct(e,t,r):(n=r.prototype,le.TypeIsObject(n)||(n=Object.prototype),n=b(n),e=le.Call(e,n,t),le.TypeIsObject(e)?e:n)},SpeciesConstructor:function(e,t){if(void 0===(e=e.constructor))return t;if(!le.TypeIsObject(e))throw new TypeError("Bad constructor");if(e=e[V],oe(e))return t;if(!le.IsConstructor(e))throw new TypeError("Bad @@species");return e},CreateHTML:function(e,t,r,n){e=le.ToString(e);var i="<"+t;return""!==r&&(i+=" "+r+'="'+(n=le.ToString(n).replace(/"/g,"&quot;"))+'"'),i+">"+e+"</"+t+">"},IsRegExp:function(e){if(!le.TypeIsObject(e))return!1;var t=e[q.match];return void 0!==t?!!t:K.regex(e)},ToString:function(e){return ie(e)}};if(s&&te){var se=function(e){if(K.symbol(q[e]))return q[e];var t=q.for("Symbol."+e);return Object.defineProperty(q,e,{configurable:!1,enumerable:!1,writable:!1,value:t}),t};if(!K.symbol(q.search)){var ue=se("search"),ce=String.prototype.search;v(RegExp.prototype,ue,(function(e){return le.Call(ce,e,[this])})),ee(String.prototype,"search",(function(e){var t=le.RequireObjectCoercible(this);if(!oe(e)){var r=le.GetMethod(e,ue);if(void 0!==r)return le.Call(r,e,[t])}return le.Call(ce,t,[le.ToString(e)])}))}if(!K.symbol(q.replace)){var pe=se("replace"),fe=String.prototype.replace;v(RegExp.prototype,pe,(function(e,t){return le.Call(fe,e,[this,t])})),ee(String.prototype,"replace",(function(e,t){var r=le.RequireObjectCoercible(this);if(!oe(e)){var n=le.GetMethod(e,pe);if(void 0!==n)return le.Call(n,e,[r,t])}return le.Call(fe,r,[le.ToString(e),t])}))}if(!K.symbol(q.split)){var he=se("split"),ve=String.prototype.split;v(RegExp.prototype,he,(function(e,t){return le.Call(ve,e,[this,t])})),ee(String.prototype,"split",(function(e,t){var r=le.RequireObjectCoercible(this);if(!oe(e)){var n=le.GetMethod(e,he);if(void 0!==n)return le.Call(n,e,[r,t])}return le.Call(ve,r,[le.ToString(e),t])}))}var de=K.symbol(q.match),me=de&&function(){var e={};return e[q.match]=function(){return 42},42!=="a".match(e)}();if(!de||me){var ge=se("match"),ye=String.prototype.match;v(RegExp.prototype,ge,(function(e){return le.Call(ye,e,[this])})),ee(String.prototype,"match",(function(e){var t=le.RequireObjectCoercible(this);if(!oe(e)){var r=le.GetMethod(e,ge);if(void 0!==r)return le.Call(r,e,[t])}return le.Call(ye,t,[le.ToString(e)])}))}}var be=function(e,t,r){y.preserveToString(t,e),Object.setPrototypeOf&&Object.setPrototypeOf(e,t),s?c(Object.getOwnPropertyNames(e),(function(n){n in D||r[n]||y.proxy(e,n,t)})):c(Object.keys(e),(function(n){n in D||r[n]||(t[n]=e[n])})),t.prototype=e.prototype,y.redefine(e.prototype,"constructor",t)},Pe=function(){return this},xe=function(e){s&&!R(e,V)&&y.getter(e,V,Pe)},Ce=function(e,t){v(e,re,t=t||function(){return this}),!e[re]&&K.symbol(re)&&(e[re]=t)},_e=function(e,t,r){if(s?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,writable:!0,value:r}):e[t]=r,!le.SameValue(e[t],r))throw new TypeError("property is nonconfigurable")},we=function(e,t,r,n){if(!le.TypeIsObject(e))throw new TypeError("Constructor requires `new`: "+t.name);for(var i in e=t.prototype,le.TypeIsObject(e)||(e=r),r=b(e),n)R(n,i)&&v(r,i,n[i],!0);return r};if(String.fromCodePoint&&1!==String.fromCodePoint.length){var Se=String.fromCodePoint;ee(String,"fromCodePoint",(function(e){return le.Call(Se,this,arguments)}))}var Me={fromCodePoint:function(e){for(var t,r=[],n=0,i=arguments.length;n<i;n++){if(t=Number(arguments[n]),!le.SameValue(t,le.ToInteger(t))||0>t||1114111<t)throw new RangeError("Invalid code point "+t);65536>t?T(r,String.fromCharCode(t)):(t-=65536,T(r,String.fromCharCode(55296+(t>>10))),T(r,String.fromCharCode(t%1024+56320)))}return r.join("")},raw:function(e){var t=le.ToObject(e,"bad callSite");t=le.ToObject(t.raw,"bad raw value");var r=le.ToLength(t.length);if(0>=r)return"";for(var n,i=[],a=0;a<r&&(n=le.ToString(a),n=le.ToString(t[n]),T(i,n),!(a+1>=r));)n=a+1<arguments.length?arguments[a+1]:"",n=le.ToString(n),T(i,n),a+=1;return i.join("")}};String.raw&&"xy"!==String.raw({raw:{0:"x",1:"y",length:2}})&&ee(String,"raw",Me.raw),d(String,Me);var Te=function e(t,r){return 1>r?"":r%2?e(t,r-1)+t:(t=e(t,r/2))+t},Ie={repeat:function(e){var t=le.ToString(le.RequireObjectCoercible(this));if(0>(e=le.ToInteger(e))||1/0<=e)throw new RangeError("repeat count must be less than infinity and not overflow maximum string size");return Te(t,e)},startsWith:function(e){var t=le.ToString(le.RequireObjectCoercible(this));if(le.IsRegExp(e))throw new TypeError('Cannot call method "startsWith" with a regex');var r,n=le.ToString(e);return 1<arguments.length&&(r=arguments[1]),r=O(le.ToInteger(r),0),M(t,r,r+n.length)===n},endsWith:function(e){var t=le.ToString(le.RequireObjectCoercible(this));if(le.IsRegExp(e))throw new TypeError('Cannot call method "endsWith" with a regex');var r,n=le.ToString(e),i=t.length;return 1<arguments.length&&(r=arguments[1]),r=void 0===r?i:le.ToInteger(r),i=E(O(r,0),i),M(t,i-n.length,i)===n},includes:function(e){if(le.IsRegExp(e))throw new TypeError('"includes" does not accept a RegExp');var t,r=le.ToString(e);return 1<arguments.length&&(t=arguments[1]),-1!==_(this,r,t)},codePointAt:function(e){var t=le.ToString(le.RequireObjectCoercible(this)),r=le.ToInteger(e),n=t.length;if(0<=r&&r<n)return 55296>(e=t.charCodeAt(r))||56319<e||r+1===n||56320>(t=t.charCodeAt(r+1))||57343<t?e:1024*(e-55296)+(t-56320)+65536}};if(String.prototype.includes&&!1!=="a".includes("a",1/0)&&ee(String.prototype,"includes",Ie.includes),String.prototype.startsWith&&String.prototype.endsWith){var Le=i((function(){return"/a/".startsWith(/a/)})),Oe=a((function(){return!1==="abc".startsWith("a",1/0)}));Le&&Oe||(ee(String.prototype,"startsWith",Ie.startsWith),ee(String.prototype,"endsWith",Ie.endsWith))}te&&(a((function(){var e=/a/;return e[q.match]=!1,"/a/".startsWith(e)}))||ee(String.prototype,"startsWith",Ie.startsWith),a((function(){var e=/a/;return e[q.match]=!1,"/a/".endsWith(e)}))||ee(String.prototype,"endsWith",Ie.endsWith),a((function(){var e=/a/;return e[q.match]=!1,"/a/".includes(e)}))||ee(String.prototype,"includes",Ie.includes)),d(String.prototype,Ie);var Ee=/(^[\t\n\x0B\f\r \u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]+)|([\t\n\x0B\f\r \u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]+$)/g,Ne=function(){return le.ToString(le.RequireObjectCoercible(this)).replace(Ee,"")},Ae=/[\u0085\u200b\ufffe]/g,ke=/^[-+]0x[0-9a-f]+$/i;v(String.prototype,"trim",Ne,!0);var ze=function(e){return{value:e,done:0===arguments.length}},je=function(e){le.RequireObjectCoercible(e),this._s=le.ToString(e),this._i=0};je.prototype.next=function(){var e=this._s,t=this._i;if(void 0===e||t>=e.length)return this._s=void 0,ze();var r=e.charCodeAt(t);return 55296>r||56319<r||t+1===e.length?r=1:r=56320>(r=e.charCodeAt(t+1))||57343<r?1:2,this._i=t+r,ze(e.substr(t,r))},Ce(je.prototype),Ce(String.prototype,(function(){return new je(this)}));var Re={from:function(e){var r,n,i;if(1<arguments.length&&(r=arguments[1]),void 0===r)var a=!1;else{if(!le.IsCallable(r))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(n=arguments[2]),a=!0}if(void 0!==(Q(e)||le.GetMethod(e,re))){var o=le.IsConstructor(this)?Object(new this):[],l=le.GetIterator(e);for(i=0;;){var s=le.IteratorStep(l);if(!1===s)break;s=s.value;try{a&&(s=void 0===n?r(s,i):t(r,n,s,i)),o[i]=s}catch(e){throw le.IteratorClose(l,!0),e}i+=1}l=i}else for(s=le.ToObject(e),l=le.ToLength(s.length),o=le.IsConstructor(this)?Object(new this(l)):Array(l),i=0;i<l;++i){var u=s[i];a&&(u=void 0===n?r(u,i):t(r,n,u,i)),_e(o,i,u)}return o.length=l,o},of:function(){for(var e=arguments.length,t=r(this)||!le.IsCallable(this)?Array(e):le.Construct(this,[e]),n=0;n<e;++n)_e(t,n,arguments[n]);return t.length=e,t}};d(Array,Re),xe(Array);var De=function(e,t){this.i=0,this.array=e,this.kind=t};d(De.prototype,{next:function(){var e=this.i,t=this.array;if(!(this instanceof De))throw new TypeError("Not an ArrayIterator");if(void 0!==t)for(var r=le.ToLength(t.length);e<r;){var n;return"key"===(r=this.kind)?n=e:"value"===r?n=t[e]:"entry"===r&&(n=[e,t[e]]),this.i=e+1,ze(n)}return this.array=void 0,ze()}}),Ce(De.prototype),Array.of===Re.of||function(){var e=function(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&2===t.length}()||ee(Array,"of",Re.of);var $e={copyWithin:function(e,t){var r,n=le.ToObject(this),i=le.ToLength(n.length),a=le.ToInteger(e),o=le.ToInteger(t);for(a=0>a?O(i+a,0):E(a,i),o=0>o?O(i+o,0):E(o,i),2<arguments.length&&(r=arguments[2]),r=0>(r=void 0===r?i:le.ToInteger(r))?O(i+r,0):E(r,i),i=E(r-o,i-a),r=1,o<a&&a<o+i&&(r=-1,o+=i-1,a+=i-1);0<i;)o in n?n[a]=n[o]:delete n[a],o+=r,a+=r,--i;return n},fill:function(e){var t,r;1<arguments.length&&(t=arguments[1]),2<arguments.length&&(r=arguments[2]);var n=le.ToObject(this),i=le.ToLength(n.length);for(t=le.ToInteger(void 0===t?0:t),r=le.ToInteger(void 0===r?i:r),t=0>t?O(i+t,0):E(t,i),r=0>r?i+r:r;t<i&&t<r;++t)n[t]=e;return n},find:function(e){var r=le.ToObject(this),n=le.ToLength(r.length);if(!le.IsCallable(e))throw new TypeError("Array#find: predicate must be a function");for(var i,a=1<arguments.length?arguments[1]:null,o=0;o<n;o++)if(i=r[o],a){if(t(e,a,i,o,r))return i}else if(e(i,o,r))return i},findIndex:function(e){var r=le.ToObject(this),n=le.ToLength(r.length);if(!le.IsCallable(e))throw new TypeError("Array#findIndex: predicate must be a function");for(var i=1<arguments.length?arguments[1]:null,a=0;a<n;a++)if(i){if(t(e,i,r[a],a,r))return a}else if(e(r[a],a,r))return a;return-1},keys:function(){return new De(this,"key")},values:function(){return new De(this,"value")},entries:function(){return new De(this,"entry")}};if(Array.prototype.keys&&!le.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!le.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[re]&&(d(Array.prototype,{values:Array.prototype[re]}),K.symbol(q.unscopables)&&(Array.prototype[q.unscopables].values=!0)),u&&Array.prototype.values&&"values"!==Array.prototype.values.name){var Be=Array.prototype.values;ee(Array.prototype,"values",(function(){return le.Call(Be,this,arguments)})),v(Array.prototype,re,Array.prototype.values,!0)}d(Array.prototype,$e),0>1/[!0].indexOf(!0,-0)&&v(Array.prototype,"indexOf",(function(e){var t=w(this,arguments);return 0===t&&0>1/t?0:t}),!0),Ce(Array.prototype,(function(){return this.values()})),Object.getPrototypeOf&&Ce(Object.getPrototypeOf([].values()));var Fe=a((function(){return 0===Array.from({length:-1}).length})),Xe=function(){var e=Array.from([0].entries());return 1===e.length&&r(e[0])&&0===e[0][0]&&0===e[0][1]}();if(Fe&&Xe||ee(Array,"from",Re.from),!a((function(){return Array.from([0],void 0)}))){var Ye=Array.from;ee(Array,"from",(function(e){return 1<arguments.length&&void 0!==arguments[1]?le.Call(Ye,this,arguments):t(Ye,this,e)}))}var qe=-(Math.pow(2,32)-1),Ve=function(e,r){var n={length:qe};return n[r?(n.length>>>0)-1:0]=!0,a((function(){return t(e,n,(function(){throw new RangeError("should not reach here")}),[]),!0}))};if(!Ve(Array.prototype.forEach)){var Ue=Array.prototype.forEach;ee(Array.prototype,"forEach",(function(e){return le.Call(Ue,0<=this.length?this:[],arguments)}),!0)}if(!Ve(Array.prototype.map)){var We=Array.prototype.map;ee(Array.prototype,"map",(function(e){return le.Call(We,0<=this.length?this:[],arguments)}),!0)}if(!Ve(Array.prototype.filter)){var Ge=Array.prototype.filter;ee(Array.prototype,"filter",(function(e){return le.Call(Ge,0<=this.length?this:[],arguments)}),!0)}if(!Ve(Array.prototype.some)){var He=Array.prototype.some;ee(Array.prototype,"some",(function(e){return le.Call(He,0<=this.length?this:[],arguments)}),!0)}if(!Ve(Array.prototype.every)){var Je=Array.prototype.every;ee(Array.prototype,"every",(function(e){return le.Call(Je,0<=this.length?this:[],arguments)}),!0)}if(!Ve(Array.prototype.reduce)){var Ze=Array.prototype.reduce;ee(Array.prototype,"reduce",(function(e){return le.Call(Ze,0<=this.length?this:[],arguments)}),!0)}if(!Ve(Array.prototype.reduceRight,!0)){var Qe=Array.prototype.reduceRight;ee(Array.prototype,"reduceRight",(function(e){return le.Call(Qe,0<=this.length?this:[],arguments)}),!0)}var Ke=8!==Number("0o10"),et=2!==Number("0b10"),tt=h("",(function(e){return 0===Number(e+0+e)}));if(Ke||et||tt){var rt=Number,nt=/^0b[01]+$/i,it=/^0o[0-7]+$/i,at=nt.test.bind(nt),ot=it.test.bind(it),lt=function(e){if("function"==typeof e.valueOf){var t=e.valueOf();if(K.primitive(t))return t}if("function"==typeof e.toString&&(t=e.toString(),K.primitive(t)))return t;throw new TypeError("No default value")},st=Ae.test.bind(Ae),ut=ke.test.bind(ke),ct=function(){var e=function(t){var r=0<arguments.length?K.primitive(t)?t:lt(t,"number"):0;"string"==typeof r&&(r=le.Call(Ne,r),at(r)?r=parseInt(M(r,2),2):ot(r)?r=parseInt(M(r,2),8):(st(r)||ut(r))&&(r=NaN));var n=this,i=a((function(){return rt.prototype.valueOf.call(n),!0}));return n instanceof e&&!i?new rt(r):rt(r)};return e}();be(rt,ct,{}),d(ct,{NaN:rt.NaN,MAX_VALUE:rt.MAX_VALUE,MIN_VALUE:rt.MIN_VALUE,NEGATIVE_INFINITY:rt.NEGATIVE_INFINITY,POSITIVE_INFINITY:rt.POSITIVE_INFINITY}),Number=ct,y.redefine(x,"Number",ct)}var pt=Math.pow(2,53)-1;d(Number,{MAX_SAFE_INTEGER:pt,MIN_SAFE_INTEGER:-pt,EPSILON:2220446049250313e-31,parseInt:x.parseInt,parseFloat:x.parseFloat,isFinite:W,isInteger:function(e){return W(e)&&le.ToInteger(e)===e},isSafeInteger:function(e){return Number.isInteger(e)&&A(e)<=Number.MAX_SAFE_INTEGER},isNaN:U}),v(Number,"parseInt",x.parseInt,Number.parseInt!==x.parseInt),1===[,1].find((function(){return!0}))&&ee(Array.prototype,"find",$e.find),0!==[,1].findIndex((function(){return!0}))&&ee(Array.prototype,"findIndex",$e.findIndex);var ft=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable),ht=function(e,t){s&&ft(e,t)&&Object.defineProperty(e,t,{enumerable:!1})},vt=function(){var e=Number(this),t=arguments.length,r=t-e;r=Array(0>r?0:r);for(var n=e;n<t;++n)r[n-e]=arguments[n];return r},dt=function(e){return function(t,r){return t[r]=e[r],t}},mt=function(e,t){var r,i=n(Object(t));return le.IsCallable(Object.getOwnPropertySymbols)&&(r=f(Object.getOwnPropertySymbols(Object(t)),ft(t))),p(S(i,r||[]),dt(t),e)},gt={assign:function(e,t){var r=le.ToObject(e,"Cannot convert undefined or null to object");return p(le.Call(vt,1,arguments),mt,r)},is:function(e,t){return le.SameValue(e,t)}};if(Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return"y"===e[1]}}()&&ee(Object,"assign",gt.assign),d(Object,gt),s){var yt={setPrototypeOf:function(e,r){var n=function(e,r){if(!le.TypeIsObject(e))throw new TypeError("cannot set prototype on a non-object");if(null!==r&&!le.TypeIsObject(r))throw new TypeError("can only set prototype to an object or null"+r);return t(i,e,r),e};try{var i=e.getOwnPropertyDescriptor(e.prototype,r).set;t(i,{},null)}catch(t){if(e.prototype!=={}[r])return;i=function(e){this[r]=e},n.polyfill=n(n({},null),e.prototype)instanceof e}return n}(Object,"__proto__")};d(Object,yt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&function(){var e=Object.create(null),t=Object.getPrototypeOf,r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){return(r=t(r))===e?null:r},Object.setPrototypeOf=function(t,n){return r(t,null===n?e:n)},Object.setPrototypeOf.polyfill=!1}(),i((function(){return Object.keys("foo")}))){var bt=Object.keys;ee(Object,"keys",(function(e){return bt(le.ToObject(e))})),n=Object.keys}if(i((function(){return Object.keys(/a/g)}))){var Pt=Object.keys;ee(Object,"keys",(function(e){if(K.regex(e)){var t,r=[];for(t in e)R(e,t)&&T(r,t);return r}return Pt(e)})),n=Object.keys}if(Object.getOwnPropertyNames&&i((function(){return Object.getOwnPropertyNames("foo")}))){var xt="object"==typeof window?Object.getOwnPropertyNames(window):[],Ct=Object.getOwnPropertyNames;ee(Object,"getOwnPropertyNames",(function(e){if(e=le.ToObject(e),"[object Window]"===m(e))try{return Ct(e)}catch(e){return S([],xt)}return Ct(e)}))}if(Object.getOwnPropertyDescriptor&&i((function(){return Object.getOwnPropertyDescriptor("foo","bar")}))){var _t=Object.getOwnPropertyDescriptor;ee(Object,"getOwnPropertyDescriptor",(function(e,t){return _t(le.ToObject(e),t)}))}if(Object.seal&&i((function(){return Object.seal("foo")}))){var wt=Object.seal;ee(Object,"seal",(function(e){return le.TypeIsObject(e)?wt(e):e}))}if(Object.isSealed&&i((function(){return Object.isSealed("foo")}))){var St=Object.isSealed;ee(Object,"isSealed",(function(e){return!le.TypeIsObject(e)||St(e)}))}if(Object.freeze&&i((function(){return Object.freeze("foo")}))){var Mt=Object.freeze;ee(Object,"freeze",(function(e){return le.TypeIsObject(e)?Mt(e):e}))}if(Object.isFrozen&&i((function(){return Object.isFrozen("foo")}))){var Tt=Object.isFrozen;ee(Object,"isFrozen",(function(e){return!le.TypeIsObject(e)||Tt(e)}))}if(Object.preventExtensions&&i((function(){return Object.preventExtensions("foo")}))){var It=Object.preventExtensions;ee(Object,"preventExtensions",(function(e){return le.TypeIsObject(e)?It(e):e}))}if(Object.isExtensible&&i((function(){return Object.isExtensible("foo")}))){var Lt=Object.isExtensible;ee(Object,"isExtensible",(function(e){return!!le.TypeIsObject(e)&&Lt(e)}))}if(Object.getPrototypeOf&&i((function(){return Object.getPrototypeOf("foo")}))){var Ot=Object.getPrototypeOf;ee(Object,"getPrototypeOf",(function(e){return Ot(le.ToObject(e))}))}var Et=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&le.IsCallable(e.get)}();s&&!Et&&y.getter(RegExp.prototype,"flags",(function(){if(!le.TypeIsObject(this))throw new TypeError("Method called on incompatible type: must be an object.");var e="";return this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.unicode&&(e+="u"),this.sticky&&(e+="y"),e}));var Nt=s&&a((function(){return"/a/i"===String(new RegExp(/a/g,"i"))})),At=te&&s&&function(){var e=/./;return e[q.match]=!1,RegExp(e)===e}(),kt=a((function(){return"/abc/"===RegExp.prototype.toString.call({source:"abc"})})),zt=kt&&a((function(){return"/a/b"===RegExp.prototype.toString.call({source:"a",flags:"b"})}));if(!kt||!zt){var jt=RegExp.prototype.toString;v(RegExp.prototype,"toString",(function(){var e=le.RequireObjectCoercible(this);return K.regex(e)?t(jt,e):"/"+ie(e.source)+"/"+(e=ie(e.flags))}),!0),y.preserveToString(RegExp.prototype.toString,jt)}if(s&&(!Nt||At)){var Rt=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get,Dt=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{},$t=function(){return this.source},Bt=le.IsCallable(Dt.get)?Dt.get:$t,Ft=RegExp,Xt=function e(t,r){var n=le.IsRegExp(t);return this instanceof e||!n||void 0!==r||t.constructor!==e?K.regex(t)?new e(n=le.Call(Bt,t),t=void 0===r?le.Call(Rt,t):r):new Ft(t,r):t};be(Ft,Xt,{$input:!0}),RegExp=Xt,y.redefine(x,"RegExp",Xt)}if(s){var Yt={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};c(n(Yt),(function(e){e in RegExp&&!(Yt[e]in RegExp)&&y.getter(RegExp,Yt[e],(function(){return RegExp[e]}))}))}xe(RegExp);var qt=1/Number.EPSILON,Vt=Math.pow(2,-23),Ut=Math.pow(2,127)*(2-Vt),Wt=Math.pow(2,-126),Gt=Math.E,Ht=Math.LOG2E,Jt=Math.LOG10E,Zt=Number.prototype.clz;delete Number.prototype.clz;var Qt={acosh:function(e){var t=Number(e);return U(t)||1>e?NaN:1===t?0:1/0===t?t:(e=1/(t*t),2>t?H(t-1+j(1-e)*t):H((t/=2)+j(1-e)*t-1)+1/Ht)},asinh:function(e){var t=Number(e);if(0===t||!C(t))return t;var r=(e=A(t))*e;return t=G(t),1>e?t*H(e+r/(j(r+1)+1)):t*(H(e/2+j(1+1/r)*e/2-1)+1/Ht)},atanh:function(e){if(0===(e=Number(e)))return e;if(-1===e)return-1/0;if(1===e)return 1/0;if(U(e)||-1>e||1<e)return NaN;var t=A(e);return G(e)*H(2*t/(1-t))/2},cbrt:function(e){if(0===(e=Number(e)))return e;var t=0>e;if(t&&(e=-e),1/0===e)var r=1/0;else r=(e/((r=k(z(e)/3))*r)+2*r)/3;return t?-r:r},clz32:function(e){return 0===(e=le.ToUint32(Number(e)))?32:Zt?le.Call(Zt,e):31-N(z(e+.5)*Ht)},cosh:function(e){return 0===(e=Number(e))?1:U(e)?NaN:C(e)?(e=k(A(e)-1),Gt/2*(e+1/(e*Gt*Gt))):1/0},expm1:function(e){if(-1/0===(e=Number(e)))return-1;if(!C(e)||0===e)return e;if(.5<A(e))return k(e)-1;for(var t=e,r=0,n=1;r+t!==r;)r+=t,t*=e/(n+=1);return r},hypot:function(e,t){for(var r=0,n=0,i=0;i<arguments.length;++i){var a=A(Number(arguments[i]));n<a?(r*=n/a*(n/a),r+=1,n=a):r+=0<a?a/n*(a/n):a}return 1/0===n?1/0:n*j(r)},log2:function(e){return z(e)*Ht},log10:function(e){return z(e)*Jt},log1p:H,sign:G,sinh:function(e){if(e=Number(e),!C(e)||0===e)return e;var t=A(e);return 1>t?(t=Math.expm1(t),G(e)*t*(1+1/(t+1))/2):(t=k(t-1),G(e)*(t-1/(t*Gt*Gt))*(Gt/2))},tanh:function(e){return e=Number(e),U(e)||0===e?e:20<=e?1:-20>=e?-1:(Math.expm1(e)-Math.expm1(-e))/(k(e)+k(-e))},trunc:function(e){return 0>(e=Number(e))?-N(-e):N(e)},imul:function(e,t){var r=65535&(e=le.ToUint32(e)),n=65535&(t=le.ToUint32(t));return r*n+((e>>>16&65535)*n+r*(t>>>16&65535)<<16>>>0)|0},fround:function(e){var t=Number(e);if(0===t||1/0===t||-1/0===t||U(t))return t;if(e=G(t),(t=A(t))<Wt)return e*(t/Wt/Vt+qt-qt)*Wt*Vt;var r=(1+Vt/Number.EPSILON)*t;return(t=r-(r-t))>Ut||U(t)?1/0*e:e*t}};d(Math,Qt),v(Math,"sinh",Qt.sinh,1/0===Math.sinh(710)),v(Math,"cosh",Qt.cosh,1/0===Math.cosh(710)),v(Math,"log1p",Qt.log1p,-1e-17!==Math.log1p(-1e-17)),v(Math,"asinh",Qt.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7)),v(Math,"asinh",Qt.asinh,1/0===Math.asinh(1e300)),v(Math,"atanh",Qt.atanh,0===Math.atanh(1e-300)),v(Math,"tanh",Qt.tanh,-2e-17!==Math.tanh(-2e-17)),v(Math,"acosh",Qt.acosh,1/0===Math.acosh(Number.MAX_VALUE)),v(Math,"acosh",Qt.acosh,!(8>A(1-Math.acosh(1+Number.EPSILON)/Math.sqrt(2*Number.EPSILON))/Number.EPSILON)),v(Math,"cbrt",Qt.cbrt,!(8>A(1-Math.cbrt(1e-300)/1e-100)/Number.EPSILON)),v(Math,"sinh",Qt.sinh,-2e-17!==Math.sinh(-2e-17));var Kt=Math.expm1(10);v(Math,"expm1",Qt.expm1,22025.465794806718<Kt||22025.465794806718>Kt);var er=Math.round,tr=0===Math.round(.5-Number.EPSILON/4)&&1===Math.round(Number.EPSILON/3.99-.5),rr=[qt+1,2*qt-1].every((function(e){return Math.round(e)===e}));v(Math,"round",(function(e){var t=N(e);return.5>e-t?t:-1===t?-0:t+1}),!tr||!rr),y.preserveToString(Math.round,er);var nr=Math.imul;-5!==Math.imul(4294967295,5)&&(Math.imul=Qt.imul,y.preserveToString(Math.imul,nr)),2!==Math.imul.length&&ee(Math,"imul",(function(e,t){return le.Call(nr,Math,arguments)}));var ir=function(){var e=x.setTimeout;if("function"==typeof e||"object"==typeof e){le.IsPromise=function(e){return!(!le.TypeIsObject(e)||void 0===e._promise)};var r,n=function(e){if(!le.IsConstructor(e))throw new TypeError("Bad promise constructor");var t=this;if(t.resolve=void 0,t.reject=void 0,t.promise=new e((function(e,r){if(void 0!==t.resolve||void 0!==t.reject)throw new TypeError("Bad Promise implementation!");t.resolve=e,t.reject=r})),!le.IsCallable(t.resolve)||!le.IsCallable(t.reject))throw new TypeError("Bad promise constructor")};"undefined"!=typeof window&&le.IsCallable(window.postMessage)&&(r=function(){var e=[];return window.addEventListener("message",(function(t){t.source===window&&"zero-timeout-message"===t.data&&(t.stopPropagation(),0!==e.length&&L(e)())}),!0),function(t){T(e,t),window.postMessage("zero-timeout-message","*")}});var i=le.IsCallable(x.setImmediate)?x.setImmediate:"object"==typeof process&&process.nextTick?process.nextTick:function(){var e=x.Promise,t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}}()||(le.IsCallable(r)?r():function(t){e(t,0)}),a=function(e){return e},o=function(e){throw e},l={},s=function(e,t,r){i((function(){if(t===l)e(r);else{try{var n=e(r),i=t.resolve}catch(e){n=e,i=t.reject}i(n)}}))},u=function(e,t){var r=e._promise,n=r.reactionLength;if(0<n&&(s(r.fulfillReactionHandler0,r.reactionCapability0,t),r.fulfillReactionHandler0=void 0,r.rejectReactions0=void 0,r.reactionCapability0=void 0,1<n))for(var i=1,a=0;i<n;i++,a+=3)s(r[a+0],r[a+2],t),e[a+0]=void 0,e[a+1]=void 0,e[a+2]=void 0;r.result=t,r.state=1,r.reactionLength=0},c=function(e,t){var r=e._promise,n=r.reactionLength;if(0<n&&(s(r.rejectReactionHandler0,r.reactionCapability0,t),r.fulfillReactionHandler0=void 0,r.rejectReactions0=void 0,r.reactionCapability0=void 0,1<n))for(var i=1,a=0;i<n;i++,a+=3)s(r[a+1],r[a+2],t),e[a+0]=void 0,e[a+1]=void 0,e[a+2]=void 0;r.result=t,r.state=2,r.reactionLength=0},p=function(e){var t=!1;return{resolve:function(r){if(!t){if(t=!0,r===e)return c(e,new TypeError("Self resolution"));if(!le.TypeIsObject(r))return u(e,r);try{var n=r.then}catch(t){return c(e,t)}if(!le.IsCallable(n))return u(e,r);i((function(){var t=n,i=p(e),a=i.resolve;i=i.reject;try{f(t,r,a,i)}catch(e){i(e)}}))}},reject:function(r){if(!t)return t=!0,c(e,r)}}},f=function(e,r,n,i){e===g?t(e,r,n,i,l):t(e,r,n,i)},h=function(){var e=function(t){if(!(this instanceof e))throw new TypeError('Constructor Promise requires "new"');if(this&&this._promise)throw new TypeError("Bad construction");if(!le.IsCallable(t))throw new TypeError("not a valid resolver");var r=we(this,e,v,{_promise:{result:void 0,state:0,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}}),n=p(r),i=n.reject;try{t(n.resolve,i)}catch(e){i(e)}return r};return e}(),v=h.prototype,m=function(e,t,r,n){var i=!1;return function(a){i||(i=!0,t[e]=a,0==--n.count&&(a=r.resolve)(t))}};d(h,{all:function(e){if(!le.TypeIsObject(this))throw new TypeError("Promise is not object");var t,r=new n(this);try{for(var i,a,o=le.GetIterator(e),l=(e=t={iterator:o,done:!1}).iterator,s=[],u={count:1},c=0;;){try{if(!1===(i=le.IteratorStep(l))){e.done=!0;break}a=i.value}catch(t){throw e.done=!0,t}s[c]=void 0;var p=this.resolve(a),h=m(c,s,r,u);u.count+=1,f(p.then,p,h,r.reject),c+=1}if(0==--u.count)(0,r.resolve)(s);return r.promise}catch(e){if(l=e,t&&!t.done)try{le.IteratorClose(o,!0)}catch(e){l=e}return(o=r.reject)(l),r.promise}},race:function(e){if(!le.TypeIsObject(this))throw new TypeError("Promise is not object");var t,r=new n(this);try{for(var i,a,o,l=le.GetIterator(e),s=(e=t={iterator:l,done:!1}).iterator;;){try{if(!1===(i=le.IteratorStep(s))){e.done=!0;break}a=i.value}catch(t){throw e.done=!0,t}o=this.resolve(a),f(o.then,o,r.resolve,r.reject)}return r.promise}catch(e){if(s=e,t&&!t.done)try{le.IteratorClose(l,!0)}catch(e){s=e}return(l=r.reject)(s),r.promise}},reject:function(e){if(!le.TypeIsObject(this))throw new TypeError("Bad promise constructor");var t=new n(this);return(0,t.reject)(e),t.promise},resolve:function(e){if(!le.TypeIsObject(this))throw new TypeError("Bad promise constructor");if(le.IsPromise(e)&&e.constructor===this)return e;var t=new n(this);return(0,t.resolve)(e),t.promise}}),d(v,{catch:function(e){return this.then(null,e)},then:function(e,t){if(!le.IsPromise(this))throw new TypeError("not a promise");var r=le.SpeciesConstructor(this,h);r=2<arguments.length&&arguments[2]===l&&r===h?l:new n(r);var i=le.IsCallable(e)?e:a,u=le.IsCallable(t)?t:o,c=this._promise;if(0===c.state){if(0===c.reactionLength)c.fulfillReactionHandler0=i,c.rejectReactionHandler0=u,c.reactionCapability0=r;else{var p=3*(c.reactionLength-1);c[p+0]=i,c[p+1]=u,c[p+2]=r}c.reactionLength+=1}else if(1===c.state)c=c.result,s(i,r,c);else{if(2!==c.state)throw new TypeError("unexpected Promise state");c=c.result,s(u,r,c)}return r.promise}}),l=new n(h);var g=v.then;return h}}();if(x.Promise&&(delete x.Promise.accept,delete x.Promise.defer,delete x.Promise.prototype.chain),"function"==typeof ir){d(x,{Promise:ir});var ar=P(x.Promise,(function(e){return e.resolve(42).then((function(){}))instanceof e})),or=!i((function(){return x.Promise.reject(42).then(null,5).then(null,D)})),lr=i((function(){return x.Promise.call(3,D)})),sr=function(e){var t=e.resolve(5);t.constructor={},e=e.resolve(t);try{e.then(null,D).then(null,D)}catch(e){return!0}return t===e}(x.Promise),ur=s&&function(){var e=0,t=Object.defineProperty({},"then",{get:function(){e+=1}});return Promise.resolve(t),1===e}(),cr=function e(t){var r=new Promise(t);t(3,(function(){})),this.then=r.then,this.constructor=e};cr.prototype=Promise.prototype,cr.all=Promise.all;var pr=a((function(){return!!cr.all([1,2])}));if(ar&&or&&lr&&!sr&&ur&&!pr||(Promise=ir,ee(x,"Promise",ir)),1!==Promise.all.length){var fr=Promise.all;ee(Promise,"all",(function(e){return le.Call(fr,this,arguments)}))}if(1!==Promise.race.length){var hr=Promise.race;ee(Promise,"race",(function(e){return le.Call(hr,this,arguments)}))}if(1!==Promise.resolve.length){var vr=Promise.resolve;ee(Promise,"resolve",(function(e){return le.Call(vr,this,arguments)}))}if(1!==Promise.reject.length){var dr=Promise.reject;ee(Promise,"reject",(function(e){return le.Call(dr,this,arguments)}))}ht(Promise,"all"),ht(Promise,"race"),ht(Promise,"resolve"),ht(Promise,"reject"),xe(Promise)}var mr=function(e){var t=n(p(e,(function(e,t){return e[t]=!0,e}),{}));return e.join(":")===t.join(":")},gr=mr(["z","a","bb"]),yr=mr(["z",1,"a","3",2]);if(s){var br=function(e,t){return t||gr?oe(e)?"^"+le.ToString(e):"string"==typeof e?"$"+e:"number"==typeof e?yr?e:"n"+e:"boolean"==typeof e?"b"+e:null:null},Pr=function(){return Object.create?Object.create(null):{}},xr=function(e,n,i){if(r(i)||K.string(i))c(i,(function(e){if(!le.TypeIsObject(e))throw new TypeError("Iterator value "+e+" is not an entry object");n.set(e[0],e[1])}));else if(i instanceof e)t(e.prototype.forEach,i,(function(e,t){n.set(t,e)}));else{if(!oe(i)){var a=n.set;if(!le.IsCallable(a))throw new TypeError("bad map");var o=le.GetIterator(i)}if(void 0!==o)for(;!1!==(e=le.IteratorStep(o));){e=e.value;try{if(!le.TypeIsObject(e))throw new TypeError("Iterator value "+e+" is not an entry object");t(a,n,e[0],e[1])}catch(e){throw le.IteratorClose(o,!0),e}}}},Cr=function(e,n,i){if(r(i)||K.string(i))c(i,(function(e){n.add(e)}));else if(i instanceof e)t(e.prototype.forEach,i,(function(e){n.add(e)}));else{if(!oe(i)){var a=n.add;if(!le.IsCallable(a))throw new TypeError("bad set");var o=le.GetIterator(i)}if(void 0!==o)for(;!1!==(e=le.IteratorStep(o));){e=e.value;try{t(a,n,e)}catch(e){throw le.IteratorClose(o,!0),e}}}},_r={Map:function(){var e={},r=function(e,t){this.key=e,this.value=t,this.prev=this.next=null};r.prototype.isRemoved=function(){return this.key===e};var n=function(e,t){if(!le.TypeIsObject(e)||!e._es6map)throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+le.ToString(e))},i=function(e,t){n(e,"[[MapIterator]]"),this.i=this.head=e._head,this.kind=t};i.prototype={isMapIterator:!0,next:function(){if(!this.isMapIterator)throw new TypeError("Not a MapIterator");var e=this.i,t=this.kind,r=this.head;if(void 0===this.i)return ze();for(;e.isRemoved()&&e!==r;)e=e.prev;for(;e.next!==r;)if(!(e=e.next).isRemoved())return t="key"===t?e.key:"value"===t?e.value:[e.key,e.value],this.i=e,ze(t);return this.i=void 0,ze()}},Ce(i.prototype);var a=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');if(this&&this._es6map)throw new TypeError("Bad construction");var t=we(this,e,o,{_es6map:!0,_head:null,_map:$?new $:null,_size:0,_storage:Pr()}),n=new r(null,null);return n.next=n.prev=n,t._head=n,0<arguments.length&&xr(e,t,arguments[0]),t},o=a.prototype;return y.getter(o,"size",(function(){if(void 0===this._size)throw new TypeError("size method called on incompatible Map");return this._size})),d(o,{get:function(e){n(this,"get");var t=br(e,!0);if(null!==t){if(e=this._storage[t])return e.value}else if(this._map){if(e=F.call(this._map,e))return e.value}else for(var r=t=this._head;(r=r.next)!==t;)if(le.SameValueZero(r.key,e))return r.value},has:function(e){n(this,"has");var t=br(e,!0);if(null!==t)return void 0!==this._storage[t];if(this._map)return X.call(this._map,e);for(var r=t=this._head;(r=r.next)!==t;)if(le.SameValueZero(r.key,e))return!0;return!1},set:function(e,t){n(this,"set");var i=this._head,a=i,o=br(e,!0);if(null!==o){if(void 0!==this._storage[o])return this._storage[o].value=t,this;var l=this._storage[o]=new r(e,t);a=i.prev}else this._map&&(X.call(this._map,e)?F.call(this._map,e).value=t:(l=new r(e,t),Y.call(this._map,e,l),a=i.prev));for(;(a=a.next)!==i;)if(le.SameValueZero(a.key,e))return a.value=t,this;return l=l||new r(e,t),le.SameValue(-0,e)&&(l.key=0),l.next=this._head,l.prev=this._head.prev,l.prev.next=l,l.next.prev=l,this._size+=1,this},delete:function(t){n(this,"delete");var r=this._head,i=r,a=br(t,!0);if(null!==a){if(void 0===this._storage[a])return!1;i=this._storage[a].prev,delete this._storage[a]}else if(this._map){if(!X.call(this._map,t))return!1;i=F.call(this._map,t).prev,B.call(this._map,t)}for(;(i=i.next)!==r;)if(le.SameValueZero(i.key,t))return i.key=e,i.value=e,i.prev.next=i.next,i.next.prev=i.prev,--this._size,!0;return!1},clear:function(){n(this,"clear"),this._map=$?new $:null,this._size=0,this._storage=Pr();for(var t,r=this._head,i=r.next;(t=i)!==r;)t.key=e,t.value=e,i=t.next,t.next=t.prev=r;r.next=r.prev=r},keys:function(){return n(this,"keys"),new i(this,"key")},values:function(){return n(this,"values"),new i(this,"value")},entries:function(){return n(this,"entries"),new i(this,"key+value")},forEach:function(e){n(this,"forEach");for(var r=1<arguments.length?arguments[1]:null,i=this.entries(),a=i.next();!a.done;a=i.next())r?t(e,r,a.value[1],a.value[0],this):e(a.value[1],a.value[0],this)}}),Ce(o,o.entries),a}(),Set:function(){var e=function(e,t){if(!le.TypeIsObject(e)||!e._es6set||void 0===e._storage)throw new TypeError("Set.prototype."+t+" called on incompatible receiver "+le.ToString(e))},r=function e(){if(!(this instanceof e))throw new TypeError('Constructor Set requires "new"');if(this&&this._es6set)throw new TypeError("Bad construction");var t=we(this,e,i,{_es6set:!0,"[[SetData]]":null,_storage:Pr()});if(!t._es6set)throw new TypeError("bad set");return 0<arguments.length&&Cr(e,t,arguments[0]),t},i=r.prototype,a=function(e){if(!e["[[SetData]]"]){var t=new _r.Map;e["[[SetData]]"]=t,c(n(e._storage),(function(e){if("^null"===e)e=null;else if("^undefined"!==e){var r=e.charAt(0);e="$"===r?M(e,1):"n"===r?+M(e,1):"b"===r?"btrue"===e:+e}else e=void 0;t.set(e,e)})),e["[[SetData]]"]=t}e._storage=null};y.getter(r.prototype,"size",(function(){return e(this,"size"),this._storage?n(this._storage).length:(a(this),this["[[SetData]]"].size)})),d(r.prototype,{has:function(t){var r;return e(this,"has"),this._storage&&null!==(r=br(t))?!!this._storage[r]:(a(this),this["[[SetData]]"].has(t))},add:function(t){var r;return e(this,"add"),this._storage&&null!==(r=br(t))?(this._storage[r]=!0,this):(a(this),this["[[SetData]]"].set(t,t),this)},delete:function(t){var r;return e(this,"delete"),this._storage&&null!==(r=br(t))?(t=R(this._storage,r),delete this._storage[r]&&t):(a(this),this["[[SetData]]"].delete(t))},clear:function(){e(this,"clear"),this._storage&&(this._storage=Pr()),this["[[SetData]]"]&&this["[[SetData]]"].clear()},values:function(){return e(this,"values"),a(this),new o(this["[[SetData]]"].values())},entries:function(){return e(this,"entries"),a(this),new o(this["[[SetData]]"].entries())},forEach:function(r){e(this,"forEach");var n=1<arguments.length?arguments[1]:null,i=this;a(i),this["[[SetData]]"].forEach((function(e,a){n?t(r,n,a,a,i):r(a,a,i)}))}}),v(r.prototype,"keys",r.prototype.values,!0),Ce(r.prototype,r.prototype.values);var o=function(e){this.it=e};return o.prototype={isSetIterator:!0,next:function(){if(!this.isSetIterator)throw new TypeError("Not a SetIterator");return this.it.next()}},Ce(o.prototype),r}()};if(x.Set&&!Set.prototype.delete&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys)&&(x.Set=_r.Set),x.Map||x.Set){a((function(){return 2===new Map([[1,2]]).get(1)}))||(x.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');var t=new $;return 0<arguments.length&&xr(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,x.Map.prototype),t},x.Map.prototype=b($.prototype),v(x.Map.prototype,"constructor",x.Map,!0),y.preserveToString(x.Map,$));var wr=new Map,Sr=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);return e.set(-0,e),e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}(),Mr=wr.set(1,2)===wr;Sr&&Mr||ee(Map.prototype,"set",(function(e,r){return t(Y,this,0===e?0:e,r),this})),Sr||(d(Map.prototype,{get:function(e){return t(F,this,0===e?0:e)},has:function(e){return t(X,this,0===e?0:e)}},!0),y.preserveToString(Map.prototype.get,F),y.preserveToString(Map.prototype.has,X));var Tr=new Set,Ir=Set.prototype.delete&&Set.prototype.add&&Set.prototype.has&&function(e){return e.delete(0),e.add(-0),!e.has(0)}(Tr),Lr=Tr.add(1)===Tr;if(!Ir||!Lr){var Or=Set.prototype.add;Set.prototype.add=function(e){return t(Or,this,0===e?0:e),this},y.preserveToString(Set.prototype.add,Or)}if(!Ir){var Er=Set.prototype.has;Set.prototype.has=function(e){return t(Er,this,0===e?0:e)},y.preserveToString(Set.prototype.has,Er);var Nr=Set.prototype.delete;Set.prototype.delete=function(e){return t(Nr,this,0===e?0:e)},y.preserveToString(Set.prototype.delete,Nr)}var Ar=P(x.Map,(function(e){var t=new e([]);return t.set(42,42),t instanceof e})),kr=Object.setPrototypeOf&&!Ar;try{var zr=!(x.Map()instanceof x.Map)}catch(e){zr=e instanceof TypeError}0===x.Map.length&&!kr&&zr||(x.Map=function e(){if(!(this instanceof e))throw new TypeError('Constructor Map requires "new"');var t=new $;return 0<arguments.length&&xr(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},x.Map.prototype=$.prototype,v(x.Map.prototype,"constructor",x.Map,!0),y.preserveToString(x.Map,$));var jr=P(x.Set,(function(e){var t=new e([]);return t.add(42,42),t instanceof e})),Rr=Object.setPrototypeOf&&!jr;try{var Dr=!(x.Set()instanceof x.Set)}catch(e){Dr=e instanceof TypeError}if(0!==x.Set.length||Rr||!Dr){var $r=x.Set;x.Set=function e(){if(!(this instanceof e))throw new TypeError('Constructor Set requires "new"');var t=new $r;return 0<arguments.length&&Cr(e,t,arguments[0]),delete t.constructor,Object.setPrototypeOf(t,e.prototype),t},x.Set.prototype=$r.prototype,v(x.Set.prototype,"constructor",x.Set,!0),y.preserveToString(x.Set,$r)}var Br=new x.Map,Fr=!a((function(){return Br.keys().next().done}));if(("function"!=typeof x.Map.prototype.clear||0!==(new x.Set).size||0!==Br.size||"function"!=typeof x.Map.prototype.keys||"function"!=typeof x.Set.prototype.keys||"function"!=typeof x.Map.prototype.forEach||"function"!=typeof x.Set.prototype.forEach||o(x.Map)||o(x.Set)||"function"!=typeof Br.keys().next||Fr||!Ar)&&d(x,{Map:_r.Map,Set:_r.Set},!0),x.Set.prototype.keys!==x.Set.prototype.values&&v(x.Set.prototype,"keys",x.Set.prototype.values,!0),Ce(Object.getPrototypeOf((new x.Map).keys())),Ce(Object.getPrototypeOf((new x.Set).keys())),u&&"has"!==x.Set.prototype.has.name){var Xr=x.Set.prototype.has;ee(x.Set.prototype,"has",(function(e){return t(Xr,this,e)}))}}d(x,_r),xe(x.Map),xe(x.Set)}var Yr=function(e){if(!le.TypeIsObject(e))throw new TypeError("target must be an object")},qr={apply:function(){return le.Call(le.Call,null,arguments)},construct:function(e,t){if(!le.IsConstructor(e))throw new TypeError("First argument must be a constructor.");var r=2<arguments.length?arguments[2]:e;if(!le.IsConstructor(r))throw new TypeError("new.target must be a constructor.");return le.Construct(e,t,r,"internal")},deleteProperty:function(e,t){if(Yr(e),s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable)return!1}return delete e[t]},has:function(e,t){return Yr(e),t in e}};if(Object.getOwnPropertyNames&&Object.assign(qr,{ownKeys:function(e){Yr(e);var t=Object.getOwnPropertyNames(e);return le.IsCallable(Object.getOwnPropertySymbols)&&I(t,Object.getOwnPropertySymbols(e)),t}}),Object.preventExtensions&&Object.assign(qr,{isExtensible:function(e){return Yr(e),Object.isExtensible(e)},preventExtensions:function(e){return Yr(e),!i((function(){return Object.preventExtensions(e)}))}}),s){var Vr=function(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);return n?"value"in n?n.value:n.get?le.Call(n.get,r):void 0:null===(e=Object.getPrototypeOf(e))?void 0:Vr(e,t,r)},Ur=function(e,r,n,i){var a=Object.getOwnPropertyDescriptor(e,r);if(!a){if(null!==(e=Object.getPrototypeOf(e)))return Ur(e,r,n,i);a={value:void 0,writable:!0,enumerable:!0,configurable:!0}}return"value"in a?!(!a.writable||!le.TypeIsObject(i))&&(Object.getOwnPropertyDescriptor(i,r)?ne.defineProperty(i,r,{value:n}):ne.defineProperty(i,r,{value:n,writable:!0,enumerable:!0,configurable:!0})):!!a.set&&(t(a.set,i,n),!0)};Object.assign(qr,{defineProperty:function(e,t,r){return Yr(e),!i((function(){return Object.defineProperty(e,t,r)}))},getOwnPropertyDescriptor:function(e,t){return Yr(e),Object.getOwnPropertyDescriptor(e,t)},get:function(e,t){return Yr(e),Vr(e,t,2<arguments.length?arguments[2]:e)},set:function(e,t,r){return Yr(e),Ur(e,t,r,3<arguments.length?arguments[3]:e)}})}if(Object.getPrototypeOf){var Wr=Object.getPrototypeOf;qr.getPrototypeOf=function(e){return Yr(e),Wr(e)}}Object.setPrototypeOf&&qr.getPrototypeOf&&Object.assign(qr,{setPrototypeOf:function(e,t){if(Yr(e),null!==t&&!le.TypeIsObject(t))throw new TypeError("proto must be an object or null");if(t===ne.getPrototypeOf(e))return!0;if(ne.isExtensible&&!ne.isExtensible(e))return!1;var r;e:{for(r=t;r;){if(e===r){r=!0;break e}r=qr.getPrototypeOf(r)}r=!1}return!r&&(Object.setPrototypeOf(e,t),!0)}});var Gr=function(e,t){le.IsCallable(x.Reflect[e])?a((function(){return x.Reflect[e](1),x.Reflect[e](NaN),x.Reflect[e](!0),!0}))&&ee(x.Reflect,e,t):v(x.Reflect,e,t)};Object.keys(qr).forEach((function(e){Gr(e,qr[e])}));var Hr=x.Reflect.getPrototypeOf;if(u&&Hr&&"getPrototypeOf"!==Hr.name&&ee(x.Reflect,"getPrototypeOf",(function(e){return t(Hr,x.Reflect,e)})),x.Reflect.setPrototypeOf&&a((function(){return x.Reflect.setPrototypeOf(1,{}),!0}))&&ee(x.Reflect,"setPrototypeOf",qr.setPrototypeOf),x.Reflect.defineProperty&&(a((function(){var e=!x.Reflect.defineProperty(1,"test",{value:1}),t="function"!=typeof Object.preventExtensions||!x.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t}))||ee(x.Reflect,"defineProperty",qr.defineProperty)),x.Reflect.construct&&(a((function(){var e=function(){};return x.Reflect.construct((function(){}),[],e)instanceof e}))||ee(x.Reflect,"construct",qr.construct)),"Invalid Date"!==String(new Date(NaN))){var Jr=Date.prototype.toString;ee(Date.prototype,"toString",(function(){var e=+this;return e!=e?"Invalid Date":le.Call(Jr,this)}))}var Zr={anchor:function(e){return le.CreateHTML(this,"a","name",e)},big:function(){return le.CreateHTML(this,"big","","")},blink:function(){return le.CreateHTML(this,"blink","","")},bold:function(){return le.CreateHTML(this,"b","","")},fixed:function(){return le.CreateHTML(this,"tt","","")},fontcolor:function(e){return le.CreateHTML(this,"font","color",e)},fontsize:function(e){return le.CreateHTML(this,"font","size",e)},italics:function(){return le.CreateHTML(this,"i","","")},link:function(e){return le.CreateHTML(this,"a","href",e)},small:function(){return le.CreateHTML(this,"small","","")},strike:function(){return le.CreateHTML(this,"strike","","")},sub:function(){return le.CreateHTML(this,"sub","","")},sup:function(){return le.CreateHTML(this,"sup","","")}};c(Object.keys(Zr),(function(e){var r=String.prototype[e];if(le.IsCallable(r)){r=t(r,"",' " ');var n=S([],r.match(/"/g)).length;r=r!==r.toLowerCase()||2<n}else r=!0;r&&ee(String.prototype,e,Zr[e])}));var Qr=function(){if(!te)return!1;var e="object"==typeof JSON&&"function"==typeof JSON.stringify?JSON.stringify:null;if(!e)return!1;if(void 0!==e(q())||"[null]"!==e([q()]))return!0;var t={a:q()};return t[q()]=!0,"{}"!==e(t)}(),Kr=a((function(){return!te||"{}"===JSON.stringify(Object(q()))&&"[{}]"===JSON.stringify([Object(q())])}));if(Qr||!Kr){var en=JSON.stringify;ee(JSON,"stringify",(function(e){if("symbol"!=typeof e){var n;1<arguments.length&&(n=arguments[1]);var i=[e];if(r(n))i.push(n);else{var a=le.IsCallable(n)?n:null;i.push((function(e,r){if("symbol"!=typeof(e=a?t(a,this,e,r):r))return K.symbol(e)?dt({})(e):e}))}return 2<arguments.length&&i.push(arguments[2]),en.apply(this,i)}}))}return x}));var CindyJS=function(){function e(e){return 0===r?(console.error("Waiting for "+e+" after we finished waiting."),function(){}):(0>r&&(r=0),++r,function(){if(0>--r&&console.error("Wait count mismatch: "+e),0===r)for(var t=0,i=n.length;t<i;)n[t++].startup()})}function t(e){var i=t.newInstance(e);return 0>=r?i.startup():!1!==e.autostart&&n.push(i),i}var r=-1,n=[];Math.sign||(Math.sign=function(e){return(0<e)-(0>e)||+e}),"undefined"==typeof document||"undefined"==typeof window||void 0===document.addEventListener||void 0!==window.cindyDontWait&&!0===window.cindyDontWait||document.addEventListener("DOMContentLoaded",e("DOMContentLoaded"));var i=null,a=null,o={};t.getBaseDir=function(){if(null!==i)return i;for(var e=document.getElementsByTagName("script"),t=0;t<e.length;++t){var r=e[t],n=r.src;if(n){var o=/Cindy\.js$/.exec(n);if(o)return i=n.substr(0,o.index),console.log("Will load extensions from "+i),a=r,i}}return console.error("Could not find <script> tag for Cindy.js"),i=a=!1},t.addNewScript=function(e,r){r||console.error.bind(console);var n=t.getBaseDir();return!1!==n&&((r=document.createElement("script")).src=n+e,e=a.nextSibling,n=a.parentElement,e?n.insertBefore(r,e):n.appendChild(r),r)},t.loadScript=function(e,r,n,i){for(var a=String(e).split("."),l=window;a.length&&"object"==typeof l&&null!==l;)l=l[a.shift()];if(l&&!a.length)return n(),!0;if(i||(i=console.error.bind(console)),!(a=o[e])){if(!1===(a=t.addNewScript(r,i)))return i("Can't load additional components."),!1;o[e]=a}return a.addEventListener("load",n),a.addEventListener("error",i),null},t._autoLoadingPlugin={},t.autoLoadPlugin=function(e,r,n){if(t._pluginRegistry[e])return n(),!0;var i=t._autoLoadingPlugin[e];if(!i){if(r||(r=e+"-plugin.js"),i=t._autoLoadingPlugin[e]=[],!1===(e=t.addNewScript(r)))return!1;e.addEventListener("error",console.error.bind(console))}return i.push(n),null};var l={ctype:"undefined"};t.waitFor=e,t._pluginRegistry={},t.instances=[],t.registerPlugin=function(e,r,n){if(1!==e)return console.error("Plugin API version "+e+" not supported"),!1;t._pluginRegistry[r]=n,(t._autoLoadingPlugin[r]||[]).forEach((function(e){e()}))};var s=0;return t.dumpState=function(e){e=t.instances[e||0].saveState(),console.log(JSON.stringify(e))},t.debugState=function(e){t.instances.map((function(e){var t=e.config;t=JSON.parse(JSON.stringify(t));var r=e.saveState();for(var n in console.log(JSON.stringify(r)),r)t[n]=r[n];return e.shutdown(),t})).forEach((function(e){t(e)}))},t.newInstance=function(e){function t(){if(Ct.width=Mt=Ct.clientWidth,Ct.height=Tt=Ct.clientHeight,Gt=1,(Ut||Wt)&&(Gt=Math.max(Ut?Ut/Ct.width:0,Wt?Wt/Ct.height:0),Mt=Gt*Ct.clientWidth,Tt=Gt*Ct.clientHeight),St.setTransform(1/Gt,0,0,1/Gt,0,0),wn.setMat(25,0,0,25,250.5,250.5),_t)for(var e=0;e<_t.length;e++){var t=_t[e],r=Object.keys(t)[0];"scale"===r&&(Bt=t.scale,wn[r](t.scale)),"translate"===r&&wn[r](t.translate[0],t.translate[1]),"scaleAndOrigin"===r&&(Bt=t[r][0]/25,wn[r].apply(null,t[r])),"visibleRect"===r&&(wn[r].apply(null,t[r]),Bt=wn.drawingstate.initialmatrix.a/25)}wn.createnewbackup(),wn.greset(),e=1,"undefined"!=typeof window&&window.devicePixelRatio&&(e=window.devicePixelRatio),e!==(t=St.webkitBackingStorePixelRatio||St.mozBackingStorePixelRatio||St.msBackingStorePixelRatio||St.oBackingStorePixelRatio||St.backingStorePixelRatio||1)&&(e/=t,Ct.width=Mt*e,Ct.height=Tt*e,St.scale(e,e))}function r(e){if("canvas"!==e.tagName.toLowerCase()){var t=e;for(Ct=document.createElement("canvas");t.firstChild;)t.removeChild(t.firstChild)}else{Ct=e,t=document.createElement("div");var r=null,n=null;Array.prototype.slice.call(Ct.attributes).forEach((function(e){"width"===e.name?r=e.value:"height"===e.name?n=e.value:t.setAttributeNodeNS(Ct.removeAttributeNode(e))})),null===r||t.style.width||(t.style.width=r+"px"),null===n||t.style.height||(t.style.height=n+"px"),Ct.parentNode.replaceChild(t,Ct)}return t.classList.add("CindyJS-widget"),(e=Ct.style).position="absolute",e.border="none",e.margin=e.padding=e.left=e.top="0px",e.width=e.height="100%",e="static",window.getComputedStyle&&(e=window.getComputedStyle(t).getPropertyValue("position"),e=String(e||"static")),"static"===e&&(t.style.position="relative"),t.appendChild(Ct),Ct}function n(){var t=e.cinderella;if(!t||!t.version)return!1;for(var r=0;r<arguments.length;++r){var n=t.version[r],i=arguments[r];if(n!==i)return typeof n==typeof i&&n<i}return!1}function i(){if(or=!0,0===lr){if(e.exclusive)for(m=Ot.instances.length;0<m;)Ot.instances[--m].shutdown();void 0!==e.csconsole&&(xt=e.csconsole),xt=null===xt?new b:!0===xt?new g:"string"==typeof xt||"object"==typeof xt&&"function"==typeof xt.appendChild?new y(xt):new b,wt=[100,100];var i=null;if(_t=e.transform,e.ports&&0<e.ports.length){(i=(m=e.ports[0]).element)||(i=document.getElementById(m.id));var s=(i=r(i)).parentNode.style;"window"===m.fill?(s.width="100vw",s.height="100vh"):"parent"===m.fill?(s.width="100%",s.height="100%"):m.width&&m.height&&(s.width=m.width+"px",s.height=m.height+"px"),m.virtualwidth&&(Ut=m.virtualwidth),m.virtualheight&&(Wt=m.virtualheight),m.background&&(i.style.backgroundColor=m.background),void 0!==m.transform&&(_t=m.transform),Ht(m.grid)&&0<m.grid&&(Ft=m.grid),Ht(m.tgrid)&&0<m.tgrid&&(Xt=m.tgrid),m.snap&&(Yt=!0),Number.isFinite(m.snapdistance)&&(qt=Math.max(m.snapdistance,0)),m.axes&&(Vt=!0)}i||((i=e.canvas)||"undefined"==typeof document||(i=document.getElementById(e.canvasname))&&(i=r(i))),i&&(Ct=i,St=i.getContext("2d"),t(),St.setLineDash||(St.setLineDash=function(){}),(e.animation?e.animation.controls:e.animcontrols)&&function(e){function t(e,t){var r=document.createElement("button"),n=document.createElement("img");r.appendChild(n),c.appendChild(r),er(n,e),r.addEventListener("click",t),Qt[e]=function(e){e?r.classList.add("CindyJS-active"):r.classList.remove("CindyJS-active")}}function r(e){if(p){var t=s.getBoundingClientRect();o(l*(e.clientX-t.left-s.clientLeft+.5)/t.width+i)}}var n=document.createElement("div");n.className="CindyJS-animcontrols",Ct.parentNode.appendChild(n);var i=0,a=1,l=1;e.animation&&e.animation.speedRange&&Ht(e.animation.speedRange[0])&&Ht(e.animation.speedRange[1])&&(i=e.animation.speedRange[0],a=e.animation.speedRange[1],l=a-i);var s=document.createElement("div");s.className="CindyJS-animspeed",n.appendChild(s);var u=document.createElement("div");s.appendChild(u),P(s,"mousedown",(function(e){p=!0,r(e)})),P(s,"mousemove",r),P(Ct.parentNode,"mouseup",(function(e){p=!1}),!0);var c=document.createElement("div");c.className="CindyJS-animbuttons",n.appendChild(c),t("play",f),t("pause",h),t("stop",v),Qt.stop(!0),Kt=function(e){e=(e-i)/l,e=Math.max(0,Math.min(1,e)),e=.1*Math.round(1e3*e),u.style.width=e+"%"};var p=!1}(e),e.animation&&Ht(e.animation.speed)&&(void 0===e.animation.accuracy&&n(2,9,1875)?o(.5*e.animation.speed):o(e.animation.speed)),e.animation&&Ht(e.animation.accuracy)&&(Rt=e.animation.accuracy)),e.statusbar&&(Dr="string"==typeof e.statusbar?document.getElementById(e.statusbar):e.statusbar);var u=e.scripts,d=null;"string"==typeof u&&u.search(/\*/)&&(d=u),"object"!=typeof u&&(u=null),"move keydown keyup keytyped keytype mousedown mouseup mousedrag mousemove mouseclick multidown multiup multidrag init tick draw simulationstep simulationstart simulationstop ondrop".split(" ").forEach((function(t){if(null!==u&&u[t])var r=u[t];else{if(e[r=t+"script"])r=document.getElementById(e[r]);else{if(!d)return;if(!(r=document.getElementById(d.replace(/\*/,t))))return}r=r.text}"error"===(r=fe(r)).ctype?console.error("Error compiling "+t+" script: "+r.message):Et[t]=function(e,t){return{ctype:"infix",args:[],impl:function(){ln=[{oper:t}];var r=ue(e);return ln=[],r}}}(r,t)})),n(2,9,1888)&&!Et.keydown&&(Et.keydown=Et.keytyped,Et.keytyped=Et.keytype,Et.keytype=void 0),Ht(e.grid)&&0<e.grid&&(Ft=e.grid),e.snap&&(Yt=!0),Number.isFinite(e.snapdistance)&&(qt=Math.max(e.snapdistance,0)),It={};var m=0;for(var x in Lt={},e.geometry||(e.geometry=[]),function(e){Object.keys(qn).forEach((function(e){var t=qn[e];Ue(t.signature||"_helper"===e,e+" has no signature"),void 0!==t.updatePosition&&void 0===t.stateSize&&(t.stateSize=0)})),It.gslp=[],It.csnames={},It.points=[],It.lines=[],It.conics=[],It.texts=[],It.free=[],It.polygons=[],It.ifs=[],It.sets={points:[],lines:[],conics:[]},e.forEach(Be),dt()}(e.geometry),e.behavior||(e.behavior=[]),Pt(e.behavior),e.images)(m=a(e.images[x],!1))!==l&&(Lt[x]=m);for(var C in e.videos)(x=a(e.videos[C],!0))!==l&&(Lt[C]=x);ar.canvas=i,e.oninit&&e.oninit(ar),Ot.instances.push(ar),e.use&&e.use.forEach((function(e){Or.use$1([Tr.wrap(e)],{})})),on.convexhull3d$1&&c("QuickHull3D","QuickHull3D.js"),(on.colorplot$1||on.colorplot$2||on.colorplot$3||on.colorplot$4)&&c("CindyGL","CindyGL.js"),(on.playtone$1||on.playmelody$1)&&c("midi","midi-plugin.js"),p()}}function a(e,t){if("string"==typeof e){if(t){var r=document.createElement("video");r.preload="auto",r.loop=!0,r.setAttribute("playsinline",""),enableInlineVideo(r)}else r=new Image;r.src=e}else r=e;if(!r.tagName)return console.error("Not a valid image element",r),l;var n={img:r,width:NaN,height:NaN,ready:!0,live:!1,generation:0,whenReady:u};e=r.tagName.toLowerCase();var i=[];if("img"===e)r.complete?(n.width=r.width,n.height=r.height):(n.ready=!1,r.addEventListener("load",(function(){n.width=r.width,n.height=r.height,n.ready=!0,n.whenReady=u,i.forEach(u),_()})),n.whenReady=i.push.bind(i));else if("video"===e)n.live=!0,r.readyState>=r.HAVE_METADATA?(n.width=r.videoWidth,n.height=r.videoHeight):(n.ready=!1,r.addEventListener("loadedmetadata",(function(){n.width=r.videoWidth,n.height=r.videoHeight,n.ready=!0,n.whenReady=u,i.forEach(u),_()})),n.whenReady=i.push.bind(i));else{if("canvas"!==e)return console.error("Not a valid image element",e,r),l;n.width=r.width,n.height=r.height}return{ctype:"image",value:n}}function o(e){zt=e,Kt&&Kt(e)}function u(e){return e()}function c(t,r,n){var i=null;e.plugins&&(i=e.plugins[t]),i||(i=Ot._pluginRegistry[t]),i?Or.use$1([Tr.wrap(t)],{}):(++tr,Ot.autoLoadPlugin(t,r,(function(){Or.use$1([Tr.wrap(t)],{}),p(n)})))}function p(r){0==--tr&&(r?_():(ue(Et.init),(e.animation||e).autoplay&&f(),ar.canvas&&function(e,r){function n(t,r){for(var n=0;n<t.changedTouches.length;n++){var i=t.changedTouches[n],a=o(i.identifier);if(r||hr[a]){var l=e.getBoundingClientRect();i=wn.to(i.clientX-l.left-e.clientLeft+.5,i.clientY-l.top-e.clientTop+.5),hr[a]=[i[0],i[1]]}}_()}function i(t){var r=e.getBoundingClientRect();t=wn.to(t.clientX-r.left-e.clientLeft+.5,t.clientY-r.top-e.clientTop+.5),ur.prevx=ur.x,ur.prevy=ur.y,ur.x=t[0],ur.y=t[1],wt[0]=ur.x,wt[1]=ur.y,_()}function o(e){if(vr.hasOwnProperty(e))return vr[e];var t=Object.values(vr);t=t.sort((function(e,t){return e-t}));var r,n=!1;for(r in t)!n&&t[r]>1+(0|r)&&(vr[e]=1+(0|r),n=!0);return n||(vr[e]=t.length+1),vr[e]}function s(e){var t=e.changedTouches;n(e,!1);for(var r=0;r<e.changedTouches.length;r++)I(fr=o(e.changedTouches[r].identifier)),delete vr[e.changedTouches[r].identifier];r=!1;for(var i=0;i<t.length;i++)t[i].identifier===f&&(r=!0);r&&(f=-1,ur.down=!1,sr=void 0,ue(Et.mouseup),_e("mouseup"),p||ue(Et.mouseclick),_(),e.preventDefault())}var u=null,c=null,p=!1;"undefined"!=typeof MutationObserver&&(u=MutationObserver),u||"undefined"==typeof WebKitMutationObserver||(u=WebKitMutationObserver),u?(u=new u((function(t){document.body.contains(e)||d()})),u.observe(document.documentElement,{childList:!0,subtree:!0}),nr.push((function(){u.disconnect()}))):(P(e,"DOMNodeRemovedFromDocument",d),P(e,"DOMNodeRemoved",d)),!0===r.keylistener?(P(document,"keydown",(function(e){return M(e,Et.keydown),!1})),P(document,"keyup",(function(e){return M(e,Et.keyup),!1})),P(document,"keypress",(function(e){return M(e,Et.keytyped),!1}))):(Et.keydown||Et.keyup||Et.keytyped)&&(e.setAttribute("tabindex","0"),P(e,"mousedown",(function(){e.focus()})),P(e,"keydown",(function(e){9!==e.keyCode&&(M(e,Et.keydown),Et.keytyped||e.preventDefault())})),P(e,"keyup",(function(e){M(e,Et.keyup),e.preventDefault()})),P(e,"keypress",(function(e){9!==e.keyCode&&(M(e,Et.keytyped),e.preventDefault())})));P(e,"mousedown",(function(e){c=e,p=!1,ur.button=e.which,i(e),T(0),ue(Et.mousedown),_e("mousedown"),ur.down=!0,e.preventDefault()})),P(e,"mouseup",(function(e){ur.down=!1,sr=void 0,ue(Et.mouseup),I(0),_e("mouseup"),delete hr[0],_(),e.preventDefault()})),P(e,"mousemove",(function(e){i(e),ur.down?(c&&(2<Math.abs(c.clientX-e.clientX)||2<Math.abs(c.clientY-e.clientY))&&(p=!0),ue(Et.mousedrag),hr[0]&&(fr=0,ue(Et.multidrag),fr=0)):ue(Et.mousemove),_e("mousemove"),e.preventDefault()})),P(e,"click",(function(e){i(e),p||ue(Et.mouseclick),e.preventDefault()})),P(e,"dragenter",(function(e){e.preventDefault()})),P(e,"dragover",(function(e){e.preventDefault()})),P(e,"drop",(function(t){function r(e,t){function r(){u.readyState===XMLHttpRequest.DONE&&(200!==u.status?(console.error("GET request for "+e+" failed: "+(u.responseText||"(no error message)")),s(t,l)):i(t,u.responseText))}var a=e.replace(/[?#][^]*/,"");a=a.replace(/[^]*\/([^\/])/,"$1"),c[t]={type:"",name:a};var u=new XMLHttpRequest;u.onreadystatechange=function(){if(u.readyState===XMLHttpRequest.DONE)if(200!==u.status)console.error("HEAD request for "+e+" failed: "+(u.responseText||"(no error message)")),s(t,l);else{var i=u.getResponseHeader("Content-Type");c[t].type=i,/^image\//.test(i)?o(t,e):n(i)?((u=new XMLHttpRequest).onreadystatechange=r,u.open("GET",e),u.send()):s(t,l)}},u.open("HEAD",e),u.send()}function n(e){return e=e.replace(/;[^]*/,""),/^text\//.test(e)?1:"application/json"===e?2:0}function i(e,t){switch(n(c[e].type)){case 1:s(e,Tr.string(t));break;case 2:try{var r=JSON.parse(t),i=Tr.wrapJSON(r)}catch(e){console.error(e),i=l}s(e,i);break;default:s(e,l)}}function o(e,t){var r=new Image,n=!1;r.onload=function(){n||(n=!0,s(e,a(r,!1)))},r.onerror=function(t){n||(n=!0,console.error(t),s(e,l))},r.src=t}function s(e,t,r){p[e]=wr.turnIntoCSList([t,Tr.string(r||t.ctype),Tr.string(c[e].type),Tr.string(c[e].name)]),0==--f&&(e=v,Jt=wr.turnIntoCSList(p),Zt=e,ue(Et.ondrop),Zt=Jt=l,_())}t.preventDefault();var u=t.dataTransfer,c=u.files,p=Array(c.length),f=c.length,h=t.currentTarget.getBoundingClientRect(),v=wr.realVector(wn.to(t.clientX-h.left-e.clientLeft+.5,t.clientY-h.top-e.clientTop+.5));0<c.length?Array.prototype.forEach.call(c,(function(e,t){var r=new FileReader;n(e.type)?(r.onload=function(){i(t,r.result)},r.readAsText(e)):/^image\//.test(e.type)?(r.onload=function(){o(t,r.result)},r.readAsDataURL(e)):(console.log("Unknown MIME type: "+e.type),s(t,l))})):(t=u.getData("text/uri-list"))&&(t=t.split("\n").filter((function(e){return!/^\s*(#|$)/.test(e)})),f=t.length,p=Array(f),c=Array(f),t.forEach(r))}));var f=-1;P(e,"touchstart",(function(e){n(e,!0);for(var t=0;t<e.changedTouches.length;t++)T(o(e.changedTouches[t].identifier));-1===f&&(0!==(t=e.changedTouches).length&&(f=t[0].identifier,i(e.targetTouches[0]),ue(Et.mousedown),ur.down=!0,c=e.targetTouches[0],p=!1,_e("mousedown"),e.preventDefault()))}),!1),P(e,"touchmove",(function(e){n(e,!1);for(var t=0;t<e.changedTouches.length;t++)fr=o(e.changedTouches[t].identifier),ue(Et.multidrag),fr=0;t=e.changedTouches;for(var r=!1,a=0;a<t.length;a++)t[a].identifier===f&&(r=!0);r&&(i(e.targetTouches[0]),ur.down?(c&&(2<Math.abs(c.clientX-e.targetTouches[0].clientX)||2<Math.abs(c.clientY-e.targetTouches[0].clientY))&&(p=!0),fr=o(f),ue(Et.mousedrag)):ue(Et.mousemove),_e("mousemove"),e.preventDefault())}),!0),P(e,"touchend",s,!1),"undefined"!=typeof document&&document.body&&P(document.body,"touchcancel",s,!1),"undefined"!=typeof window&&P(window,"resize",(function(){dr((function(){t(),_()}))}),!1),C(e.parentNode),_()}(ar.canvas,e)))}function f(){if(!Nt){if(At){var e=On.backup;e.set(jn);for(var t={},r=0;r<It.points.length;r++){var n=It.points[r];void 0!==n.behavior&&(t[n.name]=[n.behavior.vx,n.behavior.vy,n.behavior.vz])}rr={state:e,speeds:t},kt=0,At=!1,Qt.stop(!1)}else Qt.pause(!1);jt=Date.now(),Qt.play(!0),ni&&Hn.forEach((function(e){var t=(e.geo||[]).map((function(e){return It.csnames[e]}));ii[e.type].reset(e,t[0],t)})),Nt=!0,ue(Et.simulationstart),_()}}function h(){Nt&&(Qt.play(!1),Qt.pause(!0),Nt=!1)}function v(){At||(Nt?(ue(Et.simulationstop),Nt=!1,Qt.play(!1)):Qt.pause(!1),Qt.stop(!0),At=!0,null!==rr&&(jn.set(rr.state),Object.keys(rr.speeds).forEach((function(e){var t=It.csnames[e];void 0!==t.behavior&&(e=rr.speeds[e],t.behavior.vx=e[0],t.behavior.vy=e[1],t.behavior.vz=e[2],t.behavior.fx=0,t.behavior.fy=0,t.behavior.fz=0)})),Qe()))}function d(){if(!ir){ir=!0;for(var e=Ot.instances.length;0<e;)if(Ot.instances[--e]===ar){Ot.instances.splice(e,1);break}for(e=nr.length;0<e;)try{nr[--e]()}catch(e){console.error(e)}}}function m(e){this.in=function(e,t){console.log(e),t?this.append(this.createTextNode("span","blue",e)):this.append(this.createTextNode("p","blue",e))},this.out=function(e,t){console.log(e),t?this.append(this.createTextNode("span","red",e)):this.append(this.createTextNode("p","red",e))},this.err=function(e,t){console.log(e),t?this.append(this.createTextNode("span","red",e)):this.append(this.createTextNode("p","red",e))},this.createTextNode=function(e,t,r){return"undefined"!=typeof document?((e=document.createElement(e)).appendChild(document.createTextNode(r)),e.style.color=t,e):r+"\n"}}function g(){var e=this,t=document.createElement("div");t.innerHTML='<div id="console" style="border-top: 1px solid #333333; bottom: 0px; position: absolute; width: 100%;"><div id="log" style="height: 150px; overflow-y: auto;"></div><input id="cmd" type="text" style="box-sizing: border-box; height: 30px; width: 100%;"></div>',document.body.appendChild(t);var r=document.getElementById("cmd"),n=document.getElementById("log");r.onkeydown=function(t){13===t.keyCode&&""!==r.value&&(e.in(r.value),t=ue(t=Or.parse$1([Tr.wrap(r.value)],[])),console.log(E(t)),"undefined"!==t.ctype&&xt.out(E(t)),r.value="",n.scrollTop=n.scrollHeight)},this.append=function(e){n.appendChild(e)},this.clear=function(){n.innerHTML=""}}function y(e){var t=e;"string"==typeof e&&(t=document.getElementById(e)),this.append=function(e){t.appendChild(e)},this.clear=function(){t.innerHTML=""}}function b(){this.append=function(e){},this.clear=function(){}}function P(e,t,r,n){void 0===n&&(n=!1),nr.push((function(){e.removeEventListener(t,r,n)})),e.addEventListener(t,r,n)}function x(e,t){var r=document.createElement("div");return r.setAttribute("style",t),e.appendChild(r),r}function C(e){function r(){i.scrollLeft=i.scrollTop=a.scrollLeft=a.scrollTop=1e5}function n(){o===e.clientWidth&&l===e.clientHeight||(o=e.clientWidth,l=e.clientHeight,s||(s=!0,dr((function(){s=!1,t(),_()})))),r()}if("undefined"!=typeof document){var i=x(e,"position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;");x(i,"position: absolute; transition: 0s; left: 0; top: 0; width: 100000px; height: 100000px");var a=x(e,"position: absolute; transition: 0s; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;");x(a,"position: absolute; transition: 0s; left: 0; top: 0; width: 200%; height: 200%"),r();var o=e.clientWidth,l=e.clientHeight,s=!1;i.addEventListener("scroll",n),a.addEventListener("scroll",n)}}function _(){mr||(mr=dr(w))}function w(){if(mr=null,!ir){if(Nt){var e=Date.now(),t=Math.min(50,e-jt)*zt*$t;jt=e,e=kt+t,ni&&void 0!==Jn&&Jn.tick(t),kt=e,Nt&&ue(Et.tick)}S(),Nt&&_()}}function S(){wn.reset(),St.save(),St.clearRect(0,0,Mt,Tt);var e,t,r=wn.drawingstate.matrix;if(0!==Ft){St.beginPath(),St.strokeStyle="rgba(0,0,0,0.1)",St.lineWidth=1,St.lineCap="butt";var n=Ft*r.a;for(e=Math.ceil(-r.tx/n);(t=e*n+r.tx)<Mt;)!e&&Vt||(St.moveTo(t,0),St.lineTo(t,Tt)),e++;for(e=Math.floor(r.ty/n);(t=e*n-r.ty)<Tt;)!e&&Vt||(St.moveTo(0,t),St.lineTo(Mt,t)),e++;St.stroke()}if(0!==Xt){St.beginPath(),St.strokeStyle="rgba(0,0,0,0.1)",St.lineWidth=1,St.lineCap="butt",n=Xt*r.a;var i=Math.sqrt(3),a=r.ty/i,o=(Tt+r.ty)/i;for(e=Math.ceil(-(r.tx+o)/n);(t=e*n+r.tx)+a<Mt;)St.moveTo(t+a,0),St.lineTo(t+o,Tt),e++;for(e=Math.ceil(-(r.tx-a)/n);(t=e*n+r.tx)-o<Mt;)St.moveTo(t-a,0),St.lineTo(t-o,Tt),e++;for(n*=.5*i,e=Math.floor(r.ty/n);(t=e*n-r.ty)<Tt;)!e&&Vt||(St.moveTo(0,t),St.lineTo(Mt,t)),e++;St.stroke()}for(Vt&&(St.beginPath(),St.strokeStyle="rgba(0,0,0,0.2)",St.lineWidth=3,St.lineCap="butt",St.lineJoin="miter",St.miterLimit=10,St.beginPath(),St.moveTo(0,-r.ty),St.lineTo(Mt-6,-r.ty),St.moveTo(Mt-13,-5-r.ty),St.lineTo(Mt-3,-r.ty),St.lineTo(Mt-13,5-r.ty),St.moveTo(r.tx,Tt),St.lineTo(r.tx,6),St.moveTo(r.tx-5,13),St.lineTo(r.tx,3),St.lineTo(r.tx+5,13),St.stroke()),function(){if(Xn&&(Xn.currentMouseAndScripts=[]),$n=!0,sr){Ze(sr.mover,wr.realVector([ur.x+sr.offset.x,ur.y+sr.offset.y,1]),"mouse"),sr.prev.x=ur.x,sr.prev.y=ur.y}ue(Et.move),ue(Et.draw),kn||We(),$n=!1,Xn&&(Xn.fullLog.push(wr.turnIntoCSList([wr.turnIntoCSList(Xn.currentMouseAndScripts)])),Xn.length>Xn.logLength&&Xn.splice(0,Xn.length-Xn.logLength),Xn.currentMouseAndScripts=null,Xn.postMouseHooks.forEach((function(e){e()})))}(),wn.greset(),function(){function e(){var e=l++/r._traces.length,t=r._traces[o];t&&(e*=n*e*e,Or.draw$1([t],{size:yr.real(i),color:r.color,alpha:yr.real(e)})),i*=a}for(var t=0;t<It.points.length;t++){var r=It.points[t];if(r.drawtrace){r._traces_tick===r.traceskip?(r._traces[r._traces_index]=r.homog,r._traces_index=(r._traces_index+1)%r._traces.length,r._traces_tick=0):r._traces_tick++;var n=r.alpha.value.real,i=r.size.value.real,a=1;1!==r.tracedim&&(i*=r.tracedim,a=Math.pow(r.tracedim,-1/r._traces.length));var o,l=0;for(o=r._traces_index;o<r._traces.length;++o)e();for(o=0;o<r._traces_index;++o)e()}}}(),r=0;r<It.polygons.length;r++)(n=It.polygons[r]).isshowing&&!1!==n.visible&&(a={color:n.color,alpha:n.alpha,fillcolor:n.fillcolor,fillalpha:n.fillalpha,size:n.size,lineJoin:Tr.string("miter"),fillrule:Tr.string(n.fillrule)},Er.drawpolygon([n.vertices],a,"D",!0));for(r=0;r<It.conics.length;r++)It.conics[r].isArc?(n=It.conics[r]).isshowing&&!1!==n.visible&&((a={}).color=n.color,a.alpha=n.alpha,a.size=n.size,Er.drawarc(n,a,n.filled?"F":"D")):(n=It.conics[r]).isshowing&&!1!==n.visible&&((a={}).color=n.color,a.alpha=n.alpha,a.size=n.size,Er.drawconic(n.matrix,a));for(r=0;r<It.lines.length;r++)e:if(n=It.lines[r],n.isshowing&&!1!==n.visible&&wr._helper.isAlmostReal(n.homog))if("S"===n.kind)a={overhang:n.overhang,dashtype:n.dashtype,size:n.size,color:n.color,alpha:n.alpha,arrow:n.arrow,arrowsize:n.arrowsize,arrowposition:n.arrowposition,arrowshape:n.arrowshape,arrowsides:n.arrowsides},0<=yr.mult(n.startpos.value[2],yr.conjugate(n.endpos.value[2])).value.real?(Or.draw$2([n.startpos,n.endpos],a),n.labeled&&!n.tmp&&(a=n.printname||n.name||"S",o={x:(o=wr.scalmult(yr.real(Math.sign(n.startpos.value[2].value.real)*Math.sign(n.endpos.value[2].value.real)),wr.cross(n.startpos,n.endpos))).value[0].value.real,y:o.value[1].value.real},e=Math.sqrt(o.x*o.x+o.y*o.y),o={x:8*o.x/e-3,y:8*o.y/e-3},o=n.labelpos||o,e=pn.makeColor(Sn.textColor),qe(n,a,t=qn._helper.midpoint(qn._helper.midpoint(n.startpos,n.endpos),n.endpos),o,e))):(pn.handleModifs(a,pn.lineModifs),pn.drawRaySegment(n.startpos,n.endpos));else if("end"===n.clip.value&&"Join"===n.type)e=It.csnames[n.args[0]],a=It.csnames[n.args[1]],Or.draw$2([e.homog,a.homog],{overhang:n.overhang,dashtype:n.dashtype,size:n.size,color:n.color,alpha:n.alpha});else{if("inci"===n.clip.value){for(e=[1e6,0],a=[-1e6,0],t=[1e6,0],o=[-1e6,0],i=0;i<n.incidences.length;i++){var l=It.csnames[n.incidences[i]].homog,s=l.value[0],u=l.value[1],c=l.value[2];yr._helper.isAlmostZero(c)||(s=yr.div(s,c),u=yr.div(u,c),yr._helper.isAlmostReal(s)&&yr._helper.isAlmostReal(u)&&(s.value.real<e[0]&&(e=[s.value.real,l]),s.value.real>a[0]&&(a=[s.value.real,l]),u.value.real<t[0]&&(t=[u.value.real,l]),u.value.real>o[0]&&(o=[u.value.real,l])))}if(a[0]-e[0]>o[0]-t[0]?(e=e[1],a=a[1]):(e=t[1],a=o[1]),e!==a){Or.draw$2([e,a],{dashtype:n.dashtype,size:n.size,color:n.color,alpha:n.alpha,overhang:n.overhang});break e}}Or.draw$1([n.homog],{dashtype:n.dashtype,size:n.size,color:n.color,alpha:n.alpha})}for(r=0;r<It.points.length;r++)(n=It.points[r]).isshowing&&!1!==n.visible&&wr._helper.isAlmostReal(n.homog)&&(a=n.color,n.behavior&&(a=n.color),Or.draw$1([n.homog],{size:n.size,color:a,alpha:n.alpha,noborder:n.noborder,border:n.border}),n.labeled&&!n.tmp)&&(o=n.printname||n.name||"P",e=n.labelpos||{x:3,y:3},t=pn.makeColor(Sn.textColor),!0!==n.noborder.value&&!1!==n.border.value||(t=a),qe(n,o,n.homog,e,t));for(r=0;r<It.texts.length;r++)Ve(It.texts[r]);It.ifs.length&&(!Vn.dirty&&Tr.deeplyEqual(Vn.mat,wn.drawingstate.matrix)||(qn.IFS.updateParameters(),Vn.dirty=!1),Vn.img&&St.drawImage(Vn.img,0,0,Mt,Tt)),St.restore()}function M(e,t){e=(e=window.event?event:e).charCode?e.charCode:e.keyCode,cr=String.fromCharCode(e),pr=e,ue(t),_()}function T(e){fr=e,0===e&&(hr[0]=wt),ue(Et.multidown),fr=0}function I(e){fr=e,ue(Et.multiup),delete hr[e],fr=0}function L(e){var t=e.value;e=t[0].value;var r=t[1].value;return t=t[2].value,wr.turnIntoCSList([e[0],yr.add(e[1],r[0]),yr.add(e[2],t[0]),r[1],yr.add(r[2],t[1]),t[2]])}function O(e){var t=!0;return function(r,n){return t&&(console.error("Operator "+e+" is not supported yet."),t=!1),l}}function E(e,t){if(void 0===e)return"_??_";if(null===e)return"_???_";if("undefined"===e.ctype)return"___";if("number"===e.ctype)return yr.niceprint(e);if("string"===e.ctype||"boolean"===e.ctype)return e.value;if("list"===e.ctype){t="[";for(var r=0;r<e.value.length;r++)t+=E(ue(e.value[r])),r!==e.value.length-1&&(t+=", ");return t+"]"}if("JSON"===e.ctype)try{return Sr.niceprint(e,t)}catch(e){return Sr._helper.handlePrintException(e)}return"dict"===e.ctype?Mr.niceprint(e):"function"===e.ctype?"FUNCTION":"infix"===e.ctype?"INFIX":"modifier"===e.ctype?e.key+"->"+E(e.value):"shape"===e.ctype?e.type:"error"===e.ctype?"Error: "+e.message:"variable"===e.ctype?E(Nr.getvar(e.name)):"geo"===e.ctype?e.value.name:"image"===e.ctype?"IMAGE":"_?_"}function N(e,t){t="undefined"===e[0].ctype;var r="undefined"===e[1].ctype,n=ue(e[1]);return t||r?l:("variable"===e[0].ctype?Nr.setvar(e[0].name,n):"infix"===e[0].ctype?"_"===e[0].oper?Er.assigntake(e[0],n):he("Can't use infix expression as lvalue"):"field"===e[0].ctype?Er.assigndot(e[0],n):"userdata"===e[0].ctype?Er.assigncolon(e[0],n):"function"===e[0].ctype&&"genList"===e[0].oper?"list"===n.ctype?Er.assignlist(e[0].args,n.value):he("Expected list in rhs of assignment"):he("Left hand side of assignment is not a recognized lvalue"),n)}function A(e,t){if(t=ue(e[0]),e=ue(e[1]),t.ctype===e.ctype){if("number"===t.ctype)return Tr.bool(t.value.real===e.value.real&&t.value.imag===e.value.imag);if("string"===t.ctype||"boolean"===t.ctype)return Tr.bool(t.value===e.value);if("list"===t.ctype)return wr.equals(t,e);if("geo"===t.ctype)return Tr.bool(t.value===e.value)}return{ctype:"boolean",value:!1}}function k(e,t){return Tr.not(A(e,t))}function z(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype?{ctype:"boolean",value:yr._helper.isAlmostEqual(t,e)}:"string"===t.ctype&&"string"===e.ctype||"boolean"===t.ctype&&"boolean"===e.ctype?{ctype:"boolean",value:t.value===e.value}:"list"===t.ctype&&"list"===e.ctype?wr.almostequals(t,e):{ctype:"boolean",value:!1}}function j(e,t){return t=ce(e[0]),e=ce(e[1]),"boolean"===t.ctype&&"boolean"===e.ctype?{ctype:"boolean",value:t.value&&e.value}:l}function R(e,t){return t=ce(e[0]),e=ce(e[1]),"boolean"===t.ctype&&"boolean"===e.ctype?{ctype:"boolean",value:t.value||e.value}:l}function D(e,t){"void"!==(t=e[0]).ctype&&(t=ce(t)),e=ce(e[1]);var r=Tr.add(t,e);return"Angle"===t.usage&&"Angle"===e.usage&&(r=Tr.withUsage(r,"Angle")),r}function $(e,t){"void"!==(t=e[0]).ctype&&(t=ce(t)),e=ce(e[1]);var r=Tr.sub(t,e);return"Angle"===t.usage&&"Angle"===e.usage&&(r=Tr.withUsage(r,"Angle")),r}function B(e,t){t=ce(e[0]),e=ce(e[1]);var r=Tr.mult(t,e);return("Angle"!==t.usage||e.usage)&&("Angle"!==e.usage||t.usage)||(r=Tr.withUsage(r,"Angle")),r}function F(e,t){t=ce(e[0]),"number"===(e=ce(e[1])).ctype&&yr._helper.isZero(e)&&he("WARNING: Division by zero!");var r=Tr.div(t,e);return("Angle"!==t.usage||e.usage)&&("Angle"!==e.usage||t.usage)||(r=Tr.withUsage(r,"Angle")),r}function X(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype?yr.pow(t,e):l}function Y(e,t){if(t=pe(e[0]),e=pe(e[1]),t!==l&&e!==l){var r=wr.cross(t,e);return"Point"===t.usage&&"Point"===e.usage&&(r=Tr.withUsage(r,"Line")),"Line"===t.usage&&"Line"===e.usage&&(r=Tr.withUsage(r,"Point")),r}return l}function q(e){var t=e.length;if(0===t)return[];if(1===t)return[0];if(2===t)return e[0][0]+e[1][1]<=e[0][1]+e[1][0]?[0,1]:[1,0];if(4<t)return function(e){function t(){return{matched:-1,prev:-1,start:-1,cost:0,used:!1,leaf:!1}}function r(e){for(var t=0;t<l;++t)0<c[e][t]||u[t].used||(u[t].used=!0,r(u[t].matched))}function n(e){for(var t=0;t<l;++t)0<c[t][e]||s[t].used||(s[t].used=!0,n(s[t].matched))}var i,a,o=Math.abs,l=e.length,s=Array(l),u=Array(l),c=Array(l);for(i=0;i<l;++i)c[i]=Array(l);for(i=0;i<l;++i)for(s[i]=t(),u[i]=t(),s[i].cost=e[i][0],a=1;a<l;++a)s[i].cost>e[i][a]&&(s[i].cost=e[i][a]);for(;;){for(i=0;i<l;++i)for(a=0;a<l;++a)c[i][a]=e[i][a]-s[i].cost-u[a].cost,c[i][a]<1e-14*(o(e[i][a])+o(s[i].cost)+o(u[a].cost))&&(c[i][a]=0);for(i=0;i<l;++i)s[i].matched=u[i].matched=-1;for(var p=0;;){for(i=0;i<l;++i)s[i].used=s[i].leaf=u[i].used=u[i].leaf=!1,-1===s[i].matched&&(s[i].start=i,s[i].used=s[i].leaf=!0,s[i].prev=-1);for(var f=!1,h=!1;!h;){for(i=0;i<l;++i)if(s[i].leaf)for(s[i].leaf=!1,a=0;a<l;++a)if(!(u[a].used||0<c[i][a])&&s[i].matched!==a&&(u[a].prev=i,u[a].start=s[i].start,u[a].used=u[a].leaf=!0,-1===u[a].matched)){s[u[a].start].prev=a,f=!0;break}if(f)break;for(h=!0,a=0;a<l;++a)u[a].leaf&&(u[a].leaf=!1,i=u[a].matched,s[i].used||(s[i].prev=a,s[i].start=u[a].start,s[i].used=s[i].leaf=!0,h=!1))}if(!f)break;for(f=0;f<l;++f)if(-1===s[f].matched&&-1!==s[f].prev){a=s[f].prev;do{i=u[a].prev,u[a].matched=i,s[i].matched=a,a=s[i].prev}while(i!==f);++p}}if(p===l)break;for(i=0;i<l;++i)s[i].used=s[i].leaf=u[i].used=u[i].leaf=!1;for(i=0;i<l;++i)-1===s[i].matched&&r(i);for(a=0;a<l;++a)-1===u[a].matched&&n(a);for(i=0;i<l;++i)-1===s[i].matched||s[i].used||u[s[i].matched].used||(s[i].used=!0);for(p=Number.POSITIVE_INFINITY,i=0;i<l;++i)if(!s[i].used)for(a=0;a<l;++a)u[a].used||p>c[i][a]&&(p=c[i][a]);for(i=0;i<l;++i)s[i].used||(s[i].cost+=p),u[i].used&&(u[i].cost-=p)}for(e=Array(l),i=0;i<l;++i)a=s[i].matched,e[i]=a;return e}(e);for(var r=zr[t],n=Number.POSITIVE_INFINITY,i=r[0],a=0;a<r.length;++a){for(var o=r[a],l=0,s=0;s<t;++s)l+=e[s][o[s]];l<n&&(n=l,i=o)}return i}function V(e,t){if(t=ue(e[0]),e=ce(e[1]),"string"!==t.ctype&&"JSON"!==t.ctype&&(t=wr.asList(t)),"JSON"!==t.ctype&&"number"===e.ctype)return 0>(e=Math.floor(e.value.real))&&(e=t.value.length+e+1),0<e&&e<t.value.length+1?"list"===t.ctype?t.value[e-1]:{ctype:"string",value:t.value.charAt(e-1)}:(he("WARNING: Index out of range!"),l);if("JSON"===t.ctype)return e=E(e),-1!==E.errorTypes.indexOf(e)?l:void 0!==(t=t.value[e])&&t.ctype?t:l;if("list"===e.ctype){for(var r=[],n=0;n<e.value.length;n++){var i=ce(e.value[n]);r[n]=V([t,i],[])}return wr.turnIntoCSList(r)}return l}function U(e,t){return t=ue(e[0]),e=ue(e[1]),"shape"===t.ctype&&"shape"===e.ctype?Er.shapeconcat(t,e):(t=wr.asList(t),e=wr.asList(e),"list"===t.ctype&&"list"===e.ctype?wr.concat(t,e):l)}function W(e,t){return t=ue(e[0]),e=ue(e[1]),"list"===t.ctype&&"list"===e.ctype?wr.set(wr.common(t,e)):"shape"===t.ctype&&"shape"===e.ctype?Er.shapecommon(t,e):l}function G(e,t){return t=ue(e[0]),e=ue(e[1]),"list"===t.ctype&&"list"===e.ctype?wr.remove(t,e):"shape"===t.ctype&&"shape"===e.ctype?Er.shaperemove(t,e):l}function H(e,t){return t=ue(e[0]),e=ue(e[1]),"list"===t.ctype?wr.append(t,e):l}function J(e,t){return t=ue(e[0]),"list"===(e=ue(e[1])).ctype?wr.prepend(t,e):l}function Z(e,t){if(t|=0,0===(e|=0)&&0===t)return 0;for(;0!==t;){var r=e;e=t,t=r%t|0}return e}function Q(e){return 1===e?0:1}function K(e,t,r){var n=t*t-4*e*r;return 0<=n?(n=Math.sqrt(n),0<t&&(n=-n),t=[[n-t,2*e],[2*r,n-t]]):t=null,null===t?null:(e=t[0][0]/t[0][1],(t=t[1][0]/t[1][1])<e?[t,e]:[e,t])}function ee(e){return"image"===e.ctype?e.value:"string"===e.ctype&&Lt.hasOwnProperty(e.value)?Lt[e.value].value:null}function te(e,t,r,n,i){var a=[];if(e.readPixels)a=e.readPixels(t,r,n,i);else{if(e.img.getContext)var o=e.img.getContext("2d"),l=o.getImageData(t,r,n,i).data;else try{Fr||(Fr=document.createElement("canvas")),Fr.width=n,Fr.height=i,(o=Fr.getContext("2d")).drawImage(e.img,t,r,n,i,0,0,n,i),l=o.getImageData(0,0,n,i).data}catch(e){console.log(e)}for(var s in l)a.push(l[s]/255)}return a}function re(e){return e.replace(/[^A-Za-z0-9 \u0080-\uffff]/gi,"\\$&")}function ne(e,t,r){var n=e;return t&&(n=n+" at "+t.row+":"+t.col),r&&(n=n+": "+r+""),(n=Error(n)).name="CindyScriptParseError",n.description=e,n.location=t,n.text=r,n}function ie(e){this.input=e,this.re=new RegExp(tn,"g");for(var t=[],r=e.indexOf("\n")+1;r;)t.push(r),r=e.indexOf("\n",r)+1;t.push(e.length),this.bols=t,this.bol=this.pos=0,this.line=1}function ae(e){var t=e[e.length-2],r=e[e.length-3],n=e[e.length-1];if(r){if(r.isSuperscript&&t.precedence<=r.precedence)throw ne("Operator not allowed after superscript",t.start,t.text);if(n){if(!t.op.infix)throw ne("Operator may not be used infix",t.start,t.text)}else if(!t.op.postfix)throw ne("Operator may not be used postfix",t.start,t.text)}else if(n){if(!t.op.prefix)throw ne("Operator may not be used prefix",t.start,t.text)}else if(!t.op.bare)throw ne("Operator without operands",t.start,t.text);t.ctype="infix",t.oper=t.op.sym,t.args=[r,n],e.splice(e.length-3,3,t)}function oe(e,t,r,n){for(1&e.length||e.push(null),r=Jr[r];3<=e.length&&e[e.length-2].precedence<=r.precedence;)ae(e);e.push({op:r,precedence:r.precedence+(r.rassoc?1:0),start:t.start,end:t.end,text:t.text,rawtext:t.rawtext}),r="";for(var i=t.text,a=0;a<i.length;++a)r+="0123456789+-".charAt(n.indexOf(i.charAt(a)));t.ctype="number",t.value={real:+r,imag:0},e.push(t),ae(e)}function le(e,t){var r=[],n="}"===t;e:for(;;){var i=e.next();switch(i.toktype){case"OP":var a=Jr[i.text];for("_"!==a.sym||!r.length||1&r.length||"OP"!==r[r.length-1].toktype||":="!==r[r.length-1].op.sym||(r.pop(),a=Jr[":=_"],i.text=a.sym),i.op=a,i.precedence=a.precedence,1&r.length||r.push(null);3<=r.length&&r[r.length-2].precedence<=i.precedence;)ae(r);a.rassoc&&i.precedence++,n&&":"===a.sym&&(i.jsonatom=!0,i.precedence=Jr[","].precedence,n=!1),"}"===t&&","===a.sym&&0<r.length&&r[r.length-1].jsonatom&&(n=!0),r.push(i);break;case"ID":if(i.ctype="variable",i.name=i.text,1&r.length)throw ne("Missing operator",i.start,i.text);r.push(i);break;case"NUM":if(i.ctype="number",i.value={real:+i.text,imag:0},1&r.length)throw ne("Missing operator",i.start,i.text);r.push(i);break;case"STR":if(i.ctype="string",i.value=i.raw.substring(1,i.raw.length-1),1&r.length)throw ne("Missing operator",i.start,i.text);r.push(i);break;case"SUB":oe(r,i,"_","");break;case"SUP":oe(r,i,"^",""),r[r.length-1].isSuperscript=!0;break;case"BRA":if(a="[](){}||".indexOf(i.text),i.text===t||1&a)break e;var o=le(e,a="[](){}||".charAt(a+1)),l=o.closedBy;if(l.text!==a)throw ne("Opening "+i.text+" at "+i.start.row+":"+i.start.col+" closed by "+(l.text||"EOF")+" at "+l.start.row+":"+l.start.col);if(l=i.text+l.text,a=[],o=o.expr){for(;o&&"infix"===o.ctype&&","===o.oper;)a.push(o.args[0]),o=o.args[1];a.push(o)}if(1&r.length){if("{}"===l)throw ne("{} not yet defined for operators.",i.start);if("variable"!==(o=r[r.length-1]).ctype)throw ne("Function name must be an identifier",o.start);if(2<r.length&&r[r.length-2].precedence<Yr)throw ne("Function call in indexing construct must be enclosed in parentheses",i.start);o.ctype="function",i=o.args=[],l=o.modifs={};for(var s=0;s<a.length;++s){var u=a[s];if(u&&"infix"===u.ctype&&"->"===u.oper){var c=u.args[0];if("variable"!==c.ctype)throw ne("Modifier name must be an identifier",u.start);l[c.name]=u.args[1]}else i.push(u)}o.oper=o.name.toLowerCase()+"$"+o.args.length}else if("||"===l)if(1===a.length)r.push({ctype:"function",oper:"abs_infix",args:a,modifs:{}});else{if(2!==a.length)throw ne("Don't support || with "+a.length+" arguments",i.start);r.push({ctype:"function",oper:"dist_infix",args:a,modifs:{}})}else"{}"===l?r.push({ctype:"function",oper:"genJSON",args:a,modifs:{}}):"[]"!==l&&1===a.length?r.push({ctype:"paren",args:a}):0===a.length?r.push({ctype:"list",value:[]}):r.push({ctype:"function",oper:"genList",args:a,modifs:{}});break;case"EOF":break e}}for(1&r.length||r.push(null);3<=r.length;)ae(r);return{expr:r[0],closedBy:i}}function se(e){this.usedFunctions={},this.usedVariables={}}function ue(e){if(void 0===e)return l;if("infix"===e.ctype)return e.impl(e.args,{},e);if("variable"===e.ctype)return ue(Nr.getvar(e.name));if("function"===e.ctype)return ln.push(e),e=Er.evaluate(e.oper,e.args,e.modifs),ln.pop(),e;if("void"===e.ctype)return l;if("field"===e.ctype){var t=ue(e.obj);return"geo"===t.ctype?Ar.getField(t.value,e.key):"list"===t.ctype?wr.getField(t,e.key):"JSON"===t.ctype?Sr.getField(t,e.key):l}return"userdata"===e.ctype?(t=ue(e.obj),"_?_"===(e=Tr.string(E(ue(e.key)))).value&&(e=l),"geo"===t.ctype?Ar.getuserData(t.value,e):"list"===t.ctype||"string"===t.ctype?Ar.getuserData(t,e):l):e}function ce(e){if("geo"===(e=ue(e)).ctype){var t=e.value;if("P"===t.kind)return Ar.getField(t,"xy");if("V"===t.kind)return t.value}return e}function pe(e){if("geo"===(e=ue(e)).ctype){var t=e.value;if("P"===t.kind||"L"===t.kind)return Ar.getField(t,"homog")}return wr._helper.isNumberVecN(e,3)?e:wr._helper.isNumberVecN(e,2)?(t=wr.turnIntoCSList([e.value[0],e.value[1],yr.real(1)]),e.usage&&(t=Tr.withUsage(t,e.usage)),t):l}function fe(e){var t=new se;for(var r in t.usedFunctions=on,t.infixmap=Lr,e=t.parse(e),t.usedVariables)Nr.create(r);return e}function he(e){xt.err(e+ln.map((function(e){return"\n  at "+e.oper})).join("\n"))}function ve(){this._path=[],this._defs=["<defs>"],this._imgcache=[],this._body=[],this._saveStack=[""],this._clipIndex=0,this._stroke=this._fill="#000",this._strokeOpacity=this._fillOpacity=null,this.height=this.width=0,this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10,this.globalAlpha=1}function de(){this._body=[],this._yPos=this._xPos=NaN,this._extGState={Af255:"<< /ca 1 >>",As255:"<< /CA 1 >>"},this._objects=[["%PDF-1.4\n"]],this._offset=this._objects[0][0].length,this._nextIndex=5,this._imgcache=[],this._xobjects={},this._pathUsed=-1,this._fillAlpha=this._strokeAlpha=this._globalAlpha=1,this.height=this.width=0,this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10}function me(e,t){var r=e.width,n=e.height,i=document.createElement("canvas");i.setAttribute("width",r),i.setAttribute("height",n),i.setAttribute("style","display:none;");var a=ar.canvas;a.parentNode.insertBefore(i,a.nextSibling);try{return i.getContext("2d").drawImage(e,0,0,r,n),i.toDataURL(t||"image/png")}finally{i.parentNode.removeChild(i)}}function ge(e,t){var r;if(r=/^rgba\(([0-9.]+), *([0-9.]+), *([0-9.]+), *([0-9.]+)\)$/.exec(e))t(+r[1],+r[2],+r[3],+r[4]);else{if(!(r=/^rgb\(([0-9.]+), *([0-9.]+), *([0-9.]+)\)$/.exec(e)))throw Error("Can't handle color style "+e);t(+r[1],+r[2],+r[3],1)}}function ye(e,t,r){for(r||(r="0");e.length<t;)e=r+e;return e}function be(){null!==fn&&(window.URL.revokeObjectURL(fn),fn=null)}function Pe(e){!function(e){var t=1;Object.keys(Lt).forEach((function(r){var n=Lt[r].value.img;if(void 0===n.cachedDataURL&&n.src)if("data:"===n.src.substr(0,5))n.cachedDataURL=n.src;else{++t,n.cachedDataURL=null;var i=new XMLHttpRequest;i.responseType="blob",i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status){var r=new FileReader;r.onloadend=function(){n.cachedDataURL=r.result,console.log("Cached data for image "+n.src),0==--t&&e()},r.readAsDataURL(i.response)}else console.error("Failed to load "+n.src+": "+i.statusText),0==--t&&e()},i.open("GET",n.src,!0),i.send()}})),0==--t&&e()}((function(){var t=St;try{(St=new e).width=Mt,St.height=Tt,S();var r=St.toBlob();fn=window.URL.createObjectURL(r),vn(fn)}finally{St=t}}))}function xe(e){var t=null,r=1e6;console.log("getElementAtMouse");for(var n=0;n<It.gslp.length;n++){var i=It.gslp[n];if(!i.pinned&&!1!==i.visible&&!0!==i.tmp){var a=wn.drawingstate.matrix.sdet;if("P"===i.kind){var o=wr.normalizeZ(i.homog);if(!wr._helper.isAlmostReal(o))continue;var l=o.value[0].value.real-e.x,s=o.value[1].value.real-e.y,u=Math.sqrt(l*l+s*s);i.narrow&u>20/a&&(u=1e4)}else"C"===i.kind?(s=It.csnames[i.args[0]],u=0,void 0!==i.radius&&(u=i.radius.value.real),l=yr.div(s.homog.value[0],s.homog.value[2]).value.real,s=yr.div(s.homog.value[1],s.homog.value[2]).value.real,l-=e.x,s-=e.y,u=Math.sqrt(l*l+s*s)-u,s=l=0,0>u&&(u=-u),u+=30/a):"L"!==i.kind&&"S"!==i.kind||(l=i.homog,s=(u=yr).add(u.mult(l.value[0],u.conjugate(l.value[0])),u.mult(l.value[1],u.conjugate(l.value[1]))),s=wr.scaldiv(u.sqrt(s),l),u=s.value[0].value.real*e.x+s.value[1].value.real*e.y+s.value[2].value.real,l=s.value[0].value.real*u,s=s.value[1].value.real*u,0>u&&(u=-u),u+=1);if(u<r+.2/a){r=u,t=i;var c={x:l,y:s}}}}return null===t?null:{mover:t,offset:c,prev:{x:e.x,y:e.y}}}function Ce(){return"P"+yn++}function _e(e){var t=Pn[dn].actions;t[bn].event===e&&t[bn].do()&&(_(),bn===t.length-1?(mn=[],bn=gn=0):bn++)}function we(e){return e&&.5>Math.abs(e.offset.x)&&.5>Math.abs(e.offset.y)&&!e.mover.tmp}function Se(e){return we(e)&&"P"===e.mover.kind}function Me(e){return we(e)&&("L"===e.mover.kind||"S"===e.mover.kind)}function Te(e){sr={mover:e,offset:{x:0,y:0},prev:{x:ur.x,y:ur.y}}}function Ie(){var e=xe(ur);Se(e)?mn[gn]=e.mover:(mn[gn]={type:"Free",name:Ce(),labeled:!0,pos:[wt[0],wt[1],1]},$e(mn[gn])),gn++}function Le(){var e=xe(ur);return!!Me(e)&&(mn[gn]=e.mover,gn++,!0)}function Oe(){var e,t=xe(ur);return(e=Me(t))||(e=we(t)&&"C"===t.mover.kind),!!e&&(mn[gn]=t.mover,gn++,!0)}function Ee(){var e=xe(ur);if(Se(e))for(hn.args[1]=e.mover.name,e=0;e<It.gslp.length;e++){var t=It.gslp[e];!0===t.tmp&&Fe(t.name)}else for(e=0;e<It.gslp.length;e++)!0===(t=It.gslp[e]).tmp&&(t.tmp=!1)}function Ne(e){var t={type:"Free",name:Ce(),labeled:!0,pos:[wt[0],wt[1],1],tmp:!0};t=$e(t),hn=$e({type:e,name:Ce(),labeled:!0,args:[mn[0].name,t.name]}),Te(t)}function Ae(e){void 0===e.tracedim&&(e.tracedim=1),void 0===e.tracelength&&(e.tracelength=100),void 0===e.traceskip&&(e.traceskip=1),e._traces=Array(e.tracelength),e._traces_index=0,e._traces_tick=0}function ke(e){void 0===e.size&&(e.size=Sn.pointSize),e.size=yr.real(e.size),!e.movable||e.pinned?(e.color=wr.realVector(e.color||Sn.pointColor),e.color=wr.scalmult(yr.real(Sn.dimDependent),e.color)):e.color=wr.realVector(e.color||Sn.pointColor),void 0===e.alpha&&(e.alpha=Sn.alpha),e.alpha=yr.real(e.alpha),"boolean"!=typeof e.noborder&&(e.noborder=Sn.noborder),e.noborder=Tr.bool(e.noborder),"boolean"!=typeof e.border&&(e.border=!Sn.noborder),e.border=Tr.bool(e.border),e.drawtrace&&Ae(e)}function ze(e){void 0===e.size&&(e.size=Sn.lineSize),e.size=yr.real(e.size),e.color=wr.realVector(e.color||Sn.lineColor),void 0===e.alpha&&(e.alpha=Sn.alpha),e.alpha=yr.real(e.alpha),e.clip=Tr.string(e.clip||Sn.clip),void 0===e.overhang&&(e.overhang=Sn.overhangLine),e.overhang=yr.real(e.overhang),e.dashtype&&(e.dashtype=Tr.wrap(e.dashtype))}function je(e){void 0===e.overhang&&(e.overhang=Sn.overhangSeg),e.arrow&&(e.arrow=Tr.bool(e.arrow)),e.arrowsize&&(e.arrowsize=yr.real(e.arrowsize)),e.arrowposition&&(e.arrowposition=yr.real(e.arrowposition)),e.arrowshape&&(e.arrowshape=Tr.string(e.arrowshape)),e.arrowsides&&(e.arrowsides=Tr.string(e.arrowsides)),ze(e),e.clip=Tr.string("end")}function Re(e){e.size=void 0!==e.textsize?e.textsize:void 0!==e.size?e.size:Sn.textsize,e.size=yr.real(+e.size)}function De(e){e.filled=void 0!==e.filled?Tr.bool(e.filled):Tr.bool(!0),e.fillcolor=void 0===e.fillcolor?l:wr.realVector(e.fillcolor),void 0===e.fillalpha&&(e.fillalpha=0),e.fillalpha=yr.real(e.fillalpha),ze(e)}function $e(e,t){return e=Be(e),dt(),"boolean"==typeof t&&t&&e.Duplicate?(t=e.Duplicate,console.log("duplication detected: removing "+e.name+" (type "+e.kind+") (duplicate of "+t.name+")."),Fe(e.name),t):e}function Be(e){if(void 0!==It.csnames[e.name]){console.log("Element name '"+e.name+"' already exists");var t=It.csnames[e.name];return qn[t.type].isMovable&&"P"===qn[t.type].kind&&Je(t,e.pos,"homog"),t}for(;Un.hasOwnProperty(e.type);)e.type=Un[e.type];if(t=Wn[e.type]){var r=t(e),n=null;for(t=0;t<r.length;++t)n=$e(r[t]);return n}var i=qn[e.type];if(r=!1,!i)return console.error(e),console.error("Operation "+e.type+" not implemented yet"),null;if("**"!==i.signature)if(Array.isArray(i.signature)||"*"!==i.signature.charAt(1)){if(i.signature.length!==(e.args?e.args.length:0))return console.error("Wrong number of arguments for "+e.name+" of type "+e.type),"undefined"!=typeof window&&window.alert("Wrong number of arguments for "+e.name),null}else r=!0,e.args.forEach((function(t){if(It.csnames[t].kind!==i.signature.charAt(0))return console.error("Not all elements in set are of same type: "+e.name+" expects "+i.signature+" but "+t+" is of kind "+It.csnames[t].kind),"undefined"!=typeof window&&window.alert("Not all elements in set are of same type: "+e.name),null}));if(e.args)for(t=0;t<e.args.length;++t){if(!It.csnames.hasOwnProperty(e.args[t]))return console.log("Dropping "+e.name+" due to missing argument "+e.args[t]),null;if("**"!==i.signature&&!r&&(n=It.csnames[e.args[t]].kind,i.signature[t]!==n&&("S"!==n||"L"!==i.signature[t])))return window.alert("Wrong argument kind "+n+" as argument "+t+" to element "+e.name+" of type "+e.type),null}i.signatureConstraints&&!i.signatureConstraints(e)&&window.alert("signature constraints violated for element "+e.name),It.gslp.push(e),It.csnames[e.name]=e,t=Dn.length,e.kind=i.kind,e.stateIdx=t,t+=i.stateSize,e.incidences=[],e.isshowing=!0,e.movable=!1,i.isMovable&&(e.movable=!0,It.free.push(e)),"P"===e.kind&&(It.points.push(e),ke(e)),"L"===e.kind&&(It.lines.push(e),ze(e)),"C"===e.kind&&(It.conics.push(e),ze(e)),"S"===e.kind&&(It.lines.push(e),je(e)),"Text"===e.kind&&(It.texts.push(e),Re(e)),"Poly"===e.kind&&(It.polygons.push(e),De(e)),"IFS"===e.kind&&It.ifs.push(e),/^[P|L|S|C]s$/.test(e.kind)&&It.sets[{P:"points",L:"lines",S:"lines",C:"conics"}[e.kind[0]]].push(e),function(e){if(e!==Dn.length){var t,r=In.length;if(Ln.length<e*r){var n=2*e;Ln=new Float64Array(r*n)}else n=Ln.length/r|0;for(t=0;t<r;++t)On[In[t]]=Ln.subarray(t*n,t*n+e);e=Dn,jn=On.in,Rn=On.out,(Dn=On.good).set(e)}}(t),jn=Rn=Dn,An=!0,i.initialize&&(En=Nn=e.stateIdx,e.param=i.initialize(e),Ue(Nn===e.stateIdx+i.stateSize,"State fully initialized")),En=Nn=e.stateIdx,i.updatePosition(e,!1),Ue(En===e.stateIdx+i.stateSize,"State fully consumed"),Ue(Nn===e.stateIdx+i.stateSize,"State fully updated"),An=!1,(jn=On.in).set(Dn),Rn=On.out,Ye(e,i),Mn={};try{ut(e),ct(e)}catch(e){console.error(e)}return It.csnames[e.name]}function Fe(e){if(It.csnames.hasOwnProperty(e)){var t={};Object.keys(It.csnames).forEach((function(e){var r=It.csnames[e];r.hasOwnProperty("args")&&r.args.forEach((function(r){t.hasOwnProperty(r)||(t[r]={}),t[r][e]=!0}))}));var r=function(e,n){if(n[e]=!0,!t.hasOwnProperty(e))return n;for(var i in t[e])n[i]||r(i,n);return n};(function(e){var t=Object.keys(e),r=function(e,t){return function(t){return!e[t.name]}},n={};for(var i in t.forEach((function(t){It.csnames[t].incidences.forEach((function(t){n[t]||(It.csnames[t].incidences=It.csnames[t].incidences.filter((function(t){return!e[t]})),n[t]=!0)}))})),"conics free gslp ifs lines points polygons texts".split(" ").map((function(t){It[t]=It[t].filter(r(e,t))})),It.sets)It.sets[i]=It.sets[i].filter(r(e,"set of "+i));t.forEach((function(e){delete It.csnames[e]})),Mn={}})(e=r(e,{}))}else console.log("removeElement: name "+e+"does not exist.")}function Xe(e,t){var r=It.csnames[t.args[0]].homog,n=It.csnames[t.args[1]].homog;t=e.homog,e=yr.div(r.value[0],r.value[2]),r=yr.div(r.value[1],r.value[2]);var i=yr.div(n.value[0],n.value[2]);n=yr.div(n.value[1],n.value[2]);var a=yr.div(t.value[0],t.value[2]);return t=yr.div(t.value[1],t.value[2]),!!(yr._helper.isAlmostReal(e)&&yr._helper.isAlmostReal(r)&&yr._helper.isAlmostReal(i)&&yr._helper.isAlmostReal(n)&&yr._helper.isAlmostReal(a)&&yr._helper.isAlmostReal(t))&&(e=e.value.real,r=r.value.real,i=i.value.real,n=n.value.real,a=a.value.real,t=t.value.real,1e-15>(e=Math.sqrt((e-i)*(e-i)+(r-n)*(r-n))-Math.sqrt((e-a)*(e-a)+(r-t)*(r-t))-Math.sqrt((i-a)*(i-a)+(n-t)*(n-t)))*e)}function Ye(e,t){if(e.isshowing=!0,e.args)for(var r=0;r<e.args.length;r++)if(!It.csnames[e.args[r]].isshowing)return void(e.isshowing=!1);t.visiblecheck&&t.visiblecheck(e)}function qe(e,t,r,n,i){var a=e.textsize||Sn.textsize,o=!0===e.textbold,l=!0===e.textitalics,s=e.text_fontfamily||Sn.fontFamily,u=n.x*n.x+n.y*n.y,c=1;0<u&&(c=1+e.size.value.real/Math.sqrt(u)),e=e.alpha||yr.real(Sn.alpha),Er.drawtext([r,Tr.wrap(t)],{x_offset:Tr.wrap(c*n.x),y_offset:Tr.wrap(c*n.y),size:Tr.wrap(a),bold:Tr.wrap(o),italics:Tr.wrap(l),family:Tr.wrap(s),color:i,alpha:e})}function Ve(e){if(e._bbox=null,e.isshowing&&!1!==e.visible){var t={size:e.size},r=e.homog,n=e.text,i=qn[e.type].getText;if(n=i?i(e):n.replace(/@[$#]"([^"\\]|\\.)*"/g,(function(e){try{var t=JSON.parse(e.substring(2)),r=It.csnames[t];if(!r)return"?"}catch(e){return"?"}switch(e.charAt(1)){case"$":return r.printname||t;case"#":return"V"!==r.kind?"?":E(r.value)}})),i=null,e.html){var a=e._textCache||{text:!1},o=e.html,l=o.parentNode,s=l.parentNode;i=function(t,r,n,i,u){r/=Gt,n/=Gt,u=pn.bold+pn.italics+Math.round(u/Gt*10)/10+"px "+pn.family,a.invisible&&s.style.removeProperty("display"),t===a.text&&u===a.font&&r===a.x&&n===a.y&&i===a.align||(u!==a.font&&(o.style.font=u,o.style.lineHeight=Sn.lineHeight),t!==a.text&&!1!==t&&!1===Br(o,t,u)&&(t=!1),s.style.left=r+"px",s.style.top=n+"px",(i||l.style.transform)&&(l.style.transform="translateX("+-100*i+"%)"),e._textCache={text:t,font:u,x:r,y:n,align:i})}}n=Tr.string(n),e.dock&&(e.dock.to?r=It.csnames[e.dock.to].homog:Tn.hasOwnProperty(e.dock.corner)&&(r=(r=Or.screenbounds$0([],{})).value[Tn[e.dock.corner]]),t.offset=e.dock.offset),e.align&&(t.align=Tr.string(e.align)),r&&(e._bbox=Er.drawtext([r,n],t,i))}else e.html&&(e.html.parentNode.parentNode.style.display="none",e._textCache={invisible:!0})}function Ue(e,t){if(t="Assertion failed: "+t,!e)throw console.log(t),d(),"undefined"!=typeof alert&&alert(t),Error(t)}function We(){Dn.set(jn),kn=!1,Ke(!1);for(var e=Dn.length,t=Math.abs,r=0;r<e;r+=2)t(Dn[r])>1e12*t(Dn[r+1])&&(Dn[r+1]=0)}function Ge(){if(!zn)throw Bn;kn=!0}function He(e,t,r,n,i){return Tr.add(n,Tr.mult(r,Tr.sub(i,n)))}function Je(e,t,r){Ze(e,t,r),$n||kn||We()}function Ze(e,t,r){Xn&&Xn.currentMouseAndScripts&&(Xn.currentMover=[]),e===Fn?(jn.set(Dn),kn=!1):(Fn=e,We()),Rn.set(jn);var n,i=1e4,a=Mn[e.name];if(!a){var o={},l=0;a=[],o[e.name]=e;for(var s=It.gslp,u=0;u<s.length;++u){var c=s[u],p=c.args;if(p)for(var f=0;f<p.length;++f)o.hasOwnProperty(p[f])&&(o[c.name]=c,a[l++]=c)}Mn[e.name]=a}for(o=-1,l=.9,u=(s=qn[e.type]).parameterPath||He,En=e.stateIdx,c=s.getParamFromState(e),En=Nn=e.stateIdx,p=s.getParamForInput(e,t,r),f=o+l;o!==f;){var h=f*f,v=.5/(1+h);v=yr.complex(2*f*v+.5,(1-h)*v),zn=o+.5*l<=o||0===i,0===i&&console.log("tracing limit Reached"),h=!1,Xn&&Xn.currentMouseAndScripts&&(Xn.currentStep=[]);try{En=Nn=e.stateIdx;var d=u(e,f,v,c,p);for(Xn&&(Xn.currentParam=d),v=Rn,Rn=jn,s.putParamToState(e,d),Rn=v,Nn=e.stateIdx,Xn&&(Xn.currentElement=e),s.updatePosition(e,!0),Ue(En===e.stateIdx+s.stateSize,"State fully consumed"),Ue(Nn===e.stateIdx+s.stateSize,"State fully updated"),n=0;n<a.length;++n){var m=a[n],g=qn[m.type];En=Nn=m.stateIdx,Xn&&(Xn.currentElement=m),g.updatePosition(m,!1),Ue(En===m.stateIdx+g.stateSize,"State fully consumed"),Ue(Nn===m.stateIdx+g.stateSize,"State fully updated")}Xn&&(Xn.currentElement=null),o=f,1<=(f+=l*=1.25)&&(f=1),Rn=jn,jn=v}catch(e){if(e!==Bn)throw e;f=o+(l*=.5),--i,h=!0}Xn&&Xn.currentMouseAndScripts&&(Xn.currentMover.push(wr.turnIntoCSList([wr.turnIntoCSList(Xn.currentStep),Tr.wrap(h),Tr.wrap(o),Tr.wrap(f),Tr.wrap(Xn.currentParam)])),Xn.currentStep=null,Xn.currentParam=null)}for(Ke(kn),n=0;n<a.length;++n)Ye(m=a[n],g=qn[m.type]);Xn&&Xn.currentMouseAndScripts&&(Xn.currentMouseAndScripts.push(wr.turnIntoCSList([wr.turnIntoCSList(Xn.currentMover),Tr.wrap(kn),Tr.wrap(e.name),t,Tr.wrap(r),c,p])),Xn.currentMover=null)}function Qe(){We(),zn=!0;for(var e=It.gslp,t=0;t<e.length;t++){var r=e[t],n=qn[r.type];En=Nn=r.stateIdx,n.updatePosition(r,!1),Ye(r,n)}e=Rn,Rn=jn,jn=e,We()}function Ke(t){var r=e.tracingStateReport;"string"==typeof r&&(document.getElementById(r).textContent=t?"BAD":"GOOD")}function et(){var e=En;return En+=2,yr.complex(jn[e],jn[e+1])}function tt(e){for(var t=Array(e),r=0;r<e;++r)t[r]=et();return wr.turnIntoCSList(t)}function rt(e){Rn[Nn]=e.value.real,Rn[Nn+1]=e.value.imag,Nn+=2}function nt(e){for(var t=0,r=e.value.length;t<r;++t)rt(e.value[t])}function it(e,t){return nt((e=at(e,t,tt(3),tt(3)))[0]),nt(e[1]),wr.turnIntoCSList(e)}function at(e,t,r,n){if(An)return[e,t];var i=wr.projectiveDistMinScal(r,e),a=wr.projectiveDistMinScal(r,t),o=wr.projectiveDistMinScal(n,e),s=wr.projectiveDistMinScal(n,t),u=wr.projectiveDistMinScal(r,n),c=wr.projectiveDistMinScal(e,t),p=i+s,f=a+o;if(p>f){var h=[t,e];p=f}else h=[e,t];if(f=function(){},Xn&&Xn.currentStep){var v=[Xn.labelTracing2,Tr.wrap(Xn.currentElement.name),wr.turnIntoCSList(h),wr.turnIntoCSList([r,n]),wr.realMatrix([[i,a],[o,s]]),Tr.wrap(p),Tr.wrap(u),Tr.wrap(c),l];Xn.currentStep.push(wr.turnIntoCSList(v)),f=function(e){Xn.hasOwnProperty(e)||(Xn[e]=Tr.wrap(e)),v[v.length-1]=Xn[e]}}return wr._helper.isNaN(e)||wr._helper.isNaN(t)?(f("Tracing failed due to NaNs."),kn=!0):u>3*p&&c>3*p?f("Normal case, everything all right."):1e-5>c?1e-5>u?f("Staying inside singularity."):(f("Moved into singularity."),kn=!0):1e-5>u?f("Moved out of singularity."):(f(zn?"Reached refinement limit, giving up.":"Need to refine."),Ge()),h}function ot(e,t,r,n){return e=function(e,t,r,n,i,a,o,s){var u=function(){};if(i=[i,a,o,s],e=[e,t,r,n],An)return e;for(a=0,n=Array(4),r=0;4>r;r++)for(n[r]=Array(4),s=0;4>s;s++)o=wr.projectiveDistMinScal(i[r],e[s]),n[r][s]=o;for(o=q(n),t=Array(4),r=0;4>r;++r)t[r]=e[o[r]],a+=n[r][o[r]];var c=1*a,p=1/0,f=1/0;for(r=0;4>r;r++){if(wr._helper.isNaN(e[r]))return u("Tracing failed due to NaNs."),kn=!0,t;for(s=r+1;4>s;s++)p>(o=wr.projectiveDistMinScal(i[r],i[s]))&&(p=o),f>(o=wr.projectiveDistMinScal(t[r],t[s]))&&(f=o)}if(Xn&&Xn.currentStep){var h=[Xn.labelTracing4,Tr.wrap(Xn.currentElement.name),wr.turnIntoCSList(t),wr.turnIntoCSList(i),wr.realMatrix(n),Tr.wrap(a),Tr.wrap(p),Tr.wrap(f),l];Xn.currentStep.push(wr.turnIntoCSList(h)),u=function(e){Xn.hasOwnProperty(e)||(Xn[e]=Tr.wrap(e)),h[h.length-1]=Xn[e]}}return p>c&&f>c||(1e-5>f?1e-5>p?u("Staying inside singularity."):(u("Moved into singularity."),kn=!0):1e-5>p?u("Moved out of singularity."):(u(zn?"Reached refinement limit, giving up.":"Need to refine."),Ge())),t}(e,t,r,n,tt(3),tt(3),tt(3),tt(3)),nt(e[0]),nt(e[1]),nt(e[2]),nt(e[3]),wr.turnIntoCSList(e)}function lt(e){var t,r,n=e.length;if(An){for(t=0;t<n;++t)En+=2*e[t].value.length,nt(e[t]);return e}var i=Array(n),a=Array(n),o=Array(n),s=99,u=99,c=Array(n);for(t=0;t<n;++t)i[t]=tt(e[t].value.length),a[t]=wr.normSquared(i[t]).value.real,o[t]=wr.normSquared(e[t]).value.real,c[t]=Array(n);for(t=0;t<n;++t){for(r=0;r<n;++r){var p=wr.sesquilinearproduct(i[t],e[r]).value;p=(p.real*p.real+p.imag*p.imag)/(a[t]*o[r]),c[t][r]=1-p}for(r=t+1;r<n;++r)s>1-(p=((p=wr.sesquilinearproduct(i[t],i[r]).value).real*p.real+p.imag*p.imag)/(a[t]*a[r]))&&(s=1-p),u>1-(p=((p=wr.sesquilinearproduct(e[t],e[r]).value).real*p.real+p.imag*p.imag)/(o[t]*o[r]))&&(u=1-p)}for(p=q(c),r=Array(n),a=0,o=!1,t=0;t<n;++t){a+=c[t][p[t]];var f=r[t]=e[p[t]];nt(f),o|=wr._helper.isNaN(f)}if(o|=isNaN(a),e=function(){},Xn&&Xn.currentStep){var h=[Xn.labelTracingSesq,Tr.wrap(Xn.currentElement.name),wr.turnIntoCSList(r),wr.turnIntoCSList(i),wr.realMatrix(c),Tr.wrap(a),Tr.wrap(s),Tr.wrap(u),l];Xn.currentStep.push(wr.turnIntoCSList(h)),e=function(e){Xn.hasOwnProperty(e)||(Xn[e]=Tr.wrap(e)),h[h.length-1]=Xn[e]}}return o?(e("Tracing failed due to NaNs."),kn=!0):s>3*a&&u>3*a?e("Normal case, everything all right."):1e-5>u?1e-5>s?e("Staying inside singularity."):(e("Moved into singularity."),kn=!0):1e-5>s?e("Moved out of singularity."):(e(zn?"Reached refinement limit, giving up.":"Need to refine."),Ge()),r}function st(e,t){return nt((t=at(e=qn._helper.flattenConicMatrix(e),t=qn._helper.flattenConicMatrix(t),tt(6),tt(6)))[0]),nt(t[1]),e=qn._helper.buildConicMatrix(t[0].value),t=qn._helper.buildConicMatrix(t[1].value),wr.turnIntoCSList([e,t])}function ut(e){ut.hasOwnProperty(e.kind)&&ut[e.kind](e)}function ct(e){ct.hasOwnProperty(e.kind)&&(e.incidences=[],ct[e.kind](e))}function pt(e,t){return function(){e.incidences.push(t.name),t.incidences.push(e.name)}}function ft(e,t){return function(){e.Duplicate=t}}function ht(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return"point "+e.name+" incident line "+t.name},apply:pt(e,t),holds:function(){var r=wr.scaldiv(wr.abs(e.homog),e.homog),n=wr.scaldiv(wr.abs(t.homog),t.homog);return yr.abs(wr.scalproduct(r,n)).value.real<yr.epsbig}}}function vt(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return"point "+e.name+" incident conic "+t.name},apply:pt(e,t),holds:function(){var r=Tr.mult(t.matrix,e.homog);return r=Tr.mult(e.homog,r),(r=yr.abs(r)).value.real<yr.epsbig}}}function dt(){if(0!==Yn.length){On.prover.set(jn);var e,t=function(){e={},Yn.forEach((function(t){t.getInvolved().forEach((function(t){e[t.name]||(e[t.name]=!0,r(t,{}).forEach((function(t){e[t]=!0})))}))}))},r=function(e,t){return e.incidences.forEach((function(e){t[e]||(t[e]=!0,r(It.csnames[e],t))})),Object.keys(t)};t();var n=function(e){return e.holds()};Object.keys(e).forEach((function(t){void 0!==(t=It.csnames[t].args)&&t.forEach((function(t){e[t]=!0}))}));for(var i,a=0;3>a;a++){for(var o in e){var l=It.csnames[o];!l.pinned&&qn[l.type].isMovable&&(Je(l,(i=qn[l.type].getRandomMove(l)).value,i.type),Yn=Yn.filter(n))}t()}for(jn.set(On.prover),Qe(),t=0;t<Yn.length;++t)Yn[t].apply();Yn=[]}}function mt(t,r,n){var i=document.createElement("div"),a=document.createElement("img");a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAPoCAQAAAC1v1zVAAAAGklEQVR42u3BMQEAAADCoPVPbQ0PoAAAgHcDC7gAAVI8ZnwAAAAASUVORK5CYII=",i.className="CindyJS-baseline",i.appendChild(a),(a=document.createElement("div")).className="CindyJS-button",i.appendChild(a);for(var o=2;o<arguments.length;++o)a.appendChild(arguments[o]);if(Ct.parentNode.appendChild(i),t.html=arguments[arguments.length-1],Ht(t.fillalpha)||(t.fillalpha=1),t.fillcolor&&(t.html.style.backgroundColor=pn.makeColor(t.fillcolor,t.fillalpha)),Ht(t.alpha)||(t.alpha=1),t.color&&(t.html.style.color=pn.makeColor(t.color,t.alpha)),i=_,t.script){var l=fe(t.script);i=function(){ue(l),_()}}n.addEventListener(r,i),!e.keylistener&&(Et.keydown||Et.keyup||Et.keytyped)&&(n.addEventListener("keydown",(function(e){9!==e.keyCode&&M(e,Et.keydown)})),n.addEventListener("keyup",(function(e){M(e,Et.keyup)})),n.addEventListener("keypress",(function(e){9!==e.keyCode&&M(e,Et.keytyped)}))),qn.Text.initialize(t)}function gt(){}function yt(e){var t={},r={pinned:!1,movable:!0};if("P"===e.kind&&ke(r),"L"===e.kind&&ze(r),"C"===e.kind&&ze(r),"S"===e.kind&&je(r),"Text"===e.kind&&Re(r),"Poly"===e.kind&&De(r),Gn.forEach((function(n){if(e.hasOwnProperty(n)){var i=Tr.unwrap(e[n]),a=Tr.unwrap(r[n]);null!=i&&i!==a&&JSON.stringify(i)!==JSON.stringify(a)&&(t[n]=i)}})),"P"===e.kind&&(!e.movable||e.pinned)&&t.color){var n=yr.real(1/Sn.dimDependent);t.color=Tr.unwrap(wr.scalmult(n,e.color))}return(n=function(e){if(!/^Select/.test(e.type)&&!qn[e.type].isMovable)return null;var t=Tr.unwrap,r=yr.add;switch(e.kind){case"P":case"L":case"Text":return t(e.homog);case"C":return{xx:t((e=e.matrix.value)[0].value[0]),yy:t(e[1].value[1]),zz:t(e[2].value[2]),xy:t(r(e[0].value[1],e[1].value[0])),xz:t(r(e[0].value[2],e[2].value[0])),yz:t(r(e[1].value[2],e[2].value[1]))};default:return null}}(e))&&(t.pos=n),e.dock&&(t.dock=function(e){var t={};return t.offset=Tr.unwrap(e.offset),e.to&&(t.to=e.to),e.corner&&(t.corner=e.corner),t}(e.dock)),t}function bt(){var e=[];return It.gslp.forEach((function(t){t.tmp||e.push(yt(t))})),e}function Pt(e){ni=0!==e.length,Hn=[],ti=[],ri=[],ii.Environment.init({}),e.forEach((function(e){e.behavior?(e.name&&(e.behavior.geo=[e.name]),(e=e.behavior).gravity&&(e.gravity=-e.gravity)):t=e.geo;var t=(e.geo||[]).map((function(e){return It.csnames[e]})),r=t[0],n=ii[e.type];n?(n.init&&n.init(e,r,t),r&&(r.behavior=e,"Mass"===e.type?ti.push(r):"Spring"===e.type&&ri.push(r)),Hn.push(e)):(console.error(e),console.error("Behavior "+e.type+" not implemented yet"))}))}var xt,Ct,_t,wt,St,Mt,Tt,It,Lt,Ot=this,Et={},Nt=!1,At=!0,kt=0,zt=.5,jt=0,Rt=10,Dt=5/360,$t=.04608,Bt=1,Ft=0,Xt=0,Yt=!1,qt=.2,Vt=!1,Ut=0,Wt=0,Gt=1,Ht=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},Jt=l,Zt=l,Qt={play:gt,pause:gt,stop:gt},Kt=null,er=function(e,t){var r=[];er=function(e,t){r.push({img:e,id:t})},er(e,t);var n=Ot.getBaseDir()+"images/Icons.svg",i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200!==i.status)console.error("Failed to load CindyJS Icons.svg from "+n+": "+i.statusText);else{var e,t=i.responseXML,a=t.documentElement,o={};for(e=a.firstChild;e;e=l){var l=e.nextSibling;e.nodeType===Node.ELEMENT_NODE&&"http://www.w3.org/2000/svg"===e.namespaceURI&&"g"===e.localName.toLowerCase()&&(a.removeChild(e),e.setAttribute("style","display:inline"),o[e.getAttribute("id")]=e)}var s=new XMLSerializer;er=function(e,r){if(o.hasOwnProperty(r)){r=o[r],a.appendChild(r);try{var n=s.serializeToString(t)}finally{a.removeChild(r)}e.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(n)}},r.forEach((function(e){er(e.img,e.id)})),r=null}},i.responseType="document",i.open("GET",n),i.send()},tr=1,rr=null,nr=[],ir=!1,ar={config:e,startup:i,shutdown:d,evokeCS:function(e){ue(e=fe(e)),_()},play:f,pause:h,stop:v,evalcs:function(e){return ue(fe(e))},parse:function(e){return fe(e)},niceprint:E,canvas:null},or=!1,lr=0;e.use&&e.use.forEach((function(t){var r=null;e.plugins&&(r=e.plugins[t]),r||(r=Ot._pluginRegistry[t]),r||(++lr,console.log("Loading script for plugin "+t),Ot.loadScript(t+"-plugin",t+"-plugin.js",(function(){console.log("Successfully loaded plugin "+t),0==--lr&&or&&i()}),(function(){console.error("Failed to auto-load plugin "+t),0==--lr&&or&&i()})))})),g.prototype=new m,y.prototype=new m,b.prototype=new m;var sr,ur={},cr="",pr=0,fr=0,hr={},vr={},dr=e.isNode?process.nextTick:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,0)},mr=null,gr=[0,8,7,501,"g131b593"],yr={_helper:{}};yr._helper.roundingfactor=1e4,yr._helper.angleroundingfactor=10,yr._helper.niceround=function(e,t){return Math.round(e*t)/t},yr.niceprint=function(e,t){if(t=t||yr._helper.roundingfactor,"Angle"===e.usage)return yr._helper.niceangle(e);var r=yr._helper.niceround(e.value.real,t);return 0===(e=yr._helper.niceround(e.value.imag,t))?""+r:0<e?r+" + i*"+e:r+" - i*"+-e};var br=e.angleUnit||"",Pr=br.replace(/\s+/g,""),xr=2*Math.PI,Cr=1/xr,_r={rad:xr,"":360,deg:360,degree:360,gra:400,grad:400,turn:1,cyc:1,rev:1,rot:1,"":2,pi:2,quad:4};yr._helper.niceangle=function(e){var t=_r[Pr];return t?"function"==typeof t?t(e):-1===(e=yr.niceprint(yr.realmult(t*Cr,e),200<t?yr._helper.angleroundingfactor:null)).indexOf("i*")?e+br:"("+e+")"+br:yr.niceprint(Tr.withUsage(e,null))},yr.complex=function(e,t){return{ctype:"number",value:{real:e,imag:t}}},yr.real=function(e){return{ctype:"number",value:{real:e,imag:0}}},yr.zero=yr.real(0),yr.one=yr.real(1),yr.infinity=yr.complex(1/0,1/0),yr.nan=yr.complex(NaN,NaN),yr._helper.input=function(e){return"object"==typeof e?yr.complex(+e.r,+e.i):yr.real(+e)},yr.argmax=function(e,t){return e.value.real*e.value.real+e.value.imag*e.value.imag<t.value.real*t.value.real+t.value.imag*t.value.imag?t:e},yr.max=function(e,t){return{ctype:"number",value:{real:Math.max(e.value.real,t.value.real),imag:Math.max(e.value.imag,t.value.imag)}}},yr.min=function(e,t){return{ctype:"number",value:{real:Math.min(e.value.real,t.value.real),imag:Math.min(e.value.imag,t.value.imag)}}},yr.add=function(e,t){return{ctype:"number",value:{real:e.value.real+t.value.real,imag:e.value.imag+t.value.imag}}},yr.sub=function(e,t){return{ctype:"number",value:{real:e.value.real-t.value.real,imag:e.value.imag-t.value.imag}}},yr.neg=function(e){return{ctype:"number",value:{real:-e.value.real,imag:-e.value.imag}}},yr.re=function(e){return{ctype:"number",value:{real:e.value.real,imag:0}}},yr.im=function(e){return{ctype:"number",value:{real:e.value.imag,imag:0}}},yr.conjugate=function(e){return{ctype:"number",value:{real:e.value.real,imag:-e.value.imag}}},yr.round=function(e){return{ctype:"number",value:{real:Math.round(e.value.real),imag:Math.round(e.value.imag)}}},yr.ceil=function(e){return{ctype:"number",value:{real:Math.ceil(e.value.real),imag:Math.ceil(e.value.imag)}}},yr.floor=function(e){return{ctype:"number",value:{real:Math.floor(e.value.real),imag:Math.floor(e.value.imag)}}},yr.mult=function(e,t){return{ctype:"number",value:{real:e.value.real*t.value.real-e.value.imag*t.value.imag,imag:e.value.real*t.value.imag+e.value.imag*t.value.real}}},yr.realmult=function(e,t){return{ctype:"number",value:{real:e*t.value.real,imag:e*t.value.imag}}},yr.multiMult=function(e){var t=e[0];if("number"!==t.ctype)return l;for(var r=1;r<e.length;r++){if("number"!==e[r].ctype)return l;t=yr.mult(t,e[r])}return t},yr.abs2=function(e){return{ctype:"number",value:{real:e.value.real*e.value.real+e.value.imag*e.value.imag,imag:0}}},yr.abs=function(e){return yr.sqrt(yr.abs2(e))},yr.inv=function(e){var t=e.value.real*e.value.real+e.value.imag*e.value.imag;return{ctype:"number",value:{real:e.value.real/t,imag:-e.value.imag/t}}},yr.div=function(e,t){var r=e.value.real;e=e.value.imag;var n=t.value.real,i=n*n+(t=t.value.imag)*t;return{ctype:"number",value:{real:(r*n+e*t)/i,imag:(e*n-r*t)/i}}},yr.eps=1e-10,yr.epsbig=1e-6,yr.snap=function(e){var t=e.value.real;return e=e.value.imag,Math.floor(t+yr.eps)!==Math.floor(t-yr.eps)&&(t=Math.round(t)),Math.floor(e+yr.eps)!==Math.floor(e-yr.eps)&&(e=Math.round(e)),{ctype:"number",value:{real:t,imag:e}}},yr.exp=function(e){var t=Math.exp(e.value.real);return{ctype:"number",value:{real:t*Math.cos(e.value.imag),imag:t*Math.sin(e.value.imag)}}},yr.cos=function(e){var t=e.value.real;e=e.value.imag;var r=Math.exp(e),n=r*Math.sin(-t);return{ctype:"number",value:{real:(r*Math.cos(-t)+(r=Math.exp(-e))*Math.cos(t))/2,imag:(n+r*Math.sin(t))/2}}},yr.sin=function(e){var t=e.value.real;e=e.value.imag;var r=Math.exp(e),n=r*Math.sin(-t),i=r*Math.cos(-t);return{ctype:"number",value:{real:-(n-(r=Math.exp(-e))*Math.sin(t))/2,imag:(i-r*Math.cos(t))/2}}},yr.tan=function(e){var t=yr.sin(e);return e=yr.cos(e),yr.div(t,e)},yr.arccos=function(e){var t=yr.mult(e,yr.neg(e));return t=yr.sqrt(yr.add(yr.real(1),t)),e=yr.add(yr.mult(e,yr.complex(0,1)),t),e=yr.add(yr.mult(yr.log(e),yr.complex(0,1)),yr.real(.5*Math.PI)),Tr.withUsage(e,"Angle")},yr.arcsin=function(e){var t=yr.mult(e,yr.neg(e));return t=yr.sqrt(yr.add(yr.real(1),t)),e=yr.add(yr.mult(e,yr.complex(0,1)),t),e=yr.mult(yr.log(e),yr.complex(0,-1)),Tr.withUsage(e,"Angle")},yr.arctan=function(e){var t=yr.log(yr.add(yr.mult(e,yr.complex(0,-1)),yr.real(1)));return e=yr.log(yr.add(yr.mult(e,yr.complex(0,1)),yr.real(1))),t=yr.mult(yr.sub(t,e),yr.complex(0,.5)),Tr.withUsage(t,"Angle")},yr.arctan2=function(e,t){if(void 0===t)var r=yr.real(Math.atan2(e.value.imag,e.value.real));else yr._helper.isReal(e)&&yr._helper.isReal(t)?r=yr.real(Math.atan2(t.value.real,e.value.real)):(r=yr.add(e,yr.mult(yr.complex(0,1),t)),e=yr.sqrt(yr.add(yr.mult(e,e),yr.mult(t,t))),r=yr.mult(yr.complex(0,-1),yr.log(yr.div(r,e))));return Tr.withUsage(r,"Angle")},yr.sqrt=function(e){var t=e.value.real,r=e.value.imag;return e=Math.sqrt(Math.sqrt(t*t+r*r)),t=Math.atan2(r,t),{ctype:"number",value:{real:e*Math.cos(t/2),imag:e*Math.sin(t/2)}}},yr.powRealExponent=function(e,t){var r=e.value.real,n=e.value.imag;return e=Math.pow(Math.sqrt(r*r+n*n),t),r=Math.atan2(n,r),{ctype:"number",value:{real:e*Math.cos(r*t),imag:e*Math.sin(r*t)}}},yr.log=function(e){var t=e.value.real;e=e.value.imag;var r=Math.sqrt(t*t+e*e),n=Math.atan2(e,t);return 0>e&&(n+=2*Math.PI),0===e&&0>t&&(n=Math.PI),n>Math.PI&&(n-=2*Math.PI),yr.snap({ctype:"number",value:{real:Math.log(r),imag:n}})},yr.pow=function(e,t){return yr._helper.isZero(t)?yr.one:yr._helper.isZero(e)?yr.zero:yr._helper.isReal(t)?yr.powRealExponent(e,t.value.real):yr.exp(yr.mult(yr.log(e),t))},yr.mod=function(e,t){var r=e.value.real,n=t.value.real;return e=e.value.imag,t=t.value.imag,r-=Math.floor(r/n)*n,e-=Math.floor(e/t)*t,0===n&&(r=0),0===t&&(e=0),yr.snap({ctype:"number",value:{real:r,imag:e}})},yr._helper.seed="NO",yr._helper.seedrandom=function(e){e-=Math.floor(e),yr._helper.seed=.8*e+.1},yr._helper.rand=function(){if("NO"===yr._helper.seed)return Math.random();var e=yr._helper.seed;return e=1e3*Math.sin(1e3*e),e-=Math.floor(e),yr._helper.seed=e},yr._helper.randnormal=function(){var e=yr._helper.rand(),t=yr._helper.rand();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)},yr._helper.isEqual=function(e,t){return e.value.real===t.value.real&&e.value.imag===t.value.imag},yr._helper.isLessThan=function(e,t){return e.value.real<t.value.real||e.value.real===t.value.real&&e.value.imag<t.value.imag},yr._helper.compare=function(e,t){return yr._helper.isLessThan(e,t)?-1:yr._helper.isEqual(e,t)?0:1},yr._helper.isAlmostEqual=function(e,t,r){var n=yr.eps;return void 0!==r&&(n=r),r=e.value.real-t.value.real,e=e.value.imag-t.value.imag,r<n&&r>-n&&e<n&&e>-n},yr._helper.isZero=function(e){return 0===e.value.real&&0===e.value.imag},yr._helper.isAlmostZero=function(e){var t=e.value.real;return e=e.value.imag,t<yr.eps&&t>-yr.eps&&e<yr.eps&&e>-yr.eps},yr._helper.isReal=function(e){return 0===e.value.imag},yr._helper.isAlmostReal=function(e){return(e=e.value.imag)<yr.epsbig&&e>-yr.epsbig},yr._helper.isNaN=function(e){return isNaN(e.value.real)||isNaN(e.value.imag)},yr._helper.isFinite=function(e){return isFinite(e.value.real)&&isFinite(e.value.imag)},yr._helper.isAlmostImag=function(e){return(e=e.value.real)<yr.epsbig&&e>-yr.epsbig},yr._helper.z3a=yr.complex(-.5,.5*Math.sqrt(3)),yr._helper.z3b=yr.complex(-.5,-.5*Math.sqrt(3)),yr._helper.cub1={ctype:"list",value:[yr.one,yr.one,yr.one]},yr._helper.cub2={ctype:"list",value:[yr._helper.z3a,yr.one,yr._helper.z3b]},yr._helper.cub3={ctype:"list",value:[yr._helper.z3b,yr.one,yr._helper.z3a]},yr.solveCubic=function(e,t,r,n){return e=yr._helper.solveCubicHelper(e,t,r,n),[wr.scalproduct(yr._helper.cub1,e),wr.scalproduct(yr._helper.cub2,e),wr.scalproduct(yr._helper.cub3,e)]},yr._helper.solveCubicHelper=function(e,t,r,n){var i=e.value.real;e=e.value.imag;var a=t.value.real;t=t.value.imag;var o=r.value.real,l=r.value.imag,s=n.value.real,u=n.value.imag,c=i*o-e*l,p=4*(r=i*l+e*o)-2*a*t,f=i*a-e*t,h=i*t+e*a,v=(n=4*c-(a*a-t*t))*o-p*l-18*(f*s-h*u);p=n*l+p*o-18*(f*u+h*s);var d=54*e*i,m=(n=27*(i*i-e*e))*s-d*u,g=n*u+d*s,y=a*a-t*t,b=2*a*t,P=y*a-b*t,x=y*t+b*a,C=m+4*P;return n=27*(v*o-p*l+C*s-(d=g+4*x)*u),p=27*(v*l+p*o+C*u+d*s),C=Math.sqrt(Math.sqrt(n*n+p*p)),d=Math.atan2(p,n),p=C*Math.sin(d/2),P=-2*P+9*(f*o-h*l)-m+((n=C*Math.cos(d/2))*i-p*e),x=-2*x+9*(f*l+h*o)-g+(n*e+p*i),n=Math.exp(Math.log(Math.sqrt(P*P+x*x))/3),o=Math.atan2(x,P),d=n*Math.sin(o/3),p=n*Math.cos(o/3),o*=2,c=2*y-6*c,r=2*b-6*r,b=-1.5874010519681996*(a*p-t*d),a=-1.5874010519681996*(a*d+t*p),t=1.2599210498948732*(n*=n)*Math.cos(o/3),o=1.2599210498948732*n*Math.sin(o/3),n=4.762203155904599*(p*i-d*e),d=(-c*(p=4.762203155904599*(p*e+d*i))+r*n)/(i=n*n+p*p),c=(c*n+r*p)/i,r=d,d=(-b*p+a*n)/i,b=(b*n+a*p)/i,a=d,d=(-t*p+o*n)/i,t=(t*n+o*p)/i,o=d,wr.turnIntoCSList([yr.complex(c,r),yr.complex(b,a),yr.complex(t,o)])},yr._helper.getRangeRand=function(e,t){return Math.random()*(t-e)+e},yr.getRandReal=function(e,t){return e=yr._helper.getRangeRand(e,t),yr.real(e)},yr.getRandComplex=function(e,t){var r=yr._helper.getRangeRand(e,t);return e=yr._helper.getRangeRand(e,t),yr.complex(r,e)};var wr={_helper:{},turnIntoCSList:function(e){return{ctype:"list",value:e}}};wr.EMPTY=wr.turnIntoCSList([]),wr.asList=function(e){return"list"===e.ctype?e:"number"===e.ctype||"boolean"===e.ctype||"geo"===e.ctype?wr.turnIntoCSList([e]):wr.EMPTY},wr.realVector=function(e){for(var t=[],r=0;r<e.length;r++)t[r]={ctype:"number",value:{real:e[r],imag:0}};return{ctype:"list",value:t}},wr._helper.unitvector=function(e,t){return(e=wr.zerovector(e)).value[Math.floor(t.value.real-1)]=yr.real(1),e},wr.idMatrix=function(e){for(var t=wr.zeromatrix(e,e),r=yr.real(1),n=0;n<e.value.real;n++)t.value[n].value[n]=r;return t},wr._helper.flippedidMatrix=function(e){for(var t=wr.zeromatrix(e,e),r=yr.real(1),n=0;n<e.value.real;n++)t.value[n].value[e.value.real-n-1]=r;return t},wr.println=function(e){for(var t=[],r=0;r<e.value.length;r++)if("number"===e.value[r].ctype)t[r]=yr.niceprint(e.value[r]);else{if("list"!==e.value[r].ctype)return l;wr.println(e.value[r])}"number"===e.value[0].ctype&&console.log(t)},wr.matrix=function(e){return wr.turnIntoCSList(e.map(wr.turnIntoCSList))},wr.realMatrix=function(e){for(var t=e.length,r=Array(t),n=0;n<t;n++)r[n]=wr.realVector(e[n]);return wr.turnIntoCSList(r)},wr.ex=wr.realVector([1,0,0]),wr.ey=wr.realVector([0,1,0]),wr.ez=wr.realVector([0,0,1]),wr.linfty=wr.realVector([0,0,1]),wr.ii=wr.turnIntoCSList([yr.complex(1,0),yr.complex(0,1),yr.complex(0,0)]),wr.jj=wr.turnIntoCSList([yr.complex(1,0),yr.complex(0,-1),yr.complex(0,0)]),wr.fundDual=wr.realMatrix([[1,0,0],[0,1,0],[0,0,0]]),wr.fund=wr.realMatrix([[0,0,0],[0,0,0],[0,0,1]]),wr.sequence=function(e,t){var r=[],n=0;for(e=Math.round(e.value.real);e<Math.round(t.value.real)+1;e++)r[n]={ctype:"number",value:{real:e,imag:0}},n++;return{ctype:"list",value:r}},wr.pairs=function(e){for(var t=[],r=0;r<e.value.length-1;r++)for(var n=r+1;n<e.value.length;n++)t.push({ctype:"list",value:[e.value[r],e.value[n]]});return{ctype:"list",value:t}},wr.triples=function(e){for(var t=[],r=0;r<e.value.length-2;r++)for(var n=r+1;n<e.value.length-1;n++)for(var i=n+1;i<e.value.length;i++)t.push({ctype:"list",value:[e.value[r],e.value[n],e.value[i]]});return{ctype:"list",value:t}},wr.cycle=function(e){for(var t=[],r=0;r<e.value.length-1;r++)t[r]={ctype:"list",value:[e.value[r],e.value[r+1]]};return t.push({ctype:"list",value:[e.value[e.value.length-1],e.value[0]]}),{ctype:"list",value:t}},wr.consecutive=function(e){for(var t=[],r=0;r<e.value.length-1;r++)t[r]={ctype:"list",value:[e.value[r],e.value[r+1]]};return{ctype:"list",value:t}},wr.reverse=function(e){for(var t=Array(e.value.length),r=e.value.length-1,n=0;0<=r;r--,n++)t[n]=e.value[r];return{ctype:"list",value:t}},wr.directproduct=function(e,t){for(var r=[],n=0;n<e.value.length;n++)for(var i=0;i<t.value.length;i++)r.push({ctype:"list",value:[e.value[n],t.value[i]]});return{ctype:"list",value:r}},wr.concat=function(e,t){for(var r=[],n=0;n<e.value.length;n++)r.push(e.value[n]);for(e=0;e<t.value.length;e++)r.push(t.value[e]);return{ctype:"list",value:r}},wr.prepend=function(e,t){var r=[];for(r[0]=e,e=0;e<t.value.length;e++)r[e+1]=t.value[e];return{ctype:"list",value:r}},wr.append=function(e,t){for(var r=[],n=0;n<e.value.length;n++)r[n]=e.value[n];return r.push(t),{ctype:"list",value:r}},wr.contains=function(e,t){for(var r=0;r<e.value.length;r++)if(Er.equals(e.value[r],t).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}},wr.common=function(e,t){for(var r=[],n=0,i=0;i<e.value.length;i++){for(var a=!1,o=e.value[i],l=0;l<t.value.length;l++)a=a||Er.equals(o,t.value[l]).value;a&&(r[n]=e.value[i],n++)}return{ctype:"list",value:r}},wr.remove=function(e,t){for(var r=[],n=0,i=0;i<e.value.length;i++){for(var a=!1,o=e.value[i],l=0;l<t.value.length;l++)a=a||Er.equals(o,t.value[l]).value;a||(r[n]=e.value[i],n++)}return{ctype:"list",value:r}},wr.sort1=function(e){return(e=e.value.slice()).sort(Tr.compare),wr.turnIntoCSList(e)},wr._helper.isEqual=function(e,t){return wr.equals(e,t).value},wr._helper.isLessThan=function(e,t){for(var r=e.value.length,n=t.value.length,i=0;!(i>=r||i>=n)&&Tr.isEqual(e.value[i],t.value[i]);)i++;return i===r&&i<n||!(i===n&&i<r||i===r&&i===n)&&Tr.isLessThan(e.value[i],t.value[i])},wr._helper.compare=function(e,t){return wr._helper.isLessThan(e,t)?-1:wr._helper.isEqual(e,t)?0:1},wr.equals=function(e,t){if(e.value.length!==t.value.length)return{ctype:"boolean",value:!1};for(var r=!0,n=0;n<e.value.length;n++){var i=e.value[n],a=t.value[n];r="list"===i.ctype&&"list"===a.ctype?r&&wr.equals(i,a).value:r&&A([i,a],[]).value}return{ctype:"boolean",value:r}},wr.almostequals=function(e,t){if(e.value.length!==t.value.length)return{ctype:"boolean",value:!1};for(var r=!0,n=0;n<e.value.length;n++){var i=e.value[n],a=t.value[n];r="list"===i.ctype&&"list"===a.ctype?r&&wr.almostequals(i,a).value:r&&z([i,a],[]).value}return{ctype:"boolean",value:r}},wr._helper.isAlmostReal=function(e){for(var t=!0,r=0;r<e.value.length;r++){var n=e.value[r];t="list"===n.ctype?t&&wr._helper.isAlmostReal(n):t&&yr._helper.isAlmostReal(n)}return t},wr._helper.isAlmostZero=function(e){for(var t=0;t<e.value.length;t++){var r=e.value[t];if("list"===r.ctype){if(!wr._helper.isAlmostZero(r))return!1}else if(!yr._helper.isAlmostZero(r))return!1}return!0},wr._helper.isNaN=function(e){for(var t=!1,r=0;r<e.value.length;r++){var n=e.value[r];t="list"===n.ctype?t||wr._helper.isNaN(n):t||yr._helper.isNaN(n)}return t},wr.set=function(e){var t=[],r=0;(e=e.value.slice()).sort(Tr.compare);for(var n=0;n<e.length;n++)0!==n&&A([t[t.length-1],e[n]],[]).value||(t[r]=e[n],r++);return{ctype:"list",value:t}},wr.maxval=function(e){for(var t=yr.zero,r=0;r<e.value.length;r++){var n=e.value[r];"number"===n.ctype&&(t=yr.argmax(t,n)),"list"===n.ctype&&(t=yr.argmax(t,wr.maxval(n)))}return t},wr.maxIndex=function(e,t,r){var n=0;void 0!==r&&(n=r),r=n;for(var i=t(e.value[n]).value.real;n<e.value.length;++n){var a=t(e.value[n]).value.real;a>i&&(r=n,i=a)}return r},wr.normalizeMax=function(e){var t=yr.inv(wr.maxval(e));return yr._helper.isFinite(t)?wr.scalmult(t,e):e},wr.normalizeZ=function(e){var t=yr.inv(e.value[2]);return wr.scalmult(t,e)},wr.dehom=function(e){var t=(e=e.value.slice()).length-1,r=yr.inv(e[t]);e.length=t;for(var n=0;n<t;++n)e[n]=yr.mult(r,e[n]);return wr.turnIntoCSList(e)},wr.normalizeAbs=function(e){var t=yr.inv(wr.abs(e));return wr.scalmult(t,e)},wr.max=function(e,t){if(e.value.length!==t.value.length)return l;for(var r=[],n=0;n<e.value.length;n++)r[n]=Tr.max(e.value[n],t.value[n]);return{ctype:"list",value:r}},wr.min=function(e,t){if(e.value.length!==t.value.length)return l;for(var r=[],n=0;n<e.value.length;n++)r[n]=Tr.min(e.value[n],t.value[n]);return{ctype:"list",value:r}},wr.scaldiv=function(e,t){if("number"!==e.ctype)return l;for(var r=[],n=0;n<t.value.length;n++){var i=t.value[n];r[n]="number"===i.ctype?Tr.div(i,e):"list"===i.ctype?wr.scaldiv(e,i):l}return{ctype:"list",value:r}},wr.scalmult=function(e,t){if("number"!==e.ctype)return l;for(var r=[],n=0;n<t.value.length;n++){var i=t.value[n];r[n]="number"===i.ctype?Tr.mult(i,e):"list"===i.ctype?wr.scalmult(e,i):l}return{ctype:"list",value:r}},wr.add=function(e,t){if(e.value.length!==t.value.length)return l;for(var r=[],n=0;n<e.value.length;n++){var i=e.value[n],a=t.value[n];r[n]="number"===i.ctype&&"number"===a.ctype?Tr.add(i,a):"list"===i.ctype&&"list"===a.ctype?wr.add(i,a):l}return{ctype:"list",value:r}},wr.sub=function(e,t){if(e.value.length!==t.value.length)return l;for(var r=[],n=0;n<e.value.length;n++){var i=e.value[n],a=t.value[n];r[n]="number"===i.ctype&&"number"===a.ctype?yr.sub(i,a):"list"===i.ctype&&"list"===a.ctype?wr.sub(i,a):l}return{ctype:"list",value:r}},wr.abs2=function(e){for(var t=0,r=0;r<e.value.length;r++){var n=e.value[r];if("number"===n.ctype)t+=yr.abs2(n).value.real;else{if("list"!==n.ctype)return l;t+=wr.abs2(n).value.real}}return{ctype:"number",value:{real:t,imag:0}}},wr.abs=function(e){return yr.sqrt(wr.abs2(e))},wr.normalizeMaxXX=function(e){for(var t=-1e4,r=yr.real(1),n=0;n<e.value.length;n++){var i=yr.abs(e.value[n]);i.value.real>t&&(r=e.value[n],t=i.value.real)}return wr.scaldiv(r,e)},wr.recursive=function(e,t){for(var r=[],n=0;n<e.value.length;n++){var i=ce(e.value[n]);r[n]="number"===i.ctype?yr[t](i):"list"===i.ctype?wr[t](i):l}return{ctype:"list",value:r}},wr.re=function(e){return wr.recursive(e,"re")},wr.neg=function(e){return wr.recursive(e,"neg")},wr.im=function(e){return wr.recursive(e,"im")},wr.conjugate=function(e){return wr.recursive(e,"conjugate")},wr.transjugate=function(e){return wr.transpose(wr.conjugate(e))},wr.round=function(e){return wr.recursive(e,"round")},wr.ceil=function(e){return wr.recursive(e,"ceil")},wr.floor=function(e){return wr.recursive(e,"floor")},wr._helper.colNumb=function(e){if("list"!==e.ctype)return-1;for(var t=-1,r=0;r<e.value.length;r++){if("list"!==e.value[r].ctype)return-1;if(0===r)t=e.value[r].value.length;else if(t!==e.value[r].value.length)return-1}return t},wr._helper.isNumberVecN=function(e,t){if("list"!==e.ctype||e.value.length!==t)return!1;for(t=0;t<e.value.length;t++)if("number"!==e.value[t].ctype)return!1;return!0},wr.isNumberVector=function(e){if("list"!==e.ctype)return{ctype:"boolean",value:!1};for(var t=0;t<e.value.length;t++)if("number"!==e.value[t].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}},wr.isNumberVectorN=function(e,t){if("list"!==e.ctype)return{ctype:"boolean",value:!1};if(e.value)for(t=0;t<e.value.length;t++)if("number"!==e.value[t].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}},wr.isNumberMatrix=function(e){if(-1===wr._helper.colNumb(e))return{ctype:"boolean",value:!1};for(var t=0;t<e.value.length;t++)if(!wr.isNumberVector(e.value[t]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}},wr._helper.isNumberMatrixMN=function(e,t,r){return wr.isNumberMatrix(e).value&&e.value.length===t&&e.value[0].value.length===r},wr.scalproduct=function(e,t){if(e.value.length!==t.value.length)return l;for(var r={ctype:"number",value:{real:0,imag:0}},n=0;n<t.value.length;n++){var i=e.value[n],a=t.value[n];if("number"!==i.ctype||"number"!==a.ctype)return l;r=yr.add(yr.mult(i,a),r)}return r},wr.sesquilinearproduct=function(e,t){if(e.value.length!==t.value.length)return l;for(var r=0,n=0,i=0;i<t.value.length;i++){var a=e.value[i].value,o=t.value[i].value;r+=a.real*o.real+a.imag*o.imag,n+=a.real*o.imag-a.imag*o.real}return yr.complex(r,n)},wr.normSquared=function(e){for(var t=0,r=0;r<e.value.length;r++){var n=e.value[r].value;t+=n.real*n.real+n.imag*n.imag}return yr.real(t)},wr.productMV=function(e,t){if(e.value[0].value.length!==t.value.length)return l;for(var r=[],n=0;n<e.value.length;n++){for(var i={ctype:"number",value:{real:0,imag:0}},a=e.value[n],o=0;o<t.value.length;o++){var s=a.value[o],u=t.value[o];if("number"!==s.ctype||"number"!==u.ctype)return l;i=yr.add(yr.mult(s,u),i)}r[n]=i}return wr.turnIntoCSList(r)},wr.productVM=function(e,t){if(e.value.length!==t.value.length)return l;for(var r=[],n=0;n<t.value[0].value.length;n++){for(var i={ctype:"number",value:{real:0,imag:0}},a=0;a<e.value.length;a++){var o=e.value[a],s=t.value[a].value[n];if("number"!==o.ctype||"number"!==s.ctype)return l;i=yr.add(yr.mult(o,s),i)}r[n]=i}return wr.turnIntoCSList(r)},wr.productMM=function(e,t){if(e.value[0].value.length!==t.value.length)return l;for(var r=[],n=0;n<e.value.length;n++){var i=wr.productVM(e.value[n],t);r[n]=i}return wr.turnIntoCSList(r)},wr.mult=function(e,t){return e.value.length===t.value.length&&wr.isNumberVector(e).value&&wr.isNumberVector(t).value?wr.scalproduct(e,t):wr.isNumberMatrix(e).value&&t.value.length===e.value[0].value.length&&wr.isNumberVector(t).value?wr.productMV(e,t):wr.isNumberMatrix(t).value&&e.value.length===t.value.length&&wr.isNumberVector(e).value?wr.productVM(e,t):wr.isNumberMatrix(e).value&&wr.isNumberMatrix(t).value&&t.value.length===e.value[0].value.length?wr.productMM(e,t):l},wr.projectiveDistMinScal=function(e,t){var r=wr.abs(e),n=wr.abs(t);if(0===r.value.real||0===n.value.real)return 0;var i=wr.conjugate(t);return i=wr.scalproduct(e,i),i=yr._helper.isAlmostZero(i)?yr.real(1):yr.div(i,yr.abs(i)),e=wr.scaldiv(r,e),t=wr.scaldiv(n,t),t=wr.scalmult(i,t),n=wr.abs(wr.add(e,t)),t=wr.abs(wr.sub(e,t)),Math.min(n.value.real,t.value.real)},wr.conicDist=function(e,t){return e=L(e),t=L(t),wr.projectiveDistMinScal(e,t)},wr.crossOperator=function(e){var t=e.value[0],r=e.value[1];return e=e.value[2],wr.turnIntoCSList([wr.turnIntoCSList([yr.zero,yr.neg(e),r]),wr.turnIntoCSList([e,yr.zero,yr.neg(t)]),wr.turnIntoCSList([yr.neg(r),t,yr.zero])])},wr.cross=function(e,t){var r=yr.sub(yr.mult(e.value[1],t.value[2]),yr.mult(e.value[2],t.value[1])),n=yr.sub(yr.mult(e.value[2],t.value[0]),yr.mult(e.value[0],t.value[2]));return e=yr.sub(yr.mult(e.value[0],t.value[1]),yr.mult(e.value[1],t.value[0])),wr.turnIntoCSList([r,n,e])},wr.crossratio3harm=function(e,t,r,n,i){var a=wr.det3(e,r,i),o=wr.det3(t,n,i);return e=wr.det3(e,n,i),t=wr.det3(t,r,i),a=yr.mult(a,o),o=yr.mult(e,t),wr.turnIntoCSList([a,o])},wr.crossratio3=function(e,t,r,n,i){return e=wr.crossratio3harm(e,t,r,n,i),yr.div(e.value[0],e.value[1])},wr.veronese=function(e){var t=yr.mult(e.value[0],e.value[0]),r=yr.mult(e.value[1],e.value[1]),n=yr.mult(e.value[2],e.value[2]),i=yr.mult(e.value[0],e.value[1]),a=yr.mult(e.value[0],e.value[2]);return e=yr.mult(e.value[1],e.value[2]),wr.turnIntoSCList([t,r,n,i,a,e])},wr.matrixFromVeronese=function(e){var t=e.value[0],r=e.value[1],n=e.value[2],i=yr.realmult(.5,e.value[3]),a=yr.realmult(.5,e.value[4]);return e=yr.realmult(.5,e.value[5]),wr.turnIntoCSList([wr.turnIntoCSList([t,i,a]),wr.turnIntoCSList([i,r,e]),wr.turnIntoCSList([a,e,n])])},wr.det2=function(e,t){var r=yr.mult(e.value[0],t.value[1]);return yr.sub(r,yr.mult(e.value[1],t.value[0]))},wr.det3=function(e,t,r){return yr.complex(e.value[0].value.real*t.value[1].value.real*r.value[2].value.real-e.value[0].value.imag*t.value[1].value.imag*r.value[2].value.real-e.value[0].value.imag*t.value[1].value.real*r.value[2].value.imag-e.value[0].value.real*t.value[1].value.imag*r.value[2].value.imag+e.value[2].value.real*t.value[0].value.real*r.value[1].value.real-e.value[2].value.imag*t.value[0].value.imag*r.value[1].value.real-e.value[2].value.imag*t.value[0].value.real*r.value[1].value.imag-e.value[2].value.real*t.value[0].value.imag*r.value[1].value.imag+e.value[1].value.real*t.value[2].value.real*r.value[0].value.real-e.value[1].value.imag*t.value[2].value.imag*r.value[0].value.real-e.value[1].value.imag*t.value[2].value.real*r.value[0].value.imag-e.value[1].value.real*t.value[2].value.imag*r.value[0].value.imag-e.value[0].value.real*t.value[2].value.real*r.value[1].value.real+e.value[0].value.imag*t.value[2].value.imag*r.value[1].value.real+e.value[0].value.imag*t.value[2].value.real*r.value[1].value.imag+e.value[0].value.real*t.value[2].value.imag*r.value[1].value.imag-e.value[2].value.real*t.value[1].value.real*r.value[0].value.real+e.value[2].value.imag*t.value[1].value.imag*r.value[0].value.real+e.value[2].value.imag*t.value[1].value.real*r.value[0].value.imag+e.value[2].value.real*t.value[1].value.imag*r.value[0].value.imag-e.value[1].value.real*t.value[0].value.real*r.value[2].value.real+e.value[1].value.imag*t.value[0].value.imag*r.value[2].value.real+e.value[1].value.imag*t.value[0].value.real*r.value[2].value.imag+e.value[1].value.real*t.value[0].value.imag*r.value[2].value.imag,-e.value[0].value.imag*t.value[1].value.imag*r.value[2].value.imag+e.value[0].value.imag*t.value[1].value.real*r.value[2].value.real+e.value[0].value.real*t.value[1].value.real*r.value[2].value.imag+e.value[0].value.real*t.value[1].value.imag*r.value[2].value.real-e.value[2].value.imag*t.value[0].value.imag*r.value[1].value.imag+e.value[2].value.imag*t.value[0].value.real*r.value[1].value.real+e.value[2].value.real*t.value[0].value.real*r.value[1].value.imag+e.value[2].value.real*t.value[0].value.imag*r.value[1].value.real-e.value[1].value.imag*t.value[2].value.imag*r.value[0].value.imag+e.value[1].value.imag*t.value[2].value.real*r.value[0].value.real+e.value[1].value.real*t.value[2].value.real*r.value[0].value.imag+e.value[1].value.real*t.value[2].value.imag*r.value[0].value.real+e.value[0].value.imag*t.value[2].value.imag*r.value[1].value.imag-e.value[0].value.imag*t.value[2].value.real*r.value[1].value.real-e.value[0].value.real*t.value[2].value.real*r.value[1].value.imag-e.value[0].value.real*t.value[2].value.imag*r.value[1].value.real+e.value[2].value.imag*t.value[1].value.imag*r.value[0].value.imag-e.value[2].value.imag*t.value[1].value.real*r.value[0].value.real-e.value[2].value.real*t.value[1].value.real*r.value[0].value.imag-e.value[2].value.real*t.value[1].value.imag*r.value[0].value.real+e.value[1].value.imag*t.value[0].value.imag*r.value[2].value.imag-e.value[1].value.imag*t.value[0].value.real*r.value[2].value.real-e.value[1].value.real*t.value[0].value.real*r.value[2].value.imag-e.value[1].value.real*t.value[0].value.imag*r.value[2].value.real)},wr.det4m=function(e){var t=e.value,r=t[0].value,n=r[0].value,i=+n.real,a=+n.imag,o=+(n=r[1].value).real,l=+n.imag,s=+(n=r[2].value).real,u=+n.imag,c=+(n=r[3].value).real,p=+n.imag,f=+(n=(r=t[1].value)[0].value).real,h=+n.imag,v=+(n=r[1].value).real,d=+n.imag,m=+(n=r[2].value).real,g=+n.imag;e=i*v-a*d-o*f+l*h;var y=i*d+a*v-o*h-l*f,b=i*m-a*g-s*f+u*h,P=i*g+a*m-s*h-u*f,x=i*(r=+(n=r[3].value).real)-a*(n=+n.imag)-c*f+p*h,C=i*n+a*r-c*h-p*f,_=o*m-l*g-s*v+u*d,w=o*g+l*m-s*d-u*v,S=o*r-l*n-c*v+p*d,M=o*n+l*r-c*d-p*v,T=s*r-u*n-c*m+p*g,I=s*n+u*r-c*g-p*m;i=+(n=(r=t[2].value)[0].value).real,a=+n.imag,o=+(n=r[1].value).real,l=+n.imag,s=+(n=r[2].value).real,u=+n.imag,c=+(n=r[3].value).real,p=+n.imag,f=+(n=(r=t[3].value)[0].value).real,h=+n.imag,t=i*(v=+(n=r[1].value).real)-a*(d=+n.imag)-o*f+l*h;var L=i*d+a*v-o*h-l*f,O=i*(m=+(n=r[2].value).real)-a*(g=+n.imag)-s*f+u*h,E=i*g+a*m-s*h-u*f,N=i*(r=+(n=r[3].value).real)-a*(n=+n.imag)-c*f+p*h;return i=i*n+a*r-c*h-p*f,a=o*m-l*g-s*v+u*d,f=o*g+l*m-s*d-u*v,h=o*r-l*n-c*v+p*d,o=o*n+l*r-c*d-p*v,l=s*r-u*n-c*m+p*g,s=s*n+u*r-c*g-p*m,yr.complex(e*l-y*s-b*h+P*o+x*a-C*f+_*N-w*i-S*O+M*E+T*t-I*L,e*s+y*l-b*o-P*h+x*f+C*a+_*i+w*N-S*E-M*O+T*L+I*t)},wr.eucangle=function(e,t){var r=wr.cross(e,wr.linfty);e=wr.cross(t,wr.linfty),t=wr.det3(wr.ez,r,wr.ii),r=wr.det3(wr.ez,r,wr.jj);var n=wr.det3(wr.ez,e,wr.ii);return e=wr.det3(wr.ez,e,wr.jj),t=yr.div(yr.mult(t,e),yr.mult(n,r)),t=yr.log(t),yr.mult(t,yr.complex(0,.5))},wr.zerovector=function(e){e=Math.floor(e.value.real);for(var t=Array(e),r=0;r<e;r++)t[r]=0;return wr.realVector(t)},wr.zeromatrix=function(e,t){e=Math.floor(e.value.real);for(var r=Array(e),n=0;n<e;n++)r[n]=wr.zerovector(t);return wr.turnIntoCSList(r)},wr.vandermonde=function(e){for(var t=e.value.length,r=wr.zeromatrix(t,t),n=0;n<t;n++)for(var i=0;i<t;i++)r.value[n].value[i]=yr.pow(e.value[n],yr.real(i-1));return r},wr.transpose=function(e){for(var t=[],r=e.value[0].value.length,n=e.value.length,i=0;i<r;i++){for(var a=[],o=0;o<n;o++)a[o]=e.value[o].value[i];t[i]=wr.turnIntoCSList(a)}return wr.turnIntoCSList(t)},wr.column=function(e,t){var r=[],n=e.value.length;t=Math.floor(t.value.real-1);for(var i=0;i<n;i++)r[i]=e.value[i].value[t];return wr.turnIntoCSList(r)},wr.row=function(e,t){var r=[],n=e.value[0].value.length;t=Math.floor(t.value.real-1);for(var i=0;i<n;i++)r[i]=e.value[t].value[i];return wr.turnIntoCSList(r)},wr.adjoint2=function(e){var t=e.value[0].value[0],r=e.value[1].value[0],n=Array(2);return n[0]=wr.turnIntoCSList([e.value[1].value[1],yr.neg(e.value[0].value[1])]),n[1]=wr.turnIntoCSList([yr.neg(r),t]),wr.turnIntoCSList(n)},wr.adjoint3=function(e){var t=e.value[0].value,r=t[0].value,n=r.real,i=r.imag,a=(r=t[1].value).real,o=r.imag,l=(r=t[2].value).real,s=r.imag,u=(r=(t=e.value[1].value)[0].value).real,c=r.imag,p=(r=t[1].value).real,f=r.imag,h=(r=t[2].value).real,v=r.imag;e=(r=(t=e.value[2].value)[0].value).real;var d=r.imag,m=(r=t[1].value).real,g=r.imag;return{ctype:"list",value:[{ctype:"list",value:[{ctype:"number",value:{real:p*(t=(r=t[2].value).real)-h*m-f*(r=r.imag)+v*g,imag:p*r-h*g-m*v+t*f}},{ctype:"number",value:{real:-a*t+l*m+o*r-s*g,imag:-a*r+l*g+m*s-t*o}},{ctype:"number",value:{real:a*h-l*p-o*v+s*f,imag:a*v-l*f-p*s+h*o}}]},{ctype:"list",value:[{ctype:"number",value:{real:-u*t+h*e+c*r-v*d,imag:-u*r+h*d+e*v-t*c}},{ctype:"number",value:{real:n*t-l*e-i*r+s*d,imag:n*r-l*d-e*s+t*i}},{ctype:"number",value:{real:-n*h+l*u+i*v-s*c,imag:-n*v+l*c+u*s-h*i}}]},{ctype:"list",value:[{ctype:"number",value:{real:u*m-p*e-c*g+f*d,imag:u*g-p*d-e*f+m*c}},{ctype:"number",value:{real:-n*m+a*e+i*g-o*d,imag:-n*g+a*d+e*o-m*i}},{ctype:"number",value:{real:n*p-a*u-i*f+o*c,imag:n*f-a*c-u*o+p*i}}]}]}},wr.inverse=function(e){var t=e.value.length;if(t!==e.value[0].value.length)return console.log("Inverse works only for square matrices"),l;if(2===t)return wr.scaldiv(wr.det(e),wr.adjoint2(e));if(3===t)return wr.scaldiv(wr.det(e),wr.adjoint3(e));t=wr.LUdecomp(e),e=e.value.length;var r=yr.real(0),n=yr.real(1),i=wr.zerovector(yr.real(e));i.value[0]=n;for(var a=Array(e),o=0;o<e;o++)a[o]=wr._helper.LUsolve(t,i),i.value[o]=r,i.value[o+1]=n;return a=wr.turnIntoCSList(a),wr.transpose(a)},wr.linearsolve=function(e,t){return 2===e.value.length?wr.linearsolveCramer2(e,t):3===e.value.length?wr.linearsolveCramer3(e,t):wr.LUsolve(e,t)},wr.getDiag=function(e){if(e.value.length!==e.value[0].value.length)return l;for(var t=Array(e.value.length),r=0;r<e.value.length;r++)t[r]=e.value[r].value[r];return wr.turnIntoCSList(t)},wr.getSubDiag=function(e){if(e.value.length!==e.value[0].value.length)return l;for(var t=Array(e.value.length-1),r=0;r<e.value.length-1;r++)t[r]=e.value[r+1].value[r];return wr.turnIntoCSList(t)},wr.eig2=function(e){var t=yr.add(e.value[0].value[0],e.value[1].value[1]);e=wr.det2(e.value[0],e.value[1]);var r=yr.mult(t,t),n=t=yr.mult(t,yr.real(.5));return e=yr.sqrt(yr.sub(yr.div(r,yr.real(4)),e)),t=yr.add(t,e),n=yr.sub(n,e),wr.turnIntoCSList([t,n])},wr.eig=function(e,t){var r=t||!0,n=e,i=yr.real(n.value.length);t=i.value.real,yr.real(0),n=wr._helper.QRIteration(n)[0],n=wr.getDiag(n),n=wr.sort1(n),i=wr.idMatrix(i,i);var a=Array(t);if(a=wr.turnIntoCSList(a),r){var o,l=0,s=!1;for(r=0;r<t;r++){if(s)var u=c.value[l];else{var c=n.value[r];c=wr.sub(e,wr.scalmult(c,i)),void 0!==(u=(c=wr.nullSpace(c)).value[0])&&(o=u)}void 0===u&&(u=o),1e-8>wr.abs(u).value.real&&0===l&&(u=wr._helper.inverseIteration(e,n.value[r])),a.value[r]=wr._helper.isAlmostZeroVec(u)?u:wr.scaldiv(wr.abs(u),u),r<t-1&&((s=1e-6>yr.abs(yr.sub(n.value[r],n.value[r+1])).value.real)?l++:l=0)}a=wr.transpose(a)}return wr.turnIntoCSList([n,a])},wr._helper.isNormalMatrix=function(e){return 1e-10>wr.abs(wr.sub(e,wr.transjugate(e))).value.real},wr._helper.QRIteration=function(e,t){var r=yr.real(e.value.length),n=r.value.real,i=r.value.real;yr.real(0),wr.idMatrix(r,r);var a=wr.zeromatrix(r,r);r=wr.idMatrix(r,r);var o=t||2500,l=0,s=Array(i);for(t=0;t<o;t++){var u=wr._helper.getBlock(e,[i-2,i-1],[i-2,i-1]),c=wr.eig2(u);u=c.value[0],c=c.value[1],wr.abs(u),wr.abs(c);var p=e.value[i-1].value[i-1];if(c=yr.abs(yr.sub(p,u)).value.real<(p=yr.abs(yr.sub(p,c)).value.real)?u:c,u=wr.idMatrix(yr.real(i),yr.real(i)),c=wr.scalmult(c,u),u=wr.QRdecomp(wr.sub(e,c)),e=Tr.mult(u.R,u.Q),e=wr.add(e,c),u.Q=wr._helper.buildBlockMatrix(u.Q,wr.idMatrix(yr.real(l),yr.real(l))),r=Tr.mult(r,u.Q),1e-48>yr.abs2(e.value[e.value.length-1].value[e.value[0].value.length-2]).value.real&&1<i){for(s[n-l-1]=e.value[i-1].value[i-1],t=0;t<i;t++)a.value[i-1].value[t]=e.value[i-1].value[t],a.value[t].value[i-1]=e.value[t].value[i-1];e=wr._helper.getBlock(e,[0,i-2],[0,i-2]),l++,i--}if(1===i){a.value[0].value[0]=e.value[0].value[0];break}if(wr._helper.isUpperTriangular(e)){for(t=0;t<i;t++)a.value[t].value[t]=e.value[t].value[t];break}}return[a,r]},wr.rank=function(e,t){return wr.RRQRdecomp(e,t).rank},wr._helper.isAlmostZeroVec=function(e){for(var t=e.value.length,r=0;r<t;r++)if(!yr._helper.isAlmostZero(e.value[r]))return!1;return!0},wr._helper.isLowerTriangular=function(e){for(var t=e.value.length,r=e.value[0].value.length,n=0;n<t;n++)for(var i=n+1;i<r;i++)if(!yr._helper.isAlmostZero(e.value[n].value[i]))return!1;return!0},wr._helper.isUpperTriangular=function(e){return wr._helper.isLowerTriangular(wr.transpose(e))},wr._helper.isAlmostId=function(e){var t=e.value.length,r=yr.real(t);if(t!==e.value[0].value.length)return!1;for(e=wr.sub(e,wr.idMatrix(r),r),r=0;r<t;r++)for(var n=0;n<t;n++)if(1e-16<yr.abs(e.value[r].value[n]).value.real)return!1;return!0},wr.nullSpace=function(e,t){var r=e.value.length;t=wr.RRQRdecomp(wr.transjugate(e),t),e=wr.transpose(t.Q),t=r-t.rank.value.real;var n=Array(t);e.value.reverse();for(var i,a=0;a<t;a++)i=e.value[a],n[a]=wr.scaldiv(wr.abs(i),i);return 0<(n=wr.turnIntoCSList(n)).value.length?n:wr.turnIntoCSList([wr.zerovector(yr.real(r))])},wr._helper.isAlmostDiagonal=function(e){var t=e.value.length;if(yr.real(t),yr.real(0),t!==e.value[0].value.length)return!1;for(var r=0;r<t;r++)for(var n=0;n<t;n++)if(r!==n&&1e-16<yr.abs(e.value[r].value[n]).value.real)return!1;return!0},wr._helper.inverseIteration=function(e,t){console.log("warning: code untested");for(var r=e.value.length,n=Array(r),i=0;i<r;i++)n[i]=2*Math.random()-.5;for(n=wr.realVector(n),r=wr.idMatrix(yr.real(r),yr.real(r)),t=yr.add(t,yr.real(.1*Math.random()-.5)),i=0;100>i;i++)n=wr.scaldiv(wr.abs(n),n),n=wr.LUsolve(wr.sub(e,wr.scalmult(t,r)),JSON.parse(JSON.stringify(n)));return wr.scaldiv(wr.abs(n),n)},wr._helper.toHessenberg=function(e){var t=JSON.parse(JSON.stringify(e)),r=t.value.length,n=yr.real(r-1),i=yr.real(r);if(yr.real(1),wr._helper.isUpperTriangular(t))return[wr.idMatrix(n,n),e];for(e=wr.idMatrix(i,i),i=1;i<r-1;i++){var a=wr.column(t,yr.real(i));a.value=a.value.splice(i),1e-16<wr.abs2(a).value.real&&(a=wr._helper.getHouseHolder(a),e=Tr.mult(e,a),t=Tr.mult(Tr.mult(a,t),a)),n.value.real--}return[e,t]},wr._helper.swapEl=function(e,t,r){if("[object Array]"===Object.prototype.toString.call(e)){var n=e[t];e[t]=e[r],e[r]=n}else"list"===e.ctype&&(n=e.value[t],e.value[t]=e.value[r],e.value[r]=n)},wr.RRQRdecomp=function(e,t){var r,n=Math.sqrt(yr.eps);void 0!==t&&(n=.1*t.value.real),t=n*n,n=e.value.length;var i=yr.real(n),a=yr.real(1),o=wr._helper.unitvector(yr.real(e.value.length),a),l=wr.idMatrix(i,i),s=JSON.parse(JSON.stringify(e)),u=wr.transpose(e);for(e=Array(n),r=0;r<n;r++)e[r]=wr.abs2(u.value[r]);for(e=wr.turnIntoCSList(e),u=Array(n),r=0;r<n;r++)u[r]=r;r=wr.maxIndex(e,yr.abs);for(var c=e.value[r],p=0,f=0;1e-16<yr.abs2(c).value.real;f++){for(p++,wr._helper.swapColumn(s,f,r),wr._helper.swapEl(e,f,r),wr._helper.swapEl(u,f,r),r=wr._helper.getBlock(s,[f],[f]),r=wr.column(r,a),1e-8<(c=wr.abs2(r).value.real)&&(r=wr._helper.getHouseHolder(r),r=wr._helper.buildBlockMatrix(wr.idMatrix(yr.real(f),yr.real(f)),r),l=Tr.mult(l,wr.transjugate(r)),s=Tr.mult(r,s)),r=f+1;r<n;r++)e.value[r]=yr.sub(e.value[r],yr.mult(s.value[f].value[r],yr.conjugate(s.value[f].value[r])));if(r=wr.maxIndex(e,yr.abs2,f+1),c=e.value[r],f+2===n){yr.abs(c).value.real>t&&p++;break}i=yr.sub(i,a),o.value=o.value.splice(0,o.value.length-1)}return{Q:l,R:s,P:wr.turnIntoCSList(u),rank:yr.real(p)}},wr._helper.getHouseHolder=function(e){var t=yr.real(e.value.length);if(1e-16>wr.abs2(e))return wr.idMatrix(t,t);var r=yr.real(1),n=wr._helper.unitvector(yr.real(e.value.length),r),i=wr._helper.QRgetAlpha(e,0);return i=wr.sub(e,wr.scalmult(i,n)),i=wr.scaldiv(wr.abs(i),i),e=yr.div(wr.sesquilinearproduct(e,i),wr.sesquilinearproduct(i,e)),t=wr.idMatrix(t,t),wr.sub(t,wr.scalmult(yr.add(r,e),wr._helper.transposeMult(i,wr.conjugate(i))))},wr._helper.reOrderbyPivots=function(e,t){var r=e.value.length.length;e=wr.transpose(e),r=Array(r);for(var n=0;n<t.length;n++)r[t[n]]=e.value[n];return r=wr.turnIntoCSList(r),wr.transpose(r)},wr.QRdecomp=function(e){var t=e.value.length,r=yr.real(t);if(wr._helper.isUpperTriangular(e))return{Q:wr.idMatrix(r,r),R:e};var n=yr.real(1),i=wr._helper.unitvector(yr.real(e.value.length),n),a=wr.idMatrix(r,r);e=JSON.parse(JSON.stringify(e));for(var o=0;;o++){var l=wr._helper.getBlock(e,[o],[o]);if(l=wr.column(l,n),1e-8<wr.abs2(l).value.real&&(l=wr._helper.getHouseHolder(l),l=wr._helper.buildBlockMatrix(wr.idMatrix(yr.real(o),yr.real(o)),l),a=Tr.mult(a,wr.transjugate(l)),e=Tr.mult(l,e)),o+2===t)break;r=yr.sub(r,n),i.value=i.value.splice(0,i.value.length-1)}return{Q:a,R:e}},wr._helper.swapColumn=function(e,t,r){for(var n,i=0;i<e.value.length;i++)n=e.value[i].value[t],e.value[i].value[t]=e.value[i].value[r],e.value[i].value[r]=n},wr._helper.buildBlockMatrix=function(e,t){if(0===e.value.length)return t;if(0===t.value.length)return e;var r=e.value.length,n=e.value[0].value.length,i=n+t.value[0].value.length;i=wr.zeromatrix(yr.real(r+t.value.length),yr.real(i));for(var a=0;a<e.value.length;a++)for(var o=0;o<e.value[0].value.length;o++)i.value[a].value[o]=e.value[a].value[o];for(e=0;e<t.value.length;e++)for(a=0;a<t.value[0].value.length;a++)i.value[r+e].value[n+a]=t.value[e].value[a];return i},wr._helper.getBlock=function(e,t,r){e=JSON.parse(JSON.stringify(e));var n=t[0],i=r[0];for(t=void 0===t[1]?e.value.length:t[1],r=void 0===r[1]?e.value[0].value.length:r[1],t++,r++,e.value=e.value.slice(n,t),n=0;n<e.value.length;n++)e.value[n].value=e.value[n].value.slice(i,r);return e},wr._helper.setBlock=function(e,t,r){e=JSON.parse(JSON.stringify(e));var n=r[0];r=r[1];for(var i=t.value.length,a=t.value[0].value.length,o=0;o<i;o++)for(var l=0;l<a;l++)e.value[n+o].value[r+l]=t.value[o].value[l];return e},wr._helper.transposeMult=function(e,t){if(e.value.length!==t.value.length)return l;for(var r=e.value.length,n=Array(r),i=0;i<r;i++)n[i]=wr.scalmult(e.value[i],t);return wr.turnIntoCSList(n)},wr._helper.QRgetAlpha=function(e,t){return 0>e.value[t].value.real?wr.abs(e):yr.neg(wr.abs(e))},wr.LUdecomp=function(e){var t,r,n=0,i=(e=JSON.parse(JSON.stringify(e))).value.length,a=i-1,o=Array(i);for(r=0;r<i;++r){var l=r,s=e.value[r],u=yr.abs(s.value[r]).value.real;for(t=r+1;t<i;++t){var c=yr.abs(e.value[t].value[r]);u<c.value.real&&(u=c.value.real,l=t)}for(u<yr.eps&&console.log("Warning: singular matrix!"),o[r]=l,l!==r&&(e.value[r]=e.value[l],e.value[l]=s,s=e.value[r],n++),t=s.value[r],c=r+1;c<i;++c)e.value[c].value[r]=yr.div(e.value[c].value[r],t);for(c=r+1;c<i;++c){for(l=e.value[c],t=r+1;t<a;++t)l.value[t]=yr.sub(l.value[t],yr.mult(l.value[r],s.value[t])),++t,l.value[t]=yr.sub(l.value[t],yr.mult(l.value[r],s.value[t]));t===a&&(l.value[t]=yr.sub(l.value[t],yr.mult(l.value[r],s.value[t])))}}return{LU:e,P:o,TransPos:n}},wr.LUsolve=function(e,t){return e=wr.LUdecomp(e),wr._helper.LUsolve(e,t)},wr._helper.LUsolve=function(e,t){var r=JSON.parse(JSON.stringify(t)),n=(t=e.LU).value.length,i=JSON.parse(JSON.stringify(r)),a=e.P;for(e=n-1;-1!==e;--e)i.value[e]=r.value[e];for(e=0;e<n;++e){if(r=a[e],a[e]!==e){var o=i.value[e];i.value[e]=i.value[r],i.value[r]=o}for(o=t.value[e],r=0;r<e;++r)i.value[e]=yr.sub(i.value[e],yr.mult(i.value[r],o.value[r]))}for(e=n-1;0<=e;--e){for(o=t.value[e],r=e+1;r<n;++r)i.value[e]=yr.sub(i.value[e],yr.mult(i.value[r],o.value[r]));i.value[e]=yr.div(i.value[e],o.value[e])}return i},wr.linearsolveCramer2=function(e,t){var r=wr.column(e,yr.real(1)),n=wr.column(e,yr.real(2));return e=wr.det2(r,n),yr._helper.isZero(e)&&console.log("A is not regular!"),n=wr.det2(t,n),n=yr.div(n,e),t=wr.det2(r,t),t=yr.div(t,e),wr.turnIntoCSList([n,t])},wr.linearsolveCramer3=function(e,t){var r=wr.column(e,yr.real(1)),n=wr.column(e,yr.real(2)),i=wr.column(e,yr.real(3));e=wr.det3(r,n,i),yr._helper.isZero(e)&&console.log("A is not regular!");var a=wr.det3(t,n,i);return i=wr.det3(r,t,i),t=wr.det3(r,n,t),t=wr.turnIntoCSList([a,i,t]),wr.scaldiv(e,t)},wr.linearsolveCGNR=function(e,t){var r=wr.transpose(e);return e=Tr.mult(r,e),t=Tr.mult(r,t),wr.linearsolveCG(e,t)},wr.linearsolveCG=function(e,t){for(var r,n=t,i=t=wr.sub(t,Tr.mult(e,t)),a=Math.ceil(1.2*e.value.length),o=0;o<a;){o++;var l=Tr.mult(e,i),s=r=wr.scalproduct(t,t);if(r=yr.div(r,wr.scalproduct(i,l)),n=wr.add(n,Tr.mult(r,i)),t=wr.sub(t,Tr.mult(r,l)),wr.abs(t).value.real<yr.eps)break;r=wr.scalproduct(t,t),r=yr.div(r,s),i=wr.add(t,Tr.mult(r,i))}return o>=a&&console.log("CG did not converge"),n},wr.det=function(e){if(1===e.value.length)return e.value[0].value[0];if(2===e.value.length)return wr.det2(e.value[0],e.value[1]);if(3===e.value.length)return wr.det3(e.value[0],e.value[1],e.value[2]);if(4===e.value.length)return wr.det4m(e);var t,r=e.value.length,n=yr.real(1),i=JSON.parse(JSON.stringify(e));for(e=0;e<r-1;e++){var a=e;for(t=e+1;t<r;t++)yr.abs(i.value[t].value[e]).value.real>yr.abs(i.value[a].value[e]).value.real&&(a=t);a!==e&&(t=i.value[a],i.value[a]=i.value[e],i.value[e]=t,n=yr.neg(n));var o=i.value[e];for(t=e+1;t<r;t++){var l=i.value[t],s=yr.div(l.value[e],o.value[e]);for(a=e+1;a<r-1;a+=2){var u=a+1;l.value[a]=yr.sub(l.value[a],yr.mult(o.value[a],s)),l.value[u]=yr.sub(l.value[u],yr.mult(o.value[u],s))}a!==r&&(l.value[a]=yr.sub(l.value[a],yr.mult(o.value[a],s)))}if(yr._helper.isZero(o.value[e]))return yr.real(0);n=yr.mult(n,o.value[e])}return yr.mult(n,i.value[e].value[e])},wr.LUdet=function(e){for(var t=(e=wr.LUdecomp(e)).LU,r=t.value.length,n=t.value[0].value[0],i=1;i<r;i++)n=yr.mult(n,t.value[i].value[i]);return 1==e.TransPos%2&&(n=yr.neg(n)),n},wr.getField=function(e,t){if("homog"===t){if(wr._helper.isNumberVecN(e,3))return e;if(wr._helper.isNumberVecN(e,2))return wr.turnIntoCSList([e.value[0],e.value[1],yr.real(1)])}if("xy"===t){if(wr._helper.isNumberVecN(e,2))return e;if(wr._helper.isNumberVecN(e,3))return wr.turnIntoCSList([yr.div(e.value[0],e.value[2]),yr.div(e.value[1],e.value[2])])}if("x"===t&&wr.isNumberVector(e)){var r=e.value.length;if(0<r&&3!==r)return e.value[0];if(3===r)return"Point"===e.usage?yr.div(e.value[0],e.value[2]):e.value[0]}if("y"===t&&wr.isNumberVector(e)){if(1<(r=e.value.length)&&3!==r)return e.value[1];if(3===r)return"Point"===e.usage?yr.div(e.value[1],e.value[2]):e.value[1]}return"z"===t&&wr.isNumberVector(e)&&2<(r=e.value.length)?e.value[2]:l},wr.nil=wr.turnIntoCSList([]),wr.ofGeos=function(e){return wr.turnIntoCSList(e.map((function(e){return{ctype:"geo",value:e}})))},wr._helper.isAlmostFarpoint=function(e){return e=wr.normalizeMax(e).value[2],yr.abs(e).value.real<yr.eps},wr.getRandRealVec3=function(e,t){var r=yr.getRandReal;return wr.turnIntoCSList([r(e,t),r(e,t),r(e,t)])},wr.getRandComplexVec3=function(e,t){var r=yr.getRandComplex;return wr.turnIntoCSList([r(e,t),r(e,t),r(e,t)])};var Sr={_helper:{},turnIntoCSJson:function(e){return{ctype:"JSON",value:e}}};Sr._helper.ShallowClone=function(e){var t,r=Array.isArray(e)?[]:{};for(t in e){var n=e[t];r[t]=n}return r},Sr.getField=function(e,t){return e.value&&e.value[t]?e.value[t]:l},Sr.setField=function(e,t,r){"undefined"===r.ctype&&e[t]?delete e[t]:e[t]=r},Sr.GenFromUserDataEl=function(e){var t=e.key;return e=e.value,t&&"string"===t.ctype?e?{key:t.value,val:ue(e)}:(console.log("Warning: JSON object not defined."),{key:t.value,val:l}):(console.log("Error: JSON keys have to be strings."),l)},Sr._helper.GenJSONAtom=function(e,t){return{ctype:"JSON",value:{key:Tr.string(e),value:t}}},Sr._helper.forall=function(e,t,r,n){var i="value";if(void 0!==n.iterator){"string"===(n=ue(n.iterator)).ctype&&-1!==["key","value","pair"].indexOf(n.value)&&(i=n.value)}if("value"===i)for(var a in e){Nr.setvar(t,e[a]);var o=ue(r)}else if("key"===i)for(var l in e)Nr.setvar(t,Tr.string(l)),o=ue(r);else for(var s in e)Nr.setvar(t,Sr._helper.GenJSONAtom(s,e[s])),o=ue(r);return o},Sr._helper.niceprint=function(e,t,r){return"JSON"===e.ctype?Sr.niceprint(e,t,r):E(e)},Sr.niceprint=function(e,t,r){if(!r&&((r={printedWarning:!1,visitedMap:{}}).visitedMap.tracker=new WeakMap,r.visitedMap.level=0,r.visitedMap.maxLevel=1e3,r.visitedMap.maxElVisit=5e3,t&&t.maxDepth)){var n=ue(t.maxDepth);"number"===n.ctype&&(r.visitedMap.maxLevel=n.value.real)}var i=r.visitedMap;return i.newLevel=!0,i.level+=1,"{"+Object.keys(e.value).sort().map((function(n){var a=e.value[n];if(i.tracker.has(a)){if(i[a]>i.maxElVisit||i.level>i.maxLevel)return r.printedWarning||(console.log("Warning: We visited a key-value pair very often or encountered a very deeply nested dictionary. Dictionary is probably cyclic. Output will be probably incomplete."),r.printedWarning=!0),n+":...";i.newLevel&&(i.tracker.set(a,i.tracker.get(a)+1),i.newLevel=!1)}else i.tracker.set(a,1);return n+":"+Sr._helper.niceprint(a,t,r)})).join(", ")+"}"},Sr._helper.handlePrintException=function(e){e instanceof RangeError?console.log("Warning: Dictionary string could not be generated! Probably large cyclic Dictionary!"):e instanceof SyntaxError?console.log("Warning: Dictionary string could not be parsed!"):console.log("Warning: Dictionary printing failed!")};var Mr={key:function(e){return"string"===e.ctype?"s"+e.value.length+":"+e.value+";":"number"===e.ctype?"n"+e.value.real+","+e.value.imag+";":"list"===e.ctype?"l"+e.value.length+":"+e.value.map(Mr.key).join(",")+";":"boolean"===e.ctype?"b"+e.value+";":"dict"===e.ctype?"d"+(e=Object.keys(e.value).sort()).length+":"+e.join(",")+";":("undefined"!==e.ctype&&xt.err("Bad dictionary key: "+E(e)),"undef")},create:function(){return{ctype:"dict",value:{}}},clone:function(e){var t,r=Mr.create();for(t in e.value)e.value.hasOwnProperty(t)&&(r.value[t]=e.value[t]);return r},put:function(e,t,r){e.value[Mr.key(t)]={key:t,value:r}},get:function(e,t,r){return(e=e.value[Mr.key(t)])?e.value:r},niceprint:function(e){return"{"+Object.keys(e.value).sort().map((function(t){return E((t=e.value[t]).key)+":"+E(t.value)})).join(", ")+"}"}},Tr={_helper:{},order:{undefined:0,boolean:1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(e){return{ctype:"string",value:e}},bool:function(e){return{ctype:"boolean",value:e}},not:function(e){return Tr.bool(!e.value)},isLessThan:function(e,t){return-1===Tr.compare(e,t)},isEqual:function(e,t){return 0===Tr.compare(e,t)},compareResults:function(e,t){return Tr.compare(e.result,t.result)},compare:function(e,t){return e.ctype!==t.ctype?Tr.order[e.ctype]-Tr.order[t.ctype]:"number"===e.ctype?yr._helper.compare(e,t):"list"===e.ctype?wr._helper.compare(e,t):"geo"===e.ctype?e.value.name===t.value.name?0:e.value.name<t.value.name?-1:1:"string"===e.ctype?e.value===t.value?0:e.value<t.value?-1:1:"boolean"===e.ctype?e.value===t.value?0:!1===e.value?-1:1:void 0},add:function(e,t){return"void"===e.ctype&&"number"===t.ctype||"void"===e.ctype&&"list"===t.ctype?t:"number"===e.ctype&&"number"===t.ctype?yr.add(e,t):"string"===e.ctype||"string"===t.ctype?{ctype:"string",value:E(e)+E(t)}:"list"===e.ctype&&"list"===t.ctype?wr.add(e,t):l},sub:function(e,t){return"void"===e.ctype&&"number"===t.ctype?yr.neg(t):"void"===e.ctype&&"list"===t.ctype?wr.neg(t):"number"===e.ctype&&"number"===t.ctype?yr.sub(e,t):"list"===e.ctype&&"list"===t.ctype?wr.sub(e,t):l},mult:function(e,t){return"number"===e.ctype&&"number"===t.ctype?yr.mult(e,t):"number"===e.ctype&&"list"===t.ctype?wr.scalmult(e,t):"list"===e.ctype&&"number"===t.ctype?wr.scalmult(t,e):"list"===e.ctype&&"list"===t.ctype?wr.mult(e,t):l},div:function(e,t){return"number"===e.ctype&&"number"===t.ctype?yr.div(e,t):"list"===e.ctype&&"number"===t.ctype?wr.scaldiv(t,e):l},max:function(e,t){return"number"===e.ctype&&"number"===t.ctype?yr.max(e,t):"list"===e.ctype&&"list"===t.ctype?wr.max(e,t):l},min:function(e,t){return"number"===e.ctype&&"number"===t.ctype?yr.min(e,t):"list"===e.ctype&&"list"===t.ctype?wr.min(e,t):l},wrap:function(e){if("number"==typeof e)return yr.real(e);if("object"==typeof e&&void 0!==e.length){for(var t=[],r=0;r<e.length;r++)t[r]=Tr.wrap(e[r]);return wr.turnIntoCSList(t)}return"string"==typeof e?{ctype:"string",value:e}:"boolean"==typeof e?{ctype:"boolean",value:e}:l},unwrap:function(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map(Tr.unwrap);switch(e.ctype){case"string":case"boolean":return e.value;case"number":return 0===e.value.imag?e.value.real:{r:e.value.real,i:e.value.imag};case"list":return e.value.map(Tr.unwrap);default:return null}},withUsage:function(e,t){return{ctype:e.ctype,value:e.value,usage:t}},wrapJSON:function(e){switch(typeof e){case"number":return yr.real(e);case"string":return Tr.string(e);case"boolean":return Tr.bool(e);case"object":if(null===e)return l;if(Array.isArray(e))return wr.turnIntoCSList(e.map(Tr.wrapJSON));var t,r=Mr.create();for(t in e)Mr.put(r,Tr.string(t),Tr.wrapJSON(e[t]));return r;default:return console.log("Failed to convert "+typeof e+" to CindyJS data type"),l}},identity:function(e){return e},deeplyEqual:function(e,t){if("object"!=typeof e||"object"!=typeof t||null===e||null===t)return e===t;var r,n=0;for(r in e)if(++n,!(r in t)||!Tr.deeplyEqual(e[r],t[r]))return!1;for(r in t)--n;return 0===n}},Ir={},Lr={};Lr[":"]=O(":"),Lr[""]=function(e,t){return"number"===(t=ce(e[0])).ctype&&"void"===e[1].ctype?Tr.withUsage(yr.realmult(Math.PI/180,t),"Angle"):l},Lr._=V,Lr["^"]=X,Lr[""]=function(e,t){return"void"===e[0].ctype?Or.sqrt$1([e[1]],t):l},Lr["*"]=B,Lr[""]=Y,Lr["/"]=F,Lr["+"]=D,Lr["-"]=$,Lr["!"]=function(e,t){return t=ce(e[1]),"void"===e[0].ctype&&"boolean"===t.ctype?{ctype:"boolean",value:!t.value}:l},Lr["=="]=A,Lr["~="]=z,Lr["~<"]=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype&&yr._helper.isAlmostReal(t)&&yr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real-e.value.real<=-yr.eps}:l},Lr["~>"]=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype&&yr._helper.isAlmostReal(t)&&yr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real-e.value.real>=yr.eps}:l},Lr["=:="]=O("=:="),Lr[">="]=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype&&yr._helper.isAlmostReal(t)&&yr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real>=e.value.real}:"string"===t.ctype&&"string"===e.ctype?{ctype:"boolean",value:t.value>=e.value}:l},Lr["<="]=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype&&yr._helper.isAlmostReal(t)&&yr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real<=e.value.real}:"string"===t.ctype&&"string"===e.ctype?{ctype:"boolean",value:t.value<=e.value}:l},Lr["~>="]=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype&&yr._helper.isAlmostReal(t)&&yr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real-e.value.real>-yr.eps}:l},Lr["~<="]=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype&&yr._helper.isAlmostReal(t)&&yr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real-e.value.real<yr.eps}:l},Lr[">"]=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype&&yr._helper.isAlmostReal(t)&&yr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real>e.value.real}:"string"===t.ctype&&"string"===e.ctype?{ctype:"boolean",value:t.value>e.value}:l},Lr["<"]=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype&&yr._helper.isAlmostReal(t)&&yr._helper.isAlmostReal(e)?{ctype:"boolean",value:t.value.real<e.value.real}:"string"===t.ctype&&"string"===e.ctype?{ctype:"boolean",value:t.value<e.value}:l},Lr["<>"]=k,Lr[""]=function(e,t){return t=ue(e[0]),"list"===(e=ue(e[1])).ctype?wr.contains(e,t):l},Lr[""]=function(e,t){return t=ue(e[0]),"list"===(e=ue(e[1])).ctype?Tr.not(wr.contains(e,t)):l},Lr["&"]=j,Lr["%"]=R,Lr["!="]=k,Lr["~!="]=function(e,t){return Tr.not(z(e,t))},Lr[".."]=function(e,t){return t=ue(e[0]),e=ue(e[1]),"number"===t.ctype&&"number"===e.ctype?wr.sequence(t,e):l},Lr["++"]=U,Lr["--"]=G,Lr["~~"]=W,Lr[":>"]=H,Lr["<:"]=J,Lr["="]=N,Lr[":="]=function(e,t,r){if(t="undefined"===e[1].ctype,"undefined"===e[0].ctype||t)return l;if("function"===e[0].ctype){t=e[0].oper;var n=e[0].args,i=e[1],a=1;if(Ir.hasOwnProperty(t)){if((a=Ir[t]).definer===r)return l;a=a.generation+1}Ir[t]={oper:t,body:i,arglist:n,definer:r,generation:a}}return"variable"===e[0].ctype&&Nr.setvar(e[0].name,e[1]),l},Lr[":=_"]=function(e,t){return"void"!==e[1].ctype||"function"===e[0].ctype&&delete Ir[e[0].oper],l},Lr["::="]=O("::="),Lr[";"]=function(e,t){t="void"===e[0].ctype;var r="void"===e[1].ctype;return t&&r?l:!t&&r?ue(e[0]):(t||r||ue(e[0]),r?l:ue(e[1]))},E.errorTypes=["_?_","_??_","_???_","___"];var Or={},Er={evaluate:function(e,t,r){if(Ir.hasOwnProperty(e)){if(void 0===(e=Ir[e]))t=l;else{var n=[];for(r=0;r<e.arglist.length;r++)n[r]=ue(t[r]);for(r=0;r<e.arglist.length;r++)Nr.newvar(e.arglist[r].name),Nr.setvar(e.arglist[r].name,n[r]);for(Nr.pushVstack("*"),t=ue(e.body),Nr.cleanVstack(),r=0;r<e.arglist.length;r++)Nr.removevar(e.arglist[r].name)}return t}if(n=Or[e])return n(t,r);var i=e.lastIndexOf("$");return-1!==i&&(i=e.substr(0,i),n=Or[i])?n(t,r):(xt.err("Called undefined function "+i+" (as "+e+")"),l)},equals:function(e,t){return"number"===e.ctype&&"number"===t.ctype?{ctype:"boolean",value:e.value.real===t.value.real&&e.value.imag===t.value.imag}:"string"===e.ctype&&"string"===t.ctype||"boolean"===e.ctype&&"boolean"===t.ctype?{ctype:"boolean",value:e.value===t.value}:"list"===e.ctype&&"list"===t.ctype?wr.equals(e,t):"geo"===e.ctype&&"geo"===t.ctype?{ctype:"boolean",value:e.value===t.value}:{ctype:"boolean",value:!1}}},Nr={};Nr.vars=function(){var e,t={pi:yr.real(Math.PI),"":yr.real(Math.PI),i:yr.complex(0,1),true:Tr.bool(!0),false:Tr.bool(!1),"#":l,nil:wr.turnIntoCSList([]),newline:Tr.string("\n"),tab:Tr.string("\t")},r=[];for(e in t)r[e]=[t[e]];return r}(),Nr.isVariable=function(e){return this.vars.hasOwnProperty(e)},Nr.create=function(e){if(this.vars.hasOwnProperty(e))return this.vars[e];return this.vars[e]=[null]},Nr.newvar=function(e){return(e=this.vars[e]).push(l),e},Nr.removevar=function(e){var t=this.vars[e];0===t.length&&console.error("Removing non-existing "+e),t.pop(),0===t.length&&console.warn("Removing last "+e)},Nr.setvar=function(e,t){var r=this.vars[e];0===r.length&&console.error("Setting non-existing variable "+e),void 0===t&&(console.error("Setting variable "+e+" to undefined value"),t=l),"undefined"===t.ctype?r[r.length-1]=t:(null===(e=t)&&(e=l),r[r.length-1]=e)},Nr.undefinedWarning={},Nr.getvar=function(e){var t=this.vars[e]||[];return 0===t.length&&console.error("Getting non-existing variable "+e),null===(t=t[t.length-1])?It.csnames.hasOwnProperty(e)?{ctype:"geo",value:It.csnames[e]}:(console&&console.log&&void 0===this.undefinedWarning[e]&&(this.undefinedWarning[e]=!0,console.log("Warning: Accessing undefined variable: "+e)),l):t},Nr.dump=function(e){var t=this.vars[e];for(console.log("*** Dump "+e),e=0;e<t.length;e++)console.log(e+":> "+E(t[e]))},Nr.vstack=[],Nr.pushVstack=function(e){this.vstack.push(e)},Nr.popVstack=function(){this.vstack.pop()},Nr.cleanVstack=function(){for(var e=this.vstack;0<e.length&&"*"!==e[e.length-1];)this.removevar(e[e.length-1]),e.pop();0<e.length&&e.pop()};var Ar={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",fillcolor:"fillcolor",fillalpha:"fillalpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",trace:"",tracelength:"",selected:"",labeled:"labeled",labelled:"labeled"},getGeoField:function(e,t){return void 0!==It.csnames[e]?Ar.getField(It.csnames[e],t):l},setGeoField:function(e,t,r){return void 0!==It.csnames[e]?Ar.setField(It.csnames[e],t,r):l},getField:function(e,t){if("P"===e.kind){if("xy"===t)return e=wr.dehom(e.homog),Tr.withUsage(e,"Point");if("homog"===t)return Tr.withUsage(e.homog,"Point");if("x"===t)return yr.div(e.homog.value[0],e.homog.value[2]);if("y"===t)return yr.div(e.homog.value[1],e.homog.value[2]);if("narrow"===t)return Tr.wrap(e.narrow)}if("L"===e.kind||"S"===e.kind){if("homog"===t)return Tr.withUsage(e.homog,"Line");if("angle"===t)return e=wr.eucangle(wr.ey,e.homog),Tr.withUsage(e,"Angle");if("slope"===t)return yr.neg(yr.div(e.homog.value[0],e.homog.value[1]))}if("Tr"===e.kind&&"matrix"===t)return e.matrix;if("C"===e.kind){if("radius"===t){var r=e.matrix;e=r.value[0].value[0];var n=r.value[0].value[2];return t=r.value[1].value[2],r=r.value[2].value[2],yr.mult(e,e),n=yr.div(n,e),t=yr.div(t,e),e=yr.div(r,e),yr.sqrt(yr.sub(yr.add(yr.mult(n,n),yr.mult(t,t)),e))}if("size"===t)return e.size;if("matrix"===t)return e.matrix;if("center"===t)return e=qn._helper.CenterOfConic(e.matrix),e=wr.dehom(e),Tr.withUsage(e,"Point");if("dualMatrix"===t)return wr.normalizeMax(wr.adjoint3(e.matrix));if("narrow"===t)return Tr.wrap(e.narrow)}if("Text"===e.kind){if("pressed"===t)return e.checkbox?Tr.bool(e.checkbox.checked):Tr.bool(!1);if("xy"===t)return e=wr.dehom(e.homog),Tr.withUsage(e,"Point");if("homog"===t)return Tr.withUsage(e.homog,"Point");if("x"===t)return yr.div(e.homog.value[0],e.homog.value[2]);if("y"===t)return yr.div(e.homog.value[1],e.homog.value[2])}if("trace"===t)return Tr.bool(!!e.drawtrace);if("pinned"===t)return Tr.bool(!!e.pinned);if(Ar.generalFields[t])return(e=e[Ar.generalFields[t]])&&e.ctype?e:"object"!=typeof e?Tr.wrap(e):l;if(e.behavior){if("mass"===t&&"Mass"===e.behavior.type)return yr.real(e.behavior.mass);if("radius"===t&&"Mass"===e.behavior.type)return yr.real(e.behavior.radius);if("charge"===t&&"Mass"===e.behavior.type)return yr.real(e.behavior.charge);if("friction"===t&&"Mass"===e.behavior.type)return yr.real(e.behavior.friction);if("vx"===t&&"Mass"===e.behavior.type)return yr.real(e.behavior.vx);if("vy"===t&&"Mass"===e.behavior.type)return yr.real(e.behavior.vy);if("v"===t&&"Mass"===e.behavior.type)return wr.realVector([e.behavior.vx,e.behavior.vy]);if("fx"===t&&"Mass"===e.behavior.type)return yr.real(e.behavior.fx);if("fy"===t&&"Mass"===e.behavior.type)return yr.real(e.behavior.fy);if("f"===t&&"Mass"===e.behavior.type)return wr.realVector([e.behavior.fx,e.behavior.fy]);if("ldiff"===t&&"Spring"===e.behavior.type)return yr.real(e.behavior.ldiff)}return"function"==typeof(t=qn[e.type]["get_"+t])?t(e):l},setField:function(e,t,r){if("color"===t&&wr._helper.isNumberVecN(r,3)&&(e.color=r),"size"===t&&"number"===r.ctype&&(e.size=r),"alpha"===t&&"number"===r.ctype&&(e.alpha=r),"fillcolor"===t&&wr._helper.isNumberVecN(r,3)&&(e.fillcolor=r),"fillalpha"===t&&"number"===r.ctype&&(e.fillalpha=r),"visible"===t&&"boolean"===r.ctype&&(e.visible=r.value),"pinned"===t&&"boolean"===r.ctype&&(e.pinned=r.value),"labeled"!==t&&"labelled"!==t||"boolean"!==r.ctype||(e.labeled=r.value),"printlabel"===t&&(e.printname=E(r)),"trace"===t&&"boolean"===r.ctype&&(r.value&&!e.drawtrace?(e.drawtrace=!0,Ae(e)):e.drawtrace=r.value),"P"===e.kind&&e.movable&&("xy"===t&&wr._helper.isNumberVecN(r,2)&&Je(e,wr.turnIntoCSList([r.value[0],r.value[1],yr.real(1)]),"homog"),"xy"===t&&wr._helper.isNumberVecN(r,3)&&Je(e,r,"homog"),"x"===t&&"number"===r.ctype&&Je(e,wr.turnIntoCSList([yr.mult(r,e.homog.value[2]),e.homog.value[1],e.homog.value[2]]),"homog"),"y"===t&&"number"===r.ctype&&Je(e,wr.turnIntoCSList([e.homog.value[0],yr.mult(r,e.homog.value[2]),e.homog.value[2]]),"homog"),"homog"===t&&wr._helper.isNumberVecN(r,3)&&Je(e,r,"homog")),"homog"===t&&"L"===e.kind&&e.movable&&wr._helper.isNumberVecN(r,3)&&Je(e,r,"homog"),"Text"===e.kind&&("pressed"===t&&"boolean"===r.ctype&&e.checkbox&&(e.checkbox.checked=r.value),e.movable&&("xy"===t?wr._helper.isNumberVecN(r,2)?e.homog=wr.turnIntoCSList([r.value[0],r.value[1],yr.real(1)]):wr._helper.isNumberVecN(r,3)&&(e.homog=r):"homog"===t&&wr._helper.isNumberVecN(r,3)?e.homog=r:"x"===t&&"number"===r.ctype?e.homog=wr.turnIntoCSList([yr.mult(r,e.homog.value[2]),e.homog.value[1],e.homog.value[2]]):"y"===t&&"number"===r.ctype&&(e.homog=wr.turnIntoCSList([e.homog.value[0],yr.mult(r,e.homog.value[2]),e.homog.value[2]])))),e.behavior&&("mass"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.mass=r.value.real),"mass"===t&&"Sun"===e.behavior.type&&"number"===r.ctype&&(e.behavior.mass=r.value.real),"friction"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.friction=r.value.real),"charge"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.charge=r.value.real),"radius"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.radius=r.value.real),"vx"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.vx=r.value.real),"vy"===t&&"Mass"===e.behavior.type&&"number"===r.ctype&&(e.behavior.vy=r.value.real),"v"===t&&"Mass"===e.behavior.type&&wr._helper.isNumberVecN(r,2)&&(e.behavior.vx=r.value[0].value.real,e.behavior.vy=r.value[1].value.real)),"narrow"===t&&-1!==["P","C"].indexOf(e.kind)&&("boolean"===r.ctype&&(e.narrow=r.value),"number"===r.ctype&&yr._helper.isAlmostReal(r)&&(e.narrow=r.value.real)),"function"==typeof(t=qn[e.type]["set_"+t]))return t(e,r)},getuserData:function(e,t){var r;return"string"===t.ctype&&e.userData&&e.userData[t.value]&&(r=e.userData[t.value]),r&&r.ctype?r:"object"!=typeof r?Tr.wrap(r):l},setuserData:function(e,t,r){t&&"string"===t.ctype&&e&&r&&(e.userData||(e.userData={}),e.userData[t.value]=r)}};Or.version$0=function(e,t){return e=["CindyJS"].concat(gr),wr.turnIntoCSList(e.map(Tr.wrap))},Or.clearconsole$0=function(e,t){xt.clear()},Or.err$1=function(e,t){return t="","variable"===e[0].ctype?(t=e[0].name,e=Nr.getvar(e[0].name)):e=e[0],he(e=t+" ===> "+E(ue(e))),l},Or.errc$1=function(e,t){return"variable"===e[0].ctype?(t=ue(Nr.getvar(e[0].name)),console.log(e[0].name+" ===> "+E(t))):(t=ue(e[0]),console.log(" ===> "+E(t))),l},Or.print$1=function(e,t){return xt.out(E(ue(e[0]),t),!0),l},Or.println$1=function(e,t){return xt.out(E(ue(e[0]))),l},Or.assert$2=function(e,t){var r=ue(e[0]);if("boolean"===r.ctype){if(!1===r.value)return Or.println$1([e[1]],t)}else he("Condition for assert is not boolean");return l},Or.dump$1=function(e,t){return console.log(JSON.stringify(e[0])),l},Or.repeat$2=function(e,t){return Or.repeat$3([e[0],null,e[1]],t)},Or.repeat$3=function(e,t){var r=ce(e[0]),n="#";if(null!==e[1]&&"variable"===e[1].ctype&&(n=e[1].name),"number"!==r.ctype)return l;var i=1,a=1,o=(r=Math.round(r.value.real))+1,s=!1,u=!1,c=!1;if(void 0!==t.start){var p=ue(t.start);"number"===p.ctype&&(s=!0,a=p.value.real)}for(void 0!==t.step&&("number"===(p=ue(t.step)).ctype&&(c=!0,i=p.value.real)),void 0!==t.stop&&("number"===(p=ue(t.stop)).ctype&&(u=!0,o=p.value.real)),!s||u||c||(o=i*r+a),s||!u||c||(a=-i*(r-1)+o,o+=i),s||u||!c||(o=i*r+a),s&&u&&!c&&(o+=i=(o-a)/(r-1)),s&&!u&&c&&(o=i*r+a),!s&&u&&c&&(a=-i*(r-1)+o,o+=i),s&&u&&c&&(o+=i),(a<=o&&0<i||a>=o&&0>i)&&s&&u&&c&&(r=Math.floor((o-a)/i)),Nr.newvar(n),t=l,o=0;o<r;o++)Nr.setvar(n,{ctype:"number",value:{real:o*i+a,imag:0}}),t=ue(e[2]);return Nr.removevar(n),t},Or.while$2=function(e,t){t=e[1];for(var r=ue(e=e[0]),n=l;"list"!==r.ctype&&r.value;)n=ue(t),r=ue(e);return n},Or.apply$2=function(e,t){return Or.apply$3([e[0],null,e[1]],t)},Or.apply$3=function(e,t){return Or.apply$4([e[0],e[1],null,e[2]],t)},Or.apply$4=function(e,t){if("list"!==(t=ce(e[0])).ctype&&"JSON"!==t.ctype)return l;var r="#";if(null!==e[1]&&"variable"===e[1].ctype&&(r=e[1].name),null!==e[2]&&"variable"===e[2].ctype){var n=e[2].name;Nr.newvar(n)}var i=t.value,a="list"===t.ctype?[]:{};if(Nr.newvar(r),void 0!==n){if("list"===t.ctype)for(var o=0;o<i.length;o++)Nr.setvar(n,yr.real(o+1)),Nr.setvar(r,i[o]),a[o]=ue(e[3]);else for(o in i)Nr.setvar(n,Tr.string(o)),Nr.setvar(r,i[o]),a[o]=ue(e[3]);Nr.removevar(n)}else if("list"===t.ctype)for(a=[],n=0;n<i.length;n++)Nr.setvar(r,i[n]),a[n]=ue(e[3]);else for(var s in i)Nr.setvar(r,i[s]),a[s]=ue(e[3]);return Nr.removevar(r),"list"===t.ctype?wr.turnIntoCSList(a):Sr.turnIntoCSJson(a)},Or.forall$2=function(e,t){return Or.forall$3([e[0],null,e[1]],t)},Or.forall$3=function(e,t){var r=ce(e[0]);if("list"!==r.ctype&&"JSON"!==r.ctype)return l;var n="#";null!==e[1]&&"variable"===e[1].ctype&&(n=e[1].name);var i=r.value;if(Nr.newvar(n),"list"===r.ctype)for(t=0;t<i.length;t++){Nr.setvar(n,i[t]);var a=ue(e[2])}else a=Sr._helper.forall(i,n,e[2],t);return Nr.removevar(n),a},Or.select$2=function(e,t){return Or.select$3([e[0],null,e[1]],t)},Or.select$3=function(e,t){var r=ce(e[0]);if("list"!==r.ctype&&"JSON"!==r.ctype)return l;t="#",null!==e[1]&&"variable"===e[1].ctype&&(t=e[1].name);var n=r.value;if(Nr.newvar(t),"list"===r.ctype){r=[];for(var i=0,a=0;a<n.length;a++){Nr.setvar(t,n[a]);var o=ue(e[2]);"boolean"===o.ctype&&!0===o.value&&(r[i]=n[a],i++)}e={ctype:"list",value:r}}else{for(i in r={},n)Nr.setvar(t,n[i]),"boolean"===(o=ue(e[2])).ctype&&!0===o.value&&(r[i]=n[i]);e={ctype:"JSON",value:r}}return Nr.removevar(t),e},Or.flatten$1=function(e,t){return"list"!==(e=ce(e[0])).ctype?e:(void 0===(t=t.levels)?t=1:t="number"===(t=ue(t)).ctype?t.value.real:"string"===t.ctype&&"all"===t.value?-2:1,{ctype:"list",value:function e(t,r){return-1===r||"list"!==t.ctype?t:[].concat.apply([],t.value.map((function(t){return e(t,r-1)})))}(e,t)})},Or.createvar$1=function(e,t){return"variable"===e[0].ctype&&Nr.newvar(e[0].name),l},Or.local=function(e,t){for(t=0;t<e.length;t++)"variable"===e[t].ctype&&Nr.newvar(e[t].name);return l},Or.removevar$1=function(e,t){return t=ue(e[0]),"variable"===e[0].ctype&&Nr.removevar(e[0].name),t},Or.release=function(e,t){if(0===e.length)return l;t=ue(e[e.length-1]);for(var r=0;r<e.length;r++)"variable"===e[r].ctype&&Nr.removevar(e[r].name);return t},Or.regional=function(e,t){for(t=0;t<e.length;t++)if("variable"===e[t].ctype){var r=e[t].name;Nr.newvar(r),Nr.pushVstack(r)}return l},Or.genList=function(e,t){return wr.turnIntoCSList(e.map(ue))},Or.genJSON=function(e,t){t={};for(var r=0;r<e.length;r++){var n=Sr.GenFromUserDataEl(e[r]);n.key&&(t[n.key]=n.val)}return{ctype:"JSON",value:t}},Er.assigntake=function(e,t){var r=e.args[0],n=ue(r);e=ce(e.args[1]);var i=l;if("list"===n.ctype||"string"===n.ctype){var a=Math.floor(e.value.real);0>a&&(a=n.value.length+a+1),0<a&&a<=n.value.length&&("list"===n.ctype?((i=n.value.slice())[a-1]=ue(t),i=wr.turnIntoCSList(i),n.userData&&(i.userData=n.userData)):(i=(i=n.value).substring(0,a-1)+E(ue(t))+i.substring(a,i.length),i=Tr.string(i)))}"JSON"===n.ctype&&(e=E(e),-1===E.errorTypes.indexOf(e)&&((i=Sr._helper.ShallowClone(n)).value[e]=ue(t))),N([r,i])},Er.assigndot=function(e,t){var r=ue(e.obj);return e=e.key,"geo"===r.ctype&&"string"==typeof e&&Ar.setField(r.value,e,ce(t)),"JSON"===r.ctype&&"string"==typeof e&&Sr.setField(r.value,e,ce(t)),l},Er.assigncolon=function(e,t){var r=e.obj,n=ue(r);if("_?_"===(e=Tr.string(E(ue(e.key)))).value&&(e=l),"geo"===n.ctype&&e)Ar.setuserData(n.value,e,ce(t));else if("list"===n.ctype||"string"===n.ctype&&e){var i,a={};for(i in n)a[i]=n[i];if(a.userData){for(var o in n={},a.userData)n[o]=a.userData[o];a.userData=n}else a.userData={};a.userData[e.value]=ce(t),N([r,a])}else e&&"string"===e.ctype?console.log("User data can only be assigned to geo objects and lists."):console.log("Key is undefined");return l},Or.keys$1=function(e,t){var r=(t=ue(e[0])).ctype;return"geo"===r||"list"===r||"JSON"===r?(e=[],(t="geo"===r?t.value.userData:"list"===r?t.userData:t.value)&&(e=Object.keys(t).map(Tr.string).sort()),wr.turnIntoCSList(e)):l},Or.values$1=function(e,t){if("list"===(t=(e=ue(e[0])).ctype))return e;if("geo"===t||"JSON"===t){var r,n=[];return(r="geo"===t?e.value.userData:e.value)&&(n=Object.keys(r).sort().map((function(e){return r[e]}))),wr.turnIntoCSList(n)}return l},Er.assignlist=function(e,t){var r=e.length,n=t.length;for(n<r&&(r=n),n=0;n<r;n++)N([e[n],t[n]],[])},Or.if$2=function(e,t){return Or.if$3(e,t)},Or.if$3=function(e,t){if("boolean"===(t=ce(e[0])).ctype){if(!0===t.value)return ue(e[1]);if(3===e.length)return ue(e[2])}else he("Condition for if is not boolean");return l},Or.and$2=j,Or.or$2=R,Or.xor$2=function(e,t){return t=ce(e[0]),e=ce(e[1]),"boolean"===t.ctype&&"boolean"===e.ctype?{ctype:"boolean",value:t.value!==e.value}:l},Or.not$1=function(e,t){return"boolean"===(e=ce(e[0])).ctype?{ctype:"boolean",value:!e.value}:l},Er.genericListMathGen=function(e,t,r){Or[e+"$1"]=function(e,n){if("list"!==(e=ue(e[0])).ctype)return l;if(0===(e=e.value).length)return r;n=e[0];for(var i=1;i<e.length;i++)n=t(n,e[i]);return n};var n=e+"$3";Or[e+"$2"]=function(e,t){return Or[n]([e[0],null,e[1]])},Or[n]=function(e,n){if("list"!==(n=ce(e[0])).ctype)return l;if(0===(n=n.value).length)return r;var i="#";null!==e[1]&&"variable"===e[1].ctype&&(i=e[1].name),Nr.newvar(i),Nr.setvar(i,n[0]);for(var a=ue(e[2]),o=1;o<n.length;o++){Nr.setvar(i,n[o]);var s=ue(e[2]);a=t(a,s)}return Nr.removevar(i),a}},Er.genericListMathGen("product",Tr.mult,yr.real(1)),Er.genericListMathGen("sum",Tr.add,yr.real(0)),Er.genericListMathGen("max",Tr.max,l),Er.genericListMathGen("min",Tr.min,l),Or.max$2=function(e,t){return"list"===(t=ce(e[0])).ctype?Or.max$3([t,null,e[1]]):(e=ce(e[1]),Or.max$1([wr.turnIntoCSList([t,e])]))},Or.min$2=function(e,t){return"list"===(t=ce(e[0])).ctype?Or.min$3([t,null,e[1]]):(e=ce(e[1]),Or.min$1([wr.turnIntoCSList([t,e])]))},Or.add$2=D,Or.sub$2=$,Or.mult$2=B,Or.div$2=F,Or.mod$2=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype?yr.mod(t,e):l},Or.pow$2=X,Or.exp$1=function(e,t){return"number"===(e=ce(e[0])).ctype?yr.exp(e):l},Or.sin$1=function(e,t){return"number"===(e=ce(e[0])).ctype?yr.sin(e):l},Or.sqrt$1=function(e,t){return"number"===(e=ce(e[0])).ctype?yr.sqrt(e):l},Er.laguerre=function(e,t,r){if("list"!==e.ctype)return l;var n,i=e.value.length-1;for(n=0;n<=i;n++)if("number"!==e.value[n].ctype)return l;if("number"!==t.ctype)return l;for(var a,o,s,u=[1,.3141,.5926,.5358,.9793,.2385,.6264,.3383,.2795,.0288],c=1;c<=r;c++){for(o=s=yr.zero,a=e.value[i],n=i-1;0<=n;n--)s=yr.add(o,yr.mult(s,t)),o=yr.add(a,yr.mult(o,t)),a=yr.add(e.value[n],yr.mult(a,t));if(yr._helper.isLessThan(yr.abs(a),yr.real(1e-14)))break;if(n=yr.div(o,a),o=yr.mult(n,n),a=yr.sub(o,yr.div(yr.mult(yr.real(2),s),a)),s=yr.sqrt(yr.mult(yr.real(i-1),yr.sub(yr.mult(yr.real(i),a),o))),a=yr.add(n,s),n=yr.sub(n,s),yr._helper.isLessThan(yr.abs(a),yr.abs(n))&&(a=n),n=yr._helper.isLessThan(yr.real(1e-14),yr.abs(a))?yr.div(yr.real(i),a):yr.mult(yr.add(yr.abs(t),yr.one),yr.complex(Math.cos(c),Math.sin(c))),yr._helper.isLessThan(yr.abs(n),yr.real(1e-14)))break;0==c%20&&c<r-19&&(n=yr.mult(n,yr.real(u[Math.floor(c/20)]))),t=yr.sub(t,n)}return t},Er.quadratic_roots=function(e){if("list"!==e.ctype)return l;var t=e.value[2],r=e.value[1];if(e=e.value[0],yr._helper.isZero(e))return[yr.zero,yr.neg(yr.div(r,t))];var n=yr.sqrt(yr.sub(yr.mult(r,r),yr.mult(yr.real(4),yr.mult(t,e))));return 0<=yr.re(r)&&(n=yr.neg(n)),[yr.div(yr.sub(n,r),yr.mult(yr.real(2),t)),yr.div(yr.mult(yr.real(2),e),yr.sub(n,r))]},Er.roots=function(e){var t=[],r=e,n=e.value.length-1;if(0>=n)return wr.turnIntoCSList([]);if(yr._helper.isZero(e.value[n]))return t=Er.roots(wr.turnIntoCSList(e.value.slice(0,n))),wr.append(t,yr.infinity);if(1===n)t[0]=yr.neg(yr.div(e.value[0],e.value[1]));else if(2===n)t=Er.quadratic_roots(e);else{for(var i=0;i<n-2;i++){t[i]=Er.laguerre(e,yr.zero,200),t[i]=Er.laguerre(r,t[i],1);var a=[];a[n-i]=e.value[n-i];for(var o=n-i;0<o;o--)a[o-1]=yr.add(e.value[o-1],yr.mult(a[o],t[i]));a.shift(),e=wr.turnIntoCSList(a)}e=Er.quadratic_roots(e),t[n-2]=e[0],t[n-1]=e[1]}return wr.turnIntoCSList(t)},Or.roots$1=function(e,t){if("list"===(e=ce(e[0])).ctype){for(t=0;t<e.value.length;t++)if("number"!==e.value[t].ctype)return l;return e=Er.roots(e),wr.sort1(e)}return l},Or.autodiff$3=function(e,t){if(t="x","function"===e[0].ctype){var r=Ir[e[0].oper].body;t=e[0].args[0].name}else{if("function"!=typeof e[0].impl)return he("could not parse function"),l;r=e[0]}var n=ce(e[1]);return 1>(e=ce(e[2])).value.real?(he("grade cant be < 1"),l):(e=yr.add(e,yr.real(1)),cn.autodiff(r,t,n,e))},Or.cos$1=function(e,t){return"number"===(e=ce(e[0])).ctype?yr.cos(e):l},Or.tan$1=function(e,t){return"number"===(e=ce(e[0])).ctype?yr.tan(e):l},Or.arccos$1=function(e,t){return"number"===(e=ce(e[0])).ctype?yr.arccos(e):l},Or.arcsin$1=function(e,t){return"number"===(e=ce(e[0])).ctype?yr.arcsin(e):l},Or.arctan$1=function(e,t){return"number"===(e=ce(e[0])).ctype?yr.arctan(e):l},Or.arctan2$2=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype?yr.arctan2(t,e):l},Or.arctan2$1=function(e,t){if("list"===(e=ce(e[0])).ctype&&2===e.value.length){if("number"===(e=e.value)[0].ctype&&"number"===e[1].ctype)return Or.arctan2$2(e,t)}else if("number"===e.ctype)return yr.arctan2(e);return l},Or.log$1=function(e,t){return"number"===(e=ce(e[0])).ctype?yr.log(e):l},Er.recursiveGen=function(e){var t=yr[e],r=wr[e];Or[e+"$1"]=function(e,n){return"number"===(e=ce(e[0])).ctype?t(e):"list"===e.ctype?r(e):l}},Er.recursiveGen("im"),Er.recursiveGen("re"),Er.recursiveGen("conjugate"),Er.recursiveGen("round"),Er.recursiveGen("ceil"),Er.recursiveGen("floor"),Er.recursiveGen("abs"),Or.abs_infix=Or.abs$1,Or.random$0=function(e,t){return yr.real(yr._helper.rand())},Or.random$1=function(e,t){return"number"===(e=ce(e[0])).ctype?yr.complex(e.value.real*yr._helper.rand(),e.value.imag*yr._helper.rand()):l},Or.seedrandom$1=function(e,t){return"number"===(e=ce(e[0])).ctype&&yr._helper.seedrandom(e.value.real),l},Or.randomnormal$0=function(e,t){return yr.real(yr._helper.randnormal())},Or.randominteger$1=function(e,t){return"number"===(t=ce(e[0])).ctype?(e=0|t.value.real,t=0|t.value.imag,e=e*yr._helper.rand()|0,t=t*yr._helper.rand()|0,yr.complex(e,t)):l},Or.randomint$1=Or.randominteger$1,Or.randombool$0=function(e,t){return.5<yr._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isreal$1=function(e,t){return"number"===(e=ue(e[0])).ctype&&yr._helper.isAlmostReal(e)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isinteger$1=function(e,t){return"number"===(e=ue(e[0])).ctype&&yr._helper.isAlmostReal(e)&&e.value.real===Math.floor(e.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.iseven$1=function(e,t){return"number"===(e=ue(e[0])).ctype&&yr._helper.isAlmostReal(e)&&e.value.real/2===Math.floor(e.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isodd$1=function(e,t){return"number"===(e=ue(e[0])).ctype&&yr._helper.isAlmostReal(e)&&(e.value.real-1)/2===Math.floor((e.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.iscomplex$1=function(e,t){return"number"===ue(e[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isstring$1=function(e,t){return"string"===ue(e[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.islist$1=function(e,t){return"list"===ue(e[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.ismatrix$1=function(e,t){return e=ue(e[0]),-1!==wr._helper.colNumb(e)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.iscircle$1=function(e,t){return"geo"===(e=ue(e[0])).ctype&&"C"===e.value.kind&&"Circle"===e.value.matrix.usage?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isconic$1=function(e,t){return"geo"===(e=ue(e[0])).ctype&&"C"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isline$1=function(e,t){return"geo"===(e=ue(e[0])).ctype&&"L"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.ispoint$1=function(e,t){return"geo"===(e=ue(e[0])).ctype&&"P"===e.value.kind?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isgeometric$1=function(e,t){return"geo"===ue(e[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isnumbermatrix$1=function(e,t){return e=ue(e[0]),wr.isNumberMatrix(e)},Or.isnumbervector$1=function(e,t){return e=ue(e[0]),wr.isNumberVector(e)},Or.issun$1=function(e,t){return"geo"===(e=ue(e[0])).ctype&&void 0!==e.value.behavior&&"Sun"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.ismass$1=function(e,t){return"geo"===(e=ue(e[0])).ctype&&void 0!==e.value.behavior&&"Mass"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isspring$1=function(e,t){return"geo"===(e=ue(e[0])).ctype&&void 0!==e.value.behavior&&"Spring"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isbouncer$1=function(e,t){return"geo"===(e=ue(e[0])).ctype&&void 0!==e.value.behavior&&"Bouncer"===e.value.behavior.type?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}},Or.isundefined$1=function(e,t){return"undefined"===ue(e[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}};var kr={ArcBy3:"Arc",CenterOfConic:"Center",ConicBy1p4l:"Conic1P4L",ConicBy4p1l:"Conic4P1L",ConicBy5lines:"Conic5L",ConicBy2Foci1P:"ConicFoci",ConicFromPrincipalDirections:"ConicPrincipleDirs",Free:"FreePoint",PolarOfLine:"PolarLine",PolarOfPoint:"PolarPoint",PointOnSegment:"PointOnLine",Button:"Text",ToggleButton:"Text",TrReflectionL:"TrReflection",TrReflectionP:"TrReflection",TrReflectionC:"TrReflection",TrTranslation:"TrProjection",TrSimilarity:"TrProjection",TrAffine:"TrProjection",TransformP:"Transform",TransformL:"Transform",TransformSegment:"Transform",TransformS:"Transform",TransformPolygon:"Transform",TransformArc:"Transform",TransformConic:"Transform",TransformC:"Transform",TrMoebiusP:"Transform",TrMoebiusL:"Transform",TrMoebiusSegment:"Transform",TrMoebiusS:"Transform",TrMoebiusPolygon:"Transform",TrMoebiusArc:"Transform",TrMoebiusCircle:"Transform",TrMoebiusC:"Transform",TrInverseMoebius:"TrInverse",Perp:"Orthogonal",Para:"Parallel",AngleBisector:"AngularBisector",IntersectLC:"IntersectionConicLine",IntersectCirCir:"IntersectionCircleCircle",OtherPointOnCircle:"PointOnCircle"};Or.algorithm$1=function(e,t){if("geo"===(e=ue(e[0])).ctype){var r=(e=e.value).type;return"string"===(t=ce(t.compatibility)).ctype&&/^cinderella$/i.test(t.value)&&(/^Select/.test(r)&&(r=(e=It.csnames[e.args[0]]).type),kr.hasOwnProperty(r)?r=kr[r]:"CircleMr"===r&&(r=e.pinned?"CircleByFixedRadius":"CircleByRadius")),Tr.string(r)}return l},Or.inputs$1=function(e,t){if("geo"===(e=ue(e[0])).ctype){t=(e=e.value).type;var r=[];if(e.args&&(r=e.args.map((function(e){return{ctype:"geo",value:It.csnames[e]}}))),/^Select/.test(t)||qn[t].isMovable)switch(e.kind){case"P":case"L":r.push(e.homog);break;case"C":r.push(e.matrix)}return wr.turnIntoCSList(r)}return l},Or.moveto$2=function(e,t){return t=ue(e[0]),e=ce(e[1]),"geo"===t.ctype&&(t=t.value,wr._helper.isNumberVecN(e,2)?Ar.setField(t,"xy",e):wr._helper.isNumberVecN(e,3)&&Ar.setField(t,"homog",e)),l},Or.continuefromhere$0=function(e,t){return We(),l},Or.matrixrowcolumn$1=function(e,t){return e=ue(e[0]),-1!==wr._helper.colNumb(e)?wr.realVector([e.value.length,e.value[0].value.length]):l},Or.rowmatrix$1=function(e,t){return"list"===(e=ue(e[0])).ctype?wr.turnIntoCSList([e]):l},Or.columnmatrix$1=function(e,t){return"list"===(e=ue(e[0])).ctype?wr.turnIntoCSList(e.value.map((function(e){return wr.turnIntoCSList([e])}))):l},Or.submatrix$3=function(e,t){t=ue(e[0]);var r=ue(e[1]);if(e=ue(e[2]),"list"===t.ctype&&"number"===r.ctype&&"number"===e.ctype){var n=Math.round(r.value.real);e=Math.round(e.value.real),t=t.value.slice(),0<e&&e<=t.length&&t.splice(e-1,1);var i=!0;return t=t.map((function(e){if("list"===e.ctype)return e=e.value.slice(),0<n&&n<=e.length&&e.splice(n-1,1),wr.turnIntoCSList(e);i=!1})),i?wr.turnIntoCSList(t):l}return l},Or.complex$1=function(e,t){var r=ce(e[0]);if("list"===r.ctype&&wr.isNumberVector(r)){if(2===r.value.length)return e=r.value[0],t=r.value[1],yr.complex(e.value.real-t.value.imag,t.value.real+e.value.imag);if(3===r.value.length)return e=r.value[0],t=r.value[1],r=r.value[2],e=yr.div(e,r),t=yr.div(t,r),yr.complex(e.value.real-t.value.imag,t.value.real+e.value.imag)}return l},Or.gauss$1=function(e,t){return"number"===(e=ce(e[0])).ctype?wr.realVector([e.value.real,e.value.imag]):l},Or.cross$2=Y,Or.crossratio$4=function(e,t){t=ue(e[0]);var r=ue(e[1]),n=ue(e[2]);e=ue(e[3]);var i=pe(t),a=pe(r),o=pe(n),s=pe(e);return i!==l&&a!==l&&o!==l&&s!==l?wr.crossratio3(i,a,o,s,wr.ii):"number"===t.ctype&&"number"===r.ctype&&"number"===n.ctype&&"number"===e.ctype?yr.div(yr.mult(yr.sub(t,n),yr.sub(r,e)),yr.mult(yr.sub(t,e),yr.sub(r,n))):l},Or.para$2=function(e,t){t=ce(e[0]);var r=ce(e[1]);e=pe(t);var n=pe(r);if(t!==l&&r!==l){r=r.usage;var i=e,a=n;return"Line"!==t.usage&&"Point"!==r||(i=n,a=e),t=wr.cross(wr.cross(wr.linfty,a),i),Tr.withUsage(t,"Line")}return l},Or.perp$2=function(e,t){t=ce(e[0]);var r=ce(e[1]);e=pe(t);var n=pe(r);if(t!==l&&r!==l){var i=r.usage||n.usage;r=e;var a=n;return"Line"!==(t.usage||e.usage)&&"Point"!==i||(r=n,a=e),t=wr.turnIntoCSList([a.value[0],a.value[1],yr.zero]),t=wr.cross(t,r),Tr.withUsage(t,"Line")}return l},Or.perp$1=function(e,t){return e=ce(e[0]),wr._helper.isNumberVecN(e,2)?wr.turnIntoCSList([yr.neg(e.value[1]),e.value[0]]):l},Or.parallel$2=Or.para$2,Or.perpendicular$2=Or.perp$2,Or.perpendicular$1=Or.perp$1,Or.meet$2=function(e,t){return t=pe(e[0]),e=pe(e[1]),t!==l&&e!==l?(e=wr.cross(t,e),Tr.withUsage(e,"Point")):l},Or.join$2=function(e,t){return t=pe(e[0]),e=pe(e[1]),t!==l&&e!==l?(e=wr.cross(t,e),Tr.withUsage(e,"Line")):l},Or.dist$2=function(e,t){return e=$([ce(e[0]),e=ce(e[1])],[]),Or.abs$1([e],[])},Or.dist_infix=Or.dist$2,Or.point$1=function(e,t){return e=ue(e[0]),wr._helper.isNumberVecN(e,3)||wr._helper.isNumberVecN(e,2)?Tr.withUsage(e,"Point"):e},Or.line$1=function(e,t){return e=ue(e[0]),wr._helper.isNumberVecN(e,3)?Tr.withUsage(e,"Line"):e},Or.det$3=function(e,t){t=pe(e[0]);var r=pe(e[1]);if(e=pe(e[2]),t!==l&&r!==l&&e!==l)return wr.det3(t,r,e)},Or.det$1=function(e,t){return"list"===(e=ce(e[0])).ctype&&(-1!==(t=wr._helper.colNumb(e))&&t===e.value.length)?wr.det(e):l},Or.eig$1=function(e,t){return"list"===(e=ce(e[0])).ctype&&(-1!==(t=wr._helper.colNumb(e))&&t===e.value.length)?wr.eig(e):l},Or.eigenvalues$1=function(e,t){return"list"===(e=ce(e[0])).ctype&&(-1!==(t=wr._helper.colNumb(e))&&t===e.value.length)?wr.eig(e,!1).value[0]:l},Or.rank$1=function(e,t){if("list"===(e=ce(e[0])).ctype){var r=wr._helper.colNumb(e);if(-1!==r&&r===e.value.length)return wr.rank(e,t.precision)}return l},Or.kernel$1=function(e,t){if("list"===(e=ce(e[0])).ctype){var r=wr._helper.colNumb(e);if(-1!==r&&r===e.value.length)return t=wr.nullSpace(e,t.precision),wr.transpose(t)}return l},Or.eigenvectors$1=function(e,t){return"list"===(e=ce(e[0])).ctype&&(-1!==(t=wr._helper.colNumb(e))&&t===e.value.length)?wr.eig(e).value[1]:l},Or.area$3=function(e,t){t=pe(e[0]);var r=pe(e[1]);if(e=pe(e[2]),t!==l&&r!==l&&e!==l){var n=t.value[2],i=r.value[2],a=e.value[2];if(!yr._helper.isAlmostZero(n)&&!yr._helper.isAlmostZero(i)&&!yr._helper.isAlmostZero(a))return t=wr.scaldiv(n,t),r=wr.scaldiv(i,r),e=wr.scaldiv(a,e),t=wr.det3(t,r,e),yr.realmult(.5,t)}return l},Or.inverse$1=function(e,t){return"list"===(e=ce(e[0])).ctype&&(-1!==(t=wr._helper.colNumb(e))&&t===e.value.length)?wr.inverse(e):l},Or.linearsolve$2=function(e,t){if(t=ce(e[0]),e=ce(e[1]),"list"===t.ctype){var r=wr._helper.colNumb(t);if(-1!==r&&r===t.value.length&&wr._helper.isNumberVecN(e,r))return wr.linearsolve(t,e)}return l};var zr=[[[]],[[0]],[[0,1],[1,0]],[[0,1,2],[0,2,1],[1,0,2],[1,2,0],[2,0,1],[2,1,0]],[[0,1,2,3],[0,1,3,2],[0,2,1,3],[0,2,3,1],[0,3,1,2],[0,3,2,1],[1,0,2,3],[1,0,3,2],[1,2,0,3],[1,2,3,0],[1,3,0,2],[1,3,2,0],[2,0,1,3],[2,0,3,1],[2,1,0,3],[2,1,3,0],[2,3,0,1],[2,3,1,0],[3,0,1,2],[3,0,2,1],[3,1,0,2],[3,1,2,0],[3,2,0,1],[3,2,1,0]]];Or.mincostmatching$1=function(e,t){var r=ue(e[0]);if(wr.isNumberMatrix(r).value){var n,i,a=(e=r.value.length)<(t=wr._helper.colNumb(r))?t:e,o=Array(a);for(n=0;n<a;++n)for(o[n]=Array(a),i=0;i<a;++i)o[n][i]=n<e&&i<t?r.value[n].value[i].value.real:0;for(r=q(o),a=Array(e),n=0;n<e;++n)i=r[n],a[n]=i<t?yr.real(i+1):yr.real(0);return wr.turnIntoCSList(a)}return l},Or.take$2=V,Or.length$1=function(e,t){return"list"===(e=ue(e[0])).ctype||"string"===e.ctype?yr.real(e.value.length):l},Or.pairs$1=function(e,t){return"list"===(e=ue(e[0])).ctype?wr.pairs(e):l},Or.triples$1=function(e,t){return"list"===(e=ue(e[0])).ctype?wr.triples(e):l},Or.cycle$1=function(e,t){return"list"===(e=ue(e[0])).ctype?wr.cycle(e):l},Or.consecutive$1=function(e,t){return"list"===(e=ue(e[0])).ctype?wr.consecutive(e):l},Or.reverse$1=function(e,t){return"list"===(e=ue(e[0])).ctype?wr.reverse(e):l},Or.directproduct$2=function(e,t){return t=ue(e[0]),e=ue(e[1]),"list"===t.ctype&&"list"===e.ctype?wr.directproduct(t,e):l},Or.concat$2=U,Or.common$2=W,Or.remove$2=G,Or.append$2=H,Or.prepend$2=J,Or.contains$2=function(e,t){return t=ue(e[0]),e=ue(e[1]),"list"===t.ctype?wr.contains(t,e):l},Or.sort$2=function(e,t){return Or.sort$3([e[0],null,e[1]],t)},Or.sort$3=function(e,t){var r=ce(e[0]);if("list"!==r.ctype)return l;t="#",null!==e[1]&&"variable"===e[1].ctype&&(t=e[1].name),r=r.value;var n,i=[];for(Nr.newvar(t),n=0;n<r.length;n++)Nr.setvar(t,r[n]),i[n]={val:r[n],result:ue(e[2])};for(Nr.removevar(t),i.sort(Tr.compareResults),e=[],n=0;n<r.length;n++)e[n]=i[n].val;return{ctype:"list",value:e}},Or.sort$1=function(e,t){return"list"===(e=ue(e[0])).ctype?wr.sort1(e):l},Or.set$1=function(e,t){return"list"===(e=ue(e[0])).ctype?wr.set(e):l},Or.combinations$2=function(e,t){var r=ue(e[0]);if("number"===(e=ue(e[1])).ctype){var n=0|e.value.real;if("number"===r.ctype){var i=0|r.value.real;if(i-n<n&&(n=i-n),0>n)return yr.real(0);if(0===n)return yr.real(1);if(1===n)return r;for(var a=t=e=1;a<=n;++a){var o=i-n+a|0,s=0|a,u=0|Z(o,s);o=o/u|0,s=(s=s/u|0)/(u=0|Z(e,s))|0,e=(e=e/u|0)*(o=o/(u=0|Z(o,t))|0)|0,t=(t=t/u|0)*s|0}return yr.real(e/t)}if("list"===r.ctype){if(i=r.value.length,0>n||n>i)return wr.turnIntoCSList([]);if(0===n)return wr.turnIntoCSList([wr.turnIntoCSList([])]);if(n===i)return wr.turnIntoCSList([r]);var c=[],p=Array(n);return function e(t,a){t===n?c.push(wr.turnIntoCSList(p.slice())):a<i&&(p[t]=r.value[a],e(t+1,a+1),e(t,a+1))}(0,0),wr.turnIntoCSList(c)}}return l},Or.zeromatrix$2=function(e,t){return t=ce(e[0]),e=ce(e[1]),"number"===t.ctype&&"number"===e.ctype?wr.zeromatrix(t,e):l},Or.zerovector$1=function(e,t){return"number"===(e=ce(e[0])).ctype?wr.zerovector(e):l},Or.transpose$1=function(e,t){return"list"===(e=ce(e[0])).ctype&&-1!==wr._helper.colNumb(e)?wr.transpose(e):l},Or.row$2=function(e,t){return t=ce(e[0]),"number"===(e=ce(e[1])).ctype&&"list"===t.ctype&&-1!==wr._helper.colNumb(t)?wr.row(t,e):l},Or.column$2=function(e,t){return t=ce(e[0]),"number"===(e=ce(e[1])).ctype&&"list"===t.ctype&&-1!==wr._helper.colNumb(t)?wr.column(t,e):l},Or.dict$0=function(e,t){for(var r in e=Mr.create(),t)t.hasOwnProperty(r)&&Mr.put(e,Tr.string(r),ue(t[r]));return e},Or.put$3=function(e,t){t=ue(e[0]);var r=ue(e[1]);return e=ue(e[2]),"dict"===t.ctype?(t=Mr.clone(t),Mr.put(t,r,e),t):l},Or.get$2=function(e,t){return t=ue(e[0]),e=ue(e[1]),"dict"===t.ctype?Mr.get(t,e,l):l},Or.red$1=function(e,t){return"number"===(e=ue(e[0])).ctype?wr.realVector([Math.min(1,Math.max(0,e.value.real)),0,0]):l},Or.green$1=function(e,t){return"number"===(e=ue(e[0])).ctype?wr.realVector([0,Math.min(1,Math.max(0,e.value.real)),0]):l},Or.blue$1=function(e,t){return"number"===(e=ue(e[0])).ctype?wr.realVector([0,0,Math.min(1,Math.max(0,e.value.real))]):l},Or.gray$1=function(e,t){return"number"===(e=ue(e[0])).ctype?(e=Math.min(1,Math.max(0,e.value.real)),wr.realVector([e,e,e])):l},Or.grey$1=Or.gray$1,Er.HSVtoRGB=function(e,t,r){e&&void 0===t&&void 0===r&&(t=e.s,r=e.v,e=e.h);var n=Math.floor(6*e),i=6*e-n;e=r*(1-t);var a=r*(1-i*t);switch(t=r*(1-(1-i)*t),n%6){case 0:var o=r,l=t,s=e;break;case 1:o=a,l=r,s=e;break;case 2:o=e,l=r,s=t;break;case 3:o=e,l=a,s=r;break;case 4:o=t,l=e,s=r;break;case 5:o=r,l=e,s=a}return wr.realVector([o,l,s])},Or.hue$1=function(e,t){return"number"===(e=ue(e[0])).ctype?(e=e.value.real,e-=Math.floor(e),Er.HSVtoRGB(e,1,1)):l},Er.shapeconvert=function(e){if("circle"===e.type){var t=e.value.value[0],r=(t=Tr.div(t,t.value[2])).value[0].value.real,n=t.value[1].value.real;e=e.value.value[1].value.real;var i=Array(125),a=2*Math.PI/125;for(t=0;125>t;t++)i[t]={X:r+Math.cos(t*a)*e,Y:n+Math.sin(t*a)*e};return[i]}if("polygon"===e.type){for(r=[],t=0;t<e.value.length;t++){for(n=e.value[t],i=[],a=0;a<n.length;a++)i[a]={X:n[a].X,Y:n[a].Y};r[t]=i}return r}},Er.shapeop=function(e,t,r){e=Er.shapeconvert(e);var n=Er.shapeconvert(t);ClipperLib.JS.ScaleUpPaths(e,1e3),ClipperLib.JS.ScaleUpPaths(n,1e3),(t=new ClipperLib.Clipper).AddPaths(e,ClipperLib.PolyType.ptSubject,!0),t.AddPaths(n,ClipperLib.PolyType.ptClip,!0),n=e=ClipperLib.PolyFillType.pftNonZero;var i=new ClipperLib.Paths;return t.Execute(r,i,e,n),ClipperLib.JS.ScaleDownPaths(i,1e3),{ctype:"shape",type:"polygon",value:i}},Er.shapecommon=function(e,t){return Er.shapeop(e,t,ClipperLib.ClipType.ctIntersection)},Er.shaperemove=function(e,t){return Er.shapeop(e,t,ClipperLib.ClipType.ctDifference)},Er.shapeconcat=function(e,t){return Er.shapeop(e,t,ClipperLib.ClipType.ctUnion)},Or.key$0=function(e,t){return{ctype:"string",value:cr}},Or.keycode$0=function(e,t){return yr.real(pr)},Or.mouse$0=function(e,t){return t.id?"number"===(e=ue(t.id)).ctype&&(e=e.value.real,hr[e])?wr.realVector(hr[e]):l:wr.realVector(wt)},Or.mover$0=function(e,t){return sr&&sr.mover?{ctype:"geo",value:sr.mover}:l},Or.multiid$0=function(e,t){return yr.real(fr)},Or.multiidlist$0=function(e,t){for(var r in e=[],hr)e.push(r);return wr.realVector(e)},Or.translate$1=function(e,t){return"list"===(e=ce(e[0])).ctype&&wr.isNumberVector(e)&&2===e.value.length&&wn.translate(e.value[0].value.real,e.value[1].value.real),l},Or.rotate$1=function(e,t){return"number"===(e=ce(e[0])).ctype&&wn.rotate(e.value.real),l},Or.scale$1=function(e,t){return"number"===(e=ce(e[0])).ctype&&wn.scale(e.value.real),l},Or.greset$0=function(e,t){for(e=_n.stack.length,wn.greset(),t=0;t<e;t++)St.restore();return l},Or.gsave$0=function(e,t){return wn.gsave(),St.save(),l},Or.grestore$0=function(e,t){return wn.grestore(),St.restore(),l},Or.color$1=function(e,t){return"list"===(e=ce(e[0])).ctype&&wr.isNumberVector(e).value&&wn.setcolor(e),l},Or.linecolor$1=function(e,t){return"list"===(e=ce(e[0])).ctype&&wr.isNumberVector(e).value&&wn.setlinecolor(e),l},Or.pointcolor$1=function(e,t){return"list"===(e=ce(e[0])).ctype&&wr.isNumberVector(e).value&&wn.setpointcolor(e),l},Or.alpha$1=function(e,t){return"number"===(e=ce(e[0])).ctype&&wn.setalpha(e),l},Or.pointsize$1=function(e,t){return"number"===(e=ce(e[0])).ctype&&wn.setpointsize(e),l},Or.linesize$1=function(e,t){return"number"===(e=ce(e[0])).ctype&&wn.setlinesize(e),l},Or.textsize$1=function(e,t){return"number"===(e=ce(e[0])).ctype&&wn.settextsize(e),l},Or.playanimation$0=function(e,t){return f(),l},Or.pauseanimation$0=function(e,t){return h(),l},Or.stopanimation$0=function(e,t){return v(),l},Or.text$1=function(e,t){return e=ce(e[0]),Tr.string(E(e))},Or.replace$3=function(e,t){var r=ue(e[0]);if(t=ue(e[1]),e=ue(e[2]),"string"===r.ctype&&"string"===t.ctype&&"string"===e.ctype)return r=r.value,t=t.value.replace(/[^A-Za-z0-9]/g,"\\$&"),e=e.value.replace(/\$/g,"$$$$"),{ctype:"string",value:r=r.replace(new RegExp(t,"g"),e)}},Or.replace$2=function(e,t){function r(e,t,r){var i="";n=s=-1;for(var a=0;a<t.length;a++){var o=t[a][0],l=e.indexOf(o,r);-1!==l&&(-1===s||l<s)&&(i=o,s=l,n=a)}return i}var n;t=ue(e[0]);var i=ue(e[1]);if("string"===t.ctype&&"list"===i.ctype){e=t.value,t=[];for(var a=0;a<i.value.length;a++){var o=i.value[a];"list"===o.ctype&&2===o.value.length&&"string"===o.value[0].ctype&&"string"===o.value[1].ctype&&(t[t.length]=[o.value[0].value,o.value[1].value])}var s=-1;for(i=r(e,t,0);-1!==s;)i=r(e=e.substring(0,s)+t[n][1]+e.substring(s+i.length,e.length),t,i=s+t[n][1].length);return{ctype:"string",value:e}}return l},Or.substring$3=function(e,t){t=ue(e[0]);var r=ce(e[1]);return e=ce(e[2]),"string"===t.ctype&&"number"===r.ctype&&"number"===e.ctype?{ctype:"string",value:t.value.substring(Math.floor(r.value.real),Math.floor(e.value.real))}:l},Or.tokenize$2=function(e,t){var r=ue(e[0]);if(e=ue(e[1]),"string"===r.ctype&&"string"===e.ctype)return Or.tokenize$2([r,wr.turnIntoCSList([e])],t);if("string"===r.ctype&&"list"===e.ctype){if(r=r.value,0===e.value.length){if(e=!0,void 0!==t.autoconvert){var n=ue(t.autoconvert);"boolean"===n.ctype&&(e=n.value)}return e&&""!==r&&(e=Number(r),!isNaN(e))?yr.real(e):Tr.string(r)}n=e.value[0];var i=wr.turnIntoCSList(e.value.slice(1));return r=r.split(n.value),wr.turnIntoCSList(r.map((function(e){return Or.tokenize$2([Tr.string(e),i],t)})))}return l},Or.indexof$2=function(e,t){return t=ue(e[0]),e=ue(e[1]),"string"===t.ctype&&"string"===e.ctype?(e=t.value.indexOf(e.value),yr.real(e+1)):l},Or.indexof$3=function(e,t){t=ue(e[0]);var r=ue(e[1]);return e=ue(e[2]),"string"===t.ctype&&"string"===r.ctype&&"number"===e.ctype?(e=t.value.indexOf(r.value,Math.round(e.value.real)-1),yr.real(e+1)):l},Or.parse$1=function(e,t){return"string"===(e=ue(e[0])).ctype?ue(e=fe(e.value)):l},Or.unicode$1=function(e,t){e=ue(e[0]);var r=16;if(t.base&&("number"===(t=ue(t.base)).ctype&&(r=t.value.real)),"string"===e.ctype)t=parseInt(e.value,r);else{if("number"!==e.ctype)return l;t=e.value.real}return void 0!==String.fromCodePoint?t=String.fromCodePoint(t):65535>=t?t=String.fromCharCode(t):(t-=65536,t=String.fromCharCode(55296+(t>>10),56320+(1023&t))),Tr.string(t)},Or.international$1=function(e,t){return Or.international$2([e[0],null],t)},Or.international$2=function(t,r){if("string"!==(r=ue(t[0])).ctype)return l;var n=(e.translations||{})[e.language||"en"]||{};if(!n.hasOwnProperty(r.value))return r;var i=n[r.value];return"string"==typeof i?Tr.string(i):null===t[1]?r:(t="number"===(t=ue(t[1])).ctype?t.value.real:0,(t=(n._pluralFormFunction||Q)(t))<i.length?Tr.string(i[t]):r)},Or.currentlanguage$0=function(t,r){return Tr.string(e.language||"en")},Er.basismap=function(e,t,r,n){var i=wr.turnIntoCSList([e,t,r]);return i=wr.adjoint3(wr.transpose(i)),n=Tr.mult(i,n),i=wr.turnIntoCSList([Tr.mult(n.value[0],e),Tr.mult(n.value[1],t),Tr.mult(n.value[2],r)]),wr.transpose(i)},Or.map$8=function(e,t){t=pe(e[0]);var r=pe(e[1]),n=pe(e[2]),i=pe(e[3]),a=pe(e[4]),o=pe(e[5]),s=pe(e[6]);return e=pe(e[7]),a!==l&&o!==l&&s!==l&&e!==l&&t!==l&&r!==l&&n!==l&&i!==l?(e=Er.basismap(a,o,s,e),t=Er.basismap(t,r,n,i),t=Tr.mult(e,wr.adjoint3(t)),wr.normalizeMax(t)):l},Or.map$6=function(e,t){t=pe(e[0]);var r=pe(e[1]),n=pe(e[2]),i=wr.realVector([0,0,1]),a=wr.cross,o=a(a(n,a(i,a(t,r))),a(r,a(i,a(t,n)))),s=pe(e[3]),u=pe(e[4]);return i=a(a(e=pe(e[5]),a(i,a(s,u))),a(u,a(i,a(s,e)))),s!==l&&u!==l&&e!==l&&i!==l&&t!==l&&r!==l&&n!==l&&o!==l?(s=Er.basismap(s,u,e,i),t=Er.basismap(t,r,n,o),t=Tr.mult(s,wr.adjoint3(t)),wr.normalizeMax(t)):l},Or.map$4=function(e,t){t=wr.ii;var r=wr.jj,n=pe(e[0]),i=pe(e[1]),a=pe(e[2]);return e=pe(e[3]),a!==l&&e!==l&&n!==l&&i!==l?(e=Er.basismap(a,e,t,r),t=Er.basismap(n,i,t,r),t=Tr.mult(e,wr.adjoint3(t)),wr.normalizeMax(t)):l},Or.map$2=function(e,t){t=wr.ii;var r=wr.jj,n=pe(e[0]),i=Tr.add(wr.realVector([1,0,0]),n);e=pe(e[1]);var a=Tr.add(wr.realVector([1,0,0]),e);return e!==l&&a!==l&&n!==l&&i!==l?(e=Er.basismap(e,a,t,r),t=Er.basismap(n,i,t,r),t=Tr.mult(e,wr.adjoint3(t)),wr.normalizeMax(t)):l},Or.pointreflect$1=function(e,t){t=wr.ii;var r=wr.jj;e=pe(e[0]);var n=Tr.add(wr.realVector([1,0,0]),e),i=Tr.add(wr.realVector([-1,0,0]),e);return i!==l&&e!==l&&n!==l?(i=Er.basismap(e,i,t,r),t=Er.basismap(e,n,t,r),t=Tr.mult(i,wr.adjoint3(t)),wr.normalizeMax(t)):l},Or.linereflect$1=function(e,t){t=wr.ii;var r=wr.jj;e=pe(e[0]);var n=wr.realVector([Math.random(),Math.random(),Math.random()]),i=wr.realVector([Math.random(),Math.random(),Math.random()]);return n=wr.cross(n,e),i=wr.cross(i,e),e!==l&&n!==l?(e=Er.basismap(n,i,t,r),t=Er.basismap(n,i,r,t),t=Tr.mult(e,wr.adjoint3(t)),wr.normalizeMax(t)):l},Er.extractPointVec=function(e){var t={ok:!1};if("geo"===e.ctype){var r=e.value;if("P"===r.kind)return t.x=Ar.getField(r,"x"),t.y=Ar.getField(r,"y"),t.z=yr.real(1),t.ok=!0,t}if("list"!==e.ctype)return t;var n=e.value;return 2===n.length&&(e=n[0],r=n[1],"number"===e.ctype&&"number"===r.ctype)?(t.x=e,t.y=r,t.z=yr.real(1),t.ok=!0,t):(3===n.length&&(e=n[0],r=n[1],n=n[2],"number"===e.ctype&&"number"===r.ctype&&"number"===n.ctype&&(t.x=yr.div(e,n),t.y=yr.div(r,n),t.z=yr.real(1),t.ok=!0)),t)},Or.polygon$1=function(e,t){if("list"===(e=ue(e[0])).ctype){t=[];for(var r=0;r<e.value.length;r++){var n=Er.extractPoint(e.value[r]);if(!n.ok)return l;t[r]={X:n.x,Y:n.y}}return{ctype:"shape",type:"polygon",value:[t]}}return l},Or.circle$2=function(e,t){return t=ce(e[0]),e=ce(e[1]),(t=Er.extractPointVec(t)).ok&&"number"===e.ctype?(t=wr.turnIntoCSList([t.x,t.y,t.z]),{ctype:"shape",type:"circle",value:wr.turnIntoCSList([t,e])}):l},Or.screen$0=function(e,t){var r=wn.drawingstate.initialmatrix;return e=function(e,t){return e-=r.tx,t+=r.ty,{X:(e*r.d-t*r.b)/r.det,Y:-(-e*r.c+t*r.a)/r.det}},{ctype:"shape",type:"polygon",value:[[e(0,0),e(Mt,0),e(Mt,Tt),e(0,Tt)]]}},Or.halfplane$2=function(e,t){t=ce(e[0]),e=ce(e[1]);var r=pe(t),n=pe(e);if(t!==l&&e!==l){var i=e.usage;e=r;var a=n;return"Line"!==t.usage&&"Point"!==i||(e=n,a=r),t=wr.turnIntoCSList([a.value[0],a.value[1],yr.zero]),t=wr.cross(t,e),a=wr.cross(a,t),a=Tr.div(a,a.value[2]),e=Tr.div(e,e.value[2]),e=wr.sub(e,a),t=wr.abs(e),e=Tr.div(e,t),t=a.value[0].value.real,a=a.value[1].value.real,r=1e3*e.value[0].value.real,{ctype:"shape",type:"polygon",value:[[{X:t+(e=1e3*e.value[1].value.real)/2,Y:a-r/2},{X:t+e/2+r,Y:a-r/2+e},{X:t-e/2+r,Y:a+r/2+e},{X:t-e/2,Y:a+r/2}]]}}return l},Or.element$1=function(e,t){return"string"===(e=ue(e[0])).ctype&&It.csnames.hasOwnProperty(e.value)?{ctype:"geo",value:It.csnames[e.value]}:l},Er.all$1=function(e,t){return"geo"===(e=ue(e[0])).ctype&&e.value.incidences?wr.ofGeos(e.value.incidences.map((function(e){return It.csnames[e]})).filter(t)):wr.nil},Or.allpoints$0=function(e,t){return wr.ofGeos(It.points)},Or.allpoints$1=function(e,t){return Er.all$1(e,(function(e){return"P"===e.kind}))},Or.allmasses$0=function(e,t){return wr.ofGeos(ti)},Or.allmasses$1=function(e,t){return Er.all$1(e,(function(e){return"P"===e.kind&&e.behavior&&"Mass"===e.behavior.type}))},Or.allsprings$0=function(e,t){return wr.ofGeos(ri)},Or.allsprings$1=function(e,t){return Er.all$1(e,(function(e){return"S"===e.kind&&e.behavior&&"Spring"===e.behavior.type}))},Or.alllines$0=function(e,t){return wr.ofGeos(It.lines)},Or.alllines$1=function(e,t){return Er.all$1(e,(function(e){return"L"===e.kind||"S"===e.kind}))},Or.allsegments$0=function(e,t){return wr.ofGeos(It.lines.filter((function(e){return"S"===e.kind})))},Or.allsegments$1=function(e,t){return Er.all$1(e,(function(e){return"S"===e.kind}))},Or.allconics$0=function(e,t){return wr.ofGeos(It.conics)},Or.allconics$1=function(e,t){return Er.all$1(e,(function(e){return"C"===e.kind}))},Or.allcircles$0=function(e,t){return wr.ofGeos(It.conics.filter((function(e){return"Circle"===e.matrix.usage})))},Or.allcircles$1=function(e,t){return Er.all$1(e,(function(e){return"C"===e.kind&&"Circle"===e.matrix.usage}))},Or.allelements$0=function(e,t){return wr.ofGeos(It.gslp)},Or.allelements$1=function(e,t){return Er.all$1(e,(function(e){return!0}))},Or.elementsatmouse$0=function(e,t){var r=wr.realVector([wt[0],wt[1],1]),n=function(e){return yr._helper.isAlmostZero(e.value[2])?1/0:(e=wr.normalizeZ(e),wr.abs(wr.sub(e,r)).value.real)},i=function(e){return e=wr.turnIntoCSList([e.value[0],e.value[1],yr.zero]),wr.normalizeMax(wr.cross(r,e))},a=function(e){var t=Tr.mult(e.matrix,r);return t=i(t),e=qn._helper.IntersectLC(t,e.matrix).map((function(e){return n(e)})),.5>Math.min(e[0],e[1])};e=It.points.filter((function(e){return.5>n(e.homog)})),t=It.lines.filter((function(e){var t=i(e.homog);if(t=wr.normalizeMax(wr.cross(e.homog,t)),(t=.5>n(t))&&"S"===e.kind){var a=e.homog;a=wr.turnIntoCSList([a.value[0],a.value[1],yr.zero]),(0>(e=wr.crossratio3(e.farpoint,e.startpos,e.endpos,r,a).value.real)||1<e)&&(t=!1)}return t}));var o=It.conics.filter((function(e){var t=a(e);if(t&&e.isArc){var n=wr.crossratio3harm(e.startPoint,e.endPoint,e.viaPoint,r,wr.ii);e=n.value[0],n=n.value[1],yr._helper.isAlmostZero(e)?(e=yr.div(e,n),n=yr.real(1)):(n=yr.div(n,e),e=yr.real(1));var i=wr.abs(wr.turnIntoCSList([n,e]));e=yr.div(e,i),n=yr.div(n,i),n=yr.mult(n,e),0>e.value.real&&(n=yr.neg(n)),0>n.value.real&&(t=!1)}return t}));return e=e.concat(t,o),wr.ofGeos(e)},Or.incidences$1=Or.allelements$1,Or.createpoint$2=function(e,t){return t=ue(e[0]),e=pe(e[1]),"string"!==t.ctype?(he("Name must be a string"),l):"list"!==e.ctype&&wr.isNumberVector(e)?(he("Position must be a number vector"),l):{ctype:"geo",value:$e({name:t.value,type:"Free",labeled:!0,pos:e},!0)}},Or.create$3=function(e,t){var r=ue(e[0]),n=ue(e[1]),i=ue(e[2]);for(var a in e={},t)e[a]=ce(t[a]);if("string"===r.ctype)a=r.value;else{if("list"!==r.ctype)return he("Names must be a string or a list of strings"),l;if(1!==r.value.length){a=Tr.string(r.value.map((function(e){return e.value})).join("__"));var o=[];if((i=Or.create$3([a,n,i],e))!==l)for(n=Tr.string(i.value.kind.replace(/^(.*)s$/,"Select$1")),i=wr.turnIntoCSList([Tr.string(i.value.name)]),t=0;t<r.value.length;++t)e.index=yr.real(t+1),o.push(Or.create$3([r.value[t],n,i],e));return wr.turnIntoCSList(o)}if("string"!==r.value[0].ctype)return he("Element of names list must be a string"),l;a=r.value[0].value}if("string"!==n.ctype)return he("Type must be a string"),l;if("list"!==i.ctype)return he("Arguments must be a list"),l;if(!qn.hasOwnProperty(n.value)&&!Un.hasOwnProperty(n.value)&&!Wn.hasOwnProperty(n.value))return he("Invalid geometric operation: '"+n.value+"'"),l;r=[];var s=null;for(t=0;t<i.value.length;t++){var u=i.value[t];if("string"===u.ctype)r.push(u.value);else if("geo"===u.ctype)r.push(u.value.name);else if((s=pe(u))===l)return he("Unknown argument type"),l}for(o in i={name:a,type:n.value,labeled:!0},s&&(i.pos=s),0<r.length&&(i.args=r),e)i[o]=Tr.unwrap(e[o]);return{ctype:"geo",value:$e(i,!0)}},Or.create$2=function(e,t){function r(e){function t(e){It.csnames[e]||(n=e)}var r,n=!1;if("P"===e)for(r=0;26>r&!n;r++)8!==r&&9!==r&&t(String.fromCharCode(65+r));else if("L"===e||"S"===e)for(r=0;26>r&!n;r++)8!==r&&9!==r&&t(String.fromCharCode(97+r));for(r=0;!n;r++)t(e+r);return n}var n=ue(e[0]);e=ue(e[1]);var i={};for(a in t)i[a]=ce(t[a]);if(!qn.hasOwnProperty(n.value)&&!Un.hasOwnProperty(n.value)&&!Wn.hasOwnProperty(n.value))return he("Invalid geometric operation: '"+n.value+"'"),l;for(;Un.hasOwnProperty(n.value);)n.value=Un[n.value];var a=qn[n.value];if(t=Tr.string(r(a.kind)),e.value.length>a.signature.length){var o="Operation "+n.value+" requieres only "+a.signature.length+" argument"+(1===a.signature.length?"":"s")+" ("+e.value.length+" argument"+(1===e.value.length?"":"s")+" given) to create "+t.value+". Ignoring the last arguments.";if(!i.pos){var s=pe(e.value[e.value.length-1]);s!==l&&(o+=" Use the last argument as modifier `pos`.",i.pos=s)}he(o),e=wr.turnIntoCSList(e.value.slice(0,a.signature.length))}if((a=Or.create$3([t,n,e],i))!==l&&"s"===a.value.kind[1]&&a.value.results){if(n=Tr.string("Select"+a.value.kind[0]),e=wr.turnIntoCSList([Tr.string(a.value.name)]),i.pos)return t=Tr.string(r(a.value.kind[0])),Or.create$3([t,n,e],i);for(o=[],s=0;s<a.value.results.value.length;s++)i.index=yr.real(s+1),t=Tr.string(r(a.value.kind[0])),o.push(Or.create$3([t,n,e],i));return wr.turnIntoCSList(o)}return a.isDuplicate&&delete a.isDuplicate,a},Or.javascript$1=function(e,t){return"string"===(e=ue(e[0])).ctype&&new Function(e.value).call(ar),l},Or.use$1=function(t,r){var n;return"string"===(t=ue(t[0])).ctype?(t=t.value,e.plugins&&(n=e.plugins[t]),n||(n=Ot._pluginRegistry[t]),n?(n({instance:ar,config:e,nada:l,evaluate:ue,extractPoint:Er.extractPoint,evaluateAndVal:ce,defineFunction:function(e,t,r){Or[e.toLowerCase()+"$"+t]=r},addShutdownHook:nr.push.bind(nr),addAutoCleaningEventListener:P,getVariable:Nr.getvar.bind(Nr),getInitialMatrix:function(){return wn.drawingstate.initialmatrix},setTextRenderer:function(e,t){$r=e,t&&(Br=t)},getImage:function(e,t){return"string"==typeof e&&(e=Tr.string(e)),(e=ee(e))?(!t&&e.cdyUpdate&&e.cdyUpdate(),e):null},getMyfunction:function(e){return Ir.hasOwnProperty(e)?Ir[e]:null},scheduleUpdate:_}),{ctype:"boolean",value:!0}):(he("Plugin "+t+" not found"),{ctype:"boolean",value:!1})):l},Or.format$2=function(e,t){function r(e,r){e=e.toFixed(o);do{var n=e;e=e.substring(0,e.length-1)}while(r&&""!==e&&"-"!==e&&+e==+n);return r=""+n,t.delimiter&&"string"===t.delimiter.ctype&&(r=r.replace(".",t.delimiter.value)),r}var n=ce(e[0]);e=ce(e[1]);var i=!0;if(t.truncate){var a=ue(t.truncate);"boolean"===a.ctype&&(i=a.value)}if(("number"===n.ctype||"list"===n.ctype)&&"number"===e.ctype){var o=Math.max(0,Math.min(20,Math.round(e.value.real)));return function e(t,n){if("number"===t.ctype){var a=r(t.value.real,i),o=r(t.value.imag,i);return{ctype:"string",value:t=Math.abs(t.value.imag)<Math.pow(10,-n)?a:"-"===o.substring(0,1)?a+" - i*"+o.substring(1):a+" + i*"+o}}return"list"===t.ctype?{ctype:"list",value:t.value.map(e)}:{ctype:"string",value:E(t).toString()}}(n,o)}return l},Date.now||(Date.now=function(){return(new Date).getTime()});var jr=0;Or.timestamp$0=function(e,t){return yr.real(Date.now())},Or.seconds$0=function(e,t){return yr.real((Date.now()-jr)/1e3)},Or.resetclock$0=function(e,t){return jr=Date.now(),l},Or.time$0=function(e,t){return e=new Date,wr.realVector([e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()])},Or.date$0=function(e,t){return e=new Date,wr.realVector([e.getFullYear(),e.getMonth()+1,e.getDate()])},Or.simulationtime$0=function(e,t){return yr.real(kt*Dt)},Or.settimeout$2=function(e,t){t=ue(e[0]);var r=e[1];return"number"===t.ctype&&"undefined"!=typeof window&&window.setTimeout((function(){ue(r),_()}),1e3*t.value.real),l},Er.formatForWebGL=function(e){return e.toFixed(10)},Or.generateWebGL$2=function(e,t){var r=Er.formatForWebGL;if(t=e[0],e=ue(e[1]),console.log(e),"list"!==e.ctype)return l;for(var n=[],i=0;i<e.value.length;i++)"string"===e.value[i].ctype&&n.push(e.value[i].value);if(console.log("***********"),console.log(n),e=Er.plotvars(t),console.log(e),-1===e.indexOf("a")&&-1===e.indexOf("b")&&-1===e.indexOf("c")&&-1===e.indexOf("d")&&-1===e.indexOf("e")&&-1===e.indexOf("f")&&(t=ce(t)),"number"===t.ctype)return{ctype:"string",value:"vec2("+r(t.value.real)+","+r(t.value.imag)+")"};if("variable"===t.ctype)return{ctype:"string",value:t.name};if("string"===t.ctype||"void"===t.ctype)return t;if(2===t.args.length&&("infix"===t.ctype||"function"===t.ctype)){if(r=Or.compileToWebGL$1([t.args[0]],{}),e=Or.compileToWebGL$1([t.args[1]],{}),"+"===t.oper||"add"===t.oper)return void 0===r.value||"void"===r.ctype?{ctype:"string",value:e.value}:{ctype:"string",value:"addc("+r.value+","+e.value+")"};if("*"===t.oper||"mult"===t.oper)return{ctype:"string",value:"multc("+r.value+","+e.value+")"};if("/"===t.oper||"div"===t.oper)return{ctype:"string",value:"divc("+r.value+","+e.value+")"};if("-"===t.oper||"sub"===t.oper)return void 0===r.value||"void"===r.ctype?{ctype:"string",value:"negc("+e.value+")"}:{ctype:"string",value:"subc("+r.value+","+e.value+")"};if("^"===t.oper||"pow"===t.oper)return{ctype:"string",value:"powc("+r.value+","+e.value+")"}}if("function"===t.ctype&&1===t.args.length){if(r=Or.compileToWebGL$1([t.args[0]],{}),"sin$1"===t.oper)return{ctype:"string",value:"sinc("+r.value+")"};if("cos$1"===t.oper)return{ctype:"string",value:"cosc("+r.value+")"};if("tan$1"===t.oper)return{ctype:"string",value:"tanc("+r.value+")"};if("exp$1"===t.oper)return{ctype:"string",value:"expc("+r.value+")"};if("log$1"===t.oper)return{ctype:"string",value:"logc("+r.value+")"};if("arctan$1"===t.oper)return{ctype:"string",value:"arctanc("+r.value+")"};if("arcsin$1"===t.oper)return{ctype:"string",value:"arcsinc("+r.value+")"};if("arccos$1"===t.oper)return{ctype:"string",value:"arccosc("+r.value+")"};if("sqrt$1"===t.oper)return{ctype:"string",value:"sqrtc("+r.value+")"}}return l},Or.compileToWebGL$1=function(e,t){t=Er.formatForWebGL,e=e[0];var r=Er.plotvars(e);if(-1===r.indexOf("a")&&-1===r.indexOf("b")&&-1===r.indexOf("c")&&-1===r.indexOf("d")&&-1===r.indexOf("e")&&-1===r.indexOf("f")&&(e=ce(e)),"number"===e.ctype)return{ctype:"string",value:"vec2("+t(e.value.real)+","+t(e.value.imag)+")"};if("variable"===e.ctype)return{ctype:"string",value:e.name};if("string"===e.ctype||"void"===e.ctype)return e;if(2===e.args.length&&("infix"===e.ctype||"function"===e.ctype)){if(t=Or.compileToWebGL$1([e.args[0]],{}),r=Or.compileToWebGL$1([e.args[1]],{}),"+"===e.oper||"add"===e.oper)return void 0===t.value||"void"===t.ctype?{ctype:"string",value:r.value}:{ctype:"string",value:"addc("+t.value+","+r.value+")"};if("*"===e.oper||"mult"===e.oper)return{ctype:"string",value:"multc("+t.value+","+r.value+")"};if("/"===e.oper||"div"===e.oper)return{ctype:"string",value:"divc("+t.value+","+r.value+")"};if("-"===e.oper||"sub"===e.oper)return void 0===t.value||"void"===t.ctype?{ctype:"string",value:"negc("+r.value+")"}:{ctype:"string",value:"subc("+t.value+","+r.value+")"};if("^"===e.oper||"pow"===e.oper)return{ctype:"string",value:"powc("+t.value+","+r.value+")"}}if("function"===e.ctype&&1===e.args.length){if(t=Or.compileToWebGL$1([e.args[0]],{}),"sin$1"===e.oper)return{ctype:"string",value:"sinc("+t.value+")"};if("cos$1"===e.oper)return{ctype:"string",value:"cosc("+t.value+")"};if("tan$1"===e.oper)return{ctype:"string",value:"tanc("+t.value+")"};if("exp$1"===e.oper)return{ctype:"string",value:"expc("+t.value+")"};if("log$1"===e.oper)return{ctype:"string",value:"logc("+t.value+")"};if("arctan$1"===e.oper)return{ctype:"string",value:"arctanc("+t.value+")"};if("arcsin$1"===e.oper)return{ctype:"string",value:"arcsinc("+t.value+")"};if("arccos$1"===e.oper)return{ctype:"string$1",value:"arccosc("+t.value+")"};if("sqrt$1"===e.oper)return{ctype:"string",value:"sqrtc("+t.value+")"}}return l},Or.setsimulationspeed$1=function(e,t){return"number"===(e=ce(e[0])).ctype&&o(e.value.real),l},Or.setsimulationaccuracy$1=function(e,t){return"number"===(e=ce(e[0])).ctype&&void 0!==ii&&void 0!==ii.env&&(ii.env.accuracy=Math.max(1,0|e.value.real)),l},Or.setsimulationquality$1=function(e,t){return"number"===(e=ce(e[0])).ctype&&void 0!==ii&&void 0!==ii.env&&(0===(e=e.value.real)&&(ii.env.errorbound=.01,ii.env.lowestdeltat=1e-5,ii.env.slowdownfactor=2),1===e&&(ii.env.errorbound=.001,ii.env.lowestdeltat=1e-7,ii.env.slowdownfactor=2),2===e&&(ii.env.errorbound=1e-5,ii.env.lowestdeltat=1e-10,ii.env.slowdownfactor=4),3===e&&(ii.env.errorbound=1e-6,ii.env.lowestdeltat=1e-12,ii.env.slowdownfactor=4)),l};var Rr=null,Dr=null;Or.createtool$3=function(e,t){var r="left",n="top",i=null;if(t.space){var a=ue(t.space);"number"===a.ctype&&(i=a.value.real/2)}var o=null;if(t.toolbar&&("string"===(a=ue(t.toolbar)).ctype&&((o=document.getElementById(a.value))||console.warn("Element #"+a.value+" not found"))),!o){if(t.reference&&"string"===(a=ue(t.reference)).ctype)switch(a.value){case"UR":r="right";break;case"LL":n="bottom";break;case"LR":r="right",n="bottom"}(o=document.createElement("div")).className="CindyJS-toolbar",Ct.parentNode.appendChild(o),a=ue(e[1]);var s=ue(e[2]);"number"===a.ctype&&(o.style[r]=a.value.real+"px"),"number"===s.ctype&&(o.style[n]=s.value.real+"px"),null!==i&&(o.style.margin=-i+"px")}if("string"===(e=ue(e[0])).ctype)e=[[e.value]];else{if("list"!==e.ctype)return he("Name must be a string or a list of strings"),l;e=e.value.map((function(e){return"string"===e.ctype?[e.value]:"list"===e.ctype?e.value.map((function(e){return"string"===e.ctype?e.value:null})):[null]}))}if(t.flipped&&("boolean"===(a=ue(t.flipped)).ctype&&a.value)){he("Flipping");var u=0;for(t=e.length,e.forEach((function(e){e.length>u&&(u=e.length)})),a=[],s=0;s<u;++s){a[s]=[];for(var c=0;c<t;++c)a[s][c]=e[c][s]||null}e=a}return"bottom"===n&&e.reverse(),e.forEach((function(e){"right"===r&&e.reverse();var t=document.createElement("div");o.appendChild(t),e.forEach((function(e){function r(){Rr&&Rr.classList.remove("CindyJS-active"),Rr=a,a.classList.add("CindyJS-active");var t=Pn[dn=e].actions;Dr&&(Dr.textContent=t[0].tooltip||""),mn=[],bn=gn=0}if(Pn.hasOwnProperty(e)||(he("Tool '"+e+"' not implemented yet."),e=null),null===e){var n=document.createElement("span");n.className="CindyJS-spacer",t.appendChild(n)}else{var a=document.createElement("button");(n=document.createElement("img")).src=Ot.getBaseDir()+"images/"+e+".png",a.appendChild(n),a.addEventListener("click",r),Rr||r(),null!==i&&(a.style.margin=i+"px"),t.appendChild(a)}}))})),l},Or.dropped$0=function(){return Jt},Or.droppoint$0=function(){return Zt},Or.parsecsv$1=function(e,t){var r=!0,n=ce(t.autoconvert);if("boolean"===n.ctype&&(r=n.value),n=null,"string"===(t=ce(t.delimiter)).ctype&&/^[^"\r\n]$/.test(t.value)&&(n=t.value),"string"!==(e=ce(e[0])).ctype)return he("CSV data is not a string"),l;e=e.value,t='(?:"((?:[^"]+|"")*)"|([^]*?))(\r\n|(,)|[\r\n]|$)',n&&(n=n.replace(/[^A-Za-z0-9]/g,"\\$&").replace(/\$/g,"$$$$"),t=t.replace(/,/g,n)),t=new RegExp(t,"g"),n=[];for(var i=[],a=null;t.lastIndex<e.length;){var o=t.exec(e),s=o[2];if("string"==typeof o[1]&&(s=o[1].replace(/""/g,'"')),s=r?/^[Tt]rue$/.test(s)?Tr.bool(!0):/^[Ff]alse$/.test(s)?Tr.bool(!1):/^[\-+]?([0-9]+(\.[0-9]*)?|\.[0-9]+|Infinity)$/.test(s)?yr.real(Number(s)):Tr.string(s):Tr.string(s),n.push(s),o[4]&&t.lastIndex===e.length&&(n.push(Tr.string("")),o={}),!o[4]){if(null===a&&(a=n.length),a<n.length)for(a=n.length,o=0;o<i.length;++o)for(s=i[o].length;s<a;++s)i[o][s]=l;else if(a>n.length)for(o=n.length;o<a;++o)n[o]=l;i.push(n),n=[]}}return wr.turnIntoCSList(i.map(wr.turnIntoCSList))},Or.load$2=function(e,t){return Or.load$3([e[0],null,e[1]],t)},Or.load$3=function(e,t){var r="#";null!==e[1]&&"variable"===e[1].ctype&&(r=e[1].name),t=ce(e[0]);var n=null,i=null;return"string"===t.ctype&&/^https?:\/\//.test(t.value)&&(n=t.value),null!==n?((i=new XMLHttpRequest).onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE){if(200===i.status)var t=Tr.string(String(i.responseText));else he("Failed to load "+n+": "+i.statusText),t=l;Nr.newvar(r),Nr.setvar(r,t),ue(e[2]),Nr.removevar(r),_()}},i.open("GET",n),i.send(),Tr.bool(!0)):l},Or.removeelement$1=function(e,t){"geo"===(e=ue(e[0])).ctype?Fe(e.value.name):console.log("argument of removeelement is undefined or not of type <geo>")},Or.guess$1=function(e,t){function r(e){if((e=Cn.doPSLQ([e,1,Math.PI*Math.E],15))&&0===e[2])return[Math.round(e[0]),Math.round(e[1])]}function n(e){if(yr._helper.isAlmostZero(e))return"0";if(!yr._helper.isAlmostReal(e)){var t=e.value.real,n=e.value.imag,l=r(t),u=r(t*t+n*n);if(l&&u){t=-l[0]*u[0];var c=-l[1]*u[0]*2,p=l[0]*u[1];l=a(-c,2*t),u=c*c-4*p*t,u/=(e=o(u))*e,e="-"+(u=e===2*t||e===-2*t?"+i*sqrt("+-u+")":"+i*"+a(e,2*t).substring(1)+"*sqrt("+-u+")").substring(1),c=Math.abs((c*c-4*p*t)/(4*t*t)),t=Math.sqrt(c),c=-Math.sqrt(c),"+0"!==l&&"-0"!==l||(l=""),(n=Math.abs(n-t)<Math.abs(n-c)?l+u:l+e).startsWith("+")&&(n=n.substring(1))}else n=E(e);return n}var f=Cn.doPSLQ([Math.PI,e.value.real,1],15);n=""+e.value.real,p=t="";var h=c=1e4;if(l=1e5,f&&3e3>(l=i(f))){t=e.value.real,c=f[0],u=-f[1],f=f[2];var v="";if(0!==c){var d=Math.round(c),m=Math.round(u);v=a(d,m)+"*pi"}d="",0!==f&&(d=a(d=Math.round(f),m=Math.round(u))),s=Math.abs(t-(f/u+Math.PI*c/u)),""===(t=d+v)?t="0":t.startsWith("+")&&(t=t.substring(1)),c=s}if(u=1e5,(v=Cn.doPSLQ([e.value.real*e.value.real,e.value.real,1],15))&&9e3>(u=10+i(v))){e=e.value.real,h=v[0],f=v[1],v=v[2],d=Math.round(h),m=Math.round(f);var g=Math.round(v);p=a(-m,2*d),m=m*m-4*g*d,m/=(g=o(m))*g,d=g===2*d?"+sqrt("+m+")":g===-2*d?"-sqrt("+m+")":a(g,2*d)+"*sqrt("+m+")",m=-f/(2*h),v=Math.abs((f*f-4*v*h)/(4*h*h)),h="-"+(d="+"+d.substring(1)).substring(1),f=m+Math.sqrt(v),v=m-Math.sqrt(v),"+0"!==p&&"-0"!==p||(p=""),Math.abs(e-f)<Math.abs(e-v)?(s=Math.abs(e-f),e=p+d):(s=Math.abs(e-v),e=p+h),e.startsWith("+")&&(e=e.substring(1)),p=e,h=s}return l<u&&1e-12>c&&(n=t),u<l&&1e-12>h&&(n=p),n}function i(e){var t=Math.abs(e[0]);return Math.abs(e[1])>t&&(t=Math.abs(e[1])),Math.abs(e[2])>t&&(t=Math.abs(e[2])),t}function a(e,t){var r="+";0>e*t&&(e=Math.abs(e),t=Math.abs(t),r="-");var n=Z(e,t);return t/=n,0>(e/=n)&&0>t&&(e=-e,t=-t),1===t?r+e:r+e+"/"+t}function o(e){for(var t=3e3;0<t;t--)if(0==e%(t*t))return t;return 1}var s=0;return"number"===(e=ce(e[0])).ctype&&yr._helper.isFinite(e)?(e=void 0===n(e)?"no guess":n(e),Tr.string(e)):l},Er.extractPoint=function(e){var t={ok:!1};if("geo"===e.ctype){var r=e.value;if("P"===r.kind)return t.x=Ar.getField(r,"x").value.real,t.y=Ar.getField(r,"y").value.real,t.ok=!0,t}if("list"!==e.ctype)return t;var n=e.value;return 2===n.length&&(e=n[0],r=n[1],"number"===e.ctype&&"number"===r.ctype)?(t.x=e.value.real,t.y=r.value.real,t.ok=!0,t):(3===n.length&&(e=n[0],r=n[1],n=n[2],"number"===e.ctype&&"number"===r.ctype&&"number"===n.ctype&&(e=yr.div(e,n),r=yr.div(r,n),t.x=e.value.real,t.y=r.value.real,t.ok=!0)),t)},Or.draw$1=function(e,t){if("shape"===(e=ce(e[0])).ctype)Er.drawshape(e,t);else if("Line"===e.usage)pn.handleModifs(t,pn.lineModifs),pn.drawline(e);else{var r=Er.extractPoint(e);if(!r.ok)return void 0!==e.value&&2===e.value.length?Or.draw$2(e.value,t):void 0;null!==t&&pn.handleModifs(t,pn.pointModifs),pn.drawpoint(r)}return l},Or.draw$2=function(e,t){var r=ce(e[0]);return e=ce(e[1]),r=Er.extractPoint(r),e=Er.extractPoint(e),r.ok&&e.ok?(null!==t&&pn.handleModifs(t,pn.lineModifs),pn.drawsegcore(r,e),l):l},Or.drawcircle$2=function(e,t){return Er.drawcircle(e,t,"D")},Er.arcHelper=function(e){var t={};return t.startPoint=pe(e[0]),t.viaPoint=pe(e[1]),t.endPoint=pe(e[2]),t},Or.fillcircle$2=function(e,t){return Er.drawcircle(e,t,"F")},Or.drawarc$3=function(e,t){return e=Er.arcHelper(e),Er.drawarc(e,t,"D")},Or.fillarc$3=function(e,t){return e=Er.arcHelper(e),Er.drawarc(e,t,"F")},Er.drawarc=function(e,t,r){var n=e.startPoint,i=e.viaPoint;if(e=e.endPoint,!wr._helper.isAlmostReal(wr.turnIntoCSList([n,i,e])))return l;if(pn.handleModifs(t,pn.conicModifs),pn.preDrawCurve(),t=wr.det3(n,i,e),1e-12<Math.abs(t.value.real)){t=qn._helper.ConicBy5(null,n,i,e,wr.ii,wr.jj);var a=qn._helper.CenterOfConic(t);a=wr.normalizeMax(a),t=yr.real(0);var o=wr.turnIntoCSList([wr.turnIntoCSList([a.value[2],t,yr.neg(a.value[0])]),wr.turnIntoCSList([t,a.value[2],yr.neg(a.value[1])]),wr.turnIntoCSList([t,t,a.value[2]])]);t=wr.normalizeZ(Tr.mult(o,n)),wr.normalizeZ(Tr.mult(o,i)),o=wr.normalizeZ(Tr.mult(o,e)),t=-Math.atan2(t.value[1].value.real,t.value[0].value.real),o=-Math.atan2(o.value[1].value.real,o.value[0].value.real),a=wr.normalizeZ(a),n=wr.normalizeZ(n),i=wr.normalizeZ(i),e=wr.normalizeZ(e);var s=wr.abs(wr.sub(n,a)),u=[a.value[0].value.real,a.value[1].value.real];a=wn.drawingstate.matrix;var c=u[0]*a.a-u[1]*a.b+a.tx;u=u[0]*a.c-u[1]*a.d-a.ty,n=0<wr.det3(n,i,e).value.real,St.save(),St.beginPath(),St.translate(c,u),St.arc(0,0,s.value.real*a.sdet,t,o,n),"F"===r&&(St.fillStyle=pn.lineColor,St.closePath(),St.fill()),"D"===r&&St.stroke(),St.restore()}else{if("D"!==r)return l;if(r=Er.extractPoint(n),t=Er.extractPoint(i),o=Er.extractPoint(e),!r.ok||!t.ok||!o.ok)return l;if(s=(r.x-o.x)*(r.x-o.x)+(r.y-o.y)*(r.y-o.y),a=(o.x-t.x)*(o.x-t.x)+(o.y-t.y)*(o.y-t.y),1e-12>(r.x-t.x)*(r.x-t.x)+(r.y-t.y)*(r.y-t.y)||1e-12>s||1e-12>a)return l;0>wr.crossratio3(n,e,i,wr.cross(wr.cross(n,i),wr.linfty),wr.ii).value.real?pn.drawsegcore(r,o):pn.drawRaySegment(n,e)}return l},Er.drawcircle=function(e,t,r){var n=ce(e[0]);e=ce(e[1]);var i=Er.extractPoint(n);if(!i.ok||"number"!==e.ctype||!yr._helper.isAlmostReal(e))return l;n=wn.drawingstate.matrix;var a=i.x*n.a-i.y*n.b+n.tx;return i=i.x*n.c-i.y*n.d-n.ty,pn.handleModifs(t,pn.conicModifs),pn.preDrawCurve(),St.lineJoin="miter",St.beginPath(),St.arc(a,i,Math.abs(e.value.real)*n.sdet,0,2*Math.PI),St.closePath(),"D"===r&&St.stroke(),"F"===r&&(St.fillStyle=pn.lineColor,St.fill()),"C"===r&&St.clip(),l},Or.drawconic$1=function(e,t){if("list"!==(e=ce(e[0])).ctype||3!==e.value.length&&6!==e.value.length)return console.error("could not parse conic"),l;if(6===e.value.length){for(var r=0;6>r;r++)if("number"!==e.value[r].ctype)return console.error("could not parse conic"),l;var n=yr.real(.5);r=e.value[0];var i=e.value[2];i=yr.mult(i,n);var a=e.value[1],o=e.value[3];o=yr.mult(o,n);var s=e.value[4];s=yr.mult(s,n),e=e.value[5],e=wr.turnIntoCSList([wr.turnIntoCSList([r,i,o]),wr.turnIntoCSList([i,a,s]),wr.turnIntoCSList([o,s,e])])}else{if(!wr.isNumberMatrix(e).value||3!==e.value.length||3!==e.value[0].value.length)return l;r=wr.transpose(e),wr.equals(e,r).value||(e=wr.add(r,e))}return Er.drawconic(e,t)},Er.drawconic=function(e,t){function r(e,t){return 0<=(e=(s*e+u*t+c)*e+(p*t+f)*t+h)?1:0>e?-1:NaN}function n(e){return M.next=e,e.prev=M,M=e}function i(e,t,n,i){return{a:e,b1:t,b2:n,vertical:!0,index:i,sign:function(t){return r(e,t)},mkp:function(t){return{x:e,y:t}},sol:K(p,u*e+f,(s*e+c)*e+h),discr:function(){return K(b,-2*m,v)},tpt:function(e){return{x:e,y:-.5*(u*e+f)/p}}}}function a(e,t,n,i){return{a:e,b1:t,b2:n,vertical:!1,index:i,sign:function(t){return r(t,e)},mkp:function(t){return{x:t,y:e}},sol:K(s,u*e+c,(p*e+f)*e+h),discr:function(){return K(b,-2*y,g)},tpt:function(e){return{x:-.5*(u*e+c)/s,y:e}}}}function o(e){var t=Math.min(e.b1,e.b2),r=Math.max(e.b1,e.b2),i=e.sign(t),a=e.sign(r);if(!isFinite(i*a))return!1;var o=e.sol;if(i!==a){if(null===o)return!1;var l=.5*(o[0]+o[1]);l>t&&l<r?l=o[(t=e.sign(l))===a?0:1]:(i=.5*(t+r),l=o[Math.abs(i-o[0])<Math.abs(i-o[1])?0:1]),S.push(n(e.mkp(l)))}else{if(null===o)return 0>=P||null===(o=e.discr())||(e=e.tpt(o[e.index])).x>=x&&e.x<=_&&e.y>=C&&e.y<=w&&n(e),!0;if(!((l=.5*(o[0]+o[1]))>t&&l<r))return!0;if((t=e.sign(l))===i||isNaN(t))return!0;e.b1>e.b2&&(o=[o[1],o[0]]),S.push(n(e.mkp(o[0]))),S.push(n(e.mkp(o[1])))}return!0}function l(e,t,r,n,i){var a=t-n,o=r-e,P=e*n-t*r,x=m*a+y*o+b*P;if(1e-14>Math.abs(x))return St.lineTo(r,n);var C=(v*a+d*o+m*P)/x;if(a=(d*a+g*o+y*P)/x,!isFinite(C)||!isFinite(a)||.04>Math.abs(e*a+C*n+r*t-r*a-C*t-e*n))return St.lineTo(r,n);do{if(!(10<i)){var _=C-(P=.5*(e+r));if(!(.04>_*_+(x=a-(o=.5*(t+n)))*x)){var w=s*_*_+u*_*x+p*x*x,S=2*s*_*P+u*(_*o+x*P)+2*p*x*o+c*_+f*x,M=(s*P+u*o+c)*P+(p*o+f)*o+h,T=K(w,S,M);if(T||(T=[-.5*S/w,-2*M/S]),0<T[0])T=T[0];else{if(!(0<=T[1]))break;T=T[1]}if(!(.04>(P=(_=P+T*_)-.5*(C+P))*P+(o=(x=o+T*x)-.5*(a+o))*o))return l(e,t,_,x,i+1),void l(_,x,r,n,i+1)}}}while(0);St.quadraticCurveTo(C,a,r,n)}if(pn.handleModifs(t,pn.conicModifs),0!==pn.lsize&&(pn.preDrawCurve(),e=wr.normalizeMax(e),wr._helper.isAlmostReal(e))){t=wn.toMat(),e=wr.mult(wr.transpose(t),e),e=wr.mult(e,t);var s=(e=wr.normalizeMax(e)).value[0].value[0].value.real,u=2*e.value[0].value[1].value.real,c=2*e.value[0].value[2].value.real,p=e.value[1].value[1].value.real,f=2*e.value[1].value[2].value.real,h=e.value[2].value[2].value.real,v=4*h*p-f*f,d=f*c-2*h*u,m=f*u-2*p*c,g=4*h*s-c*c,y=c*u-2*f*s,b=4*p*s-u*u,P=b;0>(e=p*g+u*d+s*v-h*b)&&(s=-s,u=-u,c=-c,p=-p,f=-f,h=-h,e=-e);var x=-(e=pn.lsize),C=-e,_=Mt+e,w=Tt+e,S=[],M=e={};if(o(i(x,C,w,0))&&o(a(w,x,_,1))&&o(i(_,w,C,1))&&o(a(C,_,x,0))&&M!==e){if(M.next=e.next,e.next.prev=M,St.beginPath(),0===S.length){var T=M;St.moveTo(T.x,T.y);do{var I=T.next;l(T.x,T.y,I.x,I.y,0),T=I}while(T!==M);St.closePath()}if(t=1===r(x,C)?0:1,4===S.length){var L=0;for(e=0;2>e;++e){T=S[e];var O=(I=S[e+2]).x-T.x;T=I.y-T.y,T=(s*O+u*T)*O+p*T*T,Math.abs(T)>Math.abs(L)&&(L=T)}if(isNaN(L))return;0<=L&&(t=1-t)}for(e=t;e<S.length;e+=2)for(T=S[e],t=S[(e+1)%S.length],St.moveTo(T.x,T.y),I=T.next;T!==t;I=(T=I).next)l(T.x,T.y,I.x,I.y,0);St.stroke()}}},Or.drawall$1=function(e,t){if("list"===(e=ue(e[0])).ctype)for(pn.handleModifs(t,pn.pointAndLineModifs),t=0;t<e.value.length;t++)Or.draw$1([e.value[t]],null);return l},Or.connect$1=function(e,t){return Er.drawpolygon(e,t,"D",!1)},Or.drawpoly$1=function(e,t){return Er.drawpolygon(e,t,"D",!0)},Or.fillpoly$1=function(e,t){return Er.drawpolygon(e,t,"F",!0)},Or.drawpolygon$1=function(e,t){return Er.drawpolygon(e,t,"D",!0)},Or.fillpolygon$1=function(e,t){return Er.drawpolygon(e,t,"F",!0)},Er.drawpolygon=function(e,t,r,n){pn.handleModifs(t,n?pn.conicModifs:pn.lineModifs),pn.preDrawCurve();var i=wn.drawingstate.matrix,a=ue(e[0]);return St.beginPath(),"list"===a.ctype&&function(){var e;for(e=0;e<a.value.length;e++){var t=Er.extractPoint(a.value[e]);if(!t.ok)return;var r=t.x*i.a-t.y*i.b+i.tx;t=t.x*i.c-t.y*i.d-i.ty,0===e?St.moveTo(r,t):St.lineTo(r,t)}n&&St.closePath()}(),"shape"===a.ctype&&function(){for(var e=a.value,t=0;t<e.length;t++){var r,n=e[t];for(r=0;r<n.length;r++){var o=n[r],l=o.X*i.a-o.Y*i.b+i.tx;o=o.X*i.c-o.Y*i.d-i.ty,0===r?St.moveTo(l,o):St.lineTo(l,o)}St.closePath()}}(),"D"===r&&(pn.fillColor&&(St.fillStyle=pn.fillColor,St.fill(pn.fillrule)),St.stroke()),"F"===r&&(St.fillStyle=pn.lineColor,St.fill(pn.fillrule)),"C"===r&&St.clip(),l};var $r=function e(t,r,n,i,a,o,l,s){if(s=void 0===s?0:s,-1!==r.indexOf("\n")){var u=1/0,c=-1/0,p=1/0,f=-1/0;return r.split("\n").forEach((function(r){r=e(t,r,n,i,a,o),u>r.left&&(u=r.left),c<r.right&&(c=r.right),p>r.top&&(p=r.top),f<r.bottom&&(f=r.bottom),i+=l})),{left:u,right:c,top:p,bottom:f}}var h=t.measureText(r);return s?(t.save(),t.translate(n,i),t.rotate(-s),t.fillText(r,-h.width*a,0),t.restore()):t.fillText(r,n-h.width*a,i),{left:n-h.width*a,right:n+h.width*(1-a),top:i-.84*o,bottom:i+.36*o}},Br=function(e,t,r){if(-1!==t.indexOf("\n"))for(t=t.split("\n"),e.textContent=t[0],r=1;r<t.length;++r)e.appendChild(document.createElement("br")),e.appendChild(document.createTextNode(t[r]));else e.textContent=t};Er.drawtext=function(e,t,r){var n=ce(e[0]);e=ue(e[1]);var i=Er.extractPoint(n);if(!i.ok)return null;pn.handleModifs(t,pn.textModifs),null===(t=wn.drawingstate.textsize)&&(t=Sn.textsize),null!==pn.size&&(t=pn.size),St.fillStyle=pn.textColor;var a=wn.drawingstate.matrix;return n=i.x*a.a-i.y*a.b+a.tx+pn.xOffset,i=i.x*a.c-i.y*a.d-a.ty-pn.yOffset,e=E(e),Ot._pluginRegistry.katex||"string"!=typeof e||3<=e.split("$").length&&c("katex","katex-plugin.js",!0),St.font=pn.bold+pn.italics+Math.round(10*t)/10+"px "+pn.family,r?r(e,n,i,pn.align,t):$r(St,e,n,i,pn.align,t,t*Sn.lineHeight,pn.angle)},Or.drawtext$2=function(e,t){return Er.drawtext(e,t,null),l},Or.drawtable$2=function(e,t){var r=ce(e[0]);e=ce(e[1]);var n=Er.extractPoint(r);if(!n.ok||"list"!==e.ctype)return l;e=(r=e.value).length;var i,a=-1;for(i=0;i<e;++i)"list"===r[i].ctype&&r[i].value.length>a&&(a=r[i].value.length);-1===a?(r=r.map((function(e){return[e]})),a=1):r=r.map((function(e){return wr.asList(e).value}));var o=100,s=null,u=!0,c=wn.drawingstate.textcolor;pn.handleModifs(t,{size:!0,color:function(e){wr._helper.isNumberVecN(e,3)&&(c=pn.makeColor([e.value[0].value.real,e.value[1].value.real,e.value[2].value.real]))},alpha:!0,bold:!0,italics:!0,family:!0,align:!0,x_offset:!0,y_offset:!0,offset:!0,width:function(e){"number"===e.ctype&&(o=e.value.real)},height:function(e){"number"===e.ctype&&(s=e.value.real)},border:function(e){"boolean"===e.ctype&&(u=e.value)}}),null===(i=wn.drawingstate.textsize)&&(i=Sn.textsize),null!==pn.size&&(i=pn.size),null===s&&(s=1.6*i),St.font=pn.bold+pn.italics+Math.round(10*i)/10+"px "+pn.family,i=wn.drawingstate.matrix;var p=a*o,f=e*s;t=n.x*i.a-n.y*i.b+i.tx+pn.xOffset;var h=n.x*i.c-n.y*i.d-i.ty-pn.yOffset-f;if(u){for(pn.preDrawCurve(),St.strokeStyle=pn.lineColor,St.beginPath(),i=1;i<e;++i)St.moveTo(t,h+i*s),St.lineTo(t+p,h+i*s);for(n=1;n<a;++n)St.moveTo(t+n*o,h),St.lineTo(t+n*o,h+f);St.stroke(),St.lineWidth=pn.lsize+1,St.beginPath(),St.rect(t,h,p,f),St.stroke()}for(t+=pn.align*o+(1-2*pn.align)*s*.3,h+=.7*s,St.fillStyle=c,i=0;i<e;++i)for(n=0;n<a;++n)p=E(r[i][n]),$r(St,p,t+n*o,h+i*s,pn.align);return l},Er.drawshape=function(e,t){return"polygon"===e.type?Er.drawpolygon([e],t,"D",1):"circle"===e.type?Er.drawcircle([e.value.value[0],e.value.value[1]],t,"D"):l},Er.fillshape=function(e,t){return"polygon"===e.type?Er.drawpolygon([e],t,"F",1):"circle"===e.type?Er.drawcircle([e.value.value[0],e.value.value[1]],t,"F"):l},Er.clipshape=function(e,t){return"polygon"===e.type?Er.drawpolygon([e],t,"C",1):"circle"===e.type?Er.drawcircle([e.value.value[0],e.value.value[1]],t,"C"):l},Or.fill$1=function(e,t){return"shape"===(e=ue(e[0])).ctype?Er.fillshape(e,t):l},Or.clip$1=function(e,t){var r=ue(e[0]);return"shape"===r.ctype?Er.clipshape(r,t):"list"===r.ctype?(e=Or.polygon$1(e,[]),Or.clip$1([e],[])):l},Or.plot$1=function(e,t){return Or.plot$2([e[0],null],t)},Or.plot$2=function(e,t){function r(e){return"number"===e.ctype&&yr._helper.isAlmostReal(e)}function n(e,t,r,n,i){t=+t.value.real,i=+n.value.real,n=t*d.a-i*d.b+d.tx,t=t*d.c-i*d.d-d.ty,e=+e.value.real,i=+r.value.real,r=e*d.a-i*d.b+d.tx,e=e*d.c-i*d.d-d.ty,s?(St.lineTo(r,e),St.lineTo(n,t)):(St.beginPath(),St.moveTo(r,e),St.lineTo(n,t),s=!0)}function i(e,t,l,u,c){var p=r(l),f=r(u);if(.001>c)!a&&s&&(St.stroke(),s=!1);else if(p||f){var d=yr.real((e.value.real+t.value.real)/2);Nr.setvar(v,d);var m=ue(h),g=r(m);if(p&&f&&g){var y=l.value.real;if(f=m.value.real,g=u.value.real,p=1>Math.abs(y+g-2*f)/o){var b=yr.real((e.value.real+d.value.real)/2);Nr.setvar(v,b),b=ue(h);var P=yr.real((d.value.real+t.value.real)/2);Nr.setvar(v,P),P=ue(h),y=Math.abs(y+f-2*b.value.real)/o,f=Math.abs(f+g-2*P.value.real)/o,p=p&&1>y&&1>f}p?(n(e,d,l,m,c/2),n(d,t,m,u,c/2)):(i(e,d,l,m,c/2),i(d,t,m,u,c/2))}else i(e,d,l,m,c/2),i(d,t,m,u,c/2)}}var a=!1,o=.2/Bt,s=!1,u=-10,c=10,p=.1,f=1e3,h=e[0];if(null!==e[1]&&"variable"===e[1].ctype)var v=e[1].name;else e=Er.plotvars(h),v="#",-1!==e.indexOf("t")&&(v="t"),-1!==e.indexOf("z")&&(v="z"),-1!==e.indexOf("y")&&(v="y"),-1!==e.indexOf("x")&&(v="x");Nr.newvar(v);var d=wn.drawingstate.matrix;pn.handleModifs(t,{color:!0,alpha:!0,size:!0,dashpattern:!0,dashtype:!0,dashing:!0,lineCap:!0,lineJoin:!0,miterLimit:!0,connect:function(e){"boolean"===e.ctype&&(a=e.value)},start:function(e){"number"===e.ctype&&(u=e.value.real)},stop:function(e){"number"===e.ctype&&(c=e.value.real)},steps:function(e){"number"===e.ctype&&(f=e.value.real)}}),St.strokeStyle=pn.lineColor,St.lineWidth=pn.lsize,s=!1,t=yr.real(14.32),Nr.setvar(v,t);var m=ue(h);if("number"!==m.ctype){if(wr.isNumberVector(m).value&&2===m.value.length){for(s=!1,p=(c-u)/f,t=u;t<c;t+=p){Nr.setvar(v,yr.real(t));var g=ue(h);if(wr.isNumberVector(g).value&&2===g.value.length){var y=+g.value[0].value.real;g=+g.value[1].value.real,e=y*d.a-g*d.b+d.tx,y=y*d.c-g*d.d-d.ty,s?St.lineTo(e,y):(St.beginPath(),St.moveTo(e,y),s=!0)}}St.stroke(),Nr.removevar(v)}return l}for(e=u;e<c+p;e+=p)t=yr.real(e),Nr.setvar(v,t),m=ue(h),t.value.real>u&&i(y,t,g,m,p),y=t,g=m;return Nr.removevar(v),s&&St.stroke(),l},Or.plotX$1=function(e,t){e=e[0];var r=Er.plotvars(e);t="#",-1!==r.indexOf("t")&&(t="t"),-1!==r.indexOf("z")&&(t="z"),-1!==r.indexOf("y")&&(t="y"),-1!==r.indexOf("x")&&(t="x"),Nr.newvar(t),r=wn.drawingstate.matrix,St.fillStyle=wn.drawingstate.linecolor,St.lineWidth=1,St.lineCap=pn.lineCap,St.lineJoin=pn.lineJoin,St.miterLimit=pn.miterLimit;for(var n=!1,i=-10;10>i;i+=.01){Nr.setvar(t,yr.real(i));var a=ue(e);if("number"===a.ctype){var o=+a.value.real;a=i*r.a-o*r.b+r.tx,o=i*r.c-o*r.d-r.ty,n?St.lineTo(a,o):(St.beginPath(),St.moveTo(a,o),n=!0)}}return St.stroke(),Nr.removevar(t),l},Er.plotvars=function(e){function t(e,t){var r,n={};for(r=e.length-1;0<=r;--r)n[e[r]]=e[r];for(r=t.length-1;0<=r;--r)n[t[r]]=t[r];for(var i in e=[],n)n.hasOwnProperty(i)&&e.push(n[i]);return e}var r;if("variable"===e.ctype)return[e.name];if("infix"===e.ctype){var n=Er.plotvars(e.args[0]);return t(n,e=Er.plotvars(e.args[1]))}if("list"===e.ctype){var i=e.value,a=[];for(r=0;r<i.length;r++)a=t(a,n=Er.plotvars(i[r]));return a}if("function"===e.ctype){for(i=e.args,a=[],r=0;r<i.length;r++)a=t(a,n=Er.plotvars(i[r]));return"apply"!==e.oper&&"select"!==e.oper&&"forall"!==e.oper&&"sum"!==e.oper&&"product"!==e.oper&&"repeat"!==e.oper&&"min"!==e.oper&&"max"!==e.oper&&"sort"!==e.oper||"variable"!==e.args[1].ctype||(a=function(e,t){for(var r=0;r<e.length;r++)e[r]===t&&(e.splice(r,1),r--);return e}(a,e.args[1].name)),a}return[]},Or.clrscr$0=function(e,t){return void 0!==Mt&&void 0!==Tt&&St.clearRect(0,0,Mt,Tt),l},Or.repaint$0=function(e,t){return _(),l},Or.screenbounds$0=function(e,t){e=Tr.withUsage(wr.realVector(wn.to(0,0)),"Point"),t=Tr.withUsage(wr.realVector(wn.to(Ct.clientWidth,0)),"Point");var r=Tr.withUsage(wr.realVector(wn.to(Ct.clientWidth,Ct.clientHeight)),"Point"),n=Tr.withUsage(wr.realVector(wn.to(0,Ct.clientHeight)),"Point");return wr.turnIntoCSList([e,t,r,n])},Or.createimage$3=function(e,t){t=ue(e[0]);var r=ce(e[1]);if(e=ce(e[2]),"number"!==r.ctype||"number"!==e.ctype||"string"!==t.ctype)return l;var n=document.createElement("canvas");return n.id=t.value,n.width=r.value.real,n.height=e.value.real,n.style.display="none",document.body.appendChild(n),Lt[t.value]=a(n,!1),l},Or.clearimage$1=function(e,t){if("string"!==(e=ue(e[0])).ctype&&"image"!==e.ctype)return l;if(!(e=ee(e)))return l;if(null==(t=e.img))return l;var r=e.width,n=e.height;return t.getContext("2d").clearRect(0,0,r,n),e.generation++,l},Or.canvas$4=function(e,t){var r=ce(e[0]),n=ce(e[1]);t=ue(e[2]),e=e[3];var i=Er.extractPoint(r),a=Er.extractPoint(n);if(!i.ok||!a.ok||"string"!==t.ctype&&"image"!==t.ctype)return l;if(!(t=ee(t))||!t.img.getContext)return l;n=t.img;var o=t.width;r=t.height;var s=a.x-i.x,u=a.y-i.y,c=i.x-u*r/o,p=i.y+s*r/o;u=a.x-u*r/o,s=a.y+s*r/o,a=wn.from(i.x,i.y,1),c=wn.from(c,p,1),u=wn.from(u,s,1),i=a[0]*Gt,p=a[1]*Gt,s=c[0]*Gt;var f=c[1]*Gt,h=u[0]*Gt,v=u[1]*Gt;u=-(c=o*(p-f)/((i-s)*(p-v)-(i-h)*(p-f)))*i-(o=o*(i-s)/((p-f)*(i-h)-(p-v)*(i-s)))*p,r=r-(a=(r*(p-v)-r*(p-f))/((i-s)*(p-v)-(i-h)*(p-f)))*i-(s=(r*(i-h)-r*(i-s))/((p-f)*(i-h)-(p-v)*(i-s)))*p,n=n.getContext("2d"),i=St,(St=n).save(),St.transform(c,a,o,s,u,r),t.generation++,ue(e),St.restore(),St=i},Or.canvas$5=function(e,t){var r=ce(e[0]),n=ce(e[1]),i=ce(e[2]);t=ue(e[3]),e=e[4],r=Er.extractPoint(r);var a=Er.extractPoint(n),o=Er.extractPoint(i);if(!r.ok||!a.ok||!o.ok||"string"!==t.ctype&&"image"!==t.ctype)return l;if(!(t=ee(t))||!t.img.getContext)return l;i=t.img;var s=t.width;n=t.height;var u=wn.from(r.x,r.y,1),c=wn.from(a.x,a.y,1);a=wn.from(o.x,o.y,1),r=u[0]*Gt,o=u[1]*Gt;var p=c[0]*Gt,f=c[1]*Gt,h=a[0]*Gt,v=a[1]*Gt;c=-(a=((0-s)*(o-v)-0*(o-f))/((r-p)*(o-v)-(r-h)*(o-f)))*r-(s=((0-s)*(r-h)-0*(r-p))/((o-f)*(r-h)-(o-v)*(r-p)))*o,n=n-(u=((n-n)*(o-v)-(n-0)*(o-f))/((r-p)*(o-v)-(r-h)*(o-f)))*r-(p=((n-n)*(r-h)-(n-0)*(r-p))/((o-f)*(r-h)-(o-v)*(r-p)))*o,i=i.getContext("2d"),r=St,(St=i).save(),St.transform(a,u,s,p,c,n),t.generation++,ue(e),St.restore(),St=r},Or.screenresolution$0=function(e,t){return yr.real(wn.drawingstate.matrix.a)},Or.layer$1=function(e,t){},Or.imagesize$1=function(e,t){return(e=ee(ce(e[0])))?wr.realVector([+e.width,+e.height]):l},Or.imageready$1=function(e,t){return e=ee(ce(e[0])),Tr.bool(!(!e||!e.ready))},Or.drawimage$2=function(e,t){function r(){var e=1,r=1,s=1,u=1,c=Er.extractPoint(n),p=Er.extractPoint(a);if(!c.ok||!p.ok)return l;if(!(i=ee(i)))return l;var f=i.width,h=i.height;if(0===o){var v={};v.x=c.x-(p.y-c.y),v.y=c.y+(p.x-c.x),u=h/f}else if(v=Er.extractPoint(o),!c.ok)return l;if(St.save(),void 0!==t.alpha){var d=ue(t.alpha);"number"===d.ctype&&(e=d.value.real)}void 0!==t.aspect&&("number"===(d=ue(t.aspect)).ctype&&(u=d.value.real)),void 0!==t.flipx&&("boolean"===(d=ue(t.flipx)).ctype&&d.value&&(r=-1)),void 0!==t.flipy&&("boolean"===(d=ue(t.flipy)).ctype&&d.value&&(s=-1)),St.imageSmoothingEnabled=!0,void 0!==t.interpolate&&("boolean"===(d=ue(t.interpolate)).ctype&&(St.imageSmoothingEnabled=d.value)),d=wn.drawingstate.matrix,1!==e&&(St.globalAlpha=e),e=c.x*d.a-c.y*d.b+d.tx,c=c.x*d.c-c.y*d.d-d.ty,St.transform(p.x*d.a-p.y*d.b+d.tx-e,p.x*d.c-p.y*d.d-d.ty-c,v.x*d.a-v.y*d.b+d.tx-e,v.x*d.c-v.y*d.d-d.ty-c,e,c),St.scale(1/f,-1/h*u),St.translate(f/2,-h/2),St.scale(r,s),St.translate(-f/2,h/2),St.translate(0,-h),(r=i).drawTo?r.drawTo(St,0,0):St.drawImage(r.img,0,0),St.globalAlpha=1,St.restore()}if(2===e.length){var n=ce(e[0]),i=ce(e[1]);return function(){var e=1,r=1,a=1,o=1,s=0,u=1,c=Er.extractPoint(n);if(!c.ok)return l;if(!(i=ee(i)))return l;if(St.save(),void 0!==t.angle){var p=ue(t.angle);"number"===p.ctype&&(s=p.value.real)}void 0!==t.rotation&&"number"===(p=ue(t.rotation)).ctype&&(s=p.value.real),void 0!==t.scale&&("number"===(p=ce(t.scale)).ctype&&(r=e=p.value.real),wr.isNumberVector(p).value&&2===p.value.length&&(e=p.value[0].value.real,r=p.value[1].value.real)),void 0!==t.scalex&&"number"===(p=ue(t.scalex)).ctype&&(e=p.value.real),void 0!==t.scaley&&"number"===(p=ue(t.scaley)).ctype&&(r=p.value.real),void 0!==t.flipx&&"boolean"===(p=ue(t.flipx)).ctype&&p.value&&(a=-1),void 0!==t.flipy&&"boolean"===(p=ue(t.flipy)).ctype&&p.value&&(o=-1),void 0!==t.alpha&&"number"===(p=ue(t.alpha)).ctype&&(u=p.value.real),St.imageSmoothingEnabled=!0,void 0!==t.interpolate&&"boolean"===(p=ue(t.interpolate)).ctype&&(St.imageSmoothingEnabled=p.value);var f=wn.drawingstate.matrix,h=wn.drawingstate.initialmatrix,v=i.width,d=i.height;p=c.x*f.a-c.y*f.b+f.tx;var m=c.x*f.c-c.y*f.d-f.ty,g=(c.x+1)*f.a-c.y*f.b+f.tx-p;f=(c.x+1)*f.c-c.y*f.d-f.ty-m;var y=(c.x+1)*h.a-c.y*h.b+h.tx-(c.x*h.a-c.y*h.b+h.tx);h=(c.x+1)*h.c-c.y*h.d-h.ty-(c.x*h.c-c.y*h.d-h.ty),c=Math.sqrt(g*g+f*f)/Math.sqrt(y*y+h*h),g=-Math.atan2(g,f)+Math.atan2(y,h),e*=f=wn.drawingstate.matrix.sdet/72,r*=f,1!==u&&(St.globalAlpha=u),St.translate(p,m),St.scale(e*a*c,r*o*c),St.rotate(s+g),St.translate(-p,-m),St.translate(-v/2,-d/2),(e=i).drawTo?e.drawTo(St,p,m):St.drawImage(e.img,p,m),St.globalAlpha=1,St.restore()}()}if(3===e.length){n=ce(e[0]);var a=ce(e[1]),o=0;return i=ce(e[2]),r()}return 4===e.length?(n=ce(e[0]),a=ce(e[1]),o=ce(e[2]),i=ce(e[3]),r()):l},Or.drawimage$3=Or.drawimage$2,Or.drawimage$4=Or.drawimage$2,Or.allimages$0=function(){var e=[];return Object.keys(Lt).forEach((function(t){e.push({ctype:"string",value:t})})),wr.turnIntoCSList(e)};var Fr,Xr={};Or.cameravideo$0=function(e,t){function r(e){return{video:{width:e,advanced:[{width:{max:e,min:e}},{width:{ideal:e}}]},audio:!1}}e=!0;var n={};if(void 0!==t.resolution&&("string"===(t=ue(t.resolution)).ctype&&"maximal"===t.value?e=!0:"number"===t.ctype?(e=!1,n=r(t.value.real)):wr._helper.isNumberVecN(t,2)&&(e=!1,n=r(t.value[0].value.real),10>(t=t.value[1].value.real)||!Number.isInteger(t)?(n.video.aspectRatio=t,n.video.advanced[0].aspectRatio={min:t,max:t},n.video.advanced[1].aspectRatio={ideal:t}):(n.video.height=t,n.video.advanced[0].height={min:t,max:t},n.video.advanced[1].height={ideal:t}))),e&&(n=(n=[320,640,1024,1280,1920,2560]).map((function(e){return{width:{min:e}}})),n={video:{width:16e3,height:9e3,advanced:n},audio:!1}),e=JSON.stringify(n),Xr[e])return Xr[e];t=null;var i=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia;if(i?t=function(e,t){navigator.mediaDevices.getUserMedia(n).then(e,t)}:(i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)&&(t=function(e,t){i.call(navigator,n,e,t)}),!t)return console.warn("getUserMedia call not supported"),Xr[e]=l;var o=document.createElement("video");return o.autoplay=!0,Xr[e]=a(o,!0),console.log("Opening stream."),t((function(e){o.srcObject=e,o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.setAttribute("playsinline",""),o.play(),o.addEventListener("loadeddata",f)}),(function(e){console.error("Could not get user video:",String(e),e)})),Xr[e]},Or.playvideo$1=function(e,t){return(e=ee(ce(e[0]))).live&&e.img.play&&e.img.play(),l},Or.pausevideo$1=function(e,t){return(e=ee(ce(e[0]))).live&&e.img.pause&&e.img.pause(),l},Or.imagergba$3=function(e,t){t=ee(ce(e[0]));var r=ce(e[1]);return e=ce(e[2]),t&&"number"===r.ctype&&"number"===e.ctype&&t.ready?(r=Math.round(r.value.real),e=Math.round(e.value.real),Ht(r)&&Ht(e)?(e=te(t,r,e,1,1),wr.realVector([255*e[0],255*e[1],255*e[2],e[3]])):l):l},Or.imagergb$3=Or.imagergba$3,Or.imagergba$4=function(e,t){var r=ee(ce(e[2]));if(!r||!r.ready)return l;var n=r.width,i=r.height,a=pe(e[0]),o=pe(e[1]),s=pe(wr.realVector([0,i,1]));if(n=pe(wr.realVector([n,i,1])),a===l||o===l||u===l)return l;u=wr.ii,i=wr.jj,s=Er.basismap(s,n,u,i),a=Er.basismap(a,o,i,u);var u=pe(e[3]);if((i=Er.extractPoint(Tr.mult(s,Tr.mult(wr.adjoint3(a),u)))).ok)if(e=r.width,a=r.height,o=!0,s=!1,void 0!==t.interpolate&&("boolean"===(u=ue(t.interpolate)).ctype&&(o=u.value)),void 0!==t.repeat&&("boolean"===(u=ue(t.repeat)).ctype&&(s=u.value)),o&&(i.x-=.5,i.y-=.5),s&&(i.x=(i.x%e+e)%e,i.y=(i.y%a+a)%a),u=Math.floor(i.x),n=Math.floor(i.y),Ht(u)&&Ht(n)){if(t=[0,0,0,0],o){o=i.x-u,i=i.y-n;var c=te(r,u,n,2,2);if(s){if(u===e-1||n===a-1){s=te(r,(u+1)%e,n,1,1);var p=te(r,u,(n+1)%a,1,1);r=te(r,(u+1)%e,(n+1)%a,1,1),c=c.slice(0,4).concat(s,p,r)}}else-1!==u&&u!==e-1||(o=Math.round(o)),-1!==n&&n!==a-1||(i=Math.round(i));for(r=0;4>r;r++)t[r]=(1-i)*((1-o)*c[r]+o*c[r+4])+i*((1-o)*c[r+8]+o*c[r+12])}else t=te(r,u,n,1,1);r=wr.realVector(t)}else r=l;else r=l;return r},Or.imagergb$4=function(e,t){return(e=Or.imagergba$4(e,t))===l?l:wr.turnIntoCSList(e.value.slice(0,3))},Or.readpixels$1=function(e,t){e=te(e=ee(ce(e[0])),0,0,e.width,e.height),t=[];for(var r=0;r+3<e.length;r+=4)t.push(wr.turnIntoCSList([yr.real(e[r+0]),yr.real(e[r+1]),yr.real(e[r+2]),yr.real(e[r+3])]));return wr.turnIntoCSList(t)};var Yr,qr,Vr=["+","-"],Ur=["!",""],Wr=["",":=_"],Gr=[";",","],Hr=[],Jr={};qr=0,[{key:[":"],field:["."],deg:[""],take:["_"]},{functionCall:!0},{rassoc:!0,pow:["^"],sqrt:[""]},{mul:["*","","",""],cross:[""],div:["/","","",""]},{add:["+"],sub:["-",""],neg:["!",""]},{seq:[".."]},{eq:["==",""],ne:["!=","<>",""],lt:["<"],gt:[">"],le:["<=","",""],ge:[">=","",""],aeq:["~=",""],ane:["~!=",""],alt:["~<",""],agt:["~>",""],ale:["~<=",""],age:["~>=",""],in:[""],nin:[""]},{and:["&",""],or:["%",""]},{rassoc:!0,prepend:["<:"]},{concat:["++",""],remove:["--",""],common:["~~",""],append:[":>"]},{rassoc:!0,assign:["="],define:[":="],undefine:[":=_"],bdefine:["::="]},{seq:[";"]},{modif:["->",""]},{rassoc:!0,list:[","]}].forEach((function(e){qr+=2;var t=!!e.rassoc;for(var r in e.functionCall&&(Yr=qr),e){var n=e[r];if("boolean"!=typeof n)for(var i={name:r,sym:n[0],symbols:n,rassoc:t,precedence:qr,prefix:!1,postfix:!1,infix:!0,bare:!1},a=0;a<n.length;++a){var o=n[a];if(Jr.hasOwnProperty(o))throw Error("Duplicate operator: "+o);Jr[o]=i,Hr.push(o)}}})),Vr.forEach((function(e){Jr[e].prefix=!0})),Ur.forEach((function(e){Jr[e].prefix=!0,Jr[e].infix=!1})),Wr.forEach((function(e){Jr[e].postfix=!0,Jr[e].infix=!1})),Gr.forEach((function(e){Jr[e].prefix=!0,Jr[e].postfix=!0,Jr[e].infix=!0,Jr[e].bare=!0})),Hr.sort((function(e,t){return t.length-e.length}));var Zr="(?:[] )?[](?: [])*".replace(/ /g,"[ \t]*"),Qr="(?:[] )?[](?: [])*".replace(/ /g,"[ \t]*"),Kr=function(e,t,r){var n,i=0,a="(?:[",o=t.length;for(n=0;n<o;++n){var l=t.charCodeAt(n);55296<=l?(a+="]|"+t.charAt(n)+"[",i=56320):(a+=String.fromCharCode(l=i=e[l-32]+i),(i+=e[t.charCodeAt(++n)-32])!==l&&(i!==l+1&&(a+="-"),a+=String.fromCharCode(i)))}return a+"]|[\ud80c\ud840-\ud868\ud86a-\ud86c\ud86f-\ud872][\udc00-\udfff])"}([2,0,106,3,4,1,6,5,7,11,17,8,12,21,9,22,30,10,15,24,25,16,13,42,46,14,18,19,29,37,27,28,35,26,32,36,40,43,47,53,20,48,50,56,33,34,39,51,52,55,63,64,65,68,85,23,31,38,45,49,105,59,66,69,72,88,102,114,117,128,157,191,41,44,54,60,67,70,71,73,74,75,76,80,81,82,83,84,86,87,89,93,94,98,99,107,108,116,122,130,132,134,138,160,165,185,195,196,255,268,277,310,332,339,362,365,390,449,457,470,512,513,541,568,582,619,673,726,768,820,921,991,1164,2684,6581,8453,11171,20949],"T4(4I!)!'!&/ 0 ')2$+! !$ %## !(!   ! ; u . =#!+YoA& 87C% } !5%+%) #!*! <0a,!4B1%'!&-'!1!$!33`HsG$!;!+.52'(#%#- & !$#$!*!9%  2%H''%#- & % % %B# !H *+   - & % $$!;!5%3!,(#%#- & % $$!X%  5!:! '$  #$% ! %$%$ $)W!G(   / 2$!> &%C(   / . $$!L! %5%;(   D#!*!* 4'&*$W + !#&]F %6&]% !#% !#!(# &   ! !#% # %1!#$ !/#L!S( @?$7-!*''#$!$%+ ',6!:= !&!#7  ##& ! ##D ##B ##& ! ##9 K ##^Y2*V#'$#5 4&p((+, #2*2*2,  5OC!'!Uy.D !&_)0J<#$,E'4Q/1Pv!|8:&K<9%)E>@7 )@# #$%1gT#'#=#'#( ! ! ! 0#P & !$  &$##'',&  &d!9!*,b!'!#. !$$(! ! ! # 1##&$'!G%8 8 (#$%6= !&!#Q+!*/1& & & & & & & &t!%E$&%'V(  z #&D${:Aj2qEUZ#$2)%-8*0#_J+#b#M#(S1   # /0O2[R'$! !6>)/A?+8<!*$ .)$ D3  (-/$!$[ !$%#$#! !4 #1+ 6'#'#'1& & 7 .)c06/'I#\\N&6$&! . , $ ! % % M;R#Gh)d$ =4(4,a$'#'#'# \ud800!) 4 : % 9#6@?$IIX*5 ((=)<#@'(\ud801!f~N.Of1-)(\ud802!'#! E %$!#/)/10^: %)-)4nQ(%T!5#   AZ?$?C( >?G)-):9*\ud803!`KJ9J\ud804#PriL3>@7M$!6F2#/! !C* 3V& ! # 9 .+8N(#%#- & % $$!;!6$\ud805eF-% !87#=F-!k7x4\ud806RB!K\ud808!\ud809e\ud80d!8\ud811!\ud81a!+0c<;F*#BH&:\ud81bU,!l,\ud82c!%\ud82f!\"&,$++.\ud835!w m %#!#%## ) ! & S ##( & > # $ !$& #3 3 0 3 0 3 0 3 0 3 (\ud83a!\ud83b# A % !#! . # ! !(!'! ! !   % !#! ! ! ! ! % !## & # # ! . 5&  $ 5\ud869!7\ud86d!,g\ud86e!<#\ud873!\ud87e!"),en=("#(?: [1-9])?|(?:'|"+Kr+")(?: (?:[0-9']|"+Kr+"))*").replace(/ /g,"[ \t]*"),tn=["([ \t\n\r]+)|(//.*)|(/\\*)","("+("(?:[0-9](?: [0-9])*(?: \\.(?! \\.)(?:(?! "+en+")|(?= (?: [Ee](?: [+-])?(?: [0-9])+)))(?: [0-9])*)?|\\.(?: [0-9])+)(?: [Ee](?: [+-])?(?: [0-9])+)?").replace(/ /g,"[ \t]*")+")","("+Hr.map(re).join("|")+")","("+"[](){}||".split("").map(re).join("|")+")","("+Qr+")","("+Zr+")","("+en+")",'("[^"]*")|($)'].join("|"),rn=new RegExp("[ \t]*".replace(/\*$/,"+"),"g"),nn="ANY WS COMMENT START_COMMENT NUM OP BRA SUB SUP ID STR EOF".split(" ");!function(){var e=new RegExp(tn,"g").exec("");if(e.hasOwnProperty(nn.length))throw Error("RE has more groups than expected");if(!e.hasOwnProperty(nn.length-1))throw Error("RE has fewer groups than expected")}(),ie.prototype.advanceBy=function(e){this.advanceTo(this.pos+e)},ie.prototype.advanceTo=function(e){for(this.pos=e;this.bols[0]<=e;)this.bol=this.bols.shift(),this.line++},ie.prototype.curPos=function(){return{row:this.line,col:this.pos-this.bol,pos:this.pos}},ie.prototype.nextInternal=function(){var e=this.re.exec(this.input);if(e.index!==this.pos)throw ne("Invalid token",this.curPos(),this.input.substring(this.pos,e.index));var t=this.curPos();this.advanceBy(e[0].length);var r,n=this.curPos();for(r=1;null==e[r];++r);return{start:t,end:n,raw:e[0],text:e[0].replace(rn,""),toktype:nn[r]}},ie.prototype.next=function(){do{var e=this.nextInternal();if("START_COMMENT"===e.toktype){var t=/\*\/|\/\*/g;t.lastIndex=e.start.pos+2;for(var r,n=1;0<n;){if(!(r=t.exec(this.input)))throw ne("Unterminated comment",e.start,e.text);"/*"===r[0]?++n:--n}this.re.lastIndex=t.lastIndex,this.advanceTo(t.lastIndex),e.end=this.curPos(),e.raw=this.input.substring(e.start.pos,e.end.pos),e.text=e.raw,e.toktype="COMMENT"}}while("WS"===e.toktype||"COMMENT"===e.toktype);return e};var an={ctype:"void"};se.prototype.postprocess=function(e){if(null===e)return an;if(e){if("infix"===e.ctype)if(":="===e.oper){var t=e.args[0];if("function"===t.ctype)t.args.forEach((function(t){if(null===t||"variable"!==t.ctype)throw ne("Function argument must be an identifier",t.start||e.start)}));else if("variable"!==t.ctype)throw ne(e.oper+" can only be used to define functions or variables",e.start)}else if(","===e.oper)throw ne("comma may only be used to delimit list elements",e.start);if(e.args&&(e.args=e.args.map(this.postprocess,this)),e.modifs)for(var r in e.modifs)e.modifs[r]=this.postprocess(e.modifs[r]);if("paren"===e.ctype)return e.args[0];if("infix"===e.ctype){if("."===e.oper){if(!e.args[1]||"variable"!==e.args[1].ctype)throw ne("Field name must be identifier",e.start,e.text);e.ctype="field",e.obj=e.args[0],e.key=e.args[1].name,delete e.args}if(":"===e.oper){if(e.jsonatom){if(!e.args[1])throw ne("JSON: Value undefined",e.start,e.text);e.ctype="jsonatom",e.key=e.args[0],e.value=e.args[1],delete e.jsonatom}else{if(!e.args[1])throw ne("UserData: Key undefined",e.start,e.text);e.ctype="userdata",e.obj=e.args[0],e.key=e.args[1]}delete e.args}this.infixmap&&(e.impl=this.infixmap[e.oper])}else"variable"===e.ctype?this.usedVariables[e.name]=!0:"function"===e.ctype&&(this.usedFunctions[e.oper]=!0)}if("infix"===e.ctype)return{ctype:"infix",oper:String(e.oper),args:[e.args[0],e.args[1]],impl:e.impl};if("variable"===e.ctype)return{ctype:"variable",name:String(e.name)};if("number"===e.ctype)return{ctype:"number",value:{real:+e.value.real,imag:+e.value.imag}};if("string"===e.ctype)return{ctype:"string",value:String(e.value)};if("list"===e.ctype)return{ctype:"list",value:e.value};if("function"===e.ctype)return{ctype:"function",oper:String(e.oper),args:e.args,modifs:e.modifs};if("field"===e.ctype)return{ctype:"field",obj:e.obj,key:String(e.key)};if("userdata"===e.ctype)return{ctype:"userdata",obj:e.obj,key:e.key};if("jsonatom"===e.ctype)return{ctype:"jsonatom",key:e.key,value:e.value};throw Error("Unsupported AST node of type "+e.ctype)},se.prototype.parse=function(e){try{var t=le(new ie(e));if("EOF"!==t.closedBy.toktype)throw ne("Closing bracket never opened.",t.closedBy.start,t.closedBy.text);return this.postprocess(t.expr)}catch(e){return e.ctype="error",e}},"undefined"!=typeof process&&"undefined"!=typeof module&&void 0!==module.exports&&"undefined"==typeof window&&(module.exports.Parser=se,module.exports.Tokenizer=ie,module.exports.unicodeLetters=Kr,module.exports.parse=function(e){return(new se).parse(e)});var on={},ln=[],sn={lines:{},audioCtx:null,getAudioContext:function(){return this.audioCtx||(window.AudioContext||window.webkitAudioContext?this.audioCtx=new(window.AudioContext||window.webkitAudioContext):console.warn("Web Audio API not supported in this browser")),this.audioCtx},handleModif:function(e,t,r){if(void 0===e)return r;if((e=ue(e)).ctype===t){if("number"===e.ctype)return e.value.real;if("list"===e.ctype){for(t=e.value,e=[],r=0;r<t.length;r++)e[r]=t[r].value.real;return e}return e.value}},handleLineModif:function(e,t){return void 0!==e?E(e=ue(e)):t},getBufferNode:function(e,t){var r=this.getAudioContext();if(t*r.sampleRate>e.length){for(var n=[],i=0,a=0;i<r.sampleRate*t;i++,a++)a>e.length&&(a=0),n[i]=e[a];e=n}return t=new Float32Array(e),(e=r.createBuffer(1,t.length,r.sampleRate)).copyToChannel(t,0),(r=r.createBufferSource()).buffer=e,r},createMonoOscillator:function(e,t){var r=this.getAudioContext().createOscillator();if(0!==t){var n=new Float32Array(2),i=new Float32Array(2);n[1]=Math.sin(t),i[1]=Math.cos(t),t=this.getAudioContext().createPeriodicWave(n,i,{disableNormalization:!0}),r.setPeriodicWave(t)}else r.type="sine";return r.mono=!0,r.frequency.value=e,r},createWaveOscillator:function(e,t,r){for(var n=this.getAudioContext().createOscillator(),i=new Float32Array(t.length+1),a=new Float32Array(t.length+1),o=0;o<t.length;o++)a[o+1]=t[o]*Math.cos(r[o]),i[o+1]=t[o]*Math.sin(r[o]);return t=this.getAudioContext().createPeriodicWave(i,a,{disableNormalization:!0}),n.setPeriodicWave(t),n.frequency.value=e,n},cleanup:function(){for(var e in this.lines)if("sin"===this.lines[e].lineType)if(this.lines[e].oscNodes.every((function(e){return!e.oscNode.isplaying})))delete this.lines[e];else for(var t=0;t<this.lines[e].oscNodes.length;t++)this.lines[e].oscNodes[t]&&!this.lines[e].oscNodes[t].oscNode.isplaying&&delete this.lines[e].oscNodes[t]},registerInput:function(e){e.cnt?e.cnt++:e.cnt=1},deregisterInput:function(e){e.cnt&&e.cnt--},hasRegisteredInput:function(e){return e.cnt&&0!==e.cnt},playOscillator:function(e,t,r,n,i,a){var o=this.getAudioContext(),l=o.createGain();return l.gain.value=0,e.connect(l),l.connect(t),sn.registerInput(t),e.start(0),e.isplaying=!0,e.onended=function(){this.isplaying=!1,l.disconnect(),sn.deregisterInput(t),sn.hasRegisteredInput(t)||(t.disconnect(),t.panNode&&t.panNode.disconnect()),sn.cleanup()},l.gain.linearRampToValueAtTime(r,o.currentTime+n),0<=i&&(l.gain.setValueAtTime(r,o.currentTime+n+i),l.gain.linearRampToValueAtTime(0,o.currentTime+n+i+a),this.triggerStop(e,i+n+a)),{oscNode:e,gainNode:l}},softStop:function(e,t){var r=this.getAudioContext();e.gainNode.gain.cancelScheduledValues(r.currentTime),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,r.currentTime),e.gainNode.gain.linearRampToValueAtTime(0,r.currentTime+t),this.triggerStop(e.oscNode,t)},extendDuration:function(e,t,r){var n=this.getAudioContext();e.gainNode.gain.cancelScheduledValues(n.currentTime),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,n.currentTime),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,n.currentTime+t),e.gainNode.gain.linearRampToValueAtTime(0,n.currentTime+t+r),this.triggerStop(e.oscNode,t+r)},triggerStop:function(e,t){e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout((function(){e.stop(0)}),1e3*t+10)}},un=function(e){this.audioCtx=e,this.lineType="sin",this.oscNodes=[]};un.prototype.handleModif=function(e,t,r,n){if("phaseshift"===t)n=this.handlePhaseshiftModif(e.phaseshift,this.harmonics.length);else if(void 0!==e[t]&&(e=ue(e[t])).ctype===r)if("number"===e.ctype)n=e.value.real;else if("list"===e.ctype){for(r=e.value,e=[],n=0;n<r.length;n++)e[n]=r[n].value.real;n=e}else n=e.value;return this[t]=n},un.prototype.handlePhaseshiftModif=function(e,t){if(this.phaseshift=Array(t).fill(0),void 0!==e)if("list"===(e=ue(e)).ctype)for(t=e.value,e=0;e<t.length;e++)this.phaseshift[e]=t[e].value.real;else if("number"===e.ctype)for(var r=0;r<t;r++)this.phaseshift[r]=(r+1)*e.value.real;return this.phaseshift},un.prototype.cleanparameters=function(e){this.partials.length<this.harmonics.length&&(this.partials=Array(this.harmonics.length).fill(1),e.partials&&console.warn("Ignore partials because the given length does not match with the length of harmonics")),this.phaseshift.length<this.harmonics.length&&(this.phaseshift=Array(this.harmonics.length).fill(0),e.phaseshift&&console.warn("Ignore phaseshift because the given length does not match with the length of harmonics")),this.precompute&=this.partials.every((function(e){return 1e-8>Math.abs(e-1)})),0<this.damp&&(this.duration=Math.min(this.duration,6/this.damp))},un.prototype.panit=function(){0===this.pan||this.masterGain.panNode||(this.masterGain.disconnect(this.audioCtx.destination),this.masterGain.panNode=this.audioCtx.createStereoPanner(),this.masterGain.connect(this.masterGain.panNode),this.masterGain.panNode.connect(this.audioCtx.destination)),this.masterGain.panNode&&(this.masterGain.panNode.pan.value=this.pan)},un.prototype.dampit=function(){this.masterGain.gain.cancelScheduledValues(this.audioCtx.currentTime),this.masterGain.gain.setValueAtTime(this.masterGain.gain.value,this.audioCtx.currentTime),0<this.damp?this.masterGain.gain.setTargetAtTime(0,this.audioCtx.currentTime+this.attack,1/this.damp):0>this.damp&&this.masterGain.gain.setTargetAtTime(1,this.audioCtx.currentTime+this.attack,-this.damp)},un.prototype.startOscillators=function(){if(this.precompute)this.oscNodes[0]=sn.playOscillator(sn.createWaveOscillator(this.freq,this.harmonics,this.phaseshift),this.masterGain,1,this.attack,this.duration,this.release);else for(var e=0;e<this.harmonics.length;e++)this.oscNodes[e]=sn.playOscillator(sn.createMonoOscillator(this.partials[e]*(e+1)*this.freq,this.phaseshift[e]),this.masterGain,this.harmonics[e],this.attack,this.duration,this.release)},un.prototype.stopOscillators=function(){for(var e in this.oscNodes)sn.softStop(this.oscNodes[e],this.release),delete this.oscNodes[e]},un.prototype.stop=function(){this.stopOscillators()},un.prototype.updateFrequencyAndGain=function(){if(this.precompute)this.harmonicsdidnotchange()&&this.oscNodes[0]&&this.oscNodes[0].oscNode.isplaying&&!this.oscNodes[0].oscNode.mono?(this.oscNodes[0].oscNode.frequency.value=this.freq,sn.extendDuration(this.oscNodes[0],this.duration,this.release)):(this.stopOscillators(),this.startOscillators());else{for(var e=0;e<this.harmonics.length;e++)0<this.harmonics[e]&&(this.oscNodes[e]&&this.oscNodes[e].oscNode.isplaying&&this.oscNodes[e].oscNode.mono?(this.oscNodes[e].oscNode.frequency.value=this.partials[e]*(e+1)*this.freq,this.oscNodes[e].gainNode.gain.value=this.harmonics[e],sn.extendDuration(this.oscNodes[e],this.duration,this.release)):(this.oscNodes[e]&&this.oscNodes[e].oscNode.isplaying&&!this.oscNodes[e].oscNode.mono&&sn.softStop(this.oscNodes[e],this.release),this.oscNodes[e]=sn.playOscillator(sn.createMonoOscillator(this.partials[e]*(e+1)*this.freq,this.phaseshift[e]),this.masterGain,this.harmonics[e],this.attack,this.duration,this.release)));for(var t in this.oscNodes)this.harmonics[t]||(sn.softStop(this.oscNodes[t],this.release),delete this.oscNodes[t])}},un.prototype.generateNewMasterGain=function(e){this.masterGain=this.audioCtx.createGain(),this.masterGain.connect(this.audioCtx.destination),this.masterGain.gain.value=e},un.prototype.harmonicsdidnotchange=function(){if(this.lastharmonics){var e=1&this.lastharmonics.length===this.harmonics.length;for(var t in this.harmonics)e&&(e&=this.harmonics[t]===this.lastharmonics[t])}else e=!1;return e},un.prototype.evokeplaysin=function(e,t,r){if(this.cleanparameters(r),0===this.duration)return this.stop(),l;e||t&&0!==this.damp?(t&&!e&&this.stopOscillators(),this.generateNewMasterGain(this.amp),this.startOscillators()):(this.masterGain||this.generateNewMasterGain(this.amp),this.updateFrequencyAndGain()),this.panit(),this.dampit(),this.lastharmonics=this.harmonics},Or.stopsound$0=function(){if(sn.audioCtx){for(var e in sn.lines)sn.lines[e].stop(),delete sn.lines[e];sn.audioCtx.close(),sn.audioCtx=null}},Or.playsin$1=function(e,t){var r=sn.getAudioContext(),n=sn.handleLineModif(t.line,"0"),i=!1;return sn.lines[n]&&"sin"===sn.lines[n].lineType||(sn.lines[n]&&sn.lines[n].stop(),sn.lines[n]=new un(r),i=!0),(r=sn.lines[n]).freq=ue(e[0]).value.real,r.handleModif(t,"amp","number",.5),r.handleModif(t,"damp","number",0),r.handleModif(t,"duration","number",sn.handleModif(t.stop,"number",1)),r.handleModif(t,"harmonics","list",[1]),r.handleModif(t,"partials","list",[1]),r.handleModif(t,"attack","number",.01),r.handleModif(t,"release","number",.01),r.handleModif(t,"pan","number",0),r.handleModif(t,"precompute","boolean",!1),r.handleModif(t,"phaseshift","phaseshift",Array(r.harmonics.length).fill(0)),e=sn.handleModif(t.restart,"boolean",!0),r.evokeplaysin(i,e,t),l},Or.playsin$0=function(e,t){if(void 0!==t.line&&(e=sn.handleLineModif(t.line,"0"),e=sn.lines[e])){e.handleModif(t,"freq","number",e.freq),e.handleModif(t,"amp","number",e.amp),e.handleModif(t,"damp","number",e.damp),e.handleModif(t,"duration","number",sn.handleModif(t.stop,"number",e.duration)),e.handleModif(t,"harmonics","list",e.harmonics),e.handleModif(t,"partials","list",e.partials),e.handleModif(t,"attack","number",e.attack),e.handleModif(t,"release","number",e.release),e.handleModif(t,"pan","number",e.pan),e.handleModif(t,"precompute","boolean",e.precompute),e.handleModif(t,"phaseshift","phaseshift",e.phaseshift);var r=sn.handleModif(t.restart,"boolean",!1);e.evokeplaysin(!1,r,t)}return l},Or.playfunction$1=function(e,t){var r=sn.getAudioContext(),n=e[0];e=function(e){var t=[];for(t.push(e);0!==t.length;){if("variable"===(e=t.pop()).ctype&&ue(e)===l&&-1!==["x","y","t"].indexOf(e.name))return e.name;if(e.args)for(var r in e.args)t.push(e.args[r])}return l}(n),e!==l&&Nr.newvar(e);var i=sn.handleLineModif(t.line,"0"),a=sn.handleModif(t.start,"number",0),o=sn.handleModif(t.amp,"number",.5),s=sn.handleModif(t.damp,"number",0);sn.handleModif(t.stop,"number",1);var u=sn.handleModif(t.duration,"number",1),c=sn.handleModif(t.attack,"number",.01),p=sn.handleModif(t.release,"number",.01),f=sn.handleModif(t.export,"boolean",!1),h=sn.handleModif(t.silent,"boolean",!1);t=[];for(var v=0;v<r.sampleRate*u;v++){e!==l&&Nr.setvar(e,yr.real(v/r.sampleRate));var d=ue(n);t[v]=d.value.real*o*Math.exp(-s*v/r.sampleRate)}return h||(sn.lines[i]&&"function"===sn.lines[i].lineType?((n=sn.lines[i]).masterGain.gain.linearRampToValueAtTime(0,r.currentTime+p),n.bufferNode.stop(r.currentTime+p),n.bufferNode=sn.getBufferNode(t,u),n.bufferNode.connect(n.masterGain),n.bufferNode.start(a+p),n.masterGain.gain.linearRampToValueAtTime(o,r.currentTime+p+c)):(sn.lines[i]&&sn.lines[i].stop(),sn.lines[i]={lineType:"function",bufferNode:sn.getBufferNode(t,u),masterGain:r.createGain(),stop:function(){this.bufferNode.stop()}},(u=sn.lines[i]).masterGain.gain.value=0,u.masterGain.connect(r.destination),u.bufferNode.connect(u.masterGain),u.bufferNode.start(a),u.masterGain.gain.linearRampToValueAtTime(o,r.currentTime+c))),e!==l&&Nr.removevar(e),f?t:l},Or.playwave$1=function(e,t){var r=sn.getAudioContext(),n=ue(e[0]),i=sn.handleLineModif(t.line,"0");e=sn.handleModif(t.amp,"number",.5),sn.handleModif(t.damp,"number",0);var a=sn.handleModif(t.duration,"number",1),o=sn.handleModif(t.attack,"number",.01),s=sn.handleModif(t.release,"number",.01);return t=sn.handleModif(t.start,"number",0),"list"!==n.ctype||(sn.lines[i]&&"wave"===sn.lines[i].lineType?((i=sn.lines[i]).masterGain.gain.linearRampToValueAtTime(0,r.currentTime+s),i.bufferNode.stop(r.currentTime+s),i.bufferNode=sn.getBufferNode(Tr.unwrap(n),a),i.bufferNode.connect(i.masterGain),i.bufferNode.start(t+s),i.masterGain.gain.linearRampToValueAtTime(e,r.currentTime+s+o)):(sn.lines[i]&&sn.lines[i].stop(),sn.lines[i]={lineType:"wave",bufferNode:sn.getBufferNode(Tr.unwrap(n),a),masterGain:r.createGain(),stop:function(){this.bufferNode.stop()}},(n=sn.lines[i]).masterGain.gain.value=0,n.masterGain.connect(r.destination),n.bufferNode.connect(n.masterGain),n.bufferNode.start(0),n.masterGain.gain.linearRampToValueAtTime(e,r.currentTime+o))),l};var cn={printArr:function(e){for(var t=e.value.length,r=[],n=[],i=!1,a=0;a<t;a++)r[a]=e.value[a].value.real,n[a]=e.value[a].value.imag,0!==n[a]&&(i=!0);console.log(r),i&&console.log(n)},zero:function(e){for(var t=[],r=yr.real(0),n=0;n<e.value.real;n++)t[n]=r;return wr.turnIntoCSList(t)},number:function(e,t){return(t=cn.zero(t)).value[0]=e,t},variable:function(e,t){return(t=cn.zero(t)).value[0]=e,t.value[1]=yr.real(1),t},add:function(e,t){return wr.add(e,t)},sub:function(e,t){return wr.sub(e,t)},mult:function(e,t){if(e.value.length!==t.value.length)return console.error("dims don't fit return nada"),l;for(var r=e.value.length,n=cn.zero(yr.real(r)),i=yr.real(0),a=0;a<r;a++){for(var o=0;o<=a;o++)i=yr.add(i,yr.mult(e.value[o],t.value[a-o]));n.value[a]=i,i=yr.real(0)}return n},pow:function(e,t){if(0>t.value.real||t.value.real!==Math.floor(t.value.real))return cn.root(e,t);for(var r=e,n=1;n<t.value.real;n++)r=cn.mult(r,e);return r},root:function(e,t){var r=yr.real(0),n=yr.real(1),i=yr.add(n,t),a=e.value.length,o=cn.zero(yr.real(a));o.value[0]=yr.pow(e.value[0],t);var l=r;for(t=1;t<a;t++){for(var s=yr.real(t),u=1;u<=t;u++){var c=yr.mult(i,yr.real(u));c=yr.div(c,s),c=yr.sub(c,n),c=yr.mult(c,e.value[u]),c=yr.mult(c,o.value[t-u]),l=yr.add(l,c)}l=yr.div(l,e.value[0]),o.value[t]=l,l=r}return o},findFirstNoneZero:function(e,t,r){for(var n=1/0,i=1/0,a=r;a<e.value.length;a++)if(1e-12<yr.abs2(e.value[a]).value.real){n=a;break}for(e=r;e<t.value.length;e++)if(1e-12<yr.abs2(t.value[e]).value.real){i=e;break}return[n,i]},div:function(e,t){if(e.value.length!==t.value.length)return console.log("dims don't fit - return nada"),l;for(var r,n=e.value.length,i=yr.real(0),a=cn.zero(yr.real(n)),o=i,s=0;s<n;s++){s<(r=cn.findFirstNoneZero(e,t,s))[0]&&r[0]===r[1]&&1/0!==r[0]&&(e.value.splice(s,r[0]),t.value.splice(s,r[0]),a.value.splice(s,r[0]),n-=r[0]),r=e.value[s];for(var u=0;u<s;u++)o=yr.add(o,yr.mult(a.value[u],t.value[s-u]));r=yr.sub(r,o),r=yr.div(r,t.value[0]),a.value[s]=r,o=i}return a},exp:function(e){var t=yr.real(0),r=e.value.length,n=cn.zero(yr.real(r)),i=t;n.value[0]=yr.exp(e.value[0]);for(var a=1;a<r;a++){for(var o=1;o<=a;o++){var l=yr.mult(yr.real(o),e.value[o]);l=yr.mult(l,n.value[a-o]),i=yr.add(i,l)}n.value[a]=yr.div(i,yr.real(a)),i=t}return n},log:function(e){var t=yr.real(0),r=e.value.length,n=cn.zero(yr.real(r));n.value[0]=yr.log(e.value[0]);for(var i,a,o=t,l=1;l<r;l++){i=e.value[l];for(var s=1;s<l;s++)a=yr.mult(yr.real(s),n.value[s]),a=yr.mult(a,e.value[l-s]),o=yr.add(o,a);o=yr.div(o,yr.real(l)),i=yr.sub(i,o),i=yr.div(i,e.value[0]),n.value[l]=i,o=t}return n},sincos:function(e){var t=yr.real(0),r=e.value.length,n=cn.zero(yr.real(r)),i=cn.zero(yr.real(r));n.value[0]=yr.sin(e.value[0]),i.value[0]=yr.cos(e.value[0]);for(var a,o,l,s=t,u=t,c=1;c<r;c++){l=yr.real(c);for(var p=1;p<=c;p++)o=yr.mult(yr.real(p),e.value[p]),a=yr.mult(o,i.value[c-p]),o=yr.mult(o,n.value[c-p]),u=yr.add(u,a),s=yr.add(s,o);u=yr.div(u,l),s=yr.div(s,yr.neg(l)),n.value[c]=u,i.value[c]=s,s=u=t}return cn.sinsave=n,cn.cossave=i,[n,i]},sin:function(e){return cn.sincos(e)[0]},cos:function(e){return cn.sincos(e)[1]},faculty:function(e){var t=[];t[0]=yr.real(1);for(var r=1,n=1;n<=e.value.real;n++)r*=n,t[n]=yr.real(r);return wr.turnIntoCSList(t)},diff:function(e,t,r,n){if("variable"===e.ctype)var i=e.name!==t?cn.number(ue(e),n):cn.variable(r,n);else if("number"===e.ctype)i=cn.number(e,n);else{if("infix"===e.ctype)return"*"===e.oper?cn.mult(cn.diff(e.args[0],t,r,n),cn.diff(e.args[1],t,r,n)):"^"===e.oper?cn.pow(cn.diff(e.args[0],t,r,n),cn.diff(e.args[1],t,r,n).value[0]):"/"===e.oper?cn.div(cn.diff(e.args[0],t,r,n),cn.diff(e.args[1],t,r,n)):"+"===e.oper?cn.add(cn.diff(e.args[0],t,r,n),cn.diff(e.args[1],t,r,n)):"-"===e.oper?cn.sub(cn.diff(e.args[0],t,r,n),cn.diff(e.args[1],t,r,n)):(console.log("infix not found",e.oper),l);if("function"!==e.ctype)return console.log("ctype not found",e.ctype),l;if("exp$1"===e.oper)return cn.exp(cn.diff(e.args[0],t,r,n));if("log$1"===e.oper)return cn.log(cn.diff(e.args[0],t,r,n));if("sin$1"===e.oper)return cn.sin(cn.diff(e.args[0],t,r,n));if("cos$1"===e.oper)return cn.cos(cn.diff(e.args[0],t,r,n))}return i},adevaluate:function(e,t,r,n){for(e=cn.diff(e,t,r,n),n=cn.faculty(n),t=2;t<e.value.length;t++)e.value[t]=yr.mult(e.value[t],n.value[t]);return e},autodiff:function(e,t,r,n){for(var i,a=[],o=r.value.length,l=0;l<o;l++)i=cn.adevaluate(e,t,r.value[l],n),a[l]=i;return wr.turnIntoCSList(a)}},pn={handleModifs:function(e,t){var r,n;for(r in pn.dashing&&pn.unSetDash(),pn.colorraw=null,pn.fillcolorraw=null,pn.fillrule="nonzero",pn.size=null,0>=pn.psize&&(pn.psize=0),0>=pn.lsize&&(pn.lsize=0),pn.overhang=1,pn.dashing=!1,pn.isArrow=!1,pn.arrowSides="==>",pn.arrowposition=1,pn.headlen=10,pn.arrowShape=pn.arrowShapes.line,pn.alpha=wn.drawingstate.alpha,pn.fillalpha=0,pn.bold="",pn.italics="",pn.family="sans-serif",pn.align=0,pn.angle=0,pn.xOffset=0,pn.yOffset=0,pn.lineCap="round",pn.lineJoin="round",pn.miterLimit=10,pn.noborder=!1,e){var i=e[r];i&&((n=t[r])?(!0===n&&(n=pn.modifHandlers[r]),n(ue(i))):console.log("Modifier not supported: "+r))}null!==pn.size?pn.psize=pn.lsize=pn.size:(pn.psize=wn.drawingstate.pointsize,pn.lsize=wn.drawingstate.linesize),pn.dashing&&pn.dashing(pn.lsize),null!==pn.colorraw?pn.pointColor=pn.lineColor=pn.textColor=pn.makeColor(pn.colorraw):1===pn.alpha?(pn.pointColor=wn.drawingstate.pointcolor,pn.lineColor=wn.drawingstate.linecolor,pn.textColor=wn.drawingstate.textcolor):(pn.pointColor=pn.makeColor(wn.drawingstate.pointcolorraw),pn.lineColor=pn.makeColor(wn.drawingstate.linecolorraw),pn.textColor=pn.makeColor(wn.drawingstate.textcolorraw)),pn.black=1===pn.alpha?"rgb(0,0,0)":"rgba(0,0,0,"+pn.alpha+")",pn.fillColor=pn.fillcolorraw&&0<pn.fillalpha?pn.makeColor(pn.fillcolorraw,pn.fillalpha):null},modifHandlers:{size:function(e){"number"===e.ctype&&(pn.size=e.value.real,0>pn.size&&(pn.size=0),1e3<pn.size&&(pn.size=1e3))},color:function(e){wr.isNumberVector(e).value&&3===e.value.length&&(pn.colorraw=[e.value[0].value.real,e.value[1].value.real,e.value[2].value.real])},fillcolor:function(e){wr.isNumberVector(e).value&&3===e.value.length&&(pn.fillcolorraw=[e.value[0].value.real,e.value[1].value.real,e.value[2].value.real])},alpha:function(e){"number"===e.ctype&&(pn.alpha=e.value.real)},fillalpha:function(e){"number"===e.ctype&&(pn.fillalpha=e.value.real)},dashpattern:function(e){if("list"===e.ctype){for(var t=[],r=0,n=0;r<e.value.length;r++)"number"===e.value[r].ctype&&(t[n++]=e.value[r].value.real);pn.dashing=pn.setDash.bind(null,t)}},dashtype:function(e){if("number"===e.ctype)e=Math.floor(e.value.real);else{if("string"!==e.ctype)return;e=e.value}(e=pn.dashTypes[e])&&(pn.dashing=pn.setDash.bind(null,e))},dashing:function(e){"number"===e.ctype&&(e=Math.floor(e.value.real),pn.dashing=pn.setDash.bind(null,[2*e,e]))},overhang:function(e){"number"===e.ctype&&(pn.overhang=pn.overhang*e.value.real+(1-pn.overhang)*(1-e.value.real))},arrow:function(e){"boolean"===e.ctype?pn.isArrow=e.value:console.error("arrow needs to be of type boolean")},arrowshape:function(e){"string"!==e.ctype?console.error("arrowshape needs to be of type string"):pn.arrowShapes.hasOwnProperty(e.value)?(pn.arrowShape=pn.arrowShapes[e.value],pn.isArrow=!0,pn.arrowShape.deprecated&&(console.log("arrowshape "+e.value+" is deprecated, use "+pn.arrowShape.deprecated+" instead."),pn.arrowShape.deprecated=null)):((e=Object.keys(pn.arrowShapes)).sort(),e=e.join(", "),console.error("arrowshape needs to be one of "+e))},arrowsides:function(e){"string"!==e.ctype?console.error("arrowsides is not of type string"):"==>"!==e.value&&"<==>"!==e.value&&"<=="!==e.value?console.error("arrowsides is unknows"):(pn.arrowSides=e.value,pn.isArrow=!0)},arrowposition:function(e){"number"!==e.ctype?console.error("arrowposition is not of type number"):0>e.value.real?console.error("arrowposition has to be positive"):1<e.value.real?pn.overhang=pn.overhang*e.value.real+(1-pn.overhang)*(1-e.value.real):(pn.arrowposition=e.value.real,pn.isArrow=!0)},arrowsize:function(e){"number"!==e.ctype?console.error("arrowsize is not of type number"):0>e.value.real?console.error("arrowsize has to be positive"):pn.headlen*=e.value.real},bold:function(e){"boolean"===e.ctype&&e.value&&(pn.bold="bold ")},italics:function(e){"boolean"===e.ctype&&e.value&&(pn.italics="italic ")},family:function(e){"string"===e.ctype&&(pn.family=e.value)},align:function(e){"string"===e.ctype&&("left"===(e=e.value)&&(pn.align=0),"right"===e&&(pn.align=1),"mid"===e||"center"===e)&&(pn.align=.5)},angle:function(e){"number"===e.ctype&&(pn.angle=e.value.real)},x_offset:function(e){"number"===e.ctype&&(pn.xOffset=e.value.real)},y_offset:function(e){"number"===e.ctype&&(pn.yOffset=e.value.real)},offset:function(e){"list"===e.ctype&&2===e.value.length&&"number"===e.value[0].ctype&&"number"===e.value[1].ctype&&(pn.xOffset=e.value[0].value.real,pn.yOffset=e.value[1].value.real)},lineCap:function(e){"string"!==e.ctype||"round"!==e.value&&"square"!==e.value&&"butt"!==e.value||(pn.lineCap=e.value)},lineJoin:function(e){"string"!==e.ctype||"round"!==e.value&&"bevel"!==e.value&&"miter"!==e.value||(pn.lineJoin=e.value)},fillrule:function(e){"string"!==e.ctype||"nonzero"!==e.value&&"evenodd"!==e.value||(pn.fillrule=e.value)},miterLimit:function(e){"number"===e.ctype&&0<e.value.real&&(pn.miterLimit=Math.round(e.value.real))},noborder:function(e){"boolean"===e.ctype?pn.noborder=e.value:console.error("noborder needs to be of type boolean")},border:function(e){"boolean"===e.ctype?pn.noborder=!e.value:console.error("border needs to be of type boolean")}},lineModifs:{size:!0,color:!0,alpha:!0,dashpattern:!0,dashtype:!0,dashing:!0,overhang:!0,arrow:!0,arrowshape:!0,arrowsides:!0,arrowposition:!0,arrowsize:!0,lineCap:!0,lineJoin:!0,miterLimit:!0},pointModifs:{size:!0,color:!0,alpha:!0,noborder:!0,border:!0}};pn.pointAndLineModifs=pn.lineModifs,pn.conicModifs={size:!0,color:!0,alpha:!0,dashing:!0,dashpattern:!0,dashtype:!0,fillcolor:!0,fillrule:!0,fillalpha:!0,lineCap:!0,lineJoin:!0,miterLimit:!0},pn.textModifs={size:!0,color:!0,alpha:!0,bold:!0,italics:!0,family:!0,align:!0,angle:!0,x_offset:!0,y_offset:!0,offset:!0},pn.makeColor=function(e,t){return void 0===t&&(t=pn.alpha),"rgba("+Math.floor(255*e[0])+","+Math.floor(255*e[1])+","+Math.floor(255*e[2])+","+t+")"},pn.preDrawCurve=function(){St.lineWidth=pn.lsize,St.lineCap=pn.lineCap,St.lineJoin=pn.lineJoin,St.mozFillRule=pn.fillrule,St.fillrule=pn.fillrule,St.miterLimit=pn.miterLimit,St.strokeStyle=pn.lineColor},pn.arrowShapes={default:{close:!1,fill:!1,ratio:1,deprecated:"line"},line:{close:!1,fill:!1,ratio:1},empty:{close:!0,fill:!1,ratio:1},hollow:{close:!0,fill:!1,ratio:1,deprecated:"empty"},full:{close:!0,fill:!0,ratio:1},jet:{close:!0,fill:!0,ratio:1.5},delta:{close:!0,fill:!0,ratio:1.5,deprecated:"jet"}},pn.clipSegment=function(e,t){var r=t.x-e.x,n=t.y-e.y,i=pn.clipLineCore(-n,r,e.x*t.y-t.x*e.y);if(2!==i.length)return[];var a=i[0];i=i[1];var o=1/(r*r+n*n),l=((a.x-e.x)*r+(a.y-e.y)*n)*o;return 0>l&&(a=e),1<l&&(a=t),0>(r=((i.x-e.x)*r+(i.y-e.y)*n)*o)&&(i=e),1<r&&(i=t),a===i?[]:[a,i]},pn.drawsegcore=function(e,t){function r(e,t,r,n){var i=e-n*c+.5*p,a=t-n*p-.5*c,o=e-n*c-.5*p;n=t-n*p+.5*c,St.beginPath(),pn.arrowShape.fill&&(St.lineWidth=pn.lsize/2),St.moveTo(i,a),St.lineTo(e,t),St.lineTo(o,n),pn.arrowShape.close&&(St.fillStyle=pn.lineColor,St.lineTo(e-r*c,t-r*p),St.closePath(),pn.arrowShape.fill&&St.fill()),St.stroke()}var n=wn.drawingstate.matrix,i=e.x*n.a-e.y*n.b+n.tx,a=e.x*n.c-e.y*n.d-n.ty,o=t.x*n.a-t.y*n.b+n.tx,l=t.x*n.c-t.y*n.d-n.ty,s=pn.overhang,u=1-s;if(t=s*i+u*o,n=s*a+u*l,e=s*o+u*i,s=s*l+u*a,0>t||t>Mt||0>n||n>Tt||0>e||e>Mt||0>s||s>Tt){if(2!==(s=pn.clipSegment({x:t,y:n},{x:e,y:s})).length||.01>pn.lsize)return;t=s[0].x,n=s[0].y,e=s[1].x,s=s[1].y}if(pn.preDrawCurve(),!pn.isArrow||i===a&&o===l).01>pn.lsize||(St.beginPath(),St.moveTo(t,n),St.lineTo(e,s),St.stroke());else{a=l-a;var c=(i=o-i)*(o=pn.headlen/Math.sqrt(i*i+a*a)),p=a*o;i=(l=pn.arrowposition)*t+(u=1-l)*e,a=l*n+u*s,o=l*e+u*t,l=l*s+u*n,u=pn.arrowSides,St.beginPath(),pn.arrowShape.close?("<==>"===u||"<=="===u?(1>pn.arrowposition&&(St.moveTo(t,n),St.lineTo(i,a)),St.moveTo(i+c,a+p)):St.moveTo(t,n),"==>"===u||"<==>"===u?(St.lineTo(o-c,l-p),1>pn.arrowposition&&(St.moveTo(o,l),St.lineTo(e,s))):St.lineTo(e,s)):(St.moveTo(t,n),St.lineTo(e,s)),St.stroke(),"==>"!==u&&"<==>"!==u||r(o,l,1,pn.arrowShape.ratio),"<=="!==u&&"<==>"!==u||r(i,a,-1,-pn.arrowShape.ratio)}},pn.drawpoint=function(e){var t=wn.drawingstate.matrix,r=e.x*t.a-e.y*t.b+t.tx;e=e.x*t.c-e.y*t.d-t.ty,St.lineWidth=.3*pn.psize,St.beginPath(),St.arc(r,e,pn.psize,0,2*Math.PI),St.fillStyle=pn.pointColor,St.fill(),pn.noborder||(St.beginPath(),St.arc(r,e,1.15*pn.psize,0,2*Math.PI),St.fillStyle=pn.black,St.strokeStyle=pn.black,St.stroke())},pn.clipLineCore=function(e,t,r){var n=Math.SQRT1_2*pn.lsize,i=0-n,a=Mt+n,o=0-n,l=0>i*e+o*t+r,s=0>a*e+o*t+r,u=0>i*e+(n=Tt+n)*t+r,c=0>a*e+n*t+r,p=[];return l!==s&&p.push({x:(-r-t*o)/e,y:o}),s!==c&&p.push({x:a,y:(-r-e*a)/t}),u!==c&&p.push({x:(-r-t*n)/e,y:n}),l!==u&&p.push({x:i,y:(-r-e*i)/t}),p},pn.clipLine=function(e){return e=wr.normalizeMax(wr.productVM(e,wn.toMat())),pn.clipLineCore(e.value[0].value.real,e.value[1].value.real,e.value[2].value.real)},pn.drawline=function(e){wr._helper.isAlmostReal(e)&&(2===(e=pn.clipLine(e)).length&&.01<=pn.lsize&&(pn.preDrawCurve(),St.beginPath(),St.moveTo(e[0].x,e[0].y),St.lineTo(e[1].x,e[1].y),St.stroke()))},pn.drawRaySegment=function(e,t){if(e=Er.extractPoint(e),t=Er.extractPoint(t),e.ok&&t.ok){var r=e.x-t.x,n=e.y-t.y,i=25e3/wn.drawingstate.matrix.sdet/Math.sqrt(r*r+n*n);r*=i,n*=i,pn.drawsegcore(e,{x:e.x+r,y:e.y+n}),pn.drawsegcore(t,{x:t.x-r,y:t.y-n})}},pn.dashTypes={solid:[],dashed:[10,10],tightdash:[10,4],dotted:[1,3],dashdot:[10,5,1,5],"dashvalue.solid":[],"dashvalue.dashed":[10,10],"dashvalue.tightdash":[10,4],"dashvalue.dotted":[1,3],"dashvalue.dashdot":[10,5,1,5],0:[],1:[10,10],2:[10,4],3:[1,3],4:[10,5,1,5]},pn.setDash=function(e,t){t=Math.sqrt(t),e=e.slice();for(var r=0;r<e.length;r++)e[r]*=t;St.webkitLineDash=e,St.setLineDash(e),St.mozDash=e},pn.unSetDash=function(){St.webkitLineDash=[],St.setLineDash([]),St.mozDash=[]},ve.prototype={set fillStyle(e){var t=this;ge(e,(function(e,r,n,i){t._fill="#"+ye(e.toString(16),2)+ye(r.toString(16),2)+ye(n.toString(16),2),t._fillOpacity=255===i?null:i}))},set strokeStyle(e){var t=this;ge(e,(function(e,r,n,i){t._stroke="#"+ye(e.toString(16),2)+ye(r.toString(16),2)+ye(n.toString(16),2),t._strokeOpacity=255===i?null:i}))},clearRect:function(){},beginPath:function(){this._path=[]},_pathcmd:function(){this._path.push.apply(this._path,arguments)},closePath:function(){this._pathcmd("Z")},moveTo:function(e,t){this._pathcmd("M",e,t)},lineTo:function(e,t){this._pathcmd("L",e,t)},bezierCurveTo:function(e,t,r,n,i,a){this._pathcmd("C",e,t,r,n,i,a)},quadraticCurveTo:function(e,t,r,n){this._pathcmd("Q",e,t,r,n)},arc:function(e,t,r,n,i,a){var o=r*Math.cos(n)+e,l=r*Math.sin(n)+t,s=r*Math.cos(i)+e,u=r*Math.sin(i)+t;(i=a?n-i:i-n)>=2*Math.PI?this._pathcmd(this._path.length?"L":"M",o,l,"A",r,r,0,0,a?1:0,e-r*Math.cos(n),t-r*Math.sin(n),"A",r,r,0,0,a?1:0,o,l):this._pathcmd(this._path.length?"L":"M",o,l,"A",r,r,0,i>Math.PI?1:0,a?1:0,s,u)},rect:function(e,t,r,n){this._pathcmd("M",e,t,"h",r,"v",n,"h",-r,"z")},_cmd:function(e){1!==this.globalAlpha?(this._body.push('<g opacity="'+this.globalAlpha+'">'),this._body.push(e),this._body.push("</g>")):this._body.push(e)},_attrs:function(e){var t,r="";for(t in e)null!==e[t]&&(r+=" "+t+'="'+e[t]+'"');return r},fill:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),fill:this._fill,"fill-opacity":this._fillOpacity})+"/>")},stroke:function(){this._cmd("<path"+this._attrs({d:this._path.join(" "),stroke:this._stroke,"stroke-opacity":this._strokeOpacity,"stroke-width":this.lineWidth,"stroke-linecap":this.lineCap,"stroke-linejoin":this.lineJoin,"stroke-miterlimit":"miter"===this.lineJoin?this.miterLimit:null})+"/>")},clip:function(){++this._clipIndex,this._body.push('<clipPath id="clip'+this._clipIndex+'"><path d="'+this._path.join(" ")+'"/></clipPath>','<g clip-path="url(#clip'+this._clipIndex+')">'),this._saveStack[this._saveStack.length-1]+="</g>"},save:function(){this._saveStack.push("")},restore:function(){this._body.push(this._saveStack.pop()),0===this._saveStack.length&&this._saveStack.push("")},_transform:function(e){this._body.push('<g transform="'+e+'">'),this._saveStack[this._saveStack.length-1]+="</g>"},translate:function(e,t){this._transform("translate("+e+" "+t+")")},rotate:function(e){this._transform("rotate("+Math.PI/180*e+")")},scale:function(e,t){this._transform("scale("+e+" "+t+")")},transform:function(e,t,r,n,i,a){this._transform("matrix("+[e,t,r,n,i,a].join(" ")+")")},drawImage:function(e,t,r){if(3!==arguments.length)throw Error("SvgWriterContext only supports 3-argument version of drawImage");var n=this._imgcache.indexOf(e);if(-1===n){n=this._imgcache.length;var i=e.cachedDataURL?e.cachedDataURL:me(e);this._defs.push('<image id="img'+n+'" x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+i+'"/>'),this._imgcache.push(e)}this._cmd('<use x="'+t+'" y="'+r+'" xlink:href="#img'+n+'"/>')},toBlob:function(){for(;1<this._saveStack.length||""!==this._saveStack[0];)this.restore();var e='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="'+this.width+'px" height="'+this.height+'px">\n'+this._defs.join("\n")+'\n</defs>\n<g stroke="none" fill="none">\n'+this._body.join("\n")+"\n</g>\n</svg>\n";return new Blob([e],{type:"image/svg+xml"})}},de.prototype={_cmd:function(){this._body.push(Array.prototype.join.call(arguments," "))},_setAlpha:function(e,t,r){var n=Math.round(255*e*this._globalAlpha);return t+=n,this._extGState[t]="<< /"+r+" "+n/255+" >>",this._cmd("/"+t,"gs"),e},set globalAlpha(e){this._globalAlpha=e,this._setAlpha(this._strokeAlpha,"As","CA"),this._setAlpha(this._fillAlpha,"Af","ca")},set fillStyle(e){var t=this;ge(e,(function(e,r,n,i){t._cmd(e/255,r/255,n/255,"rg"),t._setAlpha(t._fillAlpha=i,"Af","ca")}))},set strokeStyle(e){var t=this;ge(e,(function(e,r,n,i){t._cmd(e/255,r/255,n/255,"RG"),t._setAlpha(t._strokeAlpha=i,"As","CA")}))},set lineWidth(e){this._cmd(e,"w")},set lineCap(e){this._cmd({butt:0,round:1,square:2}[e],"J")},set lineJoin(e){this._cmd({miter:0,round:1,bevel:2}[e],"j")},set miterLimit(e){this._cmd(e,"M")},clearRect:function(){},beginPath:function(){this._pathUsed=!1},closePath:function(){this._cmd("h")},moveTo:function(e,t){this._cmd(this._xPos=e,this._yPos=-t,"m")},lineTo:function(e,t){this._cmd(this._xPos=e,this._yPos=-t,"l")},bezierCurveTo:function(e,t,r,n,i,a){this._cmd(e,-t,r,-n,this._xPos=i,this._yPos=-a,"c")},quadraticCurveTo:function(e,t,r,n){this.bezierCurveTo((2*e+this._xPos)/3,(2*t-this._yPos)/3,(r+2*e)/3,(n+2*t)/3,r,n)},_kappa:.5522847498307935,arc:function(e,t,r,n,i,a){if(0!==n||i!==2*Math.PI)throw Error("PdfWriterContext.arc only supports full circles");n=this._kappa*r,this.moveTo(e+r,t),this.bezierCurveTo(e+r,t+n,e+n,t+r,e,t+r),this.bezierCurveTo(e-n,t+r,e-r,t+n,e-r,t),this.bezierCurveTo(e-r,t-n,e-n,t-r,e,t-r),this.bezierCurveTo(e+n,t-r,e+r,t-n,e+r,t)},rect:function(e,t,r,n){this._cmd(e,-t,r,-n,"re")},_usePath:function(e){if(this._pathUsed){var t=this._body[this._pathUsed],r={"S + f":"B","f + S":"B","W n + S":"W S","W n + f":"W f","S + W n":"W S","f + W n":"W f","B + W n":"W B","W S + f":"W B","W f + S":"W B"}[t+" + "+e];if(!r)throw Error("Don't know how to combine '"+t+"' and '"+e+"'");this._body.splice(this._pathUsed,1),e=r}this._pathUsed=this._body.length,this._cmd(e)},fill:function(){this._usePath("f")},stroke:function(){this._usePath("S")},clip:function(){this._usePath("W n")},save:function(){this._cmd("q")},restore:function(){this._cmd("Q")},translate:function(e,t){this.transform(1,0,0,1,e,t)},rotate:function(e){var t=Math.cos(e);e=Math.sin(e),this.transform(t,e,-e,t,0,0)},scale:function(e,t){this.transform(e,0,0,t,0,0)},transform:function(e,t,r,n,i,a){this._cmd(e,-t,-r,n,i,-a,"cm")},_png:function(e){if("data:image/png;base64,"!==e.substr(0,22))return{error:"Not a base64-encoded PNG file"};e=function(e){e=e.replace(/[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/]+/g,"");var t,r,n=new Uint8Array(3*e.length>>2);for(r=t=0;t+3<e.length;t+=4){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t)),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+1)),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+2)),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+3));n[r++]=i<<2|a>>4,n[r++]=a<<4|o>>2,n[r++]=o<<6|l}switch(e.length-t){case 0:break;case 2:i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t)),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+1)),n[r++]=i<<2|a>>4;break;case 3:i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t)),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+1)),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(t+2)),n[r++]=i<<2|a>>4,n[r++]=a<<4|o>>2;break;default:throw Error("Malformed Base64 input: "+(e.length-t)+" chars left: "+e.substr(t))}if(r!==n.length)throw Error("Failed assertion: "+r+" should be "+n.length);return n}(e.substr(22));var t=function(e){function t(t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}if(57>e.length)throw Error("Too short to be a PNG file");if(2303741511!==t(0)||218765834!==t(4))throw Error("PNG signature missing");for(var r=[],n=8;n<e.length;){if(n+12>e.length)throw Error("Incomplete chunk at offset 0x"+n.toString(16));var i=t(n);if(2147483648<=i)throw Error("Chunk too long");var a=n+12+i;if(a>e.length)throw Error("Incomplete chunk at offset 0x"+n.toString(16));var o=e.subarray(n+4,n+8);o=String.fromCharCode.apply(String,o),r.push({len:i,type:o,data:e.subarray(n+8,n+8+i),crc:t(n+8+i)}),n=a}return r}(e);if(console.log("PNG chunks:",t.map((function(e){return e.type}))),"IHDR"!==t[0].type)throw Error("Image does not start with an IHDR");var r=t[0].data;e=(r[0]<<24|r[1]<<16|r[2]<<8|r[3])>>>0;var n=(r[4]<<24|r[5]<<16|r[6]<<8|r[7])>>>0,i=r[8],a=r[9],o=0==(2&a),l=0!=(4&a),s=r[10],u=r[11];if(r=r[12],0!==s)throw Error("Unsupported PNG compression method: "+s);if(0!==u)throw Error("Unsupported PNG filter method: "+u);if(0!==r)return{error:"Interlaced image not supported"};if(0!=(1&a))return{error:"Indexed PNG image not supported"};if(u=null,a=o?1:3,s=t.filter((function(e){return"IDAT"===e.type})).map((function(e){return e.data})),l){for(u=new(l=window.pako).Inflate,t=0;t<s.length;++t)u.push(s[t],t+1===s.length);if(u.err)throw Error(u.err);if(r=i>>>3,(u=u.result).length!==n*(e*(a+1)*r+1))throw Error("Data length mismatch");var c=a*r;s=new Uint8Array(n*(e*c+1));for(var p=new Uint8Array(n*(e*r+1)),f=0,h=0,v=0,d=0;d<n;++d){s[h++]=p[v++]=u[f++];for(var m=0;m<e;++m){for(t=0;t<c;++t)s[h++]=u[f++];for(t=0;t<r;++t)p[v++]=u[f++]}}if(f!==u.length||h!==s.length||v!==p.length)throw Error("Seems we garbled our index computation somehow");p=l.deflate(p),u=this._strm({Type:"/XObject",Subtype:"/Image",Width:e,Height:n,ColorSpace:"/DeviceGray",BitsPerComponent:i,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:1,BitsPerComponent:i,Columns:e})},p).ref,s=[l.deflate(s)]}var g=0;return s.forEach((function(e){g+=e.length})),this._obj([this._dict({Type:"/XObject",Subtype:"/Image",Name:"/img"+this._imgcache.length,Width:e,Height:n,ColorSpace:o?"/DeviceGray":"/DeviceRGB",SMask:u,BitsPerComponent:i,Length:g,Filter:"/FlateDecode",DecodeParms:this._dict({Predictor:15,Colors:a,BitsPerComponent:i,Columns:e})}),"\nstream\n"].concat(s,["\nendstream"]))},drawImage:function(e,t,r){if(3!==arguments.length)throw Error("PdfWriterContext only supports 3-argument version of drawImage");var n=this._imgcache.indexOf(e);if(-1===n){n=this._imgcache.length,this._imgcache.push(e);var i=this._png(e.cachedDataURL||"");if(i.hasOwnProperty("error")&&(i=this._png(me(e))),i.hasOwnProperty("error"))throw Error(i.error);this._xobjects["img"+n]=i.ref}this._cmd("q"),this._setAlpha(1,"Af","ca"),this._cmd(e.width,0,0,e.height,t,-r-e.height,"cm"),this._cmd("/img"+n,"Do"),this._cmd("Q")},_dict:function(e){var t,r="<<";for(t in e)r+=" /"+t+" "+e[t];return r+" >>"},_obj:function(e,t){t||(t=this._nextIndex++),Array.isArray(e)||(e=[this._dict(e)]),e.index=t,e.ref=t+" 0 R",e.offset=this._offset;var r=0;for(e.unshift(t+" 0 obj\n"),e.push("\nendobj\n"),t=0;t<e.length;++t)r+=e[t].length;return this._offset+=r,this._objects.push(e),e},_strm:function(e,t,r){return e.Length=t.length,this._obj([this._dict(e),"\nstream\n",t,"\nendstream"],r)},toBlob:function(){var e="["+[0,-this.height,this.width,0].join(" ")+"]";this._obj({Type:"/Catalog",Pages:"2 0 R"},1),this._obj({Type:"/Pages",Kids:"[3 0 R]",Count:1},2),this._obj({Type:"/Page",Parent:"2 0 R",MediaBox:e,Contents:"4 0 R",Resources:this._dict({ProcSet:"[/PDF /Text /ImageB /ImageC /ImageI]",XObject:this._dict(this._xobjects),ExtGState:this._dict(this._extGState)})},3);var t=this._body.join("\n"),r=new Uint8Array(t.length);for(e=0;e<t.length;++e)r[e]=255&t.charCodeAt(e);t=window.pako.deflate(r),this._strm({Filter:"/FlateDecode"},t,4),t=this._objects;var n=[];for(e=1;e<t.length;++e)n[t[e].index]=t[e];for(r="xref\n0 "+n.length+"\n",e=0;e<n.length;++e)r=n[e]?r+(ye(String(n[e].offset),10)+" 00000 n \n"):r+"0000000000 65535 f \n";return e="trailer\n"+this._dict({Size:n.length,Root:"1 0 R"})+"\nstartxref\n"+this._offset+"\n%%EOF\n",(t=Array.prototype.concat.apply([],t)).push(r,e),new Blob(t,{type:"application/pdf"})}};var fn=null;nr.push(be),ar.exportSVG=function(){Pe(ve)},ar.exportPDF=function(){Ot.loadScript("pako","pako.min.js",(function(){Pe(de)}))},ar.exportPNG=function(){vn(St.canvas.toDataURL())};var hn,vn=function(e){var t=document.createElement("a");document.body.appendChild(t),t.style="display: none",t.href=e,t.download="CindyJSExport",t.click(),setTimeout((function(){document.body.removeChild(t),be()}),100)},dn="Move",mn=[],gn=0,yn=0,bn=0,Pn={Delete:{}};Pn.Delete.actions=[],Pn.Delete.actions[0]={},Pn.Delete.actions[0].event="mousedown",Pn.Delete.actions[0].tooltip="...",Pn.Delete.actions[0].do=function(){return null!==(sr=xe(ur))&&Fe(sr.mover.name),!0},Pn.Move={},Pn.Move.actions=[],Pn.Move.actions[0]={},Pn.Move.actions[0].event="mousedown",Pn.Move.actions[0].tooltip="Move free elements by dragging the mouse",Pn.Move.actions[0].do=function(){for(var e,t=ur,r=null,n=1e6,i=0;i<It.free.length;i++){var a=It.free[i];if(!a.pinned&&!1!==a.visible&&!0!==a.tmp){var o=wn.drawingstate.matrix.sdet;if("P"===a.kind){var l=wr.normalizeZ(a.homog);if(!wr._helper.isAlmostReal(l))continue;var s=l.value[0].value.real-t.x;l=l.value[1].value.real-t.y;var u=Math.sqrt(s*s+l*l);if(a.narrow&&u>("number"==typeof a.narrow?a.narrow:20)/o)continue}else if("C"===a.kind){if(l=wr.normalizeZ(It.csnames[a.args[0]].homog),s=a.radius,!wr._helper.isAlmostReal(l)||!yr._helper.isAlmostReal(s))continue;u=l.value[0].value.real;var c=l.value[1].value.real;l=t.x-u;var p=t.y-c,f=Math.sqrt(l*l+p*p);if(0===f)continue;if(c+=p/f*s.value.real,s=u+l/f*s.value.real-t.x,l=c-t.y,u=Math.sqrt(s*s+l*l),u+=30/o,a.narrow&&u>(("number"==typeof a.narrow?a.narrow:20)+30)/o)continue}else if("L"===a.kind)s=a.homog,l=(u=yr).add(u.mult(s.value[0],u.conjugate(s.value[0])),u.mult(s.value[1],u.conjugate(s.value[1]))),l=wr.scaldiv(u.sqrt(l),s),u=l.value[0].value.real*t.x+l.value[1].value.real*t.y+l.value[2].value.real,s=-l.value[0].value.real*u,l=-l.value[1].value.real*u,0>u&&(u=-u),u+=25/o;else{if("Text"!==a.kind)continue;if(!a.homog||a.dock||!a._bbox)continue;if(l=wn.from(t.x,t.y,1),s=Math.max(0,l[0]-a._bbox.right,a._bbox.left-l[0]),l=Math.max(0,l[1]-a._bbox.bottom,a._bbox.top-l[1]),20<(u=Math.sqrt(s*s+l*l)))continue;if(u/=o,l=wr.normalizeZ(a.homog),!wr._helper.isAlmostReal(l))continue;s=l.value[0].value.real-t.x,l=l.value[1].value.real-t.y}u<n+.2/o&&(n=u,r=a,e={x:s,y:l})}}return console.log("Moving "+(r?r.name:"nothing")),sr=null===r?null:{mover:r,offset:e,prev:{x:t.x,y:t.y}},!0},Pn.Point={},Pn.Point.actions=[],Pn.Point.actions[0]={},Pn.Point.actions[0].event="mousedown",Pn.Point.actions[0].tooltip="Add a single point with the mouse",Pn.Point.actions[0].do=function(){return $e({type:"Free",name:Ce(),labeled:!0,pos:[wt[0],wt[1],1]}),!0},Pn.Mid={},Pn.Mid.actions=[],Pn.Mid.actions[0]={},Pn.Mid.actions[0].event="mousedown",Pn.Mid.actions[0].tooltip="Construct two points and their midpoint by dragging",Pn.Mid.actions[0].do=function(){return Ie(),!0},Pn.Mid.actions[1]={},Pn.Mid.actions[1].event="mousemove",Pn.Mid.actions[1].do=function(){return Ne("Mid"),!0},Pn.Mid.actions[2]={},Pn.Mid.actions[2].event="mouseup",Pn.Mid.actions[2].do=function(){return Ee(),!0},Pn.Circle={},Pn.Circle.actions=[],Pn.Circle.actions[0]={},Pn.Circle.actions[0].event="mousedown",Pn.Circle.actions[0].tooltip="Construct two points and a circle by dragging the mouse",Pn.Circle.actions[0].do=function(){return Ie(),!0},Pn.Circle.actions[1]={},Pn.Circle.actions[1].event="mousemove",Pn.Circle.actions[1].do=function(){return Ne("CircleMP"),!0},Pn.Circle.actions[2]={},Pn.Circle.actions[2].event="mouseup",Pn.Circle.actions[2].do=function(){return Ee(),!0},Pn.Compass={},Pn.Compass.actions=[],Pn.Compass.actions[0]={},Pn.Compass.actions[0].event="mousedown",Pn.Compass.actions[0].tooltip="...",Pn.Compass.actions[0].do=function(){return Ie(),!0},Pn.Compass.actions[1]={},Pn.Compass.actions[1].event="mousedown",Pn.Compass.actions[1].tooltip="...",Pn.Compass.actions[1].do=function(){return Ie(),!0},Pn.Compass.actions[2]={},Pn.Compass.actions[2].event="mousedown",Pn.Compass.actions[2].tooltip="...",Pn.Compass.actions[2].do=function(){return Ie(),$e({type:"Compass",name:Ce(),labeled:!0,args:[mn[0].name,mn[1].name,mn[2].name]}),!0},Pn.Line={},Pn.Line.actions=[],Pn.Line.actions[0]={},Pn.Line.actions[0].event="mousedown",Pn.Line.actions[0].tooltip="Construct two points and their connecting line by dragging the mouse",Pn.Line.actions[0].do=function(){return Ie(),!0},Pn.Line.actions[1]={},Pn.Line.actions[1].event="mousemove",Pn.Line.actions[1].do=function(){return Ne("Join"),!0},Pn.Line.actions[2]={},Pn.Line.actions[2].event="mouseup",Pn.Line.actions[2].do=function(){return Ee(),!0},Pn.Segment={},Pn.Segment.actions=[],Pn.Segment.actions[0]={},Pn.Segment.actions[0].event="mousedown",Pn.Segment.actions[0].tooltip="Draw a segment by dragging the mouse",Pn.Segment.actions[0].do=function(){return Ie(),!0},Pn.Segment.actions[1]={},Pn.Segment.actions[1].event="mousemove",Pn.Segment.actions[1].do=function(){return Ne("Segment"),!0},Pn.Segment.actions[2]={},Pn.Segment.actions[2].event="mouseup",Pn.Segment.actions[2].do=function(){return Ee(),!0},Pn.Parallel={},Pn.Parallel.actions=[],Pn.Parallel.actions[0]={},Pn.Parallel.actions[0].event="mousedown",Pn.Parallel.actions[0].tooltip="Construct a parallel line by dragging a line",Pn.Parallel.actions[0].do=function(){return Le()},Pn.Parallel.actions[1]={},Pn.Parallel.actions[1].event="mousemove",Pn.Parallel.actions[1].do=function(){var e={type:"Free",name:Ce(),labeled:!0,pos:[wt[0],wt[1],1],tmp:!0};return e=$e(e),hn=$e({type:"Para",name:Ce(),labeled:!0,args:[mn[0].name,e.name]}),Te(e),!0},Pn.Parallel.actions[2]={},Pn.Parallel.actions[2].event="mouseup",Pn.Parallel.actions[2].do=function(){return Ee(),!0},Pn.Orthogonal={},Pn.Orthogonal.actions=[],Pn.Orthogonal.actions[0]={},Pn.Orthogonal.actions[0].event="mousedown",Pn.Orthogonal.actions[0].tooltip="Construct a orthogonal line by dragging a line",Pn.Orthogonal.actions[0].do=function(){if(Le()){var e={type:"Free",name:Ce(),labeled:!0,pos:[wt[0],wt[1],1],tmp:!0};return e=$e(e),hn=$e({type:"Perp",name:Ce(),labeled:!0,args:[mn[0].name,e.name]}),Te(e),!0}return!1},Pn.Orthogonal.actions[1]={},Pn.Orthogonal.actions[1].event="mouseup",Pn.Orthogonal.actions[1].do=function(){return Ee(),!0},Pn.Intersection={},Pn.Intersection.actions=[],Pn.Intersection.actions[0]={},Pn.Intersection.actions[0].event="mousedown",Pn.Intersection.actions[0].tooltip="Select two elements to define their intersection",Pn.Intersection.actions[0].do=function(){return Oe()},Pn.Intersection.actions[1]={},Pn.Intersection.actions[1].event="mousedown",Pn.Intersection.actions[1].do=function(){return!!Oe()&&(hn=$e({type:"Meet",name:Ce(),labeled:!0,args:[mn[0].name,mn[1].name]}),!0)};var xn=function(e){e?(this._e=[],this._e[0]=e[0][0],this._e[1]=e[1][0],this._e[2]=e[2][0],this._e[3]=e[0][1],this._e[4]=e[1][1],this._e[5]=e[2][1],this._e[6]=e[0][2],this._e[7]=e[1][2],this._e[8]=e[2][2]):this._e=[1,0,0,0,1,0,0,0,1]};xn.prototype.clone=function(){var e=[].concat($jscomp.arrayFromIterable(this._e)),t=new xn;return t.set(e),t},xn.prototype.get=function(e){return this._e[e]},xn.prototype.getRow=function(e){var t=this._e;return[t[e],t[3+e],t[6+e]]},xn.prototype.set=function(e,t){1===arguments.length&&(this._e=e),2===arguments.length&&(this._e[e]=t)},xn.prototype.exchange=function(e,t){var r=$jscomp.makeIterator([this._e[t],this._e[e]]);this._e[e]=r.next().value,this._e[t]=r.next().value},xn.prototype.inverse=function(){var e=this._e,t=-e[2]*e[4]*e[6]+e[1]*e[5]*e[6]+e[2]*e[3]*e[7]-e[0]*e[5]*e[7]-e[1]*e[3]*e[8]+e[0]*e[4]*e[8];return e=[-e[4]*e[7]+e[4]*e[8],e[5]*e[6]-e[3]*e[8],-e[4]*e[6]+e[3]*e[7],e[2]*e[7]-e[1]*e[8],-e[2]*e[6]+e[0]*e[8],e[1]*e[6]-e[0]*e[7],-e[2]*e[4]+e[1]*e[5],e[2]*e[3]-e[0]*e[5],-e[1]*e[3]+e[0]*e[4]],1e-10>Math.abs(t)&&console.log("PSLQ: inverting singular matrix!"),this._e=e.map((function(e){return e/t})),this},xn.prototype.swRow=function(e,t){for(var r=0;9>r;)this.exchange(r+e,r+t),r+=3},xn.prototype.swCol=function(e,t){for(var r=0;3>r;++r)this.exchange(3*e+r,3*t+r)},xn.mult=function(e,t,r){e=[e.get(0)*t.get(0)+e.get(3)*t.get(1)+e.get(6)*t.get(2),e.get(1)*t.get(0)+e.get(4)*t.get(1)+e.get(7)*t.get(2),e.get(2)*t.get(0)+e.get(5)*t.get(1)+e.get(8)*t.get(2),e.get(0)*t.get(3)+e.get(3)*t.get(4)+e.get(6)*t.get(5),e.get(1)*t.get(3)+e.get(4)*t.get(4)+e.get(7)*t.get(5),e.get(2)*t.get(3)+e.get(5)*t.get(4)+e.get(8)*t.get(5),e.get(0)*t.get(6)+e.get(3)*t.get(7)+e.get(6)*t.get(8),e.get(1)*t.get(6)+e.get(4)*t.get(7)+e.get(7)*t.get(8),e.get(2)*t.get(6)+e.get(5)*t.get(7)+e.get(8)*t.get(8)],r.set(e)},xn.prototype.getString=function(){var e=this._e;return"/"+e[0]+"\t "+e[3]+"\t "+e[6]+"\\\n|"+e[1]+"\t "+e[4]+"\t "+e[7]+"|\n\\"+e[2]+"\t "+e[5]+"\t "+e[8]+"/\n"},xn.prototype.transpose=function(){return this.exchange(1,3),this.exchange(2,6),this.exchange(5,7),this},xn.VMmult=function(e,t,r){r[0]=t.get(0)*e[0]+t.get(1)*e[1]+t.get(2)*e[2],r[1]=t.get(3)*e[0]+t.get(4)*e[1]+t.get(5)*e[2],r[2]=t.get(6)*e[0]+t.get(7)*e[1]+t.get(8)*e[2]};var Cn=function(){};Cn.dot=function(e,t){for(var r=0,n=0;n<e.length;n++)r+=e[n]*t[n];return r},Cn.scale=function(e,t){for(var r=0;r<e.length;++r)e[r]*=t},Cn.maxIndex=function(e){for(var t=0,r=1;r<e.length;++r)e[r]>e[t]&&(t=r);return t},Cn.hermiteReduce=function(e){for(var t,r=[[1,0,0],[0,1,0],[0,0,1]],n=e.length,i=e.map((function(e){return[].concat($jscomp.arrayFromIterable(e))})),a=1;a<n;a++)for(var o=a-1;0<=o;o--){t=Math.round(e[a][o]/e[o][o]);for(var l=0;l<=o;l++)i[a][l]-=t*i[o][l];for(l=0;l<n;l++)r[a][l]-=t*r[o][l]}for(n=0;3>n;n++)e[n]=i[n];return new xn(r)},Cn.doPSLQ=function(e,t){for(var r=e.length,n=[],i=[],a=0;a<r;++a){n[a]=e[a]/Math.sqrt(Cn.dot(e,e));for(var o=0,l=a;l<r;++l)o+=Math.pow(e[l],2);i[a]=Math.sqrt(o)}for(Cn.scale(i,1/i[0]),a=new xn,e=new xn,o=[],l=0;l<r;l++)o[l]=[];for(l=0;l<r;++l)for(var s=0;s<r-1;++s)o[l][s]=l>s?-n[l]*n[s]/i[s]/i[s+1]:l===s?i[l+1]/i[l]:0;for(s=(l=Cn.hermiteReduce(o)).clone().inverse().transpose(),xn.VMmult(n,s,n),xn.mult(l,a,a),xn.mult(e,s,e),i=0;i<Cn.MAX_ITER;++i){s=[o[0][0],o[1][1]],l=0,Math.pow(this.GAMMA,2)*Math.abs(s[1])>Math.pow(this.GAMMA,1)*Math.abs(s[0])&&(l=1);var u=s=0,c=0;l<r-2&&(s=o[l+1][l],u=o[l+1][l+1],c=Math.sqrt(Math.pow(s,2)+Math.pow(u,2)));var p=n[l];n[l]=n[l+1],n[l+1]=p,p=[].concat($jscomp.arrayFromIterable(o[l])),o[l]=o[l+1],o[l+1]=p,a.swRow(l,l+1),e.swCol(l,l+1),p=Array(2);for(var f=0;3>f;f++)p[f]=[];if(l<r-2){for(f=0;f<r-1;++f)for(var h=0;h<r-1;++h)p[f][h]=f===l&&h===l?s/c:f===l&&h===l+1?-u/c:f===l+1&&h===l?u/c:f===l+1&&h===l+1?s/c:f===h&&h!==l||f===h&&h!==l+1?1:0;o=[[o[0][0]*p[0][0]+o[0][1]*p[1][0],o[0][0]*p[0][1]+o[0][1]*p[1][1]],[o[1][0]*p[0][0]+o[1][1]*p[1][0],o[1][0]*p[0][1]+o[1][1]*p[1][1]],[o[2][0]*p[0][0]+o[2][1]*p[1][0],o[2][0]*p[0][1]+o[2][1]*p[1][1]]]}for(s=(l=Cn.hermiteReduce(o)).clone().inverse().transpose(),xn.VMmult(n,s,n),xn.mult(l,a,a),xn.mult(e,s,e),l=[n[0],n[1],n[2],o[0][0],o[1][1]],s=0;s<l.length;++s)if(Math.abs(l[s])<=Math.pow(10,5-t)){for(e.transpose(),t=0;t<n.length;++t)n[t]=-Math.abs(n[t]);return e.getRow(Cn.maxIndex(n))}}},$jscomp.global.Object.defineProperties(Cn,{MAX_ITER:{configurable:!0,enumerable:!0,get:function(){return 20}},GAMMA:{configurable:!0,enumerable:!0,get:function(){return 2/Math.sqrt(3)}}});var _n={},wn={drawingstate:{}};wn.drawingstate.linecolor="rgb(0,0,255)",wn.drawingstate.linecolorraw=[0,0,1],wn.drawingstate.pointcolor="rgb(0,255,0)",wn.drawingstate.pointcolorraw=[0,1,0],wn.drawingstate.textcolor="rgb(0,0,0)",wn.drawingstate.textcolorraw=[0,0,0],wn.drawingstate.alpha=1,wn.drawingstate.pointsize=4,wn.drawingstate.linesize=1,wn.drawingstate.textsize=null,wn.drawingstate.matrix={},wn.drawingstate.matrix.a=25,wn.drawingstate.matrix.b=0,wn.drawingstate.matrix.c=0,wn.drawingstate.matrix.d=25,wn.drawingstate.matrix.tx=250.5,wn.drawingstate.matrix.ty=250.5,wn.drawingstate.matrix.det=wn.drawingstate.matrix.a*wn.drawingstate.matrix.d-wn.drawingstate.matrix.b*wn.drawingstate.matrix.c,wn.drawingstate.matrix.sdet=Math.sqrt(wn.drawingstate.matrix.det),wn.drawingstate.initialmatrix={},wn.drawingstate.initialmatrix.a=wn.drawingstate.matrix.a,wn.drawingstate.initialmatrix.b=wn.drawingstate.matrix.b,wn.drawingstate.initialmatrix.c=wn.drawingstate.matrix.c,wn.drawingstate.initialmatrix.d=wn.drawingstate.matrix.d,wn.drawingstate.initialmatrix.tx=wn.drawingstate.matrix.tx,wn.drawingstate.initialmatrix.ty=wn.drawingstate.matrix.ty,wn.drawingstate.initialmatrix.det=wn.drawingstate.matrix.det,wn.drawingstate.initialmatrix.sdet=wn.drawingstate.matrix.sdet,wn.clone=function(e){if(null===e||"object"!=typeof e)return e;var t,r=e.constructor();for(t in e)r[t]=wn.clone(e[t]);return r},_n.backup=wn.clone(wn.drawingstate),_n.stack=[],wn.clone(wn.drawingstate),wn.reset=function(){wn.drawingstate.matrix.a=wn.drawingstate.initialmatrix.a,wn.drawingstate.matrix.b=wn.drawingstate.initialmatrix.b,wn.drawingstate.matrix.c=wn.drawingstate.initialmatrix.c,wn.drawingstate.matrix.d=wn.drawingstate.initialmatrix.d,wn.drawingstate.matrix.tx=wn.drawingstate.initialmatrix.tx,wn.drawingstate.matrix.ty=wn.drawingstate.initialmatrix.ty,wn.drawingstate.matrix.det=wn.drawingstate.initialmatrix.det,wn.drawingstate.matrix.sdet=wn.drawingstate.initialmatrix.sdet},wn.from=function(e,t,r){return t/=r,[((e/=r)*(r=wn.drawingstate.matrix).a-t*r.b+r.tx)/Gt,(e*r.c-t*r.d-r.ty)/Gt]},wn.to=function(e,t){var r=wn.drawingstate.matrix;return e=e*Gt-r.tx,t=t*Gt+r.ty,[(e*r.d-t*r.b)/r.det,-(-e*r.c+t*r.a)/r.det,1]},wn.toMat=function(){var e=wn.drawingstate.matrix;return wr.realMatrix([[e.d,-e.b,-e.tx*e.d-e.ty*e.b],[e.c,-e.a,-e.tx*e.c-e.ty*e.a],[0,0,e.det]])},wn.dumpTrafo=function(){function e(e){return Math.round(1e3*e)/1e3}var t=wn.drawingstate.matrix;console.log("a:"+e(t.a)+" b:"+e(t.b)+" c:"+e(t.c)+" d:"+e(t.d)+" tx:"+e(t.ty)+" ty:"+e(t.tx))},wn.setMat=function(e,t,r,n,i,a){var o=wn.drawingstate.matrix;o.a=e,o.b=t,o.c=r,o.d=n,o.tx=i,o.ty=a,o.det=e*n-t*r,o.sdet=Math.sqrt(o.det)},wn.scaleAndOrigin=function(e,t,r){wn.setMat(e,0,0,e,t,r)},wn.visibleRect=function(e,t,r,n){var i=r-e,a=t-n;i=Mt*a<Tt*i?Mt/i:Tt/a,wn.setMat(i,0,0,i,(Mt-i*(e+r))/2,(Tt-i*(t+n))/2)},wn.applyMat=function(e,t,r,n,i,a){var o=wn.drawingstate.matrix;wn.setMat(o.a*e+o.c*t,o.b*e+o.d*t,o.a*r+o.c*n,o.b*r+o.d*n,o.a*i+o.c*a+o.tx,o.b*i+o.d*a+o.ty)},wn.translate=function(e,t){wn.applyMat(1,0,0,1,e,t)},wn.rotate=function(e){var t=Math.cos(e);e=Math.sin(e),wn.applyMat(t,e,-e,t,0,0)},wn.scale=function(e){wn.applyMat(e,0,0,e,0,0)},wn.gsave=function(){_n.stack.push(wn.clone(wn.drawingstate))},wn.grestore=function(){0!==_n.stack.length&&(wn.drawingstate=_n.stack.pop())},wn.greset=function(){wn.drawingstate=wn.clone(_n.backup),wn.drawingstate.matrix.ty-=Tt,wn.drawingstate.initialmatrix.ty-=Tt,_n.stack=[]},wn.createnewbackup=function(){wn.drawingstate.initialmatrix.a=wn.drawingstate.matrix.a,wn.drawingstate.initialmatrix.b=wn.drawingstate.matrix.b,wn.drawingstate.initialmatrix.c=wn.drawingstate.matrix.c,wn.drawingstate.initialmatrix.d=wn.drawingstate.matrix.d,wn.drawingstate.initialmatrix.tx=wn.drawingstate.matrix.tx,wn.drawingstate.initialmatrix.ty=wn.drawingstate.matrix.ty,wn.drawingstate.initialmatrix.det=wn.drawingstate.matrix.det,wn.drawingstate.initialmatrix.sdet=wn.drawingstate.matrix.sdet,_n.backup=wn.clone(wn.drawingstate)},wn.makecolor=function(e,t,r){return e=Math.floor(255*e),t=Math.floor(255*t),r=Math.floor(255*r),1===wn.drawingstate.alpha?"rgb("+e+","+t+","+r+")":"rgba("+e+","+t+","+r+","+wn.drawingstate.alpha+")"},wn.setcolor=function(e){var t=e.value[0].value.real,r=e.value[1].value.real;e=e.value[2].value.real,wn.drawingstate.linecolor=wn.drawingstate.pointcolor=wn.makecolor(t,r,e),wn.drawingstate.linecolorraw=wn.drawingstate.pointcolorraw=[t,r,e]},wn.setlinecolor=function(e){var t=e.value[0].value.real,r=e.value[1].value.real;e=e.value[2].value.real,wn.drawingstate.linecolor=wn.makecolor(t,r,e),wn.drawingstate.linecolorraw=[t,r,e]},wn.settextcolor=function(e){var t=e.value[0].value.real,r=e.value[1].value.real;e=e.value[2].value.real,wn.drawingstate.textcolor=wn.makecolor(t,r,e),wn.drawingstate.textcolorraw=[t,r,e]},wn.setpointcolor=function(e){var t=e.value[0].value.real,r=e.value[1].value.real;e=e.value[2].value.real,wn.drawingstate.pointcolor=wn.makecolor(t,r,e),wn.drawingstate.pointcolorraw=[t,r,e]},wn.setalpha=function(e){wn.drawingstate.alpha=e.value.real,wn.drawingstate.linecolor=wn.makecolor(wn.drawingstate.linecolorraw[0],wn.drawingstate.linecolorraw[1],wn.drawingstate.linecolorraw[2]),wn.drawingstate.pointcolor=wn.makecolor(wn.drawingstate.pointcolorraw[0],wn.drawingstate.pointcolorraw[1],wn.drawingstate.pointcolorraw[2]),wn.drawingstate.textcolor=wn.makecolor(wn.drawingstate.textcolorraw[0],wn.drawingstate.textcolorraw[1],wn.drawingstate.textcolorraw[2])},wn.setpointsize=function(e){wn.drawingstate.pointsize=e.value.real},wn.setlinesize=function(e){wn.drawingstate.linesize=e.value.real},wn.settextsize=function(e){wn.drawingstate.textsize=e.value.real};var Sn={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:1,alpha:1,overhangLine:1,overhangSeg:1,dimDependent:.7,fontFamily:"sans-serif",textColor:[0,0,0],textsize:20,noborder:!1,lineHeight:1.45};e.defaultAppearance&&function(e){for(var t in e)null!==e[t]&&(Sn[t]=e[t])}(e.defaultAppearance);var Mn={},Tn={UL:0,UR:1,LR:2,LL:3},In=["in","out","good","backup","prover"],Ln=new Float64Array(0),On={};In.forEach((function(e){On[e]=Ln}));var En,Nn,An,kn,zn,jn=Ln,Rn=Ln,Dn=Ln,$n=!1,Bn={toString:function(){return"RefineException"}},Fn=null,Xn=null;e.enableTraceLog&&(Xn={logLength:1/0,fullLog:[],currentMouseAndScripts:null,currentMover:null,currentStep:null,currentElement:null,currentParam:null,labelTracing2:Tr.wrap("tracing2"),labelTracing4:Tr.wrap("tracing4"),labelTracingSesq:Tr.wrap("tracingSesq"),postMouseHooks:[]},"number"==typeof e.enableTraceLog&&(Xn.logLength=e.enableTraceLog),ar.getTraceLog=function(){return wr.turnIntoCSList(Xn.fullLog.slice())},ar.formatTraceLog=function(e){var t=JSON.stringify(Xn.fullLog);return e=new Blob([t],{type:e?"application/octet-stream":"application/json"}),window.URL.createObjectURL(e)},ar.addTraceHook=Xn.postMouseHooks.push.bind(Xn.postMouseHooks)),it.stateSize=12,ot.stateSize=24,st.stateSize=24;var Yn=[];ut._helper={},ut._helper.duplicatePPLL=function(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return{P:"point",L:"line"}[e.kind]+" "+e.name+" is duplicate of "+t.name},apply:ft(e,t),holds:function(){return wr.projectiveDistMinScal(e.homog,t.homog)<yr.epsbig}}},ut._helper.duplicatePsLs=function(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return{Ps:"point set",Ls:"line set"}[e.kind]+" "+e.name+" is duplicate of "+t.name},apply:ft(e,t),holds:function(){return ut._helper.isSetEq(e.results.value,t.results.value,wr.projectiveDistMinScal)}}},ut._helper.duplicateCC=function(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return"Conic "+e.name+" is duplicate of "+t.name},apply:ft(e,t),holds:function(){return wr.conicDist(e.matrix,t.matrix)<yr.epsbig}}},ut._helper.duplicateCs=function(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return"Conic set"+e.name+" is duplicate of "+t.name},apply:ft(e,t),holds:function(){return ut._helper.isSetEq(e.results,t.results,wr.conicDist)}}},ut._helper.duplicateSS=function(e,t){return{getInvolved:function(){return[e,t]},toString:function(){return"Segment "+e.name+" is duplicate of "+t.name},apply:ft(e,t),holds:function(){var r=e.startpos,n=e.endpos,i=t.startpos,a=t.endpos,o=wr.projectiveDistMinScal(r,i);return o+=wr.projectiveDistMinScal(n,a),n=wr.projectiveDistMinScal(n,i),n+=wr.projectiveDistMinScal(r,a),Math.min(o,n)<yr.epsbig}}},ut.P=function(e){It.points.forEach((function(t){e.name!==t.name&&((t=ut._helper.duplicatePPLL(e,t)).holds()&&Yn.push(t))}))},ut.Ps=function(e){It.sets.points.forEach((function(t){e.name!==t.name&&((t=ut._helper.duplicatePsLs(e,t)).holds()&&Yn.push(t))}))},ut.Ls=function(e){It.sets.lines.forEach((function(t){e.name!==t.name&&((t=ut._helper.duplicatePsLs(e,t)).holds()&&Yn.push(t))}))},ut.Cs=function(e){It.sets.conics.forEach((function(t){e.name!==t.name&&((t=ut._helper.duplicateCs(e,t)).holds()&&Yn.push(t))}))},ut.L=function(e){It.lines.forEach((function(t){e.name!==t.name&&e.kind===t.kind&&((t=ut._helper.duplicatePPLL(e,t)).holds()&&Yn.push(t))}))},ut.S=function(e){It.lines.forEach((function(t){e.name!==t.name&&"S"===t.kind&&((t=ut._helper.duplicateSS(e,t)).holds()&&Yn.push(t))}))},ut.C=function(e){It.conics.forEach((function(t){e.name!==t.name&&((t=ut._helper.duplicateCC(e,t)).holds()&&Yn.push(t))}))},ut._helper.isSetEq=function(e,t,r){if(e=e.slice(),t=t.slice(),e.length!==t.length)return!1;if(0===e.length&&0===t.length)return!0;var n=e.shift(),i=t.reduce((function(e,t,i,a){return r(t,n)<r(a[e],n)?i:e}),0);return r(t[i],n)<yr.epsbig&&(t.splice(i,1),ut._helper.isSetEq(e,t,r))},ct.P=function(e){It.lines.forEach((function(t){(t=ht(e,t)).holds()&&Yn.push(t)})),It.conics.forEach((function(t){(t=vt(e,t)).holds()&&Yn.push(t)}))},ct.L=function(e){It.points.forEach((function(t){(t=ht(t,e)).holds()&&Yn.push(t)}))},ct.S=ct.L,ct.C=function(e){It.points.forEach((function(t){(t=vt(t,e)).holds()&&Yn.push(t)}))};var qn={_helper:{},RandomLine:{}};qn.RandomLine.kind="L",qn.RandomLine.signature=[],qn.RandomLine.updatePosition=function(e){e.homog=wr.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]),e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Line")},qn._helper.getRandMove=function(e){e=e.homog;var t=wr.getRandComplexVec3(-.05,.05);return{type:"homog",value:wr.add(e,t)}},qn._helper.getRandPointMove=function(e){var t=(e=wr.normalizeMax(e.homog)).value[2],r=yr.abs(t).value.real,n=yr.real(0);return r<yr.eps&&(n=yr.getRandComplex(-.05,.05),t=yr.real(1)),r=wr.turnIntoCSList([yr.getRandComplex(-.1,.1),yr.getRandComplex(-.1,.1),n]),t=wr.scalmult(t,r),{type:"homog",value:t=wr.add(e,t)}},qn.FreeLine={},qn.FreeLine.kind="L",qn.FreeLine.signature=[],qn.FreeLine.isMovable=!0,qn.FreeLine.initialize=function(e){nt(e=qn._helper.initializeLine(e))},qn.FreeLine.getParamForInput=function(e,t,r){return"mouse"===r?(e=wr.cross(t,wr.ez),e=wr.cross(e,t)):e="homog"===r?t:wr.turnIntoCSList([yr.zero,yr.zero,yr.zero]),wr.normalizeMax(e)},qn.FreeLine.getParamFromState=function(e){return tt(3)},qn.FreeLine.putParamToState=function(e,t){nt(t)},qn.FreeLine.updatePosition=function(e){var t=tt(3);nt(t),e.homog=Tr.withUsage(t,"Line")},qn.FreeLine.getRandomMove=qn._helper.getRandMove,qn.FreeLine.stateSize=6,qn.RandomPoint={},qn.RandomPoint.kind="P",qn.RandomPoint.signature=[],qn.RandomPoint.updatePosition=function(e){e.homog=wr.realVector([100*Math.random(),100*Math.random(),100*Math.random()]),e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Point")},qn.Join={},qn.Join.kind="L",qn.Join.signature=["P","P"],qn.Join.updatePosition=function(e){e.homog=wr.cross(It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog),e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Line")},qn.Segment={},qn.Segment.kind="S",qn.Segment.signature=["P","P"],qn.Segment.updatePosition=function(e){var t=It.csnames[e.args[0]],r=It.csnames[e.args[1]];qn.Segment.setSegmentPos(e,wr.cross(t.homog,r.homog),wr.scalmult(r.homog.value[2],t.homog),wr.scalmult(t.homog.value[2],r.homog))},qn.Segment.setSegmentPos=function(e,t,r,n){t=wr.normalizeMax(t),e.homog=Tr.withUsage(t,"Line"),t=wr.turnIntoCSList([r,n]),t=wr.normalizeMax(t),e.startpos=t.value[0],e.endpos=t.value[1]},qn.Meet={},qn.Meet.kind="P",qn.Meet.signature=["L","L"],qn.Meet.updatePosition=function(e){e.homog=wr.cross(It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog),e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Point")},qn.Meet.visiblecheck=function(e){var t=!0,r=It.csnames[e.args[0]],n=It.csnames[e.args[1]];"S"===r.kind&&(t=Xe(e,r)),t&&"S"===n.kind&&(t=Xe(e,n)),e.isshowing=t},qn._helper.midpoint=function(e,t){return wr.normalizeMax(wr.add(wr.scalmult(t.value[2],e),wr.scalmult(e.value[2],t)))},qn.Mid={},qn.Mid.kind="P",qn.Mid.signature=["P","P"],qn.Mid.updatePosition=function(e){var t=qn._helper.midpoint(It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog);e.homog=Tr.withUsage(t,"Point")},qn.Perp={},qn.Perp.kind="L",qn.Perp.signature=["L","P"],qn.Perp.updatePosition=function(e){var t=It.csnames[e.args[0]].homog,r=It.csnames[e.args[1]].homog;t=wr.turnIntoCSList([t.value[0],t.value[1],yr.zero]),e.homog=wr.cross(t,r),e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Line")},qn.Para={},qn.Para.kind="L",qn.Para.signature=["L","P"],qn.Para.updatePosition=function(e){var t=It.csnames[e.args[1]].homog;e.homog=wr.cross(wr.cross(wr.linfty,It.csnames[e.args[0]].homog),t),e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Line")},qn.Horizontal={},qn.Horizontal.kind="L",qn.Horizontal.signature=["P"],qn.Horizontal.updatePosition=function(e){e.homog=wr.cross(wr.ex,It.csnames[e.args[0]].homog),e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Line")},qn.HorizontalLine={},qn.HorizontalLine.kind="L",qn.HorizontalLine.signature=[],qn.HorizontalLine.isMovable=!0,qn.HorizontalLine.initialize=function(e){e=qn._helper.initializeLine(e),e=wr.turnIntoCSList([yr.zero,e.value[1],e.value[2]]),nt(e=wr.normalizeMax(e))},qn.HorizontalLine.getParamForInput=function(e,t,r){return"mouse"===r?t=wr.cross(t,wr.ex):"homog"===r?0===t.value[0].real&&0===t.value[0].imag||(t=wr.turnIntoCSList([yr.zero,t.value[1],t.value[2]])):t=wr.turnIntoCSList([yr.zero,yr.zero,yr.zero]),wr.normalizeMax(t)},qn.HorizontalLine.getParamFromState=function(e){return tt(3)},qn.HorizontalLine.putParamToState=function(e,t){nt(t)},qn.HorizontalLine.updatePosition=function(e){var t=tt(3);nt(t),e.homog=Tr.withUsage(t,"Line")},qn.HorizontalLine.getRandomMove=qn._helper.getRandMove,qn.HorizontalLine.stateSize=6,qn.Vertical={},qn.Vertical.kind="L",qn.Vertical.signature=["P"],qn.Vertical.updatePosition=function(e){e.homog=wr.cross(wr.ey,It.csnames[e.args[0]].homog),e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Line")},qn.VerticalLine={},qn.VerticalLine.kind="L",qn.VerticalLine.signature=[],qn.VerticalLine.isMovable=!0,qn.VerticalLine.initialize=function(e){e=qn._helper.initializeLine(e),e=wr.turnIntoCSList([e.value[0],yr.zero,e.value[2]]),nt(e=wr.normalizeMax(e))},qn.VerticalLine.getParamForInput=function(e,t,r){return"mouse"===r?t=wr.cross(t,wr.ey):"homog"===r?0===t.value[1].real&&0===t.value[1].imag||(t=wr.turnIntoCSList([t.value[0],yr.zero,t.value[2]])):t=wr.turnIntoCSList([yr.zero,yr.zero,yr.zero]),wr.normalizeMax(t)},qn.VerticalLine.getParamFromState=function(e){return tt(3)},qn.VerticalLine.putParamToState=function(e,t){nt(t)},qn.VerticalLine.updatePosition=function(e){var t=tt(3);nt(t),e.homog=Tr.withUsage(t,"Line")},qn.VerticalLine.getRandomMove=qn._helper.getRandMove,qn.VerticalLine.stateSize=6,qn.LineByFixedAngle={},qn.LineByFixedAngle.kind="L",qn.LineByFixedAngle.signature=["L","P"],qn.LineByFixedAngle.initialize=function(e){var t=yr._helper.input(e.angle),r=yr.cos(t);t=yr.sin(t),e.rot=wr.turnIntoCSList([wr.turnIntoCSList([t,r,yr.zero]),wr.turnIntoCSList([yr.neg(r),t,yr.zero]),wr.turnIntoCSList([yr.zero,yr.zero,yr.zero])])},qn.LineByFixedAngle.updatePosition=function(e){var t=It.csnames[e.args[1]],r=wr.productMV(e.rot,It.csnames[e.args[0]].homog);e.homog=wr.cross(t.homog,r),e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Line")},qn.Through={},qn.Through.kind="L",qn.Through.signature=["P"],qn.Through.isMovable=!0,qn.Through.initialize=function(e){nt(e=e.dir?Tr.wrap(e.dir):wr.realVector([e.pos[1],-e.pos[0],0]))},qn.Through.getParamForInput=function(e,t,r){return e="dir"===r||"mouse"===r?wr.cross(It.csnames[e.args[0]].homog,t):"homog"===r?t:wr.turnIntoCSList([yr.zero,yr.zero,yr.zero]),e=wr.cross(wr.linfty,e),wr.normalizeMax(e)},qn.Through.getParamFromState=function(e){return tt(3)},qn.Through.putParamToState=function(e,t){nt(t)},qn.Through.updatePosition=function(e){var t=tt(3);nt(t),t=wr.cross(It.csnames[e.args[0]].homog,t),t=wr.normalizeMax(t),e.homog=Tr.withUsage(t,"Line")},qn.Through.getRandomMove=qn._helper.getRandMove,qn.Through.stateSize=6,qn.Through.set_angle=function(e,t){if("number"===t.ctype){var r=yr.cos(t);t=yr.sin(t),Je(e,r=wr.turnIntoCSList([r,t,yr.real(0)]),"dir")}},qn.Through.set_slope=function(e,t){"number"===t.ctype&&Je(e,t=wr.turnIntoCSList([yr.real(1),t,yr.real(0)]),"dir")},qn.Free={},qn.Free.kind="P",qn.Free.signature=[],qn.Free.isMovable=!0,qn.Free.initialize=function(e){nt(e=qn._helper.initializePoint(e))},qn.Free.getParamForInput=function(e,t,r){if("mouse"===r&&Yt&&0!==Ft){e=(t=wr.normalizeZ(t)).value[0].value.real,r=t.value[1].value.real;var n=Math.round(e/Ft)*Ft,i=Math.round(r/Ft)*Ft;Math.abs(n-e)<qt&&Math.abs(i-r)<qt&&(t=wr.realVector([n,i,1]))}return wr.normalizeMax(t)},qn.Free.getParamFromState=function(e){return tt(3)},qn.Free.putParamToState=function(e,t){nt(t)},qn.Free.updatePosition=function(e){var t=tt(3);nt(t),e.homog=Tr.withUsage(t,"Point")},qn.Free.getRandomMove=qn._helper.getRandPointMove,qn.Free.stateSize=6,qn._helper.projectPointToLine=function(e,t){var r=wr.turnIntoCSList([t.value[0],t.value[1],yr.zero]);return e=wr.cross(r,e),wr.normalizeMax(wr.cross(e,t))},qn.PointOnLine={},qn.PointOnLine.kind="P",qn.PointOnLine.signature=["L"],qn.PointOnLine.isMovable=!0,qn.PointOnLine.initialize=function(e){var t=qn._helper.initializePoint(e);e=It.csnames[e.args[0]].homog,t=qn._helper.projectPointToLine(t,e),t=wr.normalizeMax(t);var r=wr.cross(wr.linfty,t);wr.normalizeMax(r),nt(t),nt(e),An=!1},qn.PointOnLine.updatePosition=function(e,t){var r=It.csnames[e.args[0]].homog,n=tt(3);if(tt(3),!t){En=e.stateIdx;var i=jn;jn=Dn,t=tt(3);var a=tt(3);jn=i,i=wr.cross(a,r),wr._helper.isAlmostZero(i)&&(i=wr.cross(wr.linfty,r)),t=qn._helper.CircleMP(i,t),t=qn._helper.IntersectLC(r,t),i=qn._helper.pointReflection(i,n),n=at(t[0],t[1],n,i)[0]}nt(n=wr.normalizeMax(n)),nt(r),e.homog=Tr.withUsage(n,"Point")},qn.PointOnLine.getParamForInput=function(e,t,r){return e=It.csnames[e.args[0]].homog,t=qn._helper.projectPointToLine(t,e),"mouse"===r&&Yt&&0!==Ft&&(t=qn._helper.snapPointToLine(t,e)),t},qn.PointOnLine.getParamFromState=function(e){return tt(3)},qn.PointOnLine.putParamToState=function(e,t){return nt(t)},qn.PointOnLine.getRandomMove=qn._helper.getRandPointMove,qn.PointOnLine.stateSize=12,qn.PointOnCircle={},qn.PointOnCircle.kind="P",qn.PointOnCircle.signature=["C"],qn.PointOnCircle.isMovable=!0,qn.PointOnCircle.initialize=function(e){var t=It.csnames[e.args[0]];e=wr.normalizeZ(qn._helper.initializePoint(e));var r=wr.normalizeZ(qn._helper.CenterOfCircle(t.matrix)),n=wr.sub(e,r);n=wr.turnIntoCSList([n.value[1],yr.neg(n.value[0]),yr.zero]),r=wr.cross(e,r),t=qn._helper.IntersectLC(r,t.matrix),r=wr.projectiveDistMinScal(e,t[0]),wr.projectiveDistMinScal(e,t[1])<r?(e=t[1],t=t[0]):(e=t[0],t=t[1]),nt(n),nt(e),nt(t),An=!1},qn.PointOnCircle.putParamToState=function(e,t){nt(t)},qn.PointOnCircle.getParamFromState=function(e){return tt(3)},qn.PointOnCircle.getParamForInput=function(e,t,r){r=wr.normalizeZ(qn._helper.CenterOfCircle(It.csnames[e.args[0]].matrix)),t=wr.sub(t,r),En=e.stateIdx,e=tt(3);var n=wr.normalizeZ(tt(3));return r=wr.sub(n,r),0>yr.sub(yr.mult(e.value[0],r.value[1]),yr.mult(e.value[1],r.value[0])).value.real&&(t=wr.neg(t)),wr.turnIntoCSList([t.value[1],yr.neg(t.value[0]),yr.zero])},qn.PointOnCircle.parameterPath=function(e,t,r,n,i){n=wr.normalizeAbs(n),i=wr.normalizeAbs(i);var a=wr.scalproduct(n,i);if(0<=a.value.real)return He(0,0,r,n,i);e=wr.turnIntoCSList([yr.sub(n.value[1],i.value[1]),yr.sub(i.value[0],n.value[0]),yr.zero]),0>(a=wr.scalproduct(n,e)).value.real&&(e=wr.neg(e)),0>t?(a=.25/(1+(r=(t=2*t+1)*t)),r=yr.complex(2*t*a+.25,(1-r)*a)):(a=.25/(1+(r=(t=2*t-1)*t)),r=yr.complex(2*t*a+.75,(1-r)*a));var o=yr.sub(yr.real(1),r);return t=yr.mult(r,r),a=yr.mult(o,o),r=yr.mult(r,o),n=wr.scalmult(a,n),n=wr.add(n,wr.scalmult(r,e)),wr.add(n,wr.scalmult(t,i))},qn.PointOnCircle.updatePosition=function(e){var t=tt(3);nt(t);var r=It.csnames[e.args[0]];t=wr.productMV(r.matrix,t),r=it((r=qn._helper.IntersectLC(t,r.matrix))[0],r[1]),t=wr.normalizeMax(r.value[0]),e.homog=Tr.withUsage(t,"Point"),e.antipodalPoint=r.value[1]},qn.PointOnCircle.getRandomMove=qn._helper.getRandPointMove,qn.PointOnCircle.stateSize=6+it.stateSize,qn.PointOnCircle.get_angle=function(e){var t=qn._helper.CenterOfCircle(It.csnames[e.args[0]].matrix),r=wr._helper.isAlmostFarpoint;return r(e.homog)||r(t)?l:(e=wr.normalizeZ(e.homog),t=wr.normalizeZ(t),t=wr.sub(e,t),t=yr.arctan2(t.value[0],t.value[1]),e=yr.real(xr),t=yr.mod(yr.add(t,e),e),Tr.withUsage(t,"Angle"))},qn.PointOnCircle.set_angle=function(e,t){if("number"===t.ctype){var r=It.csnames[e.args[0]],n=qn._helper.CenterOfCircle(r.matrix);if(!wr._helper.isAlmostFarpoint(n)){n=wr.normalizeZ(n);var i=yr.cos(t);t=yr.sin(t),r=wr.turnIntoCSList([yr.mult(i,r.radius),yr.mult(t,r.radius),yr.real(0)]),Je(e,wr.add(n,r),"homog")}}return l},qn.OtherPointOnCircle={},qn.OtherPointOnCircle.kind="P",qn.OtherPointOnCircle.signature=["P"],qn.OtherPointOnCircle.signatureConstraints=function(e){return"PointOnCircle"===It.csnames[e.args[0]].type},qn.OtherPointOnCircle.updatePosition=function(e){var t=It.csnames[e.args[0]].antipodalPoint;t=wr.normalizeMax(t),e.homog=Tr.withUsage(t,"Point")},qn.PointOnSegment={},qn.PointOnSegment.kind="P",qn.PointOnSegment.signature=["S"],qn.PointOnSegment.isMovable=!0,qn.PointOnSegment.initialize=function(e){var t=qn._helper.initializePoint(e);rt(e=qn.PointOnSegment.getParamForInput(e,t))},qn.PointOnSegment.getParamForInput=function(e,t,r){var n=(e=It.csnames[e.args[0]]).homog;return"mouse"===r&&Yt&&0!==Ft&&(t=qn._helper.snapPointToLine(t,n)),r=wr.turnIntoCSList([n.value[0],n.value[1],yr.zero]),n=wr.sub(e.startpos,e.endpos),0>(t=wr.crossratio3(n,e.startpos,e.endpos,t,r)).value.real&&(t=yr.complex(0,t.value.imag)),1<t.value.real&&(t=yr.complex(1,t.value.imag)),t},qn.PointOnSegment.getParamFromState=function(e){return et()},qn.PointOnSegment.putParamToState=function(e,t){rt(t)},qn.PointOnSegment.updatePosition=function(e){var t=et();rt(t);var r=It.csnames[e.args[0]],n=r.startpos;r=wr.sub(r.endpos,n),t=wr.add(n,wr.scalmult(t,r)),t=wr.normalizeMax(t),e.homog=Tr.withUsage(t,"Point")},qn.PointOnSegment.getRandomMove=qn._helper.getRandPointMove,qn.PointOnSegment.stateSize=2,qn._helper.projectPointToCircle=function(e,t){var r=qn._helper.CenterOfCircle(e.matrix);return r=wr.normalizeMax(r),r=wr.normalizeMax(wr.cross(t,r)),e=qn._helper.IntersectLC(r,e.matrix),(r=wr.projectiveDistMinScal(t,e[0]))<(t=wr.projectiveDistMinScal(t,e[1]))?e[0]:e[1]},qn.PointOnArc={},qn.PointOnArc.kind="P",qn.PointOnArc.signature=["C"],qn.PointOnArc.signatureConstraints=function(e){return It.csnames[e.args[0]].isArc},qn.PointOnArc.isMovable=!0,qn.PointOnArc.initialize=function(e){var t=qn._helper.initializePoint(e);nt(e=qn.PointOnArc.getParamForInput(e,t))},qn.PointOnArc.getParamForInput=function(e,t){return e=It.csnames[e.args[0]],t=qn._helper.projectPointToCircle(e,t),t=wr.normalizeMax(wr.crossratio3harm(e.startPoint,e.endPoint,e.viaPoint,t,wr.ii)),0>(e=yr.div(t.value[0],t.value[1])).value.real&&(t=-1>e.value.real?wr.realVector([1,0]):wr.realVector([0,1])),t},qn.PointOnArc.getParamFromState=function(e){return tt(2)},qn.PointOnArc.putParamToState=function(e,t){nt(t)},qn.PointOnArc.updatePosition=function(e){var t=It.csnames[e.args[0]],r=t.startPoint,n=t.viaPoint,i=t.endPoint,a=wr.ii,o=wr.cross(r,a);n=wr.cross(n,a);var l=wr.cross(i,a);l=wr.turnIntoCSList([o,l]),o=wr.transpose(l),l=wr.conjugate(l),o=wr.productMM(l,o),n=wr.productMV(l,n),n=(o=wr.productMV(wr.adjoint2(o),n)).value[0],o=o.value[1],nt(l=tt(2)),r=wr.normalizeMax(wr.add(wr.scalmult(yr.mult(n,l.value[0]),r),wr.scalmult(yr.mult(o,l.value[1]),i))),t=qn._helper.conicOtherIntersection(t.matrix,a,r),e.homog=Tr.withUsage(t,"Point")},qn.PointOnArc.getRandomMove=qn._helper.getRandPointMove,qn.PointOnArc.stateSize=4,qn._helper.CenterOfCircle=function(e){return wr.turnIntoCSList([e.value[2].value[0],e.value[2].value[1],yr.neg(e.value[0].value[0])])},qn._helper.CenterOfConic=function(e){return{ctype:"list",value:[(e=wr.adjoint3(e)).value[2].value[0],e.value[2].value[1],e.value[2].value[2]]}},qn.CenterOfConic={},qn.CenterOfConic.kind="P",qn.CenterOfConic.signature=["C"],qn.CenterOfConic.updatePosition=function(e){var t=qn._helper.CenterOfConic(It.csnames[e.args[0]].matrix);e.homog=t,e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Point")},qn._helper.CircleMP=function(e,t){var r=e.value[0],n=e.value[1];e=yr.neg(e.value[2]);var i=yr.zero;return r=wr.turnIntoCSList([wr.turnIntoCSList([e,i,r]),wr.turnIntoCSList([i,e,n]),wr.turnIntoCSList([r,n,i])]),n=Tr.mult(Tr.mult(t,r),t),t=Tr.mult(Tr.mult(t,wr.fund),t),n=Tr.mult(n,wr.fund),t=Tr.mult(t,r),wr.sub(n,t)},qn.CircleMP={},qn.CircleMP.kind="C",qn.CircleMP.signature=["P","P"],qn.CircleMP.updatePosition=function(e){e.matrix=qn._helper.CircleMP(It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog),e.matrix=wr.normalizeMax(e.matrix),e.matrix=Tr.withUsage(e.matrix,"Circle")},qn.CircleMr={},qn.CircleMr.kind="C",qn.CircleMr.signature=["P"],qn.CircleMr.isMovable=!0,qn.CircleMr.initialize=function(e){rt(yr.real(e.radius))},qn.CircleMr.getParamForInput=function(e,t,r){return"radius"===r?t:(e=It.csnames[e.args[0]].homog,e=wr.normalizeZ(e),t=wr.normalizeZ(t),t=wr.sub(e,t),wr.abs(t))},qn.CircleMr.getParamFromState=function(e){return et()},qn.CircleMr.putParamToState=function(e,t){rt(t)},qn.CircleMr.updatePosition=function(e){var t=et();rt(t);var r=It.csnames[e.args[0]].homog,n=yr.mult(r.value[2],t);if(n=yr.mult(n,n),!yr._helper.isFinite(n)&&!yr._helper.isNaN(n))return wr.fund;r=qn._helper.ScaledCircleMrr(r,n),e.matrix=Tr.withUsage(r,"Circle"),e.radius=t},qn.CircleMr.getRandomMove=function(e){return e=e.radius,{type:"radius",value:yr.abs(e).value.real<yr.eps?yr.getRandComplex(.05,.1):yr.mult(e,yr.getRandReal(.95,1.05))}},qn.CircleMr.stateSize=2,qn.CircleMr.set_radius=function(e,t){"number"===t.ctype&&Je(e,t,"radius")},qn._helper.ScaledCircleMrr=function(e,t){var r=e.value[0],n=e.value[1];return e=yr.neg(e.value[2]),e=wr.scalmult(e,wr.turnIntoCSList([r,n,e])).value,r=wr.turnIntoCSList([r,n]),t=yr.sub(wr.scalproduct(r,r),t),t=qn._helper.buildConicMatrix([e[2],yr.zero,e[2],e[0],e[1],t]),wr.normalizeMax(t)},qn.Compass={},qn.Compass.kind="C",qn.Compass.signature=["P","P","P"],qn.Compass.updatePosition=function(e){var t=It.csnames[e.args[0]].homog,r=It.csnames[e.args[1]].homog,n=It.csnames[e.args[2]].homog,i=t.value[2],a=r.value[2],o=n.value[2];t=wr.scalmult(yr.mult(a,o),t),r=wr.scalmult(yr.mult(i,o),r),n=wr.scalmult(yr.mult(i,a),n),t=wr.sub(r,t),n=qn._helper.ScaledCircleMrr(n,wr.scalproduct(t,t)),e.matrix=Tr.withUsage(n,"Circle")},qn._helper.getConicType=function(e){if(1e-16>yr.abs(wr.det(e)).value.real)return"degenerate";var t=yr.mult(e.value[0].value[0],e.value[1].value[1]);return t=(t=yr.sub(t,yr.pow(e.value[0].value[1],yr.real(2)))).value.real,1e-16>Math.abs(t)?"parabola":1e-16<t?"ellipsoid":"hyperbola"},qn._helper.ConicBy5=function(e,t,r,n,i,a){e=wr.turnIntoCSList([wr.cross(r,n)]);var o=wr.turnIntoCSList([wr.cross(t,i)]);return t=wr.turnIntoCSList([wr.cross(t,r)]),n=wr.turnIntoCSList([wr.cross(n,i)]),qn._helper.conicFromTwoDegenerates(e,o,t,n,a)},qn._helper.conicFromTwoDegenerates=function(e,t,r,n,i){return e=Tr.mult(wr.transpose(t),e),r=Tr.mult(wr.transpose(n),r),e=wr.add(e,wr.transpose(e)),r=wr.add(r,wr.transpose(r)),n=Tr.mult(Tr.mult(i,e),i),i=Tr.mult(Tr.mult(i,r),i),r=Tr.mult(n,r),i=Tr.mult(i,e),wr.sub(r,i)},qn.ConicBy5={},qn.ConicBy5.kind="C",qn.ConicBy5.signature=["P","P","P","P","P"],qn.ConicBy5.updatePosition=function(e){var t=qn._helper.ConicBy5(e,It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog,It.csnames[e.args[2]].homog,It.csnames[e.args[3]].homog,It.csnames[e.args[4]].homog);e.matrix=t,e.matrix=wr.normalizeMax(e.matrix),e.matrix=Tr.withUsage(e.matrix,"Conic")},qn.FreeConic={},qn.FreeConic.kind="C",qn.FreeConic.signature=[],qn.FreeConic.initialize=function(e){var t=e.pos?qn._helper.inputConic(e.pos):wr.zeromatrix(yr.real(3),yr.real(3));qn.FreeConic.putParamToState(e,t)},qn.FreeConic.getParamForInput=function(e,t,r){return wr.normalizeMax(t)},qn.FreeConic.getParamFromState=function(e){return qn._helper.buildConicMatrix(tt(6).value)},qn.FreeConic.putParamToState=function(e,t){for(e=0;3>e;++e)for(var r=0;r<=e;++r)rt(t.value[e].value[r])},qn.FreeConic.updatePosition=function(e){var t=tt(6);nt(t),e.matrix=qn._helper.buildConicMatrix(t.value),e.matrix=wr.normalizeMax(e.matrix),e.matrix=Tr.withUsage(e.matrix,"Conic")},qn.FreeConic.set_matrix=function(e,t){wr._helper.isNumberMatrixMN(t,3,3)&&Je(e,wr.add(t,wr.transpose(t)),"matrix")},qn.FreeConic.stateSize=12,qn._helper.buildConicMatrix=function(e){var t=e[1],r=e[2],n=e[3],i=e[4],a=e[5];return wr.turnIntoCSList([wr.turnIntoCSList([e[0],t,n]),wr.turnIntoCSList([t,r,i]),wr.turnIntoCSList([n,i,a])])},qn._helper.flattenConicMatrix=function(e){return wr.turnIntoCSList([e.value[0].value[0],e.value[0].value[1],e.value[1].value[1],e.value[0].value[2],e.value[1].value[2],e.value[2].value[2]])},qn._helper.splitDegenConic=function(e){var t,r=wr.adjoint3(e),n=0,i=yr.abs2(r.value[0].value[0]).value.real;for(t=1;3>t;t++){var a=yr.abs2(r.value[t].value[t]).value.real;a>i&&(n=t,i=a)}if(t=yr.sqrt(yr.mult(yr.real(-1),r.value[n].value[n])),1e-16>yr.abs2(t).value.real)return[e=wr.turnIntoCSList([yr.zero,yr.zero,yr.zero]),e];n=yr.real(n+1),a=wr.column(r,n),t=(a=wr.scaldiv(t,a)).value[0],i=a.value[1],a=a.value[2],t=wr.turnIntoCSList([wr.turnIntoCSList([yr.real(0),a,yr.mult(yr.real(-1),i)]),wr.turnIntoCSList([yr.mult(yr.real(-1),a),yr.real(0),t]),wr.turnIntoCSList([i,yr.mult(yr.real(-1),t),yr.real(0)])]),e=wr.add(e,t);var o=0;for(t=i=r=0;3>t;t++)for(n=0;3>n;n++)(a=yr.abs2(e.value[t].value[n]).value.real)>i&&(o=t,r=n,i=a);return t=e.value[o],e=(e=wr.transpose(e)).value[r],t=wr.normalizeMax(t),e=wr.normalizeMax(e),[t=Tr.withUsage(t,"Line"),e=Tr.withUsage(e,"Line")]},qn._helper.inputConic=function(e){var t="xx xy yy xz yz zz".split(" ").map((function(t){var r=yr._helper.input(e[t]);return t[0]!==t[1]&&(r=yr.realmult(.5,r)),r}));return qn._helper.buildConicMatrix(t)},qn.SelectConic={},qn.SelectConic.kind="C",qn.SelectConic.signature=["Cs"],qn.SelectConic.initialize=function(e){if(void 0!==e.index)return e.index-1;var t=qn._helper.inputConic(e.pos);e=It.csnames[e.args[0]].results;for(var r=wr.conicDist(t,e[0]),n=0,i=1;i<e.length;++i){var a=wr.conicDist(t,e[i]);a<r&&(r=a,n=i)}return n},qn.SelectConic.updatePosition=function(e){e.matrix=It.csnames[e.args[0]].results[e.param],e.matrix=wr.normalizeMax(e.matrix),e.matrix=Tr.withUsage(e.matrix,"Conic")},qn._helper.ConicBy4p1l=function(e,t,r,n,i,a){var o=wr.scalproduct(t,a),l=wr.scalproduct(r,a),s=wr.scalproduct(n,a),u=wr.scalproduct(i,a),c=wr.det3(r,n,i),p=wr.det3(t,r,i),f=wr.det3(t,n,i),h=wr.det3(t,r,n),v=yr.mult;return l=yr.sqrt(v(v(l,u),v(c,p))),o=yr.sqrt(v(v(o,s),v(f,h))),s=wr.cross(wr.cross(t,n),a),a=wr.cross(wr.cross(r,i),a),s=wr.scalmult(l,s),o=wr.scalmult(o,a),o=it(a=wr.normalizeMax(wr.add(s,o)),o=wr.normalizeMax(wr.sub(s,o))),a=qn._helper.ConicBy5(e,t,r,n,i,o.value[0]),e=qn._helper.ConicBy5(e,t,r,n,i,o.value[1]),[wr.normalizeMax(a),wr.normalizeMax(e)]},qn.ConicBy4p1l={},qn.ConicBy4p1l.kind="Cs",qn.ConicBy4p1l.signature=["P","P","P","P","L"],qn.ConicBy4p1l.updatePosition=function(e){var t=qn._helper.ConicBy4p1l(e,It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog,It.csnames[e.args[2]].homog,It.csnames[e.args[3]].homog,It.csnames[e.args[4]].homog);e.results=t},qn.ConicBy4p1l.stateSize=it.stateSize,qn._helper.ConicBy3p2l=function(e,t,r,n,i){function a(e,t,r,n){return yr.sub(yr.mult(e,n),yr.mult(t,r))}var o=wr.cross(e,t),l=wr.cross(n,i);n=wr.cross(n,o),i=wr.cross(i,o),o=wr.turnIntoCSList([n,i,l]),r=wr.productVM(r,wr.adjoint3(o)),l=wr.adjoint3(wr.turnIntoCSList([wr.scalmult(r.value[0],n),wr.scalmult(r.value[1],i),wr.scalmult(r.value[2],l)])),r=wr.transpose(l),n=yr.mult,e=(i=wr.productMV(r,e)).value[0],i=i.value[1],t=(o=wr.productMV(r,t)).value[0],o=o.value[1];var s,u=yr.sqrt(n(e,i)),c=yr.sqrt(n(t,o)),p=Array(4);for(s=0;4>s;++s){var f=(2&s)-1,h=n(yr.real(((1&s)<<1)-1),u),v=n(yr.real(f),c),d=a(i,h,o,v),m=a(t,v,e,h);f=a(e,i,t,o);var g=yr.add(yr.add(a(t,o,e,i),a(o,v,i,h)),a(v,t,h,e));h=n(d,d),v=n(m,m);var y=n(g,g),b=n(d,m);d=n(d,g),m=n(m,g),b=yr.sub(b,n(yr.real(.5),n(f,f))),f=wr.turnIntoCSList([wr.turnIntoCSList([h,b,d]),wr.turnIntoCSList([b,v,m]),wr.turnIntoCSList([d,m,y])]),f=wr.productMM(l,wr.productMM(f,r)),f=wr.turnIntoCSList([f.value[0].value[0],f.value[0].value[1],f.value[0].value[2],f.value[1].value[1],f.value[1].value[2],f.value[2].value[2]]),p[s]=f}return p},qn.ConicBy3p2l={},qn.ConicBy3p2l.kind="Cs",qn.ConicBy3p2l.signature=["P","P","P","L","L"],qn.ConicBy3p2l.updatePosition=function(e){var t=qn._helper.ConicBy3p2l(It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog,It.csnames[e.args[2]].homog,It.csnames[e.args[3]].homog,It.csnames[e.args[4]].homog);t=lt(t);for(var r=Array(4),n=0;4>n;++n){var i=t[n].value;r[n]=wr.turnIntoCSList([wr.turnIntoCSList([i[0],i[1],i[2]]),wr.turnIntoCSList([i[1],i[3],i[4]]),wr.turnIntoCSList([i[2],i[4],i[5]])])}e.results=r},qn.ConicBy3p2l.stateSize=48,qn.ConicBy2p3l={},qn.ConicBy2p3l.kind="Cs",qn.ConicBy2p3l.signature=["P","P","L","L","L"],qn.ConicBy2p3l.updatePosition=function(e){var t=qn._helper.ConicBy3p2l(It.csnames[e.args[2]].homog,It.csnames[e.args[3]].homog,It.csnames[e.args[4]].homog,It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog);t=lt(t);for(var r=Array(4),n=0;4>n;++n){var i=t[n].value;i=wr.turnIntoCSList([wr.turnIntoCSList([i[0],i[1],i[2]]),wr.turnIntoCSList([i[1],i[3],i[4]]),wr.turnIntoCSList([i[2],i[4],i[5]])]),r[n]=wr.normalizeMax(wr.adjoint3(i))}e.results=r},qn.ConicBy2p3l.stateSize=48,qn.ConicBy1p4l={},qn.ConicBy1p4l.kind="Cs",qn.ConicBy1p4l.signature=["P","L","L","L","L"],qn.ConicBy1p4l.updatePosition=function(e){var t=qn._helper.ConicBy4p1l(e,It.csnames[e.args[1]].homog,It.csnames[e.args[2]].homog,It.csnames[e.args[3]].homog,It.csnames[e.args[4]].homog,It.csnames[e.args[0]].homog),r=t[0];t=t[1],t=[r=wr.adjoint3(r),t=wr.adjoint3(t)],e.results=t},qn.ConicBy1p4l.stateSize=it.stateSize,qn.ConicParabolaPL={},qn.ConicParabolaPL.kind="C",qn.ConicParabolaPL.signature=["P","L"],qn.ConicParabolaPL.updatePosition=function(e){var t=It.csnames[e.args[0]].homog.value,r=It.csnames[e.args[1]].homog.value,n=yr.mult,i=yr.neg,a=yr.add,o=yr.sub,l=t[0],s=t[1],u=t[2],c=r[0];t=r[1],r=r[2];var p=n(u,u),f=n(c,c),h=n(t,t),v=n(u,r),d=i(u);u=a(f,h),h=n(p,h),f=n(p,f),i=n(i(p),n(c,t)),c=n(d,a(n(l,u),n(v,c))),t=n(d,a(n(s,u),n(v,t))),n=o(n(a(n(l,l),n(s,s)),u),n(p,n(r,r))),n=qn._helper.buildConicMatrix([h,i,f,c,t,n]),n=wr.normalizeMax(n),e.matrix=Tr.withUsage(n,"Conic")},qn.ConicBy2Foci1P={},qn.ConicBy2Foci1P.kind="Cs",qn.ConicBy2Foci1P.signature=["P","P","P"],qn.ConicBy2Foci1P.updatePosition=function(e){var t=It.csnames[e.args[0]].homog,r=It.csnames[e.args[1]].homog,n=It.csnames[e.args[2]].homog,i=wr.ii,a=wr.jj,o=wr.normalizeMax(wr.cross(t,n)),l=wr.normalizeMax(wr.cross(r,n)),s=wr.normalizeMax(wr.cross(n,i));n=wr.normalizeMax(wr.cross(n,a)),l=qn._helper.coHarmonic(s,n,o,l),o=wr.normalizeMax(l[0]),l=wr.normalizeMax(l[1]),i=wr.turnIntoCSList([i]),s=wr.turnIntoCSList([a]),n=wr.turnIntoCSList([t]);var u=wr.turnIntoCSList([r]);a=qn._helper.conicFromTwoDegenerates(i,s,n,u,o),a=wr.normalizeMax(a),i=qn._helper.conicFromTwoDegenerates(i,s,n,u,l),i=wr.normalizeMax(i),a=wr.normalizeMax(wr.adjoint3(a)),i=wr.normalizeMax(wr.adjoint3(i)),"ellipsoid"!==qn._helper.getConicType(a)&&(o=a,a=i,i=o),wr.almostequals(t,r).value&&(t=yr.real(3),i=wr.zeromatrix(t,t)),e.results=[a,i]},qn.ConicBy2Pol1P={},qn.ConicBy2Pol1P.kind="C",qn.ConicBy2Pol1P.signature=["P","L","P","L","P"],qn.ConicBy2Pol1P.updatePosition=function(e){var t=It.csnames[e.args[0]].homog,r=It.csnames[e.args[1]].homog,n=It.csnames[e.args[2]].homog,i=It.csnames[e.args[3]].homog,a=It.csnames[e.args[4]].homog,o=wr.scalproduct,l=wr.scalmult,s=wr.sub,u=wr.productMM,c=yr.realmult,p=wr.transpose,f=wr.turnIntoCSList,h=s(l(o(r,t),a),l(c(2,o(r,a)),t)),v=s(l(o(i,n),a),l(c(2,o(i,a)),n)),d=f([wr.cross(t,a)]);a=f([wr.cross(n,a)]),v=u(p(d),f([wr.cross(t,v)])),f=u(p(a),f([wr.cross(n,h)])),u=u(p(d),a),t=o(t,i),r=o(n,r),n=s(n=wr.add(l(r,v),l(t,f)),l(c(2,yr.mult(t,r)),u)),n=wr.add(n,p(n)),n=wr.normalizeMax(n),n=Tr.withUsage(n,"Conic"),e.matrix=n},qn.ConicBy2Pol1L={},qn.ConicBy2Pol1L.kind="C",qn.ConicBy2Pol1L.signature=["P","L","P","L","L"],qn.ConicBy2Pol1L.updatePosition=function(e){var t=It.csnames[e.args[0]].homog,r=It.csnames[e.args[1]].homog,n=It.csnames[e.args[2]].homog,i=It.csnames[e.args[3]].homog,a=It.csnames[e.args[4]].homog,o=wr.scalproduct,l=wr.scalmult,s=wr.productMM,u=yr.mult,c=wr.transpose,p=wr.turnIntoCSList,f=o(r,t),h=o(r,n),v=o(i,t),d=o(i,n),m=o(a,t);o=o(a,n);var g=p([wr.sub(l(u(v,o),r),l(u(h,m),i))]);t=wr.add(s(c(p([l(u(v,h),a)])),p([wr.sub(wr.add(l(yr.sub(u(f,o),u(h,m)),i),l(yr.sub(u(d,m),u(v,o)),r)),l(wr.det3(r,i,a),wr.cross(t,n)))])),s(c(g),g)),t=wr.add(t,c(t)),t=wr.normalizeMax(t),t=Tr.withUsage(t,"Conic"),e.matrix=t},qn._helper.conic1Pol3Inc=function(e,t,r,n,i){var a=wr.scalproduct,o=wr.scalmult,l=wr.productMM,s=wr.cross,u=yr.realmult,c=yr.mult,p=wr.transpose,f=wr.turnIntoCSList,h=wr.det3,v=h(e,r,n),d=f([s(r,i)]),m=f([s(e,i)]),g=f([s(r,n)]),y=a(t,e),b=a(t,r);return t=a(t,i),s=f([s(n,wr.sub(o(y,i),o(u(2,t),e)))]),d=o(v,l(p(d),s)),e=u(2,yr.add(c(h(e,n,i),b),c(v,t))),e=yr.sub(c(h(r,n,i),y),e),d=wr.add(d,o(e,l(p(m),g))),d=wr.add(d,p(d)),wr.normalizeMax(d)},qn.ConicBy1Pol3P={},qn.ConicBy1Pol3P.kind="C",qn.ConicBy1Pol3P.signature=["P","L","P","P","P"],qn.ConicBy1Pol3P.updatePosition=function(e){var t=qn._helper.conic1Pol3Inc(It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog,It.csnames[e.args[2]].homog,It.csnames[e.args[3]].homog,It.csnames[e.args[4]].homog);t=Tr.withUsage(t,"Conic"),e.matrix=t},qn.ConicBy1Pol3L={},qn.ConicBy1Pol3L.kind="C",qn.ConicBy1Pol3L.signature=["P","L","L","L","L"],qn.ConicBy1Pol3L.updatePosition=function(e){var t=qn._helper.conic1Pol3Inc(It.csnames[e.args[1]].homog,It.csnames[e.args[0]].homog,It.csnames[e.args[2]].homog,It.csnames[e.args[3]].homog,It.csnames[e.args[4]].homog);t=wr.normalizeMax(wr.adjoint3(t)),t=Tr.withUsage(t,"Conic"),e.matrix=t},qn.ConicBy1Pol2P1L={},qn.ConicBy1Pol2P1L.kind="Cs",qn.ConicBy1Pol2P1L.signature=["P","L","P","P","L"],qn.ConicBy1Pol2P1L.updatePosition=function(e){var t=It.csnames[e.args[0]].homog,r=It.csnames[e.args[1]].homog,n=It.csnames[e.args[2]].homog,i=It.csnames[e.args[3]].homog,a=It.csnames[e.args[4]].homog,o=yr.add,l=wr.turnIntoCSList,s=wr.cross,u=wr.productMM,c=yr.mult,p=yr.realmult,f=wr.scalmult,h=wr.scalproduct,v=yr.sub,d=wr.transpose,m=h(r,t),g=h(r,n),y=h(r,i);r=h(a,t);var b=h(a,n);h=h(a,i),a=l([s(t,n)]),t=l([s(t,i)]),n=l([s(n,i)]),i=yr.sqrt(c(c(b,h),c(v(c(m,b),p(2,c(r,g))),v(c(m,h),p(2,c(r,y)))))),l=u(d(a),t),i=f(i,wr.add(l,d(l))),o=f(v(c(m,c(b,h)),o(c(r,c(g,h)),c(r,c(b,y)))),l),p=wr.add(wr.sub(f(y,a),f(g,t)),f(p(.5,m),n)),o=wr.add(o,f(c(r,r),u(d(n),p))),o=wr.add(o,d(o)),u=wr.normalizeMax(wr.add(i,o)),c=wr.normalizeMax(wr.sub(i,o)),e.results=st(u,c).value},qn.ConicBy1Pol2P1L.stateSize=st.stateSize,qn.ConicBy1Pol1P2L={},qn.ConicBy1Pol1P2L.kind="Cs",qn.ConicBy1Pol1P2L.signature=["P","L","P","L","L"],qn.ConicBy1Pol1P2L.updatePosition=function(e){var t=It.csnames[e.args[0]].homog,r=It.csnames[e.args[1]].homog,n=It.csnames[e.args[2]].homog,i=It.csnames[e.args[3]].homog,a=It.csnames[e.args[4]].homog,o=yr.add,l=wr.turnIntoCSList,s=wr.cross,u=wr.productMM,c=yr.mult,p=yr.realmult,f=wr.scalmult,h=wr.scalproduct,v=yr.sub,d=wr.transpose,m=h(r,t),g=h(r,n),y=h(i,t),b=h(i,n),P=h(a,t),x=h(a,n),C=c(m,m),_=c(m,g);h=c(g,g);var w=c(y,y),S=c(y,b),M=c(b,b),T=c(P,P),I=c(P,x),L=c(x,x),O=c(c(C,M),L);O=v(O,p(2,c(c(_,S),L))),O=o(O=v(O,p(2,c(c(_,M),I))),p(.5,c(c(h,w),L))),O=o(O,p(3,c(c(h,S),I))),O=o(O,p(.5,c(c(h,M),T))),I=v(I=c(c(m,b),x),c(c(g,y),x)),I=v(I,c(c(g,b),P)),I=c(I,c(h,P)),L=v(c(m,b),p(2,c(g,y))),L=c(L,c(h,c(b,P))),O=u(d(l([r])),l([wr.add(wr.add(f(O,r),f(I,i)),f(L,a))])),I=l([i]),O=wr.add(O,f(p(.5,c(c(h,h),T)),u(d(I),I))),O=wr.add(O,f(h,u(d(l([a])),l([wr.add(f(v(v(p(2,c(_,S)),c(C,M)),p(.5,c(h,w))),a),f(c(wr.det3(r,i,a),v(c(m,b),c(g,y))),s(t,n)))])))),O=wr.add(O,d(O)),t=yr.sqrt(c(c(b,x),c(v(c(m,b),p(2,c(g,y))),v(c(m,x),p(2,c(g,P)))))),r=u(d(l([r])),l([wr.sub(f(v(c(g,o(c(y,x),c(b,P))),c(m,c(b,x))),r),f(h,wr.add(f(P,i),f(y,a))))])),r=wr.add(r,f(c(m,h),u(d(l([i])),l([a])))),r=f(t,r),r=wr.add(r,d(r)),i=wr.normalizeMax(wr.add(O,r)),a=wr.normalizeMax(wr.sub(O,r)),e.results=st(i,a).value},qn.ConicBy1Pol1P2L.stateSize=st.stateSize,qn._helper.coHarmonic=function(e,t,r,n){var i=wr.realVector([100*Math.random(),100*Math.random(),1]),a=wr.det3(i,r,e),o=wr.det3(i,r,t);return r=wr.det3(i,n,e),n=wr.det3(i,n,t),n=yr.sqrt(yr.mult(n,o)),a=yr.sqrt(yr.mult(r,a)),e=Tr.mult(e,n),a=Tr.mult(t,a),[t=wr.add(e,a),e=wr.sub(e,a)]},qn.ConicInSquare={},qn.ConicInSquare.kind="C",qn.ConicInSquare.signature=["P","P","P","P"],qn.ConicInSquare.updatePosition=function(e){var t=Er.basismap(It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog,It.csnames[e.args[2]].homog,It.csnames[e.args[3]].homog),r=yr.one;r=qn._helper.buildConicMatrix([r,r,r,yr.real(-3),r,r]),t=wr.adjoint3(t),t=wr.productMM(wr.productMM(wr.transpose(t),r),t),t=wr.normalizeMax(t),e.matrix=Tr.withUsage(t,"Conic")},qn.ConicBy5lines={},qn.ConicBy5lines.kind="C",qn.ConicBy5lines.signature=["L","L","L","L","L"],qn.ConicBy5lines.updatePosition=function(e){var t=qn._helper.ConicBy5(e,It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog,It.csnames[e.args[2]].homog,It.csnames[e.args[3]].homog,It.csnames[e.args[4]].homog);t=wr.adjoint3(t),e.matrix=t,e.matrix=wr.normalizeMax(e.matrix),e.matrix=Tr.withUsage(e.matrix,"Conic")},qn.ConicFromPrincipalDirections={},qn.ConicFromPrincipalDirections.kind="C",qn.ConicFromPrincipalDirections.signature=["P","P","P"],qn.ConicFromPrincipalDirections.updatePosition=function(e){var t=It.csnames[e.args[0]].homog,r=It.csnames[e.args[1]].homog,n=It.csnames[e.args[2]].homog,i=qn._helper.pointReflection(t,r),a=wr.cross(r,t);t=wr.turnIntoCSList([a.value[0],a.value[1],yr.zero]),a=wr.turnIntoCSList([a]),r=wr.turnIntoCSList([wr.cross(r,t)]),i=wr.turnIntoCSList([wr.cross(i,t)]),e.matrix=qn._helper.conicFromTwoDegenerates(a,a,r,i,n),e.matrix=wr.normalizeMax(e.matrix),e.matrix=Tr.withUsage(e.matrix,"Conic")},qn.CircleBy3={},qn.CircleBy3.kind="C",qn.CircleBy3.signature=["P","P","P"],qn.CircleBy3.updatePosition=function(e){var t=qn._helper.ConicBy5(e,It.csnames[e.args[0]].homog,It.csnames[e.args[1]].homog,wr.ii,wr.jj,It.csnames[e.args[2]].homog);e.matrix=wr.normalizeMax(t),e.matrix=Tr.withUsage(e.matrix,"Circle")},qn.ArcBy3={},qn.ArcBy3.kind="C",qn.ArcBy3.signature=["P","P","P"],qn.ArcBy3.updatePosition=function(e){qn.CircleBy3.updatePosition(e),e.startPoint=It.csnames[e.args[0]].homog,e.viaPoint=It.csnames[e.args[1]].homog,e.endPoint=It.csnames[e.args[2]].homog},qn.ArcBy3.initialize=function(e){e.startPoint=It.csnames[e.args[0]].homog,e.viaPoint=It.csnames[e.args[1]].homog,e.endPoint=It.csnames[e.args[2]].homog,e.isArc=!0},qn.PolarOfPoint={},qn.PolarOfPoint.kind="L",qn.PolarOfPoint.signature=["P","C"],qn.PolarOfPoint.updatePosition=function(e){var t=Tr.mult(It.csnames[e.args[1]].matrix,It.csnames[e.args[0]].homog);t=wr.normalizeMax(t),e.homog=Tr.withUsage(t,"Line")},qn.PolarOfLine={},qn.PolarOfLine.kind="P",qn.PolarOfLine.signature=["L","C"],qn.PolarOfLine.updatePosition=function(e){var t=It.csnames[e.args[0]],r=wr.adjoint3(It.csnames[e.args[1]].matrix);t=Tr.mult(r,t.homog),t=wr.normalizeMax(t),e.homog=Tr.withUsage(t,"Point")},qn.AngleBisector={},qn.AngleBisector.kind="Ls",qn.AngleBisector.signature=["L","L","P"],qn.AngleBisector.updatePosition=function(e){var t=It.csnames[e.args[0]].homog,r=It.csnames[e.args[1]].homog,n=It.csnames[e.args[2]].homog,i=wr.add,a=wr.sub,o=wr.abs,l=wr.cross,s=wr.scalmult,u=wr.normalizeMax,c=wr._helper.isAlmostZero,p=wr.linfty,f=s(o(l(l(p,r),p)),t);a=a(f,t=s(o(l(l(p,t),p)),r)),i=i(f,t),c(a)&&(a=l(l(l(p,i),p),n)),c(i)&&(i=l(l(l(p,a),p),n)),e.results=it(u(a),u(i))},qn.AngleBisector.stateSize=it.stateSize,qn._helper.IntersectLC=function(e,t){var r=yr,n=wr.crossOperator(e),i=wr.transpose(n);if(t=Tr.mult(i,Tr.mult(t,n)),0===(i=wr.maxIndex(e,yr.abs2))){i=t.value[1].value[1];var a=t.value[1].value[2],o=t.value[2].value[1],l=t.value[2].value[2];e=e.value[0]}else 1===i?(i=t.value[0].value[0],a=t.value[0].value[2],o=t.value[2].value[0],l=t.value[2].value[2],e=e.value[1]):(i=t.value[0].value[0],a=t.value[0].value[1],o=t.value[1].value[0],l=t.value[1].value[1],e=e.value[2]);return r=r.div(r.sqrt(r.sub(r.mult(a,o),r.mult(i,l))),e),r=wr.add(t,wr.scalmult(r,n)),i=wr.maxIndex(r,wr.abs2),n=r.value[i],n=wr.normalizeMax(n),n=Tr.withUsage(n,"Point"),r=wr.transpose(r),i=wr.maxIndex(r,wr.abs2),r=r.value[i],r=wr.normalizeMax(r),[n,r=Tr.withUsage(r,"Point")]},qn.IntersectLC={},qn.IntersectLC.kind="Ps",qn.IntersectLC.signature=["L","C"],qn.IntersectLC.updatePosition=function(e){var t=qn._helper.IntersectLC(It.csnames[e.args[0]].homog,It.csnames[e.args[1]].matrix);e.results=it(t[0],t[1])},qn.IntersectLC.stateSize=it.stateSize,qn.OtherIntersectionCL={},qn.OtherIntersectionCL.kind="P",qn.OtherIntersectionCL.signature=["C","L","P"],qn.OtherIntersectionCL.updatePosition=function(e){var t=It.csnames[e.args[2]].homog,r=qn._helper.IntersectLC(It.csnames[e.args[1]].homog,It.csnames[e.args[0]].matrix),n=r[0];r=r[1];var i=wr.projectiveDistMinScal(n,t);t=wr.projectiveDistMinScal(r,t),e.homog=i<t?r:n,e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Point")},qn.IntersectCirCir={},qn.IntersectCirCir.kind="Ps",qn.IntersectCirCir.signature=["C","C"],qn.IntersectCirCir.updatePosition=function(e){var t=It.csnames[e.args[0]].matrix,r=It.csnames[e.args[1]].matrix,n=wr.scalmult(r.value[0].value[0],t.value[2]);r=wr.scalmult(t.value[0].value[0],r.value[2]),n=wr.sub(n,r),n=wr.turnIntoCSList([n.value[0],n.value[1],yr.realmult(.5,n.value[2])]),n=wr.normalizeMax(n),t=qn._helper.IntersectLC(n,t),e.results=it(t[0],t[1])},qn.IntersectCirCir.stateSize=it.stateSize,qn.OtherIntersectionCC={},qn.OtherIntersectionCC.kind="P",qn.OtherIntersectionCC.signature=["C","C","P"],qn.OtherIntersectionCC.updatePosition=function(e){var t=It.csnames[e.args[0]].matrix,r=It.csnames[e.args[1]].matrix,n=It.csnames[e.args[2]].homog,i=wr.scalmult(r.value[0].value[0],t.value[2]);r=wr.scalmult(t.value[0].value[0],r.value[2]),i=wr.sub(i,r),i=wr.turnIntoCSList([i.value[0],i.value[1],yr.realmult(.5,i.value[2])]),i=wr.normalizeMax(i),t=(i=qn._helper.IntersectLC(i,t))[0],i=i[1],r=wr.projectiveDistMinScal(t,n),n=wr.projectiveDistMinScal(i,n),e.homog=r<n?i:t,e.homog=wr.normalizeMax(e.homog),e.homog=Tr.withUsage(e.homog,"Point")},qn._helper.IntersectConicConic=function(e,t){var r=e.value[0],n=e.value[1],i=e.value[2],a=t.value[0],o=t.value[1],l=t.value[2],s=wr.det3(r,n,i),u=yr.add(yr.add(wr.det3(r,n,l),wr.det3(r,o,i)),wr.det3(a,n,i));return r=yr.add(yr.add(wr.det3(r,o,l),wr.det3(a,n,l)),wr.det3(a,o,i)),a=wr.det3(a,o,l),(l=yr.abs2(s).value.real)<(o=yr.abs2(a).value.real)&&(l=e,e=t,t=l,l=a,a=s,s=l,l=r,r=u,u=l,l=o),1e-24>l?(s=e,u=t):(u=yr.solveCubic(s,u,r,a),r=yr.abs2(yr.sub(u[0],u[1])).value.real,a=yr.abs2(yr.sub(u[0],u[2])).value.real,o=yr.abs2(yr.sub(u[1],u[2])).value.real,r>a?(s=u[1],u=r>o?u[0]:u[2]):(s=u[2],u=a>o?u[0]:u[1]),s=wr.add(wr.scalmult(s,e),t),u=wr.add(wr.scalmult(u,e),t)),e=(t=qn._helper.splitDegenConic(s))[0],t=t[1],r=(s=qn._helper.splitDegenConic(u))[0],u=s[1],s=wr.cross(e,r),r=wr.cross(t,r),e=wr.cross(e,u),t=wr.cross(t,u),s=wr.normalizeMax(s),r=wr.normalizeMax(r),e=wr.normalizeMax(e),t=wr.normalizeMax(t),[s=Tr.withUsage(s,"Point"),r=Tr.withUsage(r,"Point"),e=Tr.withUsage(e,"Point"),t=Tr.withUsage(t,"Point")]},qn.IntersectConicConic={},qn.IntersectConicConic.kind="Ps",qn.IntersectConicConic.signature=["C","C"],qn.IntersectConicConic.updatePosition=function(e){var t=qn._helper.IntersectConicConic(It.csnames[e.args[0]].matrix,It.csnames[e.args[1]].matrix);t=ot(t[0],t[1],t[2],t[3]),e.results=t},qn.IntersectConicConic.stateSize=ot.stateSize,qn.SelectP={},qn.SelectP.kind="P",qn.SelectP.signature=["Ps"],qn.SelectP.initialize=function(e){if(void 0!==e.index)return e.index-1;var t=It.csnames[e.args[0]].results.value;e=qn._helper.initializePoint(e);for(var r=wr.projectiveDistMinScal(e,t[0]),n=0,i=1;i<t.length;++i){var a=wr.projectiveDistMinScal(e,t[i]);a<r&&(r=a,n=i)}return n},qn.SelectP.updatePosition=function(e){e.homog=It.csnames[e.args[0]].results.value[e.param]},qn.SelectL={},qn.SelectL.kind="L",qn.SelectL.signature=["Ls"],qn.SelectL.initialize=function(e){if(void 0!==e.index)return e.index-1;var t=It.csnames[e.args[0]].results.value;e=qn._helper.initializeLine(e);for(var r=wr.projectiveDistMinScal(e,t[0]),n=0,i=1;i<t.length;++i){var a=wr.projectiveDistMinScal(e,t[i]);a<r&&(r=a,n=i)}return n},qn.SelectL.updatePosition=function(e){e.homog=It.csnames[e.args[0]].results.value[e.param],e.homog=Tr.withUsage(e.homog,"Line")},qn._helper.moebiusStep=function(e,t,r){var n=yr.add,i=yr.sub,a=yr.mult,o=e.value[0],l=e.value[1];e=e.value[2];var s=t.value[0],u=t.value[1];t=t.value[2];var c=r.value[0],p=r.value[1],f=r.value[2];r=i(a(t,c),a(s,f));var h=i(a(t,p),a(u,f));return c=i(a(o,f),a(e,c)),p=i(a(l,f),a(e,p)),[i(a(o,r),a(l,h)),n(a(l,r),a(o,h)),a(e,r),a(e,h),i(a(s,c),a(u,p)),n(a(u,c),a(s,p)),a(t,c),a(t,p)]},qn.TrMoebius={},qn.TrMoebius.kind="Mt",qn.TrMoebius.signature="PPPPPP".split(""),qn.TrMoebius.updatePosition=function(e){var t=yr.neg,r=qn._helper.moebiusStep(It.csnames[e.args[0]].homog,It.csnames[e.args[2]].homog,It.csnames[e.args[4]].homog),n=qn._helper.moebiusStep(It.csnames[e.args[1]].homog,It.csnames[e.args[3]].homog,It.csnames[e.args[5]].homog);n=wr.normalizeMax(wr.matrix([[n[0],t(n[1]),n[4],t(n[5])],[n[1],n[0],n[5],n[4]],[n[2],t(n[3]),n[6],t(n[7])],[n[3],n[2],n[7],n[6]]])),t=wr.normalizeMax(wr.matrix([[r[6],t(r[4])],[r[7],t(r[5])],[t(r[2]),r[0]],[t(r[3]),r[1]]])),t=wr.normalizeMax(wr.productMM(n,t)),e.moebius={anti:!1,ar:t.value[0].value[0],ai:t.value[1].value[0],br:t.value[0].value[1],bi:t.value[1].value[1],cr:t.value[2].value[0],ci:t.value[3].value[0],dr:t.value[2].value[1],di:t.value[3].value[1]},qn._helper.moebiusPair(e)},qn._helper.moebiusPair=function(e){var t=e.moebius,r=yr.neg,n=t.anti?r:Tr.identity;t=wr.normalizeMax(wr.turnIntoCSList([wr.matrix([[r(t.cr),n(t.ci),r(t.dr)],[t.ci,n(t.cr),t.di],[t.ar,r(n(t.ai)),t.br]]),wr.matrix([[r(t.ci),r(n(t.cr)),r(t.di)],[r(t.cr),n(t.ci),r(t.dr)],[t.ai,n(t.ar),t.bi]])])),e.mat1=t.value[0],e.mat2=t.value[1]},qn._helper.inverseMoebius=function(e){var t=yr.neg,r=e.anti?t:Tr.identity;return{anti:e.anti,ar:e.dr,ai:r(e.di),br:t(e.br),bi:t(r(e.bi)),cr:t(e.cr),ci:t(r(e.ci)),dr:e.ar,di:r(e.ai)}},qn.TrInverseMoebius={},qn.TrInverseMoebius.kind="Mt",qn.TrInverseMoebius.signature=["Mt"],qn.TrInverseMoebius.updatePosition=function(e){e.moebius=qn._helper.inverseMoebius(It.csnames[e.args[0]].moebius),qn._helper.moebiusPair(e)},qn.TrMoebiusP={},qn.TrMoebiusP.kind="P",qn.TrMoebiusP.signature=["Mt","P"],qn.TrMoebiusP.updatePosition=function(e){var t=It.csnames[e.args[0]],r=It.csnames[e.args[1]].homog,n=wr.productMV(t.mat1,r);t=wr.productMV(t.mat2,r),e.homog=wr.normalizeMax(wr.cross(n,t)),e.homog=Tr.withUsage(e.homog,"Point")},qn._helper.TrMoebiusP=function(e,t){var r=wr.productMV(t.mat1,e);return e=wr.productMV(t.mat2,e),wr.normalizeMax(wr.cross(r,e))},qn.TrMoebiusL={},qn.TrMoebiusL.kind="C",qn.TrMoebiusL.signature=["Mt","L"],qn.TrMoebiusL.updatePosition=function(e){var t=It.csnames[e.args[0]],r=It.csnames[e.args[1]].homog,n=function(){var e=wr.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return wr.normalizeMax(e)},i=wr.cross(n(),r),a=wr.cross(n(),r);r=wr.cross(n(),r),i=qn._helper.TrMoebiusP(i,t),a=qn._helper.TrMoebiusP(a,t),t=qn._helper.TrMoebiusP(r,t),e.matrix=wr.normalizeMax(qn._helper.ConicBy5(null,i,a,t,wr.ii,wr.jj)),e.matrix=Tr.withUsage(e.matrix,"Circle")},qn.TrMoebiusS={},qn.TrMoebiusS.kind="C",qn.TrMoebiusS.signature=["Mt","S"],qn.TrMoebiusS.updatePosition=function(e){var t=It.csnames[e.args[0]],r=It.csnames[e.args[1]],n=r.startpos;r=r.endpos;var i=wr.add(n,r);n=qn._helper.TrMoebiusP(n,t),i=qn._helper.TrMoebiusP(i,t),t=qn._helper.TrMoebiusP(r,t),e.startPoint=n,e.viaPoint=i,e.endPoint=t,e.isArc=!0,e.matrix=wr.normalizeMax(qn._helper.ConicBy5(null,n,i,t,wr.ii,wr.jj)),e.matrix=Tr.withUsage(e.matrix,"Circle")},qn.TrMoebiusC={},qn.TrMoebiusC.kind="C",qn.TrMoebiusC.signature=["Mt","C"],qn.TrMoebiusC.signatureConstraints=function(e){return"Circle"===It.csnames[e.args[1]].matrix.usage},qn.TrMoebiusC.updatePosition=function(e){var t=It.csnames[e.args[0]],r=It.csnames[e.args[1]].matrix,n=function(){var e=wr.realVector([Math.random()-.5,Math.random()-.5,Math.random()-.5]);return wr.normalizeMax(e)},i=qn._helper.IntersectLC(n(),r);n=qn._helper.IntersectLC(n(),r),r=i[1],n=n[1],i=qn._helper.TrMoebiusP(i[0],t),r=qn._helper.TrMoebiusP(r,t),t=qn._helper.TrMoebiusP(n,t),e.matrix=wr.normalizeMax(qn._helper.ConicBy5(null,i,r,t,wr.ii,wr.jj)),e.matrix=Tr.withUsage(e.matrix,"Circle")},qn.TrMoebiusArc={},qn.TrMoebiusArc.kind="C",qn.TrMoebiusArc.signature=["Mt","C"],qn.TrMoebiusArc.signatureConstraints=function(e){return It.csnames[e.args[1]].isArc},qn.TrMoebiusArc.updatePosition=function(e){var t=It.csnames[e.args[0]],r=It.csnames[e.args[1]],n=r.viaPoint,i=r.endPoint;r=qn._helper.TrMoebiusP(r.startPoint,t),n=qn._helper.TrMoebiusP(n,t),t=qn._helper.TrMoebiusP(i,t),e.startPoint=r,e.viaPoint=n,e.endPoint=t,e.isArc=!0,e.matrix=wr.normalizeMax(qn._helper.ConicBy5(null,r,n,t,wr.ii,wr.jj)),e.matrix=Tr.withUsage(e.matrix,"Circle")},qn._helper.trBuildMatrix=function(e,t){var r=t(0);t=t(1);var n=wr.productMM(t,wr.adjoint3(r));e.matrix=wr.normalizeMax(n),n=wr.transpose(wr.productMM(r,wr.adjoint3(t))),e.dualMatrix=wr.normalizeMax(n)},qn.TrProjection={},qn.TrProjection.kind="Tr",qn.TrProjection.signature="PPPPPPPP".split(""),qn.TrProjection.initialize=function(e){e.isEuclidean=0},qn.TrProjection.updatePosition=function(e){qn._helper.trBuildMatrix(e,(function(t){return Er.basismap(It.csnames[e.args[0+t]].homog,It.csnames[e.args[2+t]].homog,It.csnames[e.args[4+t]].homog,It.csnames[e.args[6+t]].homog)}))},qn.TrAffine={},qn.TrAffine.kind="Tr",qn.TrAffine.signature="PPPPPP".split(""),qn.TrAffine.initialize=function(e){e.isEuclidean=0},qn.TrAffine.updatePosition=function(e){var t=yr.mult,r=wr.scalmult,n=wr.turnIntoCSList,i=wr.transpose,a=wr.normalizeMax,o=wr.productMM,l=wr.adjoint3,s=n([It.csnames[e.args[0]].homog,It.csnames[e.args[2]].homog,It.csnames[e.args[4]].homog]),u=n([It.csnames[e.args[1]].homog,It.csnames[e.args[3]].homog,It.csnames[e.args[5]].homog]),c=i(s);i=i(u);var p=c.value[2].value,f=i.value[2].value,h=[t(p[0],f[2]),t(p[1],f[0]),t(p[2],f[1])];c=l(c).value,e.matrix=a(o(i,n([r(t(h[0],f[1]),c[0]),r(t(h[1],f[2]),c[1]),r(t(h[2],f[0]),c[2])]))),c=s.value,e.dualMatrix=a(o(l(u),n([r(t(p[2],h[1]),c[0]),r(t(p[0],h[2]),c[1]),r(t(p[1],h[0]),c[2])])))},qn.TrSimilarity={},qn.TrSimilarity.kind="Tr",qn.TrSimilarity.signature=["P","P","P","P"],qn.TrSimilarity.initialize=function(e){e.isEuclidean=1},qn.TrSimilarity.updatePosition=function(e){qn._helper.trBuildMatrix(e,(function(t){return Er.basismap(It.csnames[e.args[0+t]].homog,It.csnames[e.args[2+t]].homog,wr.ii,wr.jj)}))},qn.TrTranslation={},qn.TrTranslation.kind="Tr",qn.TrTranslation.signature=["P","P"],qn.TrTranslation.initialize=function(e){e.isEuclidean=1},qn.TrTranslation.updatePosition=function(e){var t=It.csnames[e.args[0]].homog,r=It.csnames[e.args[1]].homog,n=wr.cross(t,r).value;t=yr.mult(t.value[2],r.value[2]),r=wr.turnIntoCSList;var i=yr.neg,a=yr.zero;n=r([r([t,a,n[1]]),r([a,t,i(n[0])]),r([a,a,t])]),n=wr.normalizeMax(n),e.matrix=n,n=r([r([t=i(n.value[0].value[0]),a,a]),r([a,t,a]),r([n.value[0].value[2],n.value[1].value[2],t])]),e.dualMatrix=n},qn.TrRotationPNumb={},qn.TrRotationPNumb.kind="Tr",qn.TrRotationPNumb.signature=["P","V"],qn.TrRotationPNumb.updatePosition=function(e){var t=It.csnames[e.args[0]].homog.value,r=It.csnames[e.args[1]].value,n=yr.mult,i=yr.add,a=yr.sub,o=wr.turnIntoCSList,l=wr.normalizeMax,s=yr.zero,u=t[0],c=t[1];t=t[2];var p=yr.cos(r),f=yr.sin(r),h=a(yr.real(1),p);r=n(h,u),h=n(h,c),u=n(f,u),c=n(f,c),p=n(p,t),n=n(f,t),f=yr.neg(n),e.matrix=l(o([o([p,f,i(r,c)]),o([n,p,a(h,u)]),o([s,s,t])])),e.dualMatrix=l(o([o([p,f,s]),o([n,p,s]),o([a(r,c),i(h,u),t])]))},qn.TrReflectionP={},qn.TrReflectionP.kind="Tr",qn.TrReflectionP.signature=["P"],qn.TrReflectionP.initialize=function(e){e.isEuclidean=1},qn.TrReflectionP.updatePosition=function(e){var t=It.csnames[e.args[0]].homog.value,r=yr.realmult(-.5,t[2]),n=yr.zero;t=wr.turnIntoCSList([wr.turnIntoCSList([r,n,t[0]]),wr.turnIntoCSList([n,r,t[1]]),wr.turnIntoCSList([n,n,yr.neg(r)])]),t=wr.normalizeMax(t),e.matrix=t,e.dualMatrix=wr.transpose(t)},qn.TrReflectionL={},qn.TrReflectionL.kind="Tr",qn.TrReflectionL.signature=["L"],qn.TrReflectionL.initialize=function(e){e.isEuclidean=-1},qn.TrReflectionL.updatePosition=function(e){var t=yr.mult,r=yr.realmult,n=yr.zero,i=It.csnames[e.args[0]].homog.value,a=i[0],o=i[1];i=i[2];var l=t(a,a),s=t(o,o),u=r(-.5,yr.sub(l,s)),c=t(a,o);t=wr.turnIntoCSList([wr.turnIntoCSList([yr.neg(u),c,t(a,i)]),wr.turnIntoCSList([c,u,t(o,i)]),wr.turnIntoCSList([n,n,r(-.5,yr.add(l,s))])]),t=wr.normalizeMax(t),e.matrix=t,e.dualMatrix=wr.transpose(t)},qn.TrReflectionS={},qn.TrReflectionS.kind="Tr",qn.TrReflectionS.signature=["S"],qn.TrReflectionS.updatePosition=qn.TrReflectionL.updatePosition,qn.TrReflectionC={},qn.TrReflectionC.kind="Mt",qn.TrReflectionC.signature=["C"],qn.TrReflectionC.signatureConstraints=function(e){return"Circle"===It.csnames[e.args[0]].matrix.usage},qn.TrReflectionC.updatePosition=function(e){var t=It.csnames[e.args[0]].matrix,r=t.value[0].value[2],n=t.value[1].value[2],i=yr.neg;e.moebius={anti:!0,ar:r,ai:n,br:t.value[2].value[2],bi:yr.zero,cr:i(t.value[0].value[0]),ci:yr.zero,dr:i(r),di:n},qn._helper.moebiusPair(e)},qn.TrInverse={},qn.TrInverse.kind="Tr",qn.TrInverse.signature=["Tr"],qn.TrInverse.initialize=function(e){e.isEuclidean=It.csnames[e.args[0]].isEuclidean},qn.TrInverse.updatePosition=function(e){var t=It.csnames[e.args[0]];e.dualMatrix=wr.transpose(t.matrix),e.matrix=wr.transpose(t.dualMatrix)},qn.TransformC={},qn.TransformC.kind="C",qn.TransformC.signature=["Tr","C"],qn.TransformC.updatePosition=function(e){var t=It.csnames[e.args[0]].dualMatrix;t=wr.productMM(wr.productMM(t,It.csnames[e.args[1]].matrix),wr.transpose(t)),t=wr.normalizeMax(t),e.matrix=Tr.withUsage(t,"Conic")},qn.TransformArc={},qn.TransformArc.kind="C",qn.TransformArc.signature=["Tr","C"],qn.TransformArc.signatureConstraints=function(e){return It.csnames[e.args[0]].isArc},qn.TransformArc.updatePosition=function(e){var t=It.csnames[e.args[0]].matrix,r=It.csnames[e.args[1]],n=r.viaPoint,i=r.endPoint;r=wr.normalizeMax(wr.productMV(t,r.startPoint)),n=wr.normalizeMax(wr.productMV(t,n)),t=wr.normalizeMax(wr.productMV(t,i)),e.startPoint=r,e.viaPoint=n,e.endPoint=t,e.isArc=!0,e.matrix=wr.normalizeMax(qn._helper.ConicBy5(null,r,n,t,wr.ii,wr.jj)),e.matrix=Tr.withUsage(e.matrix,"Circle")},qn.TransformP={},qn.TransformP.kind="P",qn.TransformP.signature=["Tr","P"],qn.TransformP.updatePosition=function(e){e.homog=wr.normalizeMax(wr.productMV(It.csnames[e.args[0]].matrix,It.csnames[e.args[1]].homog)),e.homog=Tr.withUsage(e.homog,"Point")},qn.TransformL={},qn.TransformL.kind="L",qn.TransformL.signature=["Tr","L"],qn.TransformL.updatePosition=function(e){e.homog=wr.normalizeMax(wr.productMV(It.csnames[e.args[0]].dualMatrix,It.csnames[e.args[1]].homog)),e.homog=Tr.withUsage(e.homog,"Line")},qn.TransformS={},qn.TransformS.kind="S",qn.TransformS.signature=["Tr","S"],qn.TransformS.updatePosition=function(e){var t=It.csnames[e.args[0]],r=It.csnames[e.args[1]];qn.Segment.setSegmentPos(e,wr.productMV(t.dualMatrix,r.homog),wr.productMV(t.matrix,r.startpos),wr.productMV(t.matrix,r.endpos))},qn.TransformPolygon={},qn.TransformPolygon.kind="Poly",qn.TransformPolygon.signature=["Tr","Poly"],qn.TransformPolygon.updatePosition=function(e){var t=It.csnames[e.args[0]].matrix;e.vertices=wr.turnIntoCSList(It.csnames[e.args[1]].vertices.value.map((function(e){return e=wr.normalizeMax(wr.productMV(t,e)),Tr.withUsage(e,"Point")})))},qn.TrComposeTrTr={},qn.TrComposeTrTr.kind="Tr",qn.TrComposeTrTr.signature=["Tr","Tr"],qn.TrComposeTrTr.initialize=function(e){e.isEuclidean=It.csnames[e.args[0]].isEuclidean*It.csnames[e.args[1]].isEuclidean},qn.TrComposeTrTr.updatePosition=function(e){var t=It.csnames[e.args[0]],r=It.csnames[e.args[1]];e.matrix=wr.normalizeMax(wr.productMM(r.matrix,t.matrix)),e.dualMatrix=wr.normalizeMax(wr.productMM(r.dualMatrix,t.dualMatrix))},qn._helper.composeMtMt=function(e,t,r){function n(e,t,r,n){return o(s(e,t),s(r,n))}function i(e,t,r,i,a,l,s,u){return o(n(e,t,r,i),n(a,l,s,u))}function a(e,t,r,i,a,o,s,u){return l(n(e,t,r,i),n(a,o,s,u))}var o=yr.add,l=yr.sub,s=yr.mult,u=r.anti?a:i,c=r.anti?i:a;u=wr.normalizeMax(wr.turnIntoCSList([c(t.ar,r.ar,t.cr,r.br,t.ai,r.ai,t.ci,r.bi),u(t.ar,r.ai,t.cr,r.bi,t.ai,r.ar,t.ci,r.br),c(t.br,r.ar,t.dr,r.br,t.bi,r.ai,t.di,r.bi),u(t.br,r.ai,t.dr,r.bi,t.bi,r.ar,t.di,r.br),c(t.ar,r.cr,t.cr,r.dr,t.ai,r.ci,t.ci,r.di),u(t.ar,r.ci,t.cr,r.di,t.ai,r.cr,t.ci,r.dr),c(t.br,r.cr,t.dr,r.dr,t.bi,r.ci,t.di,r.di),u(t.br,r.ci,t.dr,r.di,t.bi,r.cr,t.di,r.dr)])).value,e.moebius={anti:t.anti!==r.anti,ar:u[0],ai:u[1],br:u[2],bi:u[3],cr:u[4],ci:u[5],dr:u[6],di:u[7]},qn._helper.moebiusPair(e)},qn._helper.euc2moeb=function(e){var t=e.matrix.value;return{anti:0>e.isEuclidean,ar:t[0].value[0],ai:t[1].value[0],br:t[0].value[2],bi:t[1].value[2],cr:yr.zero,ci:yr.zero,dr:t[2].value[2],di:yr.zero}},qn.TrComposeMtMt={},qn.TrComposeMtMt.kind="Mt",qn.TrComposeMtMt.signature=["Mt","Mt"],qn.TrComposeMtMt.updatePosition=function(e){qn._helper.composeMtMt(e,It.csnames[e.args[0]].moebius,It.csnames[e.args[1]].moebius)},qn.TrComposeTrMt={},qn.TrComposeTrMt.kind="Mt",qn.TrComposeTrMt.signature=["Tr","Mt"],qn.TrComposeTrMt.signatureConstraints=function(e){return!!It.csnames[e.args[0]].isEuclidean},qn.TrComposeTrMt.updatePosition=function(e){qn._helper.composeMtMt(e,qn._helper.euc2moeb(It.csnames[e.args[0]]),It.csnames[e.args[1]].moebius)},qn.TrComposeMtTr={},qn.TrComposeMtTr.kind="Mt",qn.TrComposeMtTr.signature=["Mt","Tr"],qn.TrComposeMtTr.signatureConstraints=function(e){return!!It.csnames[e.args[1]].isEuclidean},qn.TrComposeMtTr.updatePosition=function(e){qn._helper.composeMtMt(e,It.csnames[e.args[0]].moebius,qn._helper.euc2moeb(It.csnames[e.args[1]]))},qn._helper.pointReflection=function(e,t){return wr.normalizeMax(wr.sub(wr.scalmult(yr.realmult(2,t.value[2]),e),wr.scalmult(e.value[2],t)))},qn._helper.conicOtherIntersection=function(e,t,r){var n=wr.productMV(e,r);return e=wr.scalproduct(r,n),n=wr.scalproduct(t,n),n=yr.realmult(-2,n),t=wr.scalmult(e,t),r=wr.scalmult(n,r),r=wr.add(t,r),wr.normalizeMax(r)},qn.Dist={},qn.Dist.kind="V",qn.Dist.signature=["P","P"],qn.Dist.updatePosition=function(e){var t=It.csnames[e.args[1]].homog;e.value=wr.abs(wr.sub(wr.normalizeZ(It.csnames[e.args[0]].homog),wr.normalizeZ(t)))},qn.Angle={},qn.Angle.kind="V",qn.Angle.signature=["L","L","P"],qn.Angle.initialize=function(e){void 0===e.angle&&(e.angle=.5*Math.PI),rt(yr._helper.input(e.angle))},qn.Angle.updatePosition=function(e){var t=It.csnames[e.args[1]].homog,r=It.csnames[e.args[2]].homog,n=wr.cross(It.csnames[e.args[0]].homog,wr.linfty);t=wr.cross(t,wr.linfty),r=wr.crossratio3(n,t,wr.ii,wr.jj,r),r=yr.mult(yr.complex(0,.5),yr.log(r)),n=(et().value.real-r.value.real)/Math.PI,t=Math.round(n),!An&&.01<Math.abs(t-n)&&Ge(),rt(r=yr.complex(t*Math.PI+r.value.real,r.value.imag)),e.value=Tr.withUsage(r,"Angle")},qn.Angle.stateSize=2,qn.Text={},qn.Text.kind="Text",qn.Text.signature="**",qn.Text.isMovable=!0,qn.Text.updatePosition=gt,qn.Text.initialize=function(e){e.text=String(e.text),e.pos&&(e.homog=qn._helper.initializePoint(e)),e.dock&&(e.dock.offset=e.dock.offset&&2===e.dock.offset.length?wr.realVector([+e.dock.offset[0],+e.dock.offset[1]]):wr.realVector([0,0]))},qn.Text.getParamForInput=function(e,t,r){return qn.Free.getParamForInput(e,t,r)},qn.Text.getParamFromState=function(e){return e.homog},qn.Text.putParamToState=function(e,t){e.homog=t},qn.Calculation={},qn.Calculation.kind="Text",qn.Calculation.signature="**",qn.Calculation.isMovable=!0,qn.Calculation.updatePosition=gt,qn.Calculation.initialize=function(e){qn.Text.initialize(e),e.calculation=fe(e.text)},qn.Calculation.getText=function(e){return E(ue(e.calculation))},qn.Calculation.getParamForInput=qn.Text.getParamForInput,qn.Calculation.getParamFromState=qn.Text.getParamFromState,qn.Calculation.putParamToState=qn.Text.putParamToState,qn.Equation={},qn.Equation.kind="Text",qn.Equation.isMovable=!0,qn.Equation.signature="**",qn.Equation.updatePosition=gt,qn.Equation.initialize=function(e){qn.Text.initialize(e),e.calculation=fe(e.text)},qn.Equation.getText=function(e){return e.text+" = "+E(ue(e.calculation))},qn.Equation.getParamForInput=qn.Text.getParamForInput,qn.Equation.getParamFromState=qn.Text.getParamFromState,qn.Equation.putParamToState=qn.Text.putParamToState,qn.Evaluate={},qn.Evaluate.kind="Text",qn.Evaluate.isMovable=!0,qn.Evaluate.signature="**",qn.Evaluate.updatePosition=gt,qn.Evaluate.initialize=function(e){qn.Text.initialize(e),e.calculation=fe(e.text)},qn.Evaluate.getText=function(e){return ue(e.calculation),e.text},qn.Evaluate.getParamForInput=qn.Text.getParamForInput,qn.Evaluate.getParamFromState=qn.Text.getParamFromState,qn.Evaluate.putParamToState=qn.Text.putParamToState,qn.Plot={},qn.Plot.kind="Text",qn.Plot.isMovable=!0,qn.Plot.signature="**",qn.Plot.updatePosition=gt,qn.Plot.initialize=function(e){qn.Text.initialize(e),e.calculation=fe("plot(("+e.text+"))")},qn.Plot.getText=function(e){return ue(e.calculation),e.text},qn.Plot.getParamForInput=qn.Text.getParamForInput,qn.Plot.getParamFromState=qn.Text.getParamFromState,qn.Plot.putParamToState=qn.Text.putParamToState,qn.Button={},qn.Button.kind="Text",qn.Button.signature="**",qn.Button.isMovable=!0,qn.Button.updatePosition=gt,qn.Button.initialize=function(e){mt(e,"click",document.createElement("button"))},qn.Button.getParamForInput=qn.Text.getParamForInput,qn.Button.getParamFromState=qn.Text.getParamFromState,qn.Button.putParamToState=qn.Text.putParamToState,qn.Button.set_fillcolor=function(e,t){wr._helper.isNumberVecN(t,3)&&(e.fillcolor=t.value.map((function(e){return e.value.real})),e.html.style.backgroundColor=pn.makeColor(e.fillcolor,e.fillalpha))},qn.Button.set_color=function(e,t){wr._helper.isNumberVecN(t,3)&&(e.color=t.value.map((function(e){return e.value.real})),e.html.style.color=pn.makeColor(e.color,e.alpha))},qn.ToggleButton={},qn.ToggleButton.kind="Text",qn.ToggleButton.signature="**",qn.ToggleButton.isMovable=!0,qn.ToggleButton.updatePosition=gt,qn.ToggleButton.initialize=function(e){var t=void 0;void 0===t&&(t="CindyJSid"),t+=++s;var r=document.createElement("input"),n=document.createElement("label");r.setAttribute("id",t),n.setAttribute("for",t),r.setAttribute("type","checkbox"),e.pressed&&(r.checked=!0),e.checkbox=r,mt(e,"change",r,n)},qn.ToggleButton.get_text=function(e){return Tr.string(String(e.text))},qn.ToggleButton.set_currenttext=function(e,t){e.html.value=e.text=E(t)},qn.ToggleButton.getParamForInput=qn.Text.getParamForInput,qn.ToggleButton.getParamFromState=qn.Text.getParamFromState,qn.ToggleButton.putParamToState=qn.Text.putParamToState,qn.ToggleButton.set_fillcolor=qn.Button.set_fillcolor,qn.ToggleButton.set_color=qn.Button.set_color,qn.ToggleButton.set_text=qn.ToggleButton.set_currenttext,qn.ToggleButton.get_val=qn.ToggleButton.get_text,qn.ToggleButton.set_val=qn.ToggleButton.set_currenttext,qn.EditableText={},qn.EditableText.kind="Text",qn.EditableText.isMovable=!0,qn.EditableText.signature=[],qn.EditableText.updatePosition=gt,qn.EditableText.initialize=function(e){var t=document.createElement("input");t.setAttribute("type","text"),t.className="CindyJS-editabletext",Ht(e.minwidth)&&(t.style.width=e.minwidth-3+"px"),"string"==typeof e.text&&(t.value=e.text),t.addEventListener("keydown",(function(r){13===r.keyCode&&(e.text=e.html.value,t.blur())})),t.addEventListener("change",(function(t){e.text=e.html.value})),mt(e,"change",t)},qn.EditableText.getText=function(e){return!1},qn.EditableText.getParamForInput=qn.Text.getParamForInput,qn.EditableText.getParamFromState=qn.Text.getParamFromState,qn.EditableText.putParamToState=qn.Text.putParamToState,qn.EditableText.set_fillcolor=qn.Button.set_fillcolor,qn.EditableText.set_color=qn.Button.set_color,qn.EditableText.get_currenttext=function(e){return Tr.string(String(e.html.value))},qn.EditableText.get_text=qn.ToggleButton.get_text,qn.EditableText.set_currenttext=qn.ToggleButton.set_currenttext,qn.EditableText.set_text=qn.EditableText.set_currenttext,qn.EditableText.get_val=qn.EditableText.get_text,qn.EditableText.set_val=qn.EditableText.set_currenttext,qn._helper.initializePoint=function(e){var t=0,r=0,n=0;if(e.pos){if("list"===e.pos.ctype&&wr.isNumberVector(e.pos))return e.pos;2===e.pos.length&&(t=e.pos[0],r=e.pos[1],n=1),3===e.pos.length&&(t=e.pos[0],r=e.pos[1],n=e.pos[2])}return e=wr.turnIntoCSList([yr._helper.input(t),yr._helper.input(r),yr._helper.input(n)]),wr.normalizeMax(e)},qn._helper.initializeLine=function(e){var t=0,r=0,n=0;if(e.pos){if("list"===e.pos.ctype&&wr.isNumberVector(e.pos))return e.pos;3===e.pos.length&&(t=e.pos[0],r=e.pos[1],n=e.pos[2])}return e=wr.turnIntoCSList([yr._helper.input(t),yr._helper.input(r),yr._helper.input(n)]),wr.normalizeMax(e)},qn.Poly={},qn.Poly.kind="Poly",qn.Poly.signature="P*",qn.Poly.updatePosition=function(e){e.vertices=wr.turnIntoCSList(e.args.map((function(e){return It.csnames[e].homog})))};var Vn=null;qn.IFS={},qn.IFS.kind="IFS",qn.IFS.signature="**",qn.IFS.signatureConstraints=function(e){for(var t=0;t<e.args.length;++t){var r=It.csnames[e.args[t]].kind;if("Tr"!==r&&"Mt"!==r)return!1}return 0<e.args.length},qn.IFS.initialize=function(e){if(Vn)Vn.dirty=!0;else if(!1!==(e=Ot.getBaseDir())){var t=(Vn={dirty:!1,params:{generation:0}}).worker=new Worker(e+"ifs.js");t.onmessage=function(e){if(Vn.img&&"function"==typeof Vn.img.close&&Vn.img.close(),!ir){if((e=e.data).generation===Vn.params.generation){if(e.buffer){Vn.canvas||(Vn.canvas=document.createElement("canvas"),Vn.ctx=Vn.canvas.getContext("2d")),Vn.canvas.width=e.width,Vn.canvas.height=e.height;var r=new Uint8ClampedArray(e.buffer,e.imgPtr,e.width*e.height*4);r=new ImageData(r,e.width,e.height),Vn.ctx.putImageData(r,0,0),Vn.img=Vn.canvas}else Vn.img=e.img;_()}else Vn.img=null;e.buffer?t.postMessage({cmd:"next",buffer:e.buffer},[e.buffer]):t.postMessage({cmd:"next"})}},nr.push(t.terminate.bind(t))}},qn.IFS.updatePosition=function(e){Vn.dirty=!0},qn.IFS.updateParameters=function(){if(Vn.worker){var e={cmd:"init",generation:Vn.params.generation,width:Math.round(4*Mt),height:Math.round(4*Tt)};e.systems=It.ifs.map((function(e){var t,r=0,n=e.ifs||[],i=e.args.map((function(e,t){return{prob:(e=n[t]||{}).prob||1,color:e.color||[0,0,0]}}));for(t=0;t<i.length;++t)r+=i[t].prob;t=wr.realMatrix([[1,0,0],[0,1,0],[0,0,4]]);var a=wr.productMM(wn.toMat(),t);for(t=0;t<e.args.length;++t){var o=It.csnames[e.args[t]],l=o.kind,s=i[t];if(s.kind=l,s.prob/=r,"Tr"===l)o=wr.normalizeMax(wr.productMM(wr.adjoint3(a),wr.productMM(o.matrix,a))),wr._helper.isAlmostReal(o)?s.mat=o.value.map((function(e){return e.value.map((function(e){return e.value.real}))})):s.kind="cplx";else if("Mt"===l){l={anti:0<(l=wn.drawingstate.matrix).det,ar:yr.real(l.a),ai:yr.real(l.c),br:yr.real(l.tx),bi:yr.real(-l.ty),cr:yr.zero,ci:yr.zero,dr:yr.real(.25),di:yr.zero};var u={};qn._helper.composeMtMt(u,o.moebius,l),l=qn._helper.inverseMoebius(l),qn._helper.composeMtMt(u,l,u.moebius),l=u.moebius,l=wr.turnIntoCSList([l.ar,l.ai,l.br,l.bi,l.cr,l.ci,l.dr,l.di]),wr._helper.isAlmostReal(l)?(l=l.value,s.moebius={ar:l[0].value.real,ai:l[1].value.real,br:l[2].value.real,bi:l[3].value.real,cr:l[4].value.real,ci:l[5].value.real,dr:l[6].value.real,di:l[7].value.real,sign:o.moebius.anti?-1:1}):s.kind="cplx"}}return{trafos:i}})),Tr.deeplyEqual(e,Vn.params)||(++e.generation,Vn.img=null,Vn.params=e,Vn.mat=wn.drawingstate.matrix,Vn.worker.postMessage(e))}},qn.IFS.probSetter=function(e,t,r){"number"===r.ctype&&(t.ifs[e].prob=r.value.real,Vn.dirty=!0)},function(){for(var e=0;10>e;++e)qn.IFS["set_prob"+e]=qn.IFS.probSetter.bind(null,e)}(),qn._helper.snapPointToLine=function(e,t){if(yr._helper.isAlmostZero(e.value[2]))return e;var r=qn._helper.projectPointToLine(e,t),n=(r=wr.normalizeZ(r)).value[0].value.real;r=r.value[1].value.real;var i=Math.round(n/Ft)*Ft,a=Math.round(r/Ft)*Ft,o=wr.realVector([i,a,1]);return Math.abs(i-n)<qt&&Math.abs(a-r)<qt&&yr._helper.isAlmostZero(wr.scalproduct(t,o))&&(e=qn._helper.projectPointToLine(o,t)),e};var Un={CircleByRadius:"CircleMr",IntersectionCircleCircle:"IntersectCirCir",IntersectionConicConic:"IntersectConicConic",FreePoint:"Free",Orthogonal:"Perp",Parallel:"Para",Pole:"PolarOfLine",Polar:"PolarOfPoint",Arc:"ArcBy3",EuclideanMid:"Mid",AngularBisector:"AngleBisector",TransformConic:"TransformC",TransformSegment:"TransformS",TrMoebiusSegment:"TrMoebiusS",ReflectCC:"TrMoebiusC",ReflectCL:"TrMoebiusL",ReflectCP:"TrMoebiusP",ReflectCArc:"TrMoebiusArc",ReflectCS:"TrMoebiusS",TrMoebiusCircle:"TrMoebiusC"},Wn={CircleMFixedr:function(e){return e.pinned=!0,e.type="CircleMr",[e]},CircleByFixedRadius:function(e){return e.pinned=!0,e.type="CircleMr",[e]},IntersectionConicLine:function(e){return e.args=[e.args[1],e.args[0]],e.type="IntersectLC",[e]},angleBisector:function(e){var t={name:e.name+"_Intersection",type:"Meet",args:e.args,visible:!1};return e.type="AngleBisector",e.args=[e.args[0],e.args[1],t.name],[t,e]},Transform:function(e){var t=It.csnames[e.args[1]];return t={Tr:"Transform",Mt:"TrMoebius"}[It.csnames[e.args[0]].kind]+(t.isArc?"Arc":t.kind),qn.hasOwnProperty(t)?(e.type=t,[e]):(console.log(t+" not implemented yet"),[])},TrReflection:function(e){var t="TrReflection"+It.csnames[e.args[0]].kind;return qn.hasOwnProperty(t)?(e.type=t,[e]):(console.log(t+" not implemented yet"),[])},TrCompose:function(e){var t="TrCompose"+e.args.map((function(e){return It.csnames[e].kind})).join("");return qn.hasOwnProperty(t)?(e.type=t,[e]):(console.log(t+" not implemented yet"),[])}},Gn="align alpha angle args arrow arrowposition arrowshape arrowsides arrowsize clip color dashtype drawtrace fillalpha fillcolor filled labeled labelpos name overhang pinned printname radius size text text_fontfamily textbold textitalics textsize tracedim tracelength traceskip tracing type visible".split(" ");ar.saveState=function(){return{geometry:bt()}};var Hn,Jn={},Zn=[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]],Qn=[0,.2,.3,.8,8/9,1,1],Kn=[35/384,0,500/1113,125/192,-2187/6784,11/84,0],ei=[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025],ti=[],ri=[],ni=!1;Jn.tick=function(e){e/=Rt;for(var t=0;t<Rt;t++)Jn.tick1(e),kt+=e,ue(Et.simulationstep)},Jn.tick1=function(e){for(var t=e,r=0;0<e&&r<.999*e||0>e&&r>.999*e;)r+=t=Jn.oneRKStep(t),t=Math.min(2*t,e-r),t=Math.max(t,1e-16),Jn.restorePosition(),Jn.doCollisions(),Jn.calculateForces(),Jn.moveToFinalPos();return!0},Jn.restorePosition=function(){Hn.forEach((function(e){ii[e.type].restorePos(e,9)}))},Jn.doCollisions=function(){Hn.forEach((function(e){ii[e.type].doCollisions(e)}))},Jn.calculateForces=function(){Hn.forEach((function(e){ii[e.type].calculateForces(e)}))},Jn.moveToFinalPos=function(){Hn.forEach((function(e){ii[e.type].move(e)}))},Jn.oneRKStep=function(e){for(var t=function(e){Hn.forEach((function(t){ii[t.type].initRK(t,e),ii[t.type].storePosition(t)}))},r=function(e){Hn.forEach((function(t){ii[t.type].setToTimestep(t,Qn[e])}))},n=function(e){Hn.forEach((function(t){ii[t.type].proceedMotion(t,Qn[e],e,Zn[e])}))},i=function(e){Hn.forEach((function(t){ii[t.type].calculateDelta(t,e)}))},a=function(t){var r=0;return Hn.forEach((function(e){ii[e.type].proceedMotion(e,Qn[6],7,Kn),ii[e.type].savePos(e,8),ii[e.type].proceedMotion(e,Qn[6],7,ei),ii[e.type].savePos(e,9),r+=ii[e.type].sqDist(e,8,9)})),r=Math.sqrt(r)/e},o=!1;!o;){t(e);for(var l=0;7>l;l++)r(l),n(l),Hn.forEach((function(e){ii[e.type].resetForces(e)})),Jn.calculateForces(),i(l);a()>ii.env.errorbound&&e>ii.env.lowestdeltat?(e/=ii.env.slowdownfactor,Hn.forEach((function(e){ii[e.type].recallPosition(e)}))):o=!0}return e};var ii={Mass:{reset:function(e,t){e.vel=[0,0,0],e.pos=[0,0,0,0],e.el=t,void 0===e.mass&&(e.mass=1),void 0===e.charge&&(e.charge=0),void 0===e.friction&&(e.friction=0),e.lnfrict=0,void 0===e.limitspeed&&(e.limitspeed=!1),void 0===e.fixed&&(e.fixed=!1),void 0===e.radius&&(e.radius=1),e.internalmove=!1,e.fx=0,e.fy=0,e.fz=0,e.vx=e.vx||0,e.vy=e.vy||0,e.vz=e.vz||0,e.mtype=0,e.env=ii.env,e.deltat=0,e.mx=0,e.my=0,e.mz=0,e.mvx=0,e.mvy=0,e.mvz=0,e.dx=[0,0,0,0,0,0,0,0,0,0],e.dy=[0,0,0,0,0,0,0,0,0,0],e.dz=[0,0,0,0,0,0,0,0,0,0],e.dvx=[0,0,0,0,0,0,0,0,0,0],e.dvy=[0,0,0,0,0,0,0,0,0,0],e.dvz=[0,0,0,0,0,0,0,0,0,0],e.midx=0,e.midy=0,e.midz=0,e.lx=0,e.ly=0,e.lz=0},resetForces:function(e){e.fx=0,e.fy=0,e.fz=0},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){var r=Er.extractPoint(e.el.homog);e.x=r.x,e.y=r.y,e.z=0,e.xo=e.x,e.yo=e.y,e.zo=e.z,e.vxo=e.vx,e.vyo=e.vy,e.vzo=e.vz,e.deltat=t,e.fx=0,e.fy=0,e.fz=0},setVelocity:function(e,t,r,n){n||(n=0),e.vx=t,e.vy=r,e.vz=n},move:function(e){e.pos=[e.x,e.y,1],e.internalmove=!0,sr&&ur.down&&e.el===sr.mover||Je(e.el,wr.realVector(e.pos),"homog"),e.el.sx=e.x,e.el.sy=e.y,e.internalmove=!1},proceedMotion:function(e,t,r,n){if(!e.fixed)for(e.x=e.mx,e.y=e.my,e.z=e.mz,e.vx=e.mvx,e.vy=e.mvy,e.vz=e.mvz,t=0;t<r;t++)e.x+=n[t]*e.dx[t]*e.deltat,e.y+=n[t]*e.dy[t]*e.deltat,e.z+=n[t]*e.dz[t]*e.deltat,e.vx+=n[t]*e.dvx[t]*e.deltat,e.vy+=n[t]*e.dvy[t]*e.deltat,e.vz+=n[t]*e.dvz[t]*e.deltat},calculateForces:function(e){var t=Math.sqrt(e.vx*e.vx+e.vy*e.vy+e.vz*e.vz);e.lnfrict=-Math.log((1-e.friction)*(1-e.env.friction)*(.1<t&&e.limitSpeed?.1/t:1)),e.fx+=-e.vx*e.lnfrict*e.mass,e.fy+=-e.vy*e.lnfrict*e.mass,e.fz+=-e.vz*e.lnfrict*e.mass},calculateDelta:function(e,t){e.dx[t]=e.vx,e.dy[t]=e.vy,e.dz[t]=e.vz,e.dvx[t]=e.fx/e.mass,e.dvy[t]=e.fy/e.mass,e.dvz[t]=e.fz/e.mass},savePos:function(e,t){e.dx[t]=e.x,e.dy[t]=e.y,e.dz[t]=e.z,e.dvx[t]=e.vx,e.dvy[t]=e.vy,e.dvz[t]=e.vz},restorePos:function(e,t){e.fixed||(e.x=e.dx[t],e.y=e.dy[t],e.z=e.dz[t],e.vx=e.dvx[t],e.vy=e.dvy[t],e.vz=e.dvz[t])},sqDist:function(e,t,r){var n=(e.dx[t]-e.dx[r])*(e.dx[t]-e.dx[r]);return n+=(e.dy[t]-e.dy[r])*(e.dy[t]-e.dy[r]),n+=(e.dz[t]-e.dz[r])*(e.dz[t]-e.dz[r]),n+=(e.dvx[t]-e.dvx[r])*(e.dvx[t]-e.dvx[r]),(n+=(e.dvy[t]-e.dvy[r])*(e.dvy[t]-e.dvy[r]))+(e.dvz[t]-e.dvz[r])*(e.dvz[t]-e.dvz[r])},kineticEnergy:function(e){return.5*e.mass*(e.vx*e.vx+e.vy*e.vy+e.vz*e.vz)},storePosition:function(e){e.mx=e.x,e.my=e.y,e.mz=e.z,e.mvx=e.vx,e.mvy=e.vy,e.mvz=e.vz},recallPosition:function(e){e.fixed||(e.x=e.mx,e.y=e.my,e.z=e.mz,e.vx=e.mvx,e.vy=e.mvy,e.vz=e.mvz)},doCollisions:function(e){}},Sun:{reset:function(e,t){e.vel=[0,0,0],e.pos=[0,0,0,0],e.el=t,void 0===e.mass&&(e.mass=10),void 0===e.friction&&(e.friction=0),e.charge=0,e.x=0,e.y=0,e.z=0},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){t=Er.extractPoint(e.el.homog),e.x=t.x,e.y=t.y,e.z=0},setVelocity:function(e,t,r,n){},move:function(e){},proceedMotion:function(e,t,r,n){},calculateDelta:function(e,t){},calculateForces:function(e){for(var t=e.x,r=e.y,n=e.z,i=0;i<ti.length;i++){var a=ti[i],o=a.behavior.x,l=a.behavior.y,s=a.behavior.z,u=Math.sqrt((t-o)*(t-o)+(r-l)*(r-l)+(n-s)*(n-s));l=(r-l)*e.mass*a.behavior.mass/(u*u*u),s=(n-s)*e.mass*a.behavior.mass/(u*u*u),a.behavior.fx+=(t-o)*e.mass*a.behavior.mass/(u*u*u)*a.behavior.mass,a.behavior.fy+=l*a.behavior.mass,a.behavior.fz+=s*a.behavior.mass}},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){}},Velocity:{reset:function(e){var t=It.csnames[e.geo[1]];console.log(t);var r=Er.extractPoint(t.homog);e=Er.extractPoint(It.csnames[e.geo[2]].homog),t=t.behavior,ii[t.type].setVelocity(t,e.x-r.x,e.y-r.y,0)},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){},setVelocity:function(e,t,r,n){},move:function(e){var t=It.csnames[e.geo[2]];if(!sr||!ur.down||t!==sr.mover){var r=It.csnames[e.geo[1]];e=Er.extractPoint(r.homog),r=r.behavior,Je(t,e=wr.realVector([e.x+r.vx,e.y+r.vy,1]),"homog")}},proceedMotion:function(e,t,r,n){},calculateForces:function(e){},calculateDelta:function(e,t){},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){}},Gravity:{reset:function(e,t){e.vel=[0,0,0],e.pos=[0,0,0,0],e.el=t,void 0===e.strength&&(e.strength=1),e.namea=t.args[0],e.nameb=t.args[1],e.ma=It.csnames[e.namea],e.mb=It.csnames[e.nameb]},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){},setVelocity:function(e,t,r,n){},move:function(e){},proceedMotion:function(e,t,r,n){},calculateDelta:function(e,t){},calculateForces:function(e){var t=Er.extractPoint(e.ma.homog),r=Er.extractPoint(e.mb.homog),n=(r.x-t.x)*e.strength;for(e=(r.y-t.y)*e.strength,t=0;t<ti.length;t++)(r=ti[t]).behavior.fx+=n*r.behavior.mass,r.behavior.fy+=e*r.behavior.mass,r.behavior.fz+=0*r.behavior.mass},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){}},Spring:{reset:function(e,t){e.el=t,void 0===e.strength&&(e.strength=1),void 0===e.amplitude&&(e.amplitude=0),void 0===e.phase&&(e.phase=0),void 0===e.speed&&(e.speed=1),void 0===e.l0&&(e.l0=0),void 0===e.stype&&(e.stype=1),void 0===e.readOnInit&&(e.readOnInit=!1),e.namea=t.args[0],e.nameb=t.args[1],e.ma=It.csnames[e.namea],e.mb=It.csnames[e.nameb],t=Er.extractPoint(e.ma.homog);var r=Er.extractPoint(e.mb.homog);e.l0=Math.sqrt((t.x-r.x)*(t.x-r.x)+(t.y-r.y)*(t.y-r.y)),e.env=ii.env,e.ldiff=0},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){},setVelocity:function(e,t,r,n){},move:function(e){},proceedMotion:function(e,t,r,n){},calculateForces:function(e){if(!e.ma.behavior||sr&&ur.down&&e.ma===sr.mover)var t=Er.extractPoint(e.ma.homog),r=t.x,n=t.y;else r=e.ma.behavior.x,n=e.ma.behavior.y;if(!e.mb.behavior||sr&&ur.down&&e.mb===sr.mover){var i=Er.extractPoint(e.mb.homog);t=i.x,i=i.y}else t=e.mb.behavior.x,i=e.mb.behavior.y;var a=Math.sqrt((r-t)*(r-t)+(n-i)*(n-i)),o=e.l0;e.ldiff=a-o;var l=e.stype;1===l&&(o=0);var s=0;if(2!==l&&3!==l||(s=e.ma.behavior.mass*e.mb.behavior.mass*e.strength),2===l&&(s=-s),0===a||0!==l&&1!==l)if(e.ma.behavior&&e.mb.behavior&&0!==a){if(a*=a*a,2===l||3===l)var u=(r-t)*s/a,c=(n-i)*s/a}else u=c=0;else u=-(r-t)*e.strength*(a-o)/a*e.env.springstrength,c=-(n-i)*e.strength*(a-o)/a*e.env.springstrength;e.ma.behavior&&(e.ma.behavior.fx+=u,e.ma.behavior.fy+=c),e.mb.behavior&&(e.mb.behavior.fx-=u,e.mb.behavior.fy-=c)},calculateDelta:function(e,t){},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){}},det:function(e,t,r,n,i,a){return r*a-i*n+i*t-e*a+e*n-r*t},Bouncer:{reset:function(e,t){e.el=t,void 0===e.xdamp&&(e.xdamp=0),void 0===e.ydamp&&(e.ydamp=0),void 0===e.motorchanger&&(e.motorchanger=!0),e.namea=t.args[0],e.nameb=t.args[1],e.ma=It.csnames[e.namea],e.mb=It.csnames[e.nameb],t=Er.extractPoint(e.ma.homog);var r=Er.extractPoint(e.mb.homog);e.x1o=1.01*t.x-.01*r.x,e.y1o=1.01*t.y-.01*r.y,e.x2o=1.01*r.x-.01*t.x,e.y2o=1.01*r.y-.01*t.y,e.env=ii.env},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){e.deltat=t},setVelocity:function(e,t,r,n){},move:function(e){},proceedMotion:function(e,t,r,n){},calculateForces:function(e){},calculateDelta:function(e,t){},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){var t=Er.extractPoint(e.ma.homog),r=Er.extractPoint(e.mb.homog),n=t.x;t=t.y;var i=r.x;r=r.y;var a=e.x1o,o=e.y1o,l=e.x2o,s=e.y2o,u=Math.sqrt((n-i)*(n-i)+(t-r)*(t-r)),c=(n-i)/u;u=(t-r)/u;for(var p=0;p<ti.length;p++){var f=ti[p],h=f.behavior.xo,v=f.behavior.yo,d=f.behavior.x,m=f.behavior.y,g=yr.mult(yr.complex(a,o),yr.complex(i,r)),y=yr.mult(yr.complex(l,s),yr.complex(n,t));g=yr.sub(g,y),y=yr.mult(yr.complex(h,v),yr.complex(n,t)),g=yr.add(g,y),y=yr.mult(yr.complex(h,v),yr.complex(i,r)),g=yr.sub(g,y),y=yr.sub(yr.complex(a,o),yr.complex(l,s)),g=yr.div(g,y),0>ii.det(n,t,i,r,d,m)*ii.det(n,t,i,r,g.value.real,g.value.imag)&&0>ii.det(n,t,d,m,g.value.real,g.value.imag)*ii.det(i,r,d,m,g.value.real,g.value.imag)&&(h=c*(v=f.behavior.mvx+e.deltat*(-g.value.real+f.behavior.xo))+u*(d=f.behavior.mvy+e.deltat*(-g.value.imag+f.behavior.yo)),v=u*v-c*d,f.behavior.x=g.value.real,f.behavior.y=g.value.imag,f.behavior.vx=c*h*(1-e.xdamp),f.behavior.vy=u*h*(1-e.xdamp),f.behavior.vx+=-u*v*(1-e.ydamp),f.behavior.vy+=c*v*(1-e.ydamp))}e.x1o=n,e.y1o=t,e.x2o=i,e.y2o=r}},Environment:{init:function(e){void 0===e.gravity&&(e.gravity=0),void 0===e.friction&&(e.friction=0),void 0===e.springstrength&&(e.springstrength=1),void 0!==e.accuracy&&(Rt=e.accuracy),void 0!==e.deltat&&o(e.deltat/.6),void 0===e.charges&&(e.charges=!1),void 0===e.balls&&(e.balls=!1),void 0===e.newton&&(e.newton=!1),void 0===e.ballInteractionBoosting&&(e.ballInteractionBoosting=1),ii.env=e,e.errorbound=.001,e.lowestdeltat=1e-7,e.slowdownfactor=2},reset:function(e){},resetForces:function(e){},getBlock:!1,setToTimestep:function(e,t,r){},initRK:function(e,t){},setVelocity:function(e,t,r,n){},move:function(e){},proceedMotion:function(e,t,r,n){},calculateForces:function(e){var t,r;if(e.newton)for(t=0;t<ti.length-1;t++){var n=ti[t],i=n.behavior.x,a=n.behavior.y;for(r=t+1;r<ti.length;r++){var o=ti[r],l=o.behavior.x,s=o.behavior.y,u=Math.sqrt((i-l)*(i-l)+(a-s)*(a-s));l=(i-l)*n.behavior.mass*o.behavior.mass/(u*u*u),s=(a-s)*n.behavior.mass*o.behavior.mass/(u*u*u),n.behavior.fx-=l,n.behavior.fy-=s,o.behavior.fx+=l,o.behavior.fy+=s}}if(e.charges)for(t=0;t<ti.length-1;t++)for(i=(n=ti[t]).behavior.x,a=n.behavior.y,r=t+1;r<ti.length;r++)l=(o=ti[r]).behavior.x,s=o.behavior.y,u=Math.sqrt((i-l)*(i-l)+(a-s)*(a-s)),l=(i-l)*n.behavior.charge*o.behavior.charge/(u*u*u),s=(a-s)*n.behavior.charge*o.behavior.charge/(u*u*u),n.behavior.fx+=l,n.behavior.fy+=s,o.behavior.fx-=l,o.behavior.fy-=s;if(e.balls)for(t=0;t<ti.length-1;t++)if(0!==(n=ti[t]).behavior.radius)for(i=n.behavior.x,a=n.behavior.y,r=t+1;r<ti.length;r++)if(0!==(o=ti[r]).behavior.radius){l=o.behavior.x,s=o.behavior.y;var c=n.behavior.radius+o.behavior.radius;u=Math.sqrt((i-l)*(i-l)+(a-s)*(a-s)),0===e.ballInteractionBoosting?(l=(i-l)/(u*u*u)*(u>c?0:(u-c)*(u-c)),s=(a-s)/(u*u*u)*(u>c?0:(u-c)*(u-c))):1===e.ballInteractionBoosting?(l=(i-l)/(u*u*u*u)*(u>c?0:(u-c)*(u-c)),s=(a-s)/(u*u*u*u)*(u>c?0:(u-c)*(u-c))):(l=(i-l)/(u*u*u*u*u)*(u>c?0:(u-c)*(u-c)),s=(a-s)/(u*u*u*u*u)*(u>c?0:(u-c)*(u-c))),n.behavior.fx+=l,n.behavior.fy+=s,o.behavior.fx-=l,o.behavior.fy-=s}for(t=0;t<ti.length;t++)(n=ti[t]).behavior.fx+=0,n.behavior.fy+=-e.gravity*n.behavior.mass,n.behavior.fz+=0},calculateDelta:function(e,t){},savePos:function(e,t){},restorePos:function(e,t){},sqDist:function(e,t,r){return 0},kineticEnergy:function(e){},storePosition:function(e){},recallPosition:function(e){},doCollisions:function(e){}}};return ar},t}(),createCindy=CindyJS;"undefined"!=typeof process&&"undefined"!=typeof module&&void 0!==module.exports&&"undefined"==typeof window&&(module.exports=CindyJS);
//# sourceMappingURL=index.650eb9fe.js.map
